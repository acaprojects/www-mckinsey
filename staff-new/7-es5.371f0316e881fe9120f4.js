function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"7NT8":function(e,t,n){"use strict";n.r(t);var o=n("ofXK"),i=n("tyNb"),a=n("3Pt+"),s=n("IhUT"),c=n("1gA9"),r=n("OaWH"),u=n("IWZj"),l=n("fXoL"),d=n("ocbO"),b=n("mrSG"),f=n("SxV6"),p=n("Kj3r"),g=n("/uUt"),m=n("eIep"),h=n("JIr8"),_=n("lJxs"),v=n("XNiG"),C=n("LRne"),y=n("KsZa"),O=n("/1cH"),k=n("0njA"),x=n("Xa2L"),w=n("FKr1"),M=["input"];function P(e,t){1&e&&l.Rb(0,"mat-spinner",12)}var z=function(){return{type:"icon",class:"material-icons",content:"search"}};function W(e,t){if(1&e){var n=l.Xb();l.Wb(0,"div",4),l.ec("focus",(function(){return l.wc(n),l.ic().focusField()}))("click",(function(){return l.wc(n),l.ic().focusField()})),l.Wb(1,"div",5),l.Rb(2,"app-icon",6),l.Vb(),l.Wb(3,"div",7),l.Wb(4,"input",8,9),l.ec("ngModelChange",(function(e){return l.wc(n),l.ic().search_str=e}))("ngModelChange",(function(e){return l.wc(n),l.ic().search$.next(e)})),l.Vb(),l.Vb(),l.Wb(6,"div",10),l.Ec(7,P,1,0,"mat-spinner",11),l.Vb(),l.Vb()}if(2&e){var o=l.ic(),i=l.tc(2);l.Cb(2),l.oc("icon",l.pc(5,z)),l.Cb(2),l.oc("ngModel",o.search_str)("matAutocomplete",i)("placeholder",o.placeholder||"Search..."),l.Cb(3),l.oc("ngIf",o.loading)}}function V(e,t){if(1&e&&(l.Wb(0,"mat-option",13),l.Wb(1,"div",14),l.Gc(2),l.Vb(),l.Wb(3,"div",15),l.Gc(4),l.Vb(),l.Vb()),2&e){var n=t.$implicit;l.oc("value",n),l.Cb(2),l.Hc(n.name),l.Cb(2),l.Hc(n.level?n.level.name:n.email)}}var I,S=((I=function(e){function t(e,n,o){var i;return _classCallCheck(this,t),(i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._service=e,i._route=n,i._router=o,i.results=[],i.search$=new v.a,i}return _inherits(t,e),_createClass(t,[{key:"ngOnInit",value:function(){var e=this;this.subscription("route.params",this._route.paramMap.subscribe((function(t){t.has("search_type")&&(e.type=t.get("search_type"))}))),this.search_results$=this.search$.pipe(Object(p.a)(400),Object(g.a)(),Object(m.a)((function(t){return e.loading=!0,t.length>=3?e._service.Users.query({q:t.slice(0,3),cache:6e4}):Promise.resolve([])})),Object(h.a)((function(e){return Object(C.a)([])})),Object(_.a)((function(t){var n=e._service.Spaces.list((function(e){return!0})),o=(e.search_str||"").toLowerCase(),i=[];return i="space"===e.type?n:"user"===e.type?t:n.concat(t),e.loading=!1,i.filter((function(e){return(e.name||"").toLowerCase().indexOf(o)>=0||(e.email||"").toLowerCase().indexOf(o)>=0}))}))),this.subscription("search_results",this.search_results$.subscribe((function(t){e.results=t})))}},{key:"ngOnChanges",value:function(e){e.autofocus&&this.autofocus&&this.focusField()}},{key:"focusField",value:function(){this.input_field&&this.input_field.nativeElement&&this.input_field.nativeElement.focus()}},{key:"selectOption",value:function(e){this._router.navigate([],e instanceof y.a?{relativeTo:this._route,queryParams:{space:e.id},queryParamsHandling:"merge"}:{relativeTo:this._route,queryParams:{user:e.email},queryParamsHandling:"merge"}),this.search_str=e.name}}]),t}(u.a)).\u0275fac=function(e){return new(e||I)(l.Qb(r.a),l.Qb(i.a),l.Qb(i.d))},I.\u0275cmp=l.Kb({type:I,selectors:[["explore-search"]],viewQuery:function(e,t){var n;1&e&&l.Cc(M,!0),2&e&&l.sc(n=l.fc())&&(t.input_field=n.first)},inputs:{type:"type",autofocus:"autofocus",placeholder:"placeholder"},features:[l.zb,l.Ab],decls:4,vars:2,consts:[["class","searchbar","tabindex","0",3,"focus","click",4,"ngIf"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["tabindex","0",1,"searchbar",3,"focus","click"],[1,"prefix"],[3,"icon"],[1,"input"],["type","text",3,"ngModel","matAutocomplete","placeholder","ngModelChange"],["input",""],[1,"suffix"],["diameter","32",4,"ngIf"],["diameter","32"],[3,"value"],[1,"name"],[1,"email"]],template:function(e,t){1&e&&(l.Ec(0,W,8,6,"div",0),l.Wb(1,"mat-autocomplete",1,2),l.ec("optionSelected",(function(e){return t.selectOption(e.option.value)})),l.Ec(3,V,5,3,"mat-option",3),l.Vb()),2&e&&(l.oc("ngIf",t.type),l.Cb(3),l.oc("ngForOf",t.results))},directives:[o.t,O.a,o.s,k.a,a.c,O.d,a.r,a.u,x.c,w.g],styles:[".searchbar[_ngcontent-%COMP%]{display:flex;align-items:center;max-width:calc(100% - 1em);width:calc(100% - 1em);margin:.5em auto;background-color:#fff;border-radius:2em;padding:0 .75em;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}@media only screen and (orientation:portrait) and (max-width:450px){.searchbar[_ngcontent-%COMP%]{border-radius:0;box-shadow:none;margin:0;width:100%;max-width:100%;padding:0 .5em;border-bottom:1px solid #ccc}}@media only screen and (orientation:landscape) and (max-width:800px){.searchbar[_ngcontent-%COMP%]{border-radius:0;box-shadow:none;margin:0;width:100%;max-width:100%;padding:0 .5em;border-bottom:1px solid #ccc}}.prefix[_ngcontent-%COMP%], .suffix[_ngcontent-%COMP%]{font-size:1.5em;min-width:32px;min-height:100%}.input[_ngcontent-%COMP%]{flex:1;min-width:50%}input[_ngcontent-%COMP%]{width:100%;font-size:1em;border:none;outline:none;padding:1em .5em;background:none}.name[_ngcontent-%COMP%]{height:1em}.email[_ngcontent-%COMP%]{font-size:.6em;color:rgba(0,0,0,.65)}"]}),I),E=n("xhdr"),R=n("5RMF");function j(e,t){if(1&e&&(l.Wb(0,"div",8),l.Gc(1),l.Vb()),2&e){var n=l.ic(2);l.Cb(1),l.Hc(n.available_until)}}function q(e,t){if(1&e&&(l.Wb(0,"div",1),l.Rb(1,"div",2),l.Wb(2,"div",3),l.Wb(3,"div",4),l.Gc(4),l.Vb(),l.Wb(5,"div",5),l.Wb(6,"div",6),l.Gc(7),l.Vb(),l.Ec(8,j,2,1,"div",7),l.Vb(),l.Vb(),l.Vb()),2&e){var n=l.ic();l.Eb("space-info "+n.quadrant),l.oc("id",n.space.id),l.Cb(4),l.Hc(n.space.name),l.Cb(2),l.Eb(n.status_class),l.Cb(1),l.Hc(n.status),l.Cb(1),l.oc("ngIf","not-bookable"!==n.status_class)}}var G,F=((G=function(e){function t(e,n,o){var i;return _classCallCheck(this,t),(i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._data=e,i._position=n,i._service=o,i}return _inherits(t,e),_createClass(t,[{key:"ngOnInit",value:function(){var e=this;this.processBookings(),this.interval("update_bookings",(function(){return e.processBookings()}),6e4)}},{key:"processBookings",value:function(){if(this.space){var e=Object(R.d)(this.bookings,this.space.bookable,this.space.byRequest({date:this._data.date,duration:30,host:this._service.Users.current}),this._data.date);this.status=e.status,this.available_until=e.available_until}}},{key:"quadrant",get:function(){if(!this._position)return"top left";var e=this._position;return e.x>50&&e.y>50?"bottom right":e.x<50&&e.y>50?"bottom left":e.x>50?"top right":"top left"}},{key:"status_class",get:function(){return(this.status||"").toLowerCase().split(" ").join("-")}},{key:"space",get:function(){return this._data?this._data.space:null}},{key:"bookings",get:function(){return this._data&&this._data.bookings||[]}}]),t}(u.a)).\u0275fac=function(e){return new(e||G)(l.Qb(c.c),l.Qb(c.b),l.Qb(r.a))},G.\u0275cmp=l.Kb({type:G,selectors:[["a-space-info"]],features:[l.zb],decls:1,vars:1,consts:[[3,"id","class",4,"ngIf"],[3,"id"],[1,"arrow"],[1,"details"],[1,"name"],[1,"availability"],["name","status"],["name","available-until",4,"ngIf"],["name","available-until"]],template:function(e,t){1&e&&l.Ec(0,q,9,8,"div",0),2&e&&l.oc("ngIf",t.space)},directives:[o.t],styles:["[_nghost-%COMP%]{pointer-events:none}.space-info[_ngcontent-%COMP%]{position:absolute;min-width:16em;border-radius:4px;background-color:#fff;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.space-info.top[_ngcontent-%COMP%]{top:0}.space-info.top.left[_ngcontent-%COMP%]{left:0;border-top-left-radius:0}.space-info.top.right[_ngcontent-%COMP%]{right:0;border-top-right-radius:0}.space-info.bottom[_ngcontent-%COMP%]{bottom:0}.space-info.bottom.left[_ngcontent-%COMP%]{left:0;border-bottom-left-radius:0}.space-info.bottom.right[_ngcontent-%COMP%]{right:0;border-bottom-right-radius:0}.top[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{top:2px}.top.left[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{left:2px;border-width:8px 8px 0 0;border-color:#1937ea transparent transparent}.top.right[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{right:2px;border-width:0 8px 8px 0;border-color:transparent #1937ea transparent transparent}.bottom[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{bottom:2px}.bottom.left[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{left:2px;border-width:8px 0 0 8px;border-color:transparent transparent transparent #1937ea}.bottom.right[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{right:2px;border-width:0 0 8px 8px;border-color:transparent transparent #1937ea}.arrow[_ngcontent-%COMP%]{position:absolute;width:0;height:0;border-style:solid}.details[_ngcontent-%COMP%]{padding:1em}.name[_ngcontent-%COMP%]{font-size:1.25em;padding:.2em .4em}.availability[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{padding:.25rem .5rem;display:inline-block}[name=status][_ngcontent-%COMP%]{border-radius:4px;color:#fff;font-size:.8em;margin-right:auto}[name=status].not-bookable[_ngcontent-%COMP%]{background-color:#ccc}[name=status].available[_ngcontent-%COMP%]{background-color:#43a047}[name=status].available-by-request[_ngcontent-%COMP%]{background-color:#ffb300}[name=status].meeting-in-progress[_ngcontent-%COMP%]{background-color:#e53935}"]}),G),B=n("Wgwc"),D=n("0IaG"),H=n("4Man"),U=n("bTqV"),T=n("m6yr"),Q=function(){return{class:"material-icons",content:"add"}};function A(e,t){if(1&e&&(l.Ub(0),l.Rb(1,"app-icon",5),l.Wb(2,"div",6),l.Gc(3," Book "),l.Wb(4,"span"),l.Gc(5),l.Vb(),l.Gc(6),l.Vb(),l.Tb()),2&e){var n=l.ic(2);l.Cb(1),l.oc("icon",l.pc(3,Q)),l.Cb(4),l.Hc(null==n.space?null:n.space.name),l.Cb(1),l.Ic(" ",n.is_now?"from now":"at "+n.time," ")}}function L(e,t){if(1&e&&(l.Ub(0),l.Wb(1,"div",6),l.Gc(2," Book "),l.Wb(3,"span"),l.Gc(4),l.Vb(),l.Vb(),l.Tb()),2&e){var n=l.ic(2);l.Cb(4),l.Hc(null==n.space?null:n.space.name)}}function K(e,t){if(1&e&&(l.Ub(0),l.Rb(1,"a-booking-form",10),l.Tb()),2&e){var n=l.ic(3);l.Cb(1),l.oc("form",n.form)}}function $(e,t){1&e&&(l.Wb(0,"p"),l.Gc(1,"This space requires approval to reserve"),l.Vb())}function X(e,t){if(1&e&&(l.Ub(0),l.Wb(1,"p"),l.Gc(2),l.Vb(),l.Ec(3,$,2,0,"p",3),l.Tb()),2&e){var n=l.ic(3);l.Cb(2),l.Hc(n.available_until),l.Cb(1),l.oc("ngIf",n.is_requesting)}}function Y(e,t){if(1&e&&(l.Wb(0,"main"),l.Ub(1,7),l.Ec(2,K,2,1,"ng-container",8),l.Ec(3,X,4,2,"ng-container",9),l.Tb(),l.Vb()),2&e){var n=l.ic(2);l.Cb(1),l.oc("ngSwitch",n.state),l.Cb(1),l.oc("ngSwitchCase","form")}}function N(e,t){if(1&e){var n=l.Xb();l.Wb(0,"mat-dialog-actions"),l.Wb(1,"footer"),l.Wb(2,"button",11),l.Gc(3,"Cancel"),l.Vb(),l.Wb(4,"button",12),l.ec("tapped",(function(){l.wc(n);var e=l.ic(2);return"form"===e.state?e.book():e.next()})),l.Gc(5),l.Vb(),l.Vb(),l.Vb()}if(2&e){var o=l.ic(2);l.Cb(5),l.Ic(" ","form"===o.state?o.is_requesting?"Request":"Book":"Yes"," ")}}function J(e,t){if(1&e&&(l.Wb(0,"main"),l.Wb(1,"div",13),l.Wb(2,"div",14),l.Rb(3,"mat-spinner",15),l.Vb(),l.Wb(4,"div",6),l.Gc(5),l.Vb(),l.Vb(),l.Vb()),2&e){var n=l.ic(2);l.Cb(5),l.Hc(n.loading||"Processing request...")}}function Z(e,t){if(1&e&&(l.Ub(0),l.Wb(1,"header",2),l.Ec(2,A,7,4,"ng-container",3),l.Ec(3,L,5,1,"ng-container",3),l.Vb(),l.Wb(4,"mat-dialog-content"),l.Ec(5,Y,4,2,"main",0),l.Vb(),l.Ec(6,N,6,1,"mat-dialog-actions",3),l.Ec(7,J,6,1,"ng-template",null,4,l.Fc),l.Tb()),2&e){var n=l.tc(8),o=l.ic();l.Cb(1),l.Gb("request",o.is_requesting),l.Cb(1),l.oc("ngIf","form"!==o.state),l.Cb(1),l.oc("ngIf","form"===o.state),l.Cb(2),l.oc("ngIf",!o.loading)("ngIfElse",n),l.Cb(1),l.oc("ngIf",!o.loading)}}function ee(e,t){if(1&e&&(l.Ub(0),l.Gc(1,"Request for "),l.Wb(2,"span"),l.Gc(3),l.Vb(),l.Gc(4," sent"),l.Tb()),2&e){var n=l.ic(2);l.Cb(3),l.Hc(null==n.space?null:n.space.name)}}function te(e,t){if(1&e&&(l.Ub(0),l.Gc(1,"Booked "),l.Wb(2,"span"),l.Gc(3),l.Vb(),l.Gc(4),l.Tb()),2&e){var n=l.ic(2);l.Cb(3),l.Hc(null==n.space?null:n.space.name),l.Cb(1),l.Ic(" ",n.is_now?"from now":"at "+n.time,"")}}var ne=function(e){return{class:"material-icons",content:e}};function oe(e,t){if(1&e&&(l.Wb(0,"header",16),l.Wb(1,"div",6),l.Ec(2,ee,5,1,"ng-container",3),l.Ec(3,te,5,2,"ng-container",3),l.Vb(),l.Rb(4,"app-icon",5),l.Vb()),2&e){var n=l.ic();l.Gb("request",n.is_requesting),l.Cb(2),l.oc("ngIf",n.is_requesting),l.Cb(1),l.oc("ngIf",!n.is_requesting),l.Cb(1),l.oc("icon",l.qc(5,ne,n.is_requesting?"send":"done"))}}var ie,ae=((ie=function(e){function t(e,n,o,i){var a;_classCallCheck(this,t),(a=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._dialog_ref=e,a._data=n,a._router=o,a._service=i,a.state="info";var s=B(a._data.date);a.booking=new E.a(a._service.Bookings,{title:"Ad-Hoc Booking",date:s.valueOf(),duration:30,room_ids:[a._data.space.id]});var c=Object(R.d)(a._data.bookings,a.space.bookable,a.space.byRequest({date:a._data.date,duration:30,host:a._service.Users.current}),a._data.date);return a.available_until=c.available_until,a}return _inherits(t,e),_createClass(t,[{key:"next",value:function(){if(this.is_now)this.form=Object(R.a)(this.booking,this._service.Users.current,["space_list","organiser","title","duration"]),this.state="form";else{var e=this.booking.toJSON(!0);localStorage.setItem("ACA_STAFF.booking_form_data",JSON.stringify(Object.assign({id:"ad-hoc"},e))),this._router.navigate(["/book","space"],{queryParams:{back:"/explore"}}),this._dialog_ref.close()}}},{key:"book",value:function(){var e=this;this.form.valid&&(this.loading="Checking space availability...",this.checkSpaceAvailability().then((function(){e.booking.save(!0).then((function(){e.loading=null,e.success=!0,e.timeout("close",(function(){return e._dialog_ref.close()}),5e3)}),(function(t){e.loading=null,e._service.notifyError("Error ".concat(e.booking.id?"updating":"creating"," booking: ").concat(t.message||t,"}"))}))}),(function(t){e.loading=null,e._service.notifyError("Error checking space availability: ".concat(t.message||t))})))}},{key:"checkSpaceAvailability",value:function(){var e=this,t=this.booking.changes.space_list||this.booking.space_list;return new Promise((function(n,o){e._service.Spaces.available({room_ids:t.map((function(e){return e.id})).join(","),date:e.booking.changes.date||e.booking.date,duration:e.booking.changes.duration||e.booking.duration}).then((function(e){var t=!0,i=!1,a=void 0;try{for(var s,c=e[Symbol.iterator]();!(t=(s=c.next()).done);t=!0){var r=s.value;if(!r.was_available)return o("".concat(r.name," is not available at the select time period."))}}catch(u){i=!0,a=u}finally{try{t||null==c.return||c.return()}finally{if(i)throw a}}n()}),(function(e){return o(e)}))}))}},{key:"is_requesting",get:function(){var e=this.booking.toJSON(!0);return this.space.byRequest({date:this.booking.changes.date||this.booking.date||B(this._data.date).valueOf(),duration:this.booking.changes.duration||this.booking.duration||30,host:e.organiser||this._service.Users.current})}},{key:"date",get:function(){return B(this._data.date).format("DD MMM YYYY")}},{key:"time",get:function(){return B(this._data.date).format("h:mm A")}},{key:"space",get:function(){return this._data.space}},{key:"is_now",get:function(){var e=B(),t=B(this._data.date);return e.isSame(t,"m")||e.isAfter(t,"m")}}]),t}(u.a)).\u0275fac=function(e){return new(e||ie)(l.Qb(D.h),l.Qb(D.a),l.Qb(i.d),l.Qb(r.a))},ie.\u0275cmp=l.Kb({type:ie,selectors:[["a-explore-booking-modal"]],features:[l.zb],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["done_state",""],["mat-dialog-title",""],[4,"ngIf"],["load_state",""],[3,"icon"],[1,"text"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"form"],["mat-button","","mat-dialog-close","",1,"inverse"],["mat-button","",3,"tapped"],[1,"info-block"],[1,"icon"],["diameter","48"],[1,"success"]],template:function(e,t){if(1&e&&(l.Ec(0,Z,9,7,"ng-container",0),l.Ec(1,oe,5,7,"ng-template",null,1,l.Fc)),2&e){var n=l.tc(2);l.oc("ngIf",!t.success)("ngIfElse",n)}},directives:[o.t,D.i,D.f,k.a,o.x,o.y,o.z,H.a,D.c,U.b,D.d,T.c,x.c],styles:["[_nghost-%COMP%]{max-width:24em}header[_ngcontent-%COMP%]{color:#fff}header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700}header.success[_ngcontent-%COMP%]{background-color:#43a047}header.request[_ngcontent-%COMP%]{background-color:#ffb300}main[_ngcontent-%COMP%]{padding:0 1em .5em}footer[_ngcontent-%COMP%]{width:100%;text-align:center}button[_ngcontent-%COMP%]{min-width:8em}p[_ngcontent-%COMP%]{margin:.5em 0;font-size:1.25em}"]}),ie),se=["space-status",""];function ce(e,t){if(1&e){var n=l.Xb();l.Wb(0,"i",3),l.ec("modelChange",(function(e){l.wc(n);var o=t.$implicit;return l.ic(2).processSpaceBookings(o,e)})),l.Vb()}2&e&&l.oc("sys",t.$implicit.id)}function re(e,t){if(1&e&&(l.Wb(0,"div",1),l.Ec(1,ce,1,1,"i",2),l.Vb()),2&e){var n=l.ic();l.Cb(1),l.oc("ngForOf",n.space_list)}}var ue,le=["*"],de=((ue=function(e){function t(e,n){var o;return _classCallCheck(this,t),(o=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._service=e,o._dialog=n,o.status=new l.n,o.listeners=new l.n,o.features=new l.n,o.space_list=[],o.active_bookings={},o.colour_map={},o}return _inherits(t,e),_createClass(t,[{key:"ngOnInit",value:function(){var e=this;this._service.initialised.pipe(Object(f.a)((function(e){return e}))).subscribe((function(){e.colour_map=e._service.setting("app.explore.colors")||{},e.subscription("spaces",e._service.Spaces.listen("list").subscribe((function(){return e.loadSpaces()}))),e.interval("update_status",(function(){e.updateSpaceBookings(),e.calculateStatus()}),6e4)}))}},{key:"ngOnChanges",value:function(e){(e.zone||e.date)&&this.loadSpaces(),e.zone&&this.clearSpaces()}},{key:"ngOnDestroy",value:function(){this.clearSpaces()}},{key:"calculateStatus",value:function(){var e=this;this.timeout("process_statuses",(function(){var t=[],n=!0,o=!1,i=void 0;try{for(var a,s=e.space_list[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var c=a.value,r=e.getStatus(c,e.date),u=c.map_id.indexOf("area")<0?"area-".concat(c.map_id,"-status"):c.map_id;t.push({id:u,styles:{fill:e.colour_map["space-".concat(r)]||"#000",opacity:.6},status_id:r})}}catch(l){o=!0,i=l}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}e.status.emit(t)}))}},{key:"getStatus",value:function(e,t){if(!e.bookable)return"not-bookable";var n=this.active_bookings[e.id]||[],o=B(t).startOf("m").second(1);if(n.find((function(e){var t=B(e.date).startOf("m"),n=t.add(e.duration,"m");return o.isAfter(t,"s")&&o.isBefore(n,"m")})))return"unavailable";var i={date:B(this.date).valueOf(),duration:30,host:this._service.Users.current},a=e.rulesFor(i);return a.hide?"not-bookable":a.auto_approve?"available":"requestable"}},{key:"processSpaceBookings",value:function(e,t){var n=this;this.timeout("space-".concat(e.id),(function(){var o=(t||[]).map((function(t){return new E.a(n._service.Bookings,Object.assign(Object.assign({},t),{room_ids:[e.id]}))}));n.active_bookings[e.id]=o,n.calculateStatus()}),10)}},{key:"updateSpaceBookings",value:function(){var e=this;this.is_today||this.timeout("update_spaces",(function(){var t=B(e.date).startOf("d");e._service.Spaces.query({from:t.unix(),to:t.endOf("d").unix(),show_declined:!1,zone_ids:e.zone,cache:1e4}).then((function(t){t.forEach((function(t){return e.processSpaceBookings(t,t.bookings)}))}))}),50)}},{key:"loadSpaces",value:function(){var e=this;this.space_list=this._service.Spaces.list((function(t){return t.zones.indexOf(e.zone)>=0}));var t=[],n=!0,o=!1,i=void 0;try{for(var a,s=function(){var n=a.value,o=n.map_id.indexOf("area")<0?"area-".concat(n.map_id,"-status"):n.map_id;t.push({id:o,event:"mouseenter",callback:function(){return e.showSpaceInfo(n)}}),t.push({id:o,event:"mouseleave",callback:function(){return e.features.emit([])}}),n.bookable&&t.push({id:o,event:"click",callback:function(){return e.openBookingModal(n)}})},c=this.space_list[Symbol.iterator]();!(n=(a=c.next()).done);n=!0)s()}catch(r){o=!0,i=r}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}this.listeners.emit(t),this.updateSpaceBookings(),this.calculateStatus()}},{key:"clearSpaces",value:function(){delete this.active_bookings,this.active_bookings={}}},{key:"showSpaceInfo",value:function(e){var t=e.map_id.indexOf("area")<0?"area-".concat(e.map_id,"-status"):e.map_id;this.features.emit([{id:t,coordinates:null,content:F,data:{space:e,bookings:this.active_bookings[e.id],date:this.date}}])}},{key:"openBookingModal",value:function(e){var t=this.getStatus(e,this.date);"unavailable"!==t&&"not-bookable"!==t?this._dialog.open(ae,{width:"auto",height:"auto",data:{date:this.date,space:e,bookings:this.active_bookings[e.id]}}):this._service.notifyInfo("".concat(e.name," is unavailable at the selected time. Please select another space or time and try again."))}},{key:"is_today",get:function(){return B().isSame(B(this.date),"d")}}]),t}(u.a)).\u0275fac=function(e){return new(e||ue)(l.Qb(r.a),l.Qb(D.b))},ue.\u0275cmp=l.Kb({type:ue,selectors:[["","space-status",""]],inputs:{zone:"zone",date:"date"},outputs:{status:"status",listeners:"listeners",features:"features"},features:[l.zb,l.Ab],attrs:se,ngContentSelectors:le,decls:2,vars:1,consts:[["class","bindings",4,"ngIf"],[1,"bindings"],["binding","","mod","Bookings","bind","today",3,"sys","modelChange",4,"ngFor","ngForOf"],["binding","","mod","Bookings","bind","today",3,"sys","modelChange"]],template:function(e,t){1&e&&(l.nc(),l.Ec(0,re,2,1,"div",0),l.mc(1)),2&e&&l.oc("ngIf",t.space_list&&t.is_today)},directives:[o.t,o.s,s.a],encapsulation:2}),ue),be=["desk-status",""],fe=function(e){return[e]},pe=function(){return[]};function ge(e,t){if(1&e){var n=l.Xb();l.Wb(0,"div",1),l.Wb(1,"i",2),l.ec("modelChange",(function(e){return l.wc(n),l.ic().in_use=e}))("modelChange",(function(){return l.wc(n),l.ic().calculateStatus()})),l.Vb(),l.Wb(2,"i",2),l.ec("modelChange",(function(e){return l.wc(n),l.ic().id_list=e}))("modelChange",(function(){return l.wc(n),l.ic().calculateStatus()})),l.Vb(),l.Wb(3,"i",2),l.ec("modelChange",(function(e){return l.wc(n),l.ic().reserved=e}))("modelChange",(function(){return l.wc(n),l.ic().calculateStatus()})),l.Vb(),l.Wb(4,"i",2),l.ec("modelChange",(function(e){return l.wc(n),l.ic().occupied=e})),l.Vb(),l.Wb(5,"i",2),l.ec("modelChange",(function(e){return l.wc(n),l.ic().free=e})),l.Vb(),l.Wb(6,"i",3),l.ec("modelChange",(function(e){return l.wc(n),l.ic().checkin=e})),l.Vb(),l.Wb(7,"i",4),l.ec("modelChange",(function(e){return l.wc(n),l.ic().cancel=e})),l.Vb(),l.Vb()}if(2&e){var o=l.ic();l.Cb(1),l.oc("model",o.in_use)("sys",o.system_id)("bind",o.zone),l.Cb(1),l.oc("model",o.id_list)("sys",o.system_id)("bind",o.zone+":desk_ids"),l.Cb(1),l.oc("model",o.reserved)("sys",o.system_id)("bind",o.zone+":reserved"),l.Cb(1),l.oc("model",o.occupied)("sys",o.system_id)("bind",o.zone+":occupied_count"),l.Cb(1),l.oc("model",o.free)("sys",o.system_id)("bind",o.zone+":free_count"),l.Cb(1),l.oc("model",o.checkin)("sys",o.system_id)("params",l.qc(21,fe,o.checkin)),l.Cb(1),l.oc("model",o.cancel)("sys",o.system_id)("params",l.pc(23,pe))}}var me,he,_e,ve=["*"],Ce=((he=function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._service=e,n.status=new l.n,n.occupied=0,n.free=0,n.colour_map={},n}return _inherits(t,e),_createClass(t,[{key:"ngOnInit",value:function(){var e=this;this._service.initialised.pipe(Object(f.a)((function(e){return e}))).subscribe((function(){e.colour_map=e._service.setting("app.explore.colors")||{}}))}},{key:"ngOnChanges",value:function(e){e.zone&&this.loadDesks()}},{key:"calculateStatus",value:function(){var e=this,t=this.id_list||[],n=[],o=!0,i=!1,a=void 0;try{for(var s,c=function(){var t=s.value,o=(e.in_use||[]).find((function(e){return e===t})),i=(e.reserved||[]).find((function(e){return e===t})),a=o?"unavailable":i?"reserved":"available";n.push({id:t,styles:{fill:e.colour_map["desk-".concat(a)],stroke:e.colour_map["desk-".concat(a,"-stroke")]},status_id:a})},r=t[Symbol.iterator]();!(o=(s=r.next()).done);o=!0)c()}catch(u){i=!0,a=u}finally{try{o||null==r.return||r.return()}finally{if(i)throw a}}this.status.emit(n)}},{key:"loadDesks",value:function(){var e=this._service.Organisation.levelWithID(this.zone);if(e){var t=this._service.Organisation.buildings.find((function(t){return t.id===e.building_id}));if(t){var n=t.systems.desk_management;n&&(this.system_id=n)}}}}]),t}(u.a)).\u0275fac=function(e){return new(e||he)(l.Qb(r.a))},he.\u0275cmp=l.Kb({type:he,selectors:[["","desk-status",""]],inputs:{zone:"zone",checkin:"checkin"},outputs:{status:"status"},features:[l.zb,l.Ab],attrs:be,ngContentSelectors:ve,decls:2,vars:1,consts:[["class","bindings",4,"ngIf"],[1,"bindings"],["binding","","mod","DeskManagement",3,"model","sys","bind","modelChange"],["binding","","mod","DeskManagement","exec","manual_checkin",3,"model","sys","params","modelChange"],["binding","","mod","DeskManagement","exec","cancel_reservation",3,"model","sys","params","modelChange"]],template:function(e,t){1&e&&(l.nc(),l.mc(0),l.Ec(1,ge,8,24,"div",0)),2&e&&(l.Cb(1),l.oc("ngIf",t.system_id))},directives:[o.t,s.a],encapsulation:2}),he),ye=((me=function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._service=e,n.status=new l.n,n.zone_usage={},n.colour_map={},n}return _inherits(t,e),_createClass(t,[{key:"ngOnInit",value:function(){var e=this;this._service.initialised.pipe(Object(f.a)((function(e){return e}))).subscribe((function(){e.colour_map=e._service.setting("app.explore.colors")||{}}))}},{key:"ngOnDestroy",value:function(){this.clearZones(this.zone)}},{key:"calculateStatus",value:function(){var e=this._service.Organisation.levelWithID(this.zone);if(e){var t=e.settings.min_usage||0,n=[];for(var o in this.zone_usage)if(this.zone_usage[o]&&this.zone_usage.hasOwnProperty(o)){var i=Math.max(t,this.zone_usage[o]),a=i<40?"low":i<75?"medium":"high";n.push({id:o,styles:{fill:this.colour_map["zone-".concat(a)]||"#ccc"},status_id:a})}this.status.emit(n)}}},{key:"loadZones",value:function(){var e=this,t=this._service.Organisation.levelWithID(this.zone);if(t){var n=this._service.Organisation.buildings.find((function(e){return e.id===t.building_id}));if(n){var o=n.systems.floor_management;if(o){this.system_id=o;var i=this._service.Bindings.module(this.system_id,"FloorManagement");i&&(this.subscription("zone-".concat(this.zone,".binding"),i.binding(this.zone).bind()),this.subscription("zone-".concat(this.zone,".usage"),i.binding(this.zone).listen((function(t){e.zone_usage=t,e.calculateStatus()}))))}}}}},{key:"clearZones",value:function(e){this.unsub("zone-".concat(e,".binding")),this.unsub("zone-".concat(e,".usage")),delete this.zone_usage,this.zone_usage={}}}]),t}(u.a)).\u0275fac=function(e){return new(e||me)(l.Qb(r.a))},me.\u0275dir=l.Lb({type:me,selectors:[["","zone-status",""]],inputs:{zone:"zone",date:"date"},outputs:{status:"status"},features:[l.zb]}),me),Oe=n("oTgu"),ke=function(){return{type:"icon",class:"material-icons",content:"add"}},xe=function(){return{type:"icon",class:"material-icons",content:"remove"}},we=function(){return{type:"icon",class:"material-icons",content:"replay"}},Me=((_e=function(){function e(){_classCallCheck(this,e),this.zoomChange=new l.n,this.positionChange=new l.n,this.min_zoom=1,this.max_zoom=10}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"zoomIn",value:function(){this.zoom=1.2*(this.zoom||this.min_zoom),this.zoom>this.max_zoom&&(this.zoom=this.max_zoom),this.zoomChange.emit(this.zoom)}},{key:"zoomOut",value:function(){this.zoom=(this.zoom||this.min_zoom)*(1/1.2),this.zoom<this.min_zoom&&(this.zoom=this.min_zoom),this.zoomChange.emit(this.zoom)}},{key:"reset",value:function(){this.zoom=this.min_zoom,this.position={x:.5,y:.5},this.zoomChange.emit(this.zoom),this.positionChange.emit(this.position)}}]),e}()).\u0275fac=function(e){return new(e||_e)},_e.\u0275cmp=l.Kb({type:_e,selectors:[["a-zoom-controls"]],inputs:{zoom:"zoom",position:"position"},outputs:{zoomChange:"zoomChange",positionChange:"positionChange"},decls:7,vars:6,consts:[[1,"zoom-control"],["mat-icon-button","","name","zoom-in",3,"tapped"],[3,"icon"],["mat-icon-button","","name","zoom-out",3,"tapped"],["mat-icon-button","","name","reset",3,"tapped"]],template:function(e,t){1&e&&(l.Wb(0,"div",0),l.Wb(1,"button",1),l.ec("tapped",(function(){return t.zoomIn()})),l.Rb(2,"app-icon",2),l.Vb(),l.Wb(3,"button",3),l.ec("tapped",(function(){return t.zoomOut()})),l.Rb(4,"app-icon",2),l.Vb(),l.Wb(5,"button",4),l.ec("tapped",(function(){return t.reset()})),l.Rb(6,"app-icon",2),l.Vb(),l.Vb()),2&e&&(l.Cb(2),l.oc("icon",l.pc(3,ke)),l.Cb(2),l.oc("icon",l.pc(4,xe)),l.Cb(2),l.oc("icon",l.pc(5,we)))},directives:[U.b,T.c,k.a],styles:[".zoom-control[_ngcontent-%COMP%]{flex-direction:column;background-color:#fff;border-radius:8px;overflow:hidden;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.zoom-control[_ngcontent-%COMP%], button[_ngcontent-%COMP%]{display:flex;align-items:center}button[_ngcontent-%COMP%]{justify-content:center;border-radius:0;border-bottom:1px solid #ccc}button[_ngcontent-%COMP%]:last-child{border:none}app-icon[_ngcontent-%COMP%]{font-size:1.2em}"]}),_e),Pe=n("CbDI");function ze(e,t){if(1&e&&(l.Wb(0,"li",10),l.Rb(1,"div",11),l.Wb(2,"div",12),l.Gc(3),l.Vb(),l.Rb(4,"div",11),l.Vb()),2&e){var n=l.ic().$implicit;l.Cb(3),l.Hc(n)}}function We(e,t){if(1&e&&(l.Ub(0),l.Rb(1,"app-icon",5),l.Tb()),2&e){var n=l.ic().$implicit;l.Cb(1),l.oc("icon",n.icon)}}function Ve(e,t){if(1&e&&l.Rb(0,"div",17),2&e){var n=l.ic().$implicit,o=l.ic(3);l.Dc("background-color",n.color||o.colours[n.key])}}function Ie(e,t){if(1&e&&(l.Wb(0,"li",13),l.Wb(1,"div",14),l.Ec(2,We,2,1,"ng-container",15),l.Ec(3,Ve,1,2,"ng-template",null,16,l.Fc),l.Vb(),l.Wb(5,"div",12),l.Gc(6),l.Vb(),l.Vb()),2&e){var n=t.$implicit,o=l.tc(4);l.Cb(2),l.oc("ngIf",n.icon)("ngIfElse",o),l.Cb(4),l.Hc(n.name)}}function Se(e,t){if(1&e&&(l.Ub(0),l.Ec(1,ze,5,1,"li",8),l.Ec(2,Ie,7,3,"li",9),l.Tb()),2&e){var n=t.$implicit,o=l.ic(2);l.Cb(1),l.oc("ngIf",o.show_group_names),l.Cb(1),l.oc("ngForOf",o.legend_items[n])}}var Ee=function(e){return{class:"material-icons",content:e}};function Re(e,t){if(1&e){var n=l.Xb();l.Wb(0,"div",1),l.Wb(1,"div",2),l.Wb(2,"div",3),l.ec("tapped",(function(){l.wc(n);var e=l.ic();return e.show_legend=!e.show_legend})),l.Wb(3,"div",4),l.Gc(4),l.Vb(),l.Rb(5,"app-icon",5),l.Vb(),l.Vb(),l.Wb(6,"div",6),l.Wb(7,"ul"),l.Ec(8,Se,3,2,"ng-container",7),l.Vb(),l.Vb(),l.Vb()}if(2&e){var o=l.ic();l.Cb(4),l.Ic("",o.show_legend?"Hide":"Show"," Legend"),l.Cb(1),l.oc("icon",l.qc(10,Ee,o.show_legend?"arrow_drop_up":"arrow_drop_down")),l.Cb(1),l.Dc("padding-bottom",o.show_legend?"1em":"")("padding-bottom",o.show_legend?".5em":"")("overflow",o.show_legend?"hidden auto":"hidden"),l.oc("@show",o.show_legend?"show":"hide"),l.Cb(2),l.oc("ngForOf",o.group_names)}}var je,qe=((je=function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._service=e,n.legend_items={},n.colours={},n.show_legend=!1,n}return _inherits(t,e),_createClass(t,[{key:"ngOnInit",value:function(){var e=this;this._service.initialised.pipe(Object(f.a)((function(e){return e}))).subscribe((function(){var t=e._service.setting("app.explore")||{};e.legend_items=t.legend||{},e.colours=t.colors||{},e.show_group_names=!!t.show_legend_group_names}))}},{key:"group_names",get:function(){return Object.keys(this.legend_items||{})}}]),t}(u.a)).\u0275fac=function(e){return new(e||je)(l.Qb(r.a))},je.\u0275cmp=l.Kb({type:je,selectors:[["a-map-legend"]],features:[l.zb],decls:1,vars:1,consts:[["class","map-legend",4,"ngIf"],[1,"map-legend"],[1,"tag"],[1,"title",3,"tapped"],[1,"text"],[3,"icon"],[1,"contents"],[4,"ngFor","ngForOf"],["class","group",4,"ngIf"],["class","item","name","item.key",4,"ngFor","ngForOf"],[1,"group"],[1,"bar"],[1,"name"],["name","item.key",1,"item"],[1,"ref"],[4,"ngIf","ngIfElse"],["colour_display",""],[1,"colour"]],template:function(e,t){1&e&&l.Ec(0,Re,9,12,"div",0),2&e&&l.oc("ngIf",t.group_names&&t.group_names.length)},directives:[o.t,T.c,k.a,o.s],styles:[".map-legend[_ngcontent-%COMP%]{position:relative;border-radius:4px 4px 0 0;background-color:#fff;margin-top:.4em;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.tag[_ngcontent-%COMP%]{position:absolute;top:0;left:0;transform:translateY(-100%);overflow:hidden}.title[_ngcontent-%COMP%]{display:flex;align-items:center;border-radius:4px 4px 0 0;background-color:#fff;min-width:50%;flex:1;margin:.5em .5em -1px;padding:.75em .8em .75em 1.5em;font-size:.8em;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.contents[_ngcontent-%COMP%]{overflow:hidden;padding:0 .5em;max-height:50vh;min-width:16em}.group[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.25em .5em;margin:.5em 0;color:rgba(0,0,0,.65)}.group[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{margin:0 .5em}.bar[_ngcontent-%COMP%]{height:1px;min-width:1px;flex:1;background-color:rgba(0,0,0,.65)}ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}li[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:.65em;border-radius:4px;padding:.5em .5em .5em 0}li[_ngcontent-%COMP%]:nth-child(2n){background-color:rgba(0,0,0,.05)}li.group[_ngcontent-%COMP%]{background:none}.ref[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center;margin:0 .5em;height:20px;width:20px;border-radius:100%;border:1px solid rgba(0,0,0,.35);overflow:hidden;background-color:#fff}.colour[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0}app-icon[_ngcontent-%COMP%]{font-size:1.2em}"],data:{animation:[Pe.a]}}),je),Ge=n("YxBP"),Fe=n("5fZw"),Be=n("1DiH"),De=["container"];function He(e,t){if(1&e&&(l.Wb(0,"div",17),l.Wb(1,"div",18),l.Gc(2),l.Vb(),l.Rb(3,"div",6),l.Vb()),2&e){var n=t.$implicit;l.Dc("left",n.left+"%"),l.Gb("hour",n.is_hour),l.Cb(2),l.Hc(n.name)}}function Ue(e,t){if(1&e&&l.Rb(0,"div",19),2&e){var n=l.ic();l.Dc("width",n.offset+"%")}}var Te,Qe=function(){return{class:"material-icons",content:"keyboard_arrow_left"}},Ae=function(){return{class:"material-icons",content:"keyboard_arrow_right"}},Le=((Te=function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._renderer=e,n.dateChange=new l.n,n.blocks=[],n}return _inherits(t,e),_createClass(t,[{key:"ngOnInit",value:function(){var e=this;this.blocks=this.generateBlocks(),this.interval("check_date",(function(){return e.checkDate()}),15e3)}},{key:"generateBlocks",value:function(){for(var e=B().startOf("d"),t=e.endOf("d"),n=[],o=e;o.isBefore(t);){var i=0===o.minute();n.push({id:o.format("HH:mm"),name:i?o.format("h"):"",is_hour:i,left:o.diff(e,"m")/1440*100}),o=o.add(30,"m")}return n}},{key:"changeDate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=B(this.date);t=t.add(e,"d");var n=B();this.date=t.isBefore(n,"m")?n.valueOf():t.valueOf(),this.dateChange.emit(this.date)}},{key:"startMove",value:function(e){var t=this,n=Object(Ge.d)(e);this._start_position=n,this._box=this._container.nativeElement.getBoundingClientRect(),e instanceof MouseEvent?(this.subscription("move",this._renderer.listen("window","mousemove",(function(e){return t.onMove(e)}))),this.subscription("end",this._renderer.listen("window","mouseup",(function(e){t.unsub("move"),t.unsub("end")})))):(this.subscription("move",this._renderer.listen("window","touchmove",(function(e){return t.onMove(e)}))),this.subscription("end",this._renderer.listen("window","touchend",(function(e){t.unsub("move"),t.unsub("end")}))))}},{key:"onMove",value:function(e){var t=Object(Ge.d)(e),n=-Math.round((this._start_position.x-t.x)/this._box.width*1440);if(0!==n){var o=B(this.date),i=o;i=(i=i.add(n,"m")).minute(5*Math.floor(Math.round(i.minute()/5))),this.date=i.valueOf(),this.dateChange.emit(this.date),Math.abs(o.diff(i,"m"))>0&&(this._start_position=t),this.checkDate()}}},{key:"checkDate",value:function(){var e=B(this.date),t=B();t=t.minute(5*Math.floor(Math.ceil(t.minute()/5))),e.isBefore(t,"m")&&(this.date=t.valueOf(),this.dateChange.emit(this.date))}},{key:"is_today",get:function(){return B().isSame(B(this.date),"d")}},{key:"offset",get:function(){var e=B();return e.diff(e.startOf("d"),"m")/1440*100}},{key:"active_time",get:function(){var e=B(this.date),t=e.diff(e.startOf("d"),"m");return{id:e.isSame(B(),"d")?"Today":e.format("DD MMM YYYY"),name:e.format("h:mm A"),left:t/1440*100}}}]),t}(u.a)).\u0275fac=function(e){return new(e||Te)(l.Qb(l.E))},Te.\u0275cmp=l.Kb({type:Te,selectors:[["a-timeline"]],viewQuery:function(e,t){var n;1&e&&l.Cc(De,!0),2&e&&l.sc(n=l.fc())&&(t._container=n.first)},inputs:{date:"date"},outputs:{dateChange:"dateChange"},features:[l.zb],decls:20,vars:13,consts:[[1,"not-mobile"],["explore","",1,"timeline"],["container",""],["class","block",3,"hour","left",4,"ngFor","ngForOf"],["class","offset",3,"width",4,"ngIf"],[1,"active-time"],[1,"bar"],[1,"date"],["mat-icon-button","",3,"disabled","tapped"],[3,"icon"],[1,"text",3,"mousedown","touchstart"],["mat-icon-button","",3,"tapped"],[1,"time",3,"mousedown","touchstart"],[1,"triangle"],[1,"pickers","mobile-only"],["offset","top",3,"ngModel","ngModelChange"],[3,"ngModel","ngModelChange"],[1,"block"],[1,"text"],[1,"offset"]],template:function(e,t){1&e&&(l.Wb(0,"div",0),l.Wb(1,"div",1,2),l.Ec(3,He,4,5,"div",3),l.Vb(),l.Ec(4,Ue,1,2,"div",4),l.Wb(5,"div",5),l.Rb(6,"div",6),l.Wb(7,"div",7),l.Wb(8,"button",8),l.ec("tapped",(function(){return t.changeDate(-1)})),l.Rb(9,"app-icon",9),l.Vb(),l.Wb(10,"div",10),l.ec("mousedown",(function(e){return t.startMove(e)}))("touchstart",(function(e){return t.startMove(e)})),l.Gc(11),l.Vb(),l.Wb(12,"button",11),l.ec("tapped",(function(){return t.changeDate()})),l.Rb(13,"app-icon",9),l.Vb(),l.Vb(),l.Wb(14,"div",12),l.ec("mousedown",(function(e){return t.startMove(e)}))("touchstart",(function(e){return t.startMove(e)})),l.Gc(15),l.Vb(),l.Rb(16,"div",13),l.Vb(),l.Vb(),l.Wb(17,"div",14),l.Wb(18,"a-date-field",15),l.ec("ngModelChange",(function(e){return t.date=e}))("ngModelChange",(function(e){return t.dateChange.emit(e)})),l.Vb(),l.Wb(19,"a-time-field",16),l.ec("ngModelChange",(function(e){return t.date=e}))("ngModelChange",(function(e){return t.dateChange.emit(e)})),l.Vb(),l.Vb()),2&e&&(l.Cb(3),l.oc("ngForOf",t.blocks),l.Cb(1),l.oc("ngIf",t.is_today),l.Cb(1),l.Dc("left",t.active_time.left+"%"),l.Cb(3),l.oc("disabled",t.is_today),l.Cb(1),l.oc("icon",l.pc(11,Qe)),l.Cb(2),l.Hc(t.active_time.id),l.Cb(2),l.oc("icon",l.pc(12,Ae)),l.Cb(2),l.Hc(t.active_time.name),l.Cb(3),l.oc("ngModel",t.date),l.Cb(1),l.oc("ngModel",t.date))},directives:[o.s,o.t,U.b,T.c,k.a,Fe.a,a.r,a.u,Be.a],styles:["[_nghost-%COMP%]{z-index:10;border-top:1px solid #ccc;background-color:#fff}.timeline[_ngcontent-%COMP%], [_nghost-%COMP%]{position:relative;width:100%;height:3em}@media only screen and (orientation:portrait) and (max-width:450px){.timeline[_ngcontent-%COMP%], [_nghost-%COMP%]{height:3.75em}}@media only screen and (orientation:landscape) and (max-width:800px){.timeline[_ngcontent-%COMP%], [_nghost-%COMP%]{height:3.75em}}.timeline[_ngcontent-%COMP%]{background:linear-gradient(90deg,#051c2c,#051c2c 40%,#0b2453 60%,#1f40e6)}.block[_ngcontent-%COMP%]{position:absolute;top:0;left:0;bottom:0;pointer-events:none}.block.hour[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{height:40%}@media only screen and (orientation:portrait) and (max-width:450px){.block.hour[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{display:initial}}@media only screen and (orientation:landscape) and (max-width:800px){.block.hour[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{display:initial}}.block[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{position:absolute;width:2px;height:20%;bottom:0;left:-1px;background-color:#fff}@media only screen and (orientation:portrait) and (max-width:450px){.block[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{display:none}}@media only screen and (orientation:landscape) and (max-width:800px){.block[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{display:none}}.block[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{position:absolute;bottom:45%;left:0;transform:translateX(-50%);color:#fff}@media only screen and (orientation:portrait) and (max-width:450px){.block[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-size:.8em}}@media only screen and (orientation:landscape) and (max-width:800px){.block[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-size:.8em}}.block[_ngcontent-%COMP%]:first-child{display:none}@media only screen and (orientation:portrait) and (max-width:450px){.block[_ngcontent-%COMP%]:nth-child(4n-1){display:none}}@media only screen and (orientation:landscape) and (max-width:800px){.block[_ngcontent-%COMP%]:nth-child(4n-1){display:none}}.offset[_ngcontent-%COMP%]{background-color:rgba(0,0,0,.65)}.active-time[_ngcontent-%COMP%], .offset[_ngcontent-%COMP%]{position:absolute;top:0;left:0;bottom:0}.active-time[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{width:2px;height:200%;bottom:0;left:-1px}.active-time[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%], .date[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]{position:absolute;background-color:#fff}.date[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]{bottom:100%;left:0;transform:translate(-50%,-.25em);display:flex;align-items:center;overflow:hidden;border-radius:4px;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.date[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{padding:0 .5em;white-space:nowrap}.date[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0}.date[_ngcontent-%COMP%]{transform:translate(-50%,-2.5em)}.time[_ngcontent-%COMP%]{padding:.5em;white-space:nowrap;cursor:-webkit-grab;cursor:grab}.time[_ngcontent-%COMP%]:active{cursor:-webkit-grabbing;cursor:grabbing}.pickers[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.25em}.pickers[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1;margin:.25em}"]}),Te),Ke=n("bv9b");function $e(e,t){1&e&&l.Rb(0,"mat-progress-bar",18)}function Xe(e,t){if(1&e&&(l.Wb(0,"div",14),l.Wb(1,"div",15),l.Gc(2),l.Vb(),l.Wb(3,"div",16),l.Ec(4,$e,1,0,"mat-progress-bar",17),l.Vb(),l.Vb()),2&e){var n=l.ic();l.Cb(2),l.Hc(n.message),l.Cb(2),l.oc("ngIf",n.loading)}}var Ye,Ne,Je=((Ye=function(e){function t(e,n){var o;return _classCallCheck(this,t),(o=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._service=e,o._route=n,o.center={x:.5,y:.5},o.style_map={},o.status_map={},o.listener_map={},o.feature_map={},o}return _inherits(t,e),_createClass(t,[{key:"ngOnInit",value:function(){var e=this;this._service.initialised.pipe(Object(f.a)((function(e){return e}))).subscribe((function(){if(!e.active_level){var t=e._service.Organisation.building;t&&t.levels.length&&(e.active_level=t.levels[0].id)}e.subscription("route.query",e._route.queryParamMap.subscribe((function(t){t.has("space")&&e.loadSpaceLocation(t.get("space")),t.has("user")&&e.loadUserLocation(t.get("user")).then((function(t){e.loading=!1,e.message=e.focus?"":"Unable to locate ".concat(t.name)}),(function(t){e.loading=!1,e.message="Unable to locate user",t&&404!==t.status&&e._service.notifyError("Error loading user location. ".concat(t.message))}))})))}))}},{key:"processStatuses",value:function(){var e={};(this.status_map.spaces||[]).forEach((function(t){return e["#".concat(t.id)]=t.styles})),(this.status_map.desks||[]).forEach((function(t){return e["#".concat(t.id)]=t.styles})),(this.status_map.zones||[]).forEach((function(t){return e["#".concat(t.id)]=t.styles})),this.style_map=e}},{key:"processListeners",value:function(){var e=[];e=(e=(e=e.concat(this.listener_map.spaces||[])).concat(this.listener_map.desks||[])).concat(this.listener_map.zones||[]),this.listeners=e}},{key:"processFeatures",value:function(){var e=[];this.focus_feature&&(e=e.concat([this.focus_feature])),e=(e=(e=e.concat(this.feature_map.spaces||[])).concat(this.feature_map.desks||[])).concat(this.feature_map.zones||[]),this.features=e}},{key:"loadSpaceLocation",value:function(e){var t=this._service.Spaces.list((function(t){return t.id===e}))[0];t&&(this.message="Loading location of ".concat(t.name),this.loading=!0,this.active_level=t.level.id,this.focus=t.map_id,this.focus_feature={id:t.map_id,coordinates:null,content:c.e,data:{text:t.name}},this.zoom=1,this.loading=!1,this.message="",this.processFeatures())}},{key:"loadUserLocation",value:function(e){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.focus=null,this.focus_feature=null,this.loading=!0,this.message="Loading user details...",t.next=3,this._service.Users.show(e);case 3:if(n=t.sent){t.next=6;break}return t.abrupt("return",n);case 6:return this.message="Loading location for ".concat(n.name,"..."),t.next=9,n.locate();case 9:return o=t.sent,t.abrupt("return",o?(this.active_level=o.level.id,o.fixed?(this.focus=o.id,this.focus_feature={id:o.id,coordinates:null,content:c.e,data:{text:"".concat(n.name," is here")}},this.zoom=1):(this.focus={x:o.x,y:o.y},this.focus_feature={coordinates:{x:o.x,y:o.y},content:c.f,data:{text:"".concat(n.name," is here"),diameter:o.confidence||5}}),this.zoom=1,this.loading=!1,this.message="",this.processFeatures(),n):n);case 11:case"end":return t.stop()}}),t,this)})))}},{key:"map_url",get:function(){return(this._service.Organisation.levelWithID(this.active_level)||{map_url:""}).map_url||""}}]),t}(u.a)).\u0275fac=function(e){return new(e||Ye)(l.Qb(r.a),l.Qb(i.a))},Ye.\u0275cmp=l.Kb({type:Ye,selectors:[["explore-map-view"]],features:[l.zb],decls:15,vars:16,consts:[[1,"map-view"],[1,"header"],[1,"body"],["hidden","",1,"status-list"],["space-status","",3,"zone","date","status","listeners","features"],["desk-status","",3,"zone","status"],["zone-status","",3,"zone","status"],["overlay","",3,"level","levelChange"],[3,"zoom","center","src","css","listeners","features","focus","zoomChange","centerChange"],["diameter","32"],["overlay","",3,"zoom","position","zoomChange","positionChange"],["overlay",""],["class","message",4,"ngIf"],[3,"date","dateChange"],[1,"message"],[1,"text"],[1,"loader"],["mode","indeterminate",4,"ngIf"],["mode","indeterminate"]],template:function(e,t){1&e&&(l.Wb(0,"div",0),l.Wb(1,"div",1),l.Rb(2,"explore-search"),l.Vb(),l.Wb(3,"div",2),l.Wb(4,"div",3),l.Wb(5,"i",4),l.ec("status",(function(e){return t.status_map.spaces=e,t.processStatuses()}))("listeners",(function(e){return t.listener_map.spaces=e,t.processListeners()}))("features",(function(e){return t.feature_map.spaces=e,t.processFeatures()})),l.Vb(),l.Wb(6,"i",5),l.ec("status",(function(e){return t.status_map.desks=e,t.processStatuses()})),l.Vb(),l.Wb(7,"i",6),l.ec("status",(function(e){return t.status_map.zones=e,t.processStatuses()})),l.Vb(),l.Vb(),l.Wb(8,"a-map-controls",7),l.ec("levelChange",(function(e){return t.active_level=e}))("levelChange",(function(){return t.zoom=1,t.center={x:.5,y:.5}})),l.Vb(),l.Wb(9,"a-map",8),l.ec("zoomChange",(function(e){return t.zoom=e}))("centerChange",(function(e){return t.center=e})),l.Rb(10,"mat-spinner",9),l.Vb(),l.Wb(11,"a-zoom-controls",10),l.ec("zoomChange",(function(e){return t.zoom=e}))("positionChange",(function(e){return t.center=e})),l.Vb(),l.Rb(12,"a-map-legend",11),l.Ec(13,Xe,5,2,"div",12),l.Vb(),l.Wb(14,"a-timeline",13),l.ec("dateChange",(function(e){return t.date=e})),l.Vb(),l.Vb()),2&e&&(l.Cb(5),l.oc("zone",t.active_level)("date",t.date),l.Cb(1),l.oc("zone",t.active_level),l.Cb(1),l.oc("zone",t.active_level),l.Cb(1),l.oc("level",t.active_level),l.Cb(1),l.oc("zoom",t.zoom)("center",t.center)("src",t.map_url)("css",t.style_map)("listeners",t.listeners)("features",t.features)("focus",t.focus),l.Cb(2),l.oc("zoom",t.zoom)("position",t.center),l.Cb(2),l.oc("ngIf",t.message),l.Cb(1),l.oc("date",t.date))},directives:[S,de,Ce,ye,Oe.a,c.d,x.c,Me,qe,o.t,Le,Ke.a],styles:[".map-view[_ngcontent-%COMP%]{position:absolute;display:flex;align-items:center;flex-direction:column;top:0;left:0;right:0;bottom:0;overflow:hidden}.body[_ngcontent-%COMP%], .header[_ngcontent-%COMP%]{width:100%;background-color:#f8f8f8}.body[_ngcontent-%COMP%]{position:relative;min-height:50%;flex:1;overflow:hidden}.body[_ngcontent-%COMP%], a-map[_ngcontent-%COMP%]{z-index:1}[overlay][_ngcontent-%COMP%]{z-index:10}a-map-controls[_ngcontent-%COMP%]{position:absolute;top:.5em;left:.5em}a-zoom-controls[_ngcontent-%COMP%]{position:absolute;bottom:.5em;right:.5em}a-map-legend[_ngcontent-%COMP%]{bottom:0}a-map-legend[_ngcontent-%COMP%], a-popout-menu[_ngcontent-%COMP%]{position:absolute;left:.5em}a-popout-menu[_ngcontent-%COMP%]{bottom:.5em;z-index:999}.message[_ngcontent-%COMP%]{overflow:hidden;position:absolute;bottom:.5rem;left:50%;transform:translateX(-50%);background-color:#fff;border-radius:4px;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12);max-width:20rem;z-index:999;font-size:.9em}.message[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]{height:4px;width:100%}@media only screen and (orientation:portrait) and (max-width:450px){.message[_ngcontent-%COMP%]{left:.5rem;transform:none}}@media only screen and (orientation:landscape) and (max-width:800px){.message[_ngcontent-%COMP%]{left:.5rem;transform:none}}.message[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{padding:.5rem}"]}),Ye),Ze=n("p5rm"),et=n("4Uey"),tt=((Ne=function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._service=e,n}return _inherits(t,e),_createClass(t,[{key:"ngOnInit",value:function(){this._service.title="Maps"}}]),t}(u.a)).\u0275fac=function(e){return new(e||Ne)(l.Qb(r.a))},Ne.\u0275cmp=l.Kb({type:Ne,selectors:[["app-explore"]],features:[l.zb],decls:8,vars:2,consts:[[1,"explore","page"],[1,"header"],[3,"menu","menuChange"],[1,"body"],[1,"footer"],[3,"show","showChange"]],template:function(e,t){1&e&&(l.Wb(0,"div",0),l.Wb(1,"header",1),l.Wb(2,"a-topbar-header",2),l.ec("menuChange",(function(e){return t.show_menu=e})),l.Vb(),l.Vb(),l.Wb(3,"main",3),l.Rb(4,"explore-map-view"),l.Vb(),l.Wb(5,"footer",4),l.Rb(6,"a-footer-menu"),l.Vb(),l.Vb(),l.Wb(7,"a-overlay-menu",5),l.ec("showChange",(function(e){return t.show_menu=e})),l.Vb()),2&e&&(l.Cb(2),l.oc("menu",t.show_menu),l.Cb(5),l.oc("show",t.show_menu))},directives:[d.a,Je,Ze.a,et.a],styles:[".page[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;align-items:center;flex-direction:column}.page[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}.body[_ngcontent-%COMP%]{position:relative;min-width:50%;flex:1}"]}),Ne),nt=n("PCNd");n.d(t,"ExploreModule",(function(){return at}));var ot,it=[{path:"",component:tt},{path:":search_type",component:tt}],at=((ot=function e(){_classCallCheck(this,e)}).\u0275mod=l.Ob({type:ot}),ot.\u0275inj=l.Nb({factory:function(e){return new(e||ot)},imports:[[o.c,i.h.forChild(it),nt.a,c.a,s.b,a.l]]}),ot)}}]);