(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{Xi7U:function(e,t,n){"use strict";n.r(t);var i=n("ofXK"),o=n("3Pt+"),s=n("vxfF"),c=n("tyNb"),a=n("IhUT"),r=n("IWZj"),d=n("OaWH"),l=n("fXoL"),h=n("ocbO"),b=n("p5rm"),g=n("4Uey"),u=n("bTqV"),f=n("Xa2L"),m=n("xhdr"),v=n("YxBP"),p=n("ceWj"),_=n("Wgwc"),C=n("0IaG"),w=n("m6yr");const x=function(e){return[e]};function O(e,t){if(1&e){const e=l.Xb();l.Ub(0),l.Wb(1,"i",23),l.ec("modelChange",(function(t){l.wc(e);const n=l.ic().$implicit;return l.ic().last_start[n.id]=t})),l.Vb(),l.Wb(2,"i",24),l.ec("modelChange",(function(t){return l.wc(e),l.ic(2).checkin=t})),l.Vb(),l.Tb()}if(2&e){const e=l.ic().$implicit,t=l.ic();l.Cb(1),l.oc("model",t.last_start[e.id])("sys",e.id),l.Cb(1),l.oc("model",t.checkin)("sys",e.id)("params",l.qc(5,x,t.event.date))}}function M(e,t){if(1&e&&(l.Ub(0),l.Ec(1,O,3,7,"ng-container",22),l.Tb()),2&e){const e=t.$implicit;l.Cb(1),l.oc("ngIf",null==e?null:null==e.level?null:e.level.id)}}function y(e,t){if(1&e){const e=l.Xb();l.Wb(0,"button",29),l.ec("touchrelease",(function(){l.wc(e);const t=l.ic().$implicit;return l.ic().locate(t)})),l.Gc(1," Map "),l.Vb()}}function W(e,t){if(1&e&&(l.Wb(0,"a",30),l.Gc(1,"Control"),l.Vb()),2&e){const e=l.ic().$implicit;l.oc("href",e.support_url,l.yc)}}function V(e,t){if(1&e&&(l.Wb(0,"div",25),l.Rb(1,"div",26),l.Wb(2,"div",27),l.Gc(3),l.Vb(),l.Ec(4,y,2,0,"button",12),l.Ec(5,W,2,1,"a",28),l.Vb()),2&e){const e=t.$implicit,n=l.ic();l.oc("title",(null==e?null:e.name)+" - "+((null==e?null:e.status)||"Approved")),l.Cb(3),l.Hc(null==e?null:e.name),l.Cb(1),l.oc("ngIf",null==e?null:e.map_id),l.Cb(1),l.oc("ngIf",(null==e?null:e.support_url)&&n.can_control)}}function P(e,t){1&e&&(l.Wb(0,"div",31),l.Gc(1,"No Location"),l.Vb())}function k(e,t){if(1&e){const e=l.Xb();l.Wb(0,"button",29),l.ec("touchrelease",(function(){l.wc(e);const t=l.ic();return t.show_locations=!t.show_locations})),l.Gc(1),l.Vb()}if(2&e){const e=l.ic();l.Cb(1),l.Ic(" ",e.show_locations?"Hide":"Show"," Locations ")}}function I(e,t){if(1&e&&(l.Wb(0,"div",34),l.Wb(1,"a",35),l.Gc(2),l.Vb(),l.Vb()),2&e){const e=l.ic().$implicit,t=l.ic();l.Cb(1),l.oc("href","mailto:"+e.email+"?subject="+t.event.title,l.yc),l.Cb(1),l.Hc(e.email)}}function E(e,t){if(1&e&&(l.Wb(0,"div",25),l.Rb(1,"div",26),l.Wb(2,"div",27),l.Wb(3,"div",32),l.Gc(4),l.Vb(),l.Ec(5,I,3,2,"div",33),l.Vb(),l.Vb()),2&e){const e=t.$implicit;l.oc("title",(null==e?null:e.name)+" - "+((null==e?null:e.status)||"Accepted")+(null!=e&&e.email?"\n"+e.email:"")),l.Cb(4),l.Hc(e.name),l.Cb(1),l.oc("ngIf",e.email)}}function G(e,t){if(1&e){const e=l.Xb();l.Wb(0,"button",29),l.ec("touchrelease",(function(){l.wc(e);const t=l.ic();return t.show_attendees=!t.show_attendees})),l.Gc(1),l.Vb()}if(2&e){const e=l.ic();l.Cb(1),l.Ic(" ",e.show_attendees?"Hide":"Show"," Attendees ")}}function S(e,t){1&e&&(l.Wb(0,"div",36),l.Wb(1,"label"),l.Gc(2,"Catered:"),l.Vb(),l.Wb(3,"div",5),l.Gc(4,"Yes"),l.Vb(),l.Vb())}function D(e,t){if(1&e&&(l.Wb(0,"button",37),l.Wb(1,"div",27),l.Gc(2),l.Vb(),l.Vb()),2&e){const e=l.ic();l.Eb("done"!==e.status||e.is_checked_in?e.is_checked_in?"success no-events":"":"error no-events"),l.Cb(2),l.Ic(" ","done"!==e.status||e.is_checked_in?e.is_checked_in?"Checked in":"Checkin":"Cancelled"," ")}}function Y(e,t){if(1&e){const e=l.Xb();l.Wb(0,"button",38),l.ec("tapped",(function(){return l.wc(e),l.ic().edit()})),l.Gc(1,"Edit"),l.Vb()}}function z(e,t){if(1&e){const e=l.Xb();l.Wb(0,"button",39),l.ec("tapped",(function(){return l.wc(e),l.ic().duplicate()})),l.Gc(1,"Duplicate"),l.Vb()}}let U=(()=>{class e extends r.a{constructor(e,t,n){super(),this._service=e,this._dialog=t,this._router=n,this.change=new l.n,this.loading=new l.n,this.last_start={}}get title(){return this.event&&this.event.title||""}get when(){if(!this.event)return"Unable to determine.";const e=_(this.event.date),t=e.add(this.event.duration||60,"m");return this.event.all_day||this.event.duration>1380?`${e.format("DD MMM YYYY")} - All Day`:e.isSame(t,"d")?`${e.format("DD MMM YYYY, h:mm A")} - ${t.format("h:mm A")}`:`${e.format("DD MMM YYYY, h:mm A")} - ${t.format("DD MMM YYYY, h:mm A")}`}get duration(){return this.event?Object(v.g)(this.event.duration||60):"Unable to determine"}get spaces(){return this.event?this.event.space_list||(this.event.space?[this.event.space]:[]):[]}get attendees(){return this.event&&this.event.attendees.filter(e=>e.email!==this.organiser.email)||[]}get organiser(){return this.event&&this.event.organiser||this._service.Users.current}get can_edit(){return this.organiser.email===this._service.Users.current.email&&"done"!==this.status}get notes(){return this.event&&this.event.description||""}get status(){if(this.event){const e=_(),t=_(this.event.date);if(e.isBefore(t.subtract(15,"m"),"m"))return"future";if(e.isBefore(t,"m"))return"upcoming";if(e.isBefore(t.add(15,"m"),"m"))return"started";if(e.isBefore(t.add(this.event.duration,"m"),"m"))return"in_progress"}return"done"}get is_checked_in(){return this.spaces.reduce((e,t)=>e&&this.event.date<=(this.last_start[t.id]||0),!0)}get can_control(){return this.spaces.length>0&&"future"!==this.status&&"done"!==this.status}get can_checkin(){return this.spaces.length>0&&("upcoming"===this.status||"started"===this.status)}locate(e){if(e){const t=this._service.Spaces.item(e.id)||e;this._dialog.open(p.a,{width:"auto",height:"auto",maxWidth:"95vw",maxHeight:"95vh",data:{space:t}})}}edit(){this.change.emit({type:"edit"})}checkin(){this.checked_in=!this.checked_in}duplicate(){if(localStorage){const e=this.event.duplicate();localStorage.setItem("STAFF.booking_form",JSON.stringify(e))}this.change.emit({type:"duplicate"}),this._router.navigate(["/book"])}}return e.\u0275fac=function(t){return new(t||e)(l.Qb(d.a),l.Qb(C.b),l.Qb(c.d))},e.\u0275cmp=l.Kb({type:e,selectors:[["schedule-event-details"]],inputs:{event:"event"},outputs:{change:"change",loading:"loading"},features:[l.zb],decls:48,vars:21,consts:[[1,"event-details"],[1,"bindings"],[4,"ngFor","ngForOf"],[1,"body"],["name","title",1,"field"],[1,"value"],["name","when",1,"field"],["name","duration",1,"field"],["name","location",1,"field","multi"],[1,"list"],["class","list-item",3,"title",4,"ngFor","ngForOf"],["class","list-item",4,"ngIf"],["class","show",3,"touchrelease",4,"ngIf"],["name","host",1,"field"],["name","attendees",1,"field","multi"],["name","notes",1,"field"],[1,"value",3,"innerHTML"],["class","field","name","catering",4,"ngIf"],[1,"footer"],["mat-button","",3,"class",4,"ngIf"],["mat-button","","name","edit",3,"tapped",4,"ngIf"],["mat-button","","name","duplicate",3,"tapped",4,"ngIf"],[4,"ngIf"],["binding","","mod","Booking","bind","last_meeting_started",3,"model","sys","modelChange"],["binding","","mod","Booking","exec","start_meeting",3,"model","sys","params","modelChange"],[1,"list-item",3,"title"],[1,"status"],[1,"text"],["class","show","target","_blank",3,"href",4,"ngIf"],[1,"show",3,"touchrelease"],["target","_blank",1,"show",3,"href"],[1,"list-item"],[1,"name"],["class","email",4,"ngIf"],[1,"email"],[3,"href"],["name","catering",1,"field"],["mat-button",""],["mat-button","","name","edit",3,"tapped"],["mat-button","","name","duplicate",3,"tapped"]],template:function(e,t){1&e&&(l.Wb(0,"div",0),l.Wb(1,"div",1),l.Ec(2,M,2,1,"ng-container",2),l.Vb(),l.Wb(3,"div",3),l.Wb(4,"div",4),l.Wb(5,"label"),l.Gc(6,"Title:"),l.Vb(),l.Wb(7,"div",5),l.Gc(8),l.Vb(),l.Vb(),l.Wb(9,"div",6),l.Wb(10,"label"),l.Gc(11,"When:"),l.Vb(),l.Wb(12,"div",5),l.Gc(13),l.Vb(),l.Vb(),l.Wb(14,"div",7),l.Wb(15,"label"),l.Gc(16,"Duration:"),l.Vb(),l.Wb(17,"div",5),l.Gc(18),l.Vb(),l.Vb(),l.Wb(19,"div",8),l.Wb(20,"label"),l.Gc(21),l.Vb(),l.Wb(22,"div",5),l.Wb(23,"div",9),l.Ec(24,V,6,4,"div",10),l.Ec(25,P,2,0,"div",11),l.Vb(),l.Ec(26,k,2,1,"button",12),l.Vb(),l.Vb(),l.Wb(27,"div",13),l.Wb(28,"label"),l.Gc(29,"Host:"),l.Vb(),l.Wb(30,"div",5),l.Gc(31),l.Vb(),l.Vb(),l.Wb(32,"div",14),l.Wb(33,"label"),l.Gc(34),l.Vb(),l.Wb(35,"div",5),l.Wb(36,"div",9),l.Ec(37,E,6,3,"div",10),l.Vb(),l.Ec(38,G,2,1,"button",12),l.Vb(),l.Vb(),l.Wb(39,"div",15),l.Wb(40,"label"),l.Gc(41,"Notes:"),l.Vb(),l.Rb(42,"div",16),l.Vb(),l.Ec(43,S,5,0,"div",17),l.Vb(),l.Wb(44,"div",18),l.Ec(45,D,3,3,"button",19),l.Ec(46,Y,2,0,"button",20),l.Ec(47,z,2,0,"button",21),l.Vb(),l.Vb()),2&e&&(l.Cb(2),l.oc("ngForOf",t.spaces),l.Cb(6),l.Hc(t.title),l.Cb(5),l.Hc(t.when),l.Cb(5),l.Hc(t.duration),l.Cb(3),l.Ic("Locations(",t.spaces.length||"0","):"),l.Cb(2),l.Gb("shown",t.show_locations),l.Cb(1),l.oc("ngForOf",t.spaces),l.Cb(1),l.oc("ngIf",!t.spaces.length),l.Cb(1),l.oc("ngIf",t.spaces.length>5),l.Cb(5),l.Hc(t.organiser.name),l.Cb(3),l.Ic("Attendees(",t.attendees.length||"0","):"),l.Cb(2),l.Gb("shown",t.show_attendees),l.Cb(1),l.oc("ngForOf",t.attendees),l.Cb(1),l.oc("ngIf",t.attendees.length>5),l.Cb(4),l.oc("innerHTML",t.notes,l.xc),l.Cb(1),l.oc("ngIf",t.event&&t.event.has_catering),l.Cb(2),l.oc("ngIf",t.can_checkin),l.Cb(1),l.oc("ngIf",t.can_edit),l.Cb(1),l.oc("ngIf",t.can_edit))},directives:[i.s,i.t,a.a,w.c,u.b],styles:[".event-details[_ngcontent-%COMP%]{width:100%;padding:1em 2em}.field[_ngcontent-%COMP%]{display:flex;margin:1em 0}@media only screen and (orientation:portrait) and (max-width:450px){.field[_ngcontent-%COMP%]{flex-wrap:wrap}}@media only screen and (orientation:landscape) and (max-width:800px){.field[_ngcontent-%COMP%]{flex-wrap:wrap}}.field[name=title][_ngcontent-%COMP%]{display:none}@media only screen and (orientation:portrait) and (max-width:450px){.field[name=title][_ngcontent-%COMP%]{display:flex}}@media only screen and (orientation:landscape) and (max-width:800px){.field[name=title][_ngcontent-%COMP%]{display:flex}}label[_ngcontent-%COMP%]{width:8em;margin-top:.25em;margin-right:1em;font-weight:700;font-size:.8em}@media only screen and (orientation:portrait) and (max-width:450px){label[_ngcontent-%COMP%]{width:100%;margin-bottom:.5em}}@media only screen and (orientation:landscape) and (max-width:800px){label[_ngcontent-%COMP%]{width:100%;margin-bottom:.5em}}.value[_ngcontent-%COMP%]{flex:1;min-width:50%;padding:0 .5em}.value[_ngcontent-%COMP%]   .show[_ngcontent-%COMP%]{font-size:.8em;background:none;border:none;outline:none;text-decoration:underline;cursor:pointer}.value[_ngcontent-%COMP%]   .show[_ngcontent-%COMP%]:hover{color:#1937ea}.multi[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{margin-top:-.25em}.footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;padding:.5em}.list[_ngcontent-%COMP%]{max-height:15em;overflow:hidden;margin-left:-.5em}.list.shown[_ngcontent-%COMP%]{max-height:100em}.email[_ngcontent-%COMP%]{font-size:.75em;color:rgba(0,0,0,.6)}.list-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.25em .5em;border-radius:8px;width:100%}.list-item[_ngcontent-%COMP%]:nth-child(2n){background-color:rgba(0,0,0,.05)}.list-item[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{height:8px;width:8px;border-radius:100%;background-color:#43a047;margin:.5em .5em .5em 0}.list-item[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{margin-right:1em;flex:1;min-width:50%}a[_ngcontent-%COMP%]{color:inherit}[name=attendees][_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{margin-bottom:1.5em}button[_ngcontent-%COMP%]{width:8em;margin:.25em;white-space:nowrap}"]}),e})();var F=n("5RMF"),H=n("Ofvs"),T=n("4Man");function A(e,t){if(1&e){const e=l.Xb();l.Wb(0,"form",2),l.ec("ngSubmit",(function(){return l.wc(e),l.ic().save()})),l.Wb(1,"div",3),l.Rb(2,"a-booking-form",4),l.Vb(),l.Wb(3,"div",5),l.Wb(4,"button",6),l.ec("tapped",(function(){return l.wc(e),l.ic().cancel()})),l.Gc(5,"Cancel"),l.Vb(),l.Wb(6,"button",7),l.Gc(7,"Save"),l.Vb(),l.Vb(),l.Vb()}if(2&e){const e=l.ic();l.oc("formGroup",e.form),l.Cb(2),l.oc("form",e.form)}}let B=(()=>{class e extends r.a{constructor(e,t){super(),this._service=e,this._dialog=t,this.change=new l.n,this.loading=new l.n}ngOnInit(){this.event&&(this.form=Object(F.a)(this.event,this._service.Users.current,this._service.setting("app.booking.show_fields")||[]))}ngOnChanges(e){e.event&&this.event&&(this.form&&e.event.previousValue&&e.event.previousValue.emit("item_saved"),this.form=Object(F.a)(this.event,this._service.Users.current,this._service.setting("app.booking.show_fields")||[]))}ngOnDestroy(){this.form&&this.event&&this.event.emit("item_saved")}cancel(){this.change.emit({type:"cancel"})}save(){this.event.has_changes?this.form.valid?this._dialog.open(H.a,{width:"32em",maxWidth:"95vw",maxHeight:"95vh",data:{booking:this.event}}).componentInstance.event.subscribe(e=>{"success"===e.reason&&this.change.emit({type:"view"})}):console.warn("Some form fields are invalid:",this.form):this._service.notifyInfo("No changes have been made to booking")}handleEvent(e){}}return e.\u0275fac=function(t){return new(t||e)(l.Qb(d.a),l.Qb(C.b))},e.\u0275cmp=l.Kb({type:e,selectors:[["schedule-event-edit"]],inputs:{event:"event"},outputs:{change:"change",loading:"loading"},features:[l.zb,l.Ab],decls:2,vars:1,consts:[[1,"event-edit"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"formGroup","ngSubmit"],[1,"body"],[3,"form"],[1,"footer"],["mat-button","","type","button","name","cancel",1,"inverse",3,"tapped"],["mat-button","","type","submit"]],template:function(e,t){1&e&&(l.Wb(0,"div",0),l.Ec(1,A,8,2,"form",1),l.Vb()),2&e&&(l.Cb(1),l.oc("ngIf",t.form))},directives:[i.t,o.H,o.s,o.j,T.a,u.b,w.c],styles:[".event-edit[_ngcontent-%COMP%]{width:100%;padding:1em 2em}.footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;padding:.5em}button[_ngcontent-%COMP%]{width:8em;margin:.25em}"]}),e})();function R(e,t){if(1&e&&(l.Ub(0),l.Wb(1,"div",14),l.Wb(2,"div",2),l.Rb(3,"mat-spinner",15),l.Vb(),l.Wb(4,"div",16),l.Gc(5),l.Vb(),l.Vb(),l.Tb()),2&e){const e=l.ic();l.Cb(5),l.Ic(" ",e.loading," ")}}function L(e,t){if(1&e){const e=l.Xb();l.Ub(0),l.Wb(1,"schedule-event-details",17),l.ec("change",(function(t){return l.wc(e),l.ic().onChange(t)}))("loading",(function(t){return l.wc(e),l.ic().loading=t})),l.Vb(),l.Tb()}if(2&e){const e=l.ic();l.Cb(1),l.oc("event",e.event)}}function X(e,t){if(1&e){const e=l.Xb();l.Wb(0,"schedule-event-edit",17),l.ec("change",(function(t){return l.wc(e),l.ic().onChange(t)}))("loading",(function(t){return l.wc(e),l.ic().loading=t})),l.Vb()}if(2&e){const e=l.ic();l.oc("event",e.event)}}const $=function(e){return["/schedule","view",e]},j=function(){return["/schedule"]};let N=(()=>{class e extends r.a{constructor(e,t){super(),this._service=e,this._router=t}get spaces(){return this.event?this.event.space_list||(this.event.space?[this.event.space]:[]):[]}ngOnInit(){this.subscription("arrow_right",this._service.Hotkeys.listen(["ArrowRight"],()=>this.nextBooking())),this.subscription("arrow_left",this._service.Hotkeys.listen(["ArrowLeft"],()=>this.previousBooking())),this.subscription("changes",this._service.Bookings.listen("list").subscribe(()=>this.loadEvent()))}ngOnChanges(e){e.id&&this.id&&(this.event=null,this.editing=!1,this.loading="",this.loadEvent())}loadEvent(){this.loading="Loading booking data...";let e=this._service.Bookings.item(this.id);e?(this.event=e,this.loading=""):this._service.Bookings.show(this.id,{}).then(e=>{this.loading="",this.event=e},()=>{this.loading="",this._service.notifyError(`Failed to loaded booking data<br>ID: ${this.id}`),this._router.navigate(["/schedule"])})}nextBooking(){this.next&&!this.editing&&this._router.navigate(["/schedule","view",this.next])}previousBooking(){this.previous&&!this.editing&&this._router.navigate(["/schedule","view",this.previous])}onChange(e){"edit"===e.type?this.editing=!0:"view"!==e.type&&"cancel"!==e.type||(this.editing=!1)}}return e.\u0275fac=function(t){return new(t||e)(l.Qb(d.a),l.Qb(c.d))},e.\u0275cmp=l.Kb({type:e,selectors:[["schedule-view-event"]],inputs:{id:"id",next:"next",previous:"previous"},features:[l.zb,l.Ab],decls:25,vars:18,consts:[[1,"event-display"],[1,"header"],[1,"icon"],[1,"details"],["mat-icon-button","",3,"routerLink"],[1,"left","icon"],[1,"material-icons"],[1,"title"],[1,"right","icon"],[1,"body"],[1,"content"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["edit_form",""],[1,"no-item","center"],["diameter","48"],[1,"text"],[3,"event","change","loading"]],template:function(e,t){if(1&e&&(l.Wb(0,"div",0),l.Wb(1,"div",1),l.Rb(2,"div",2),l.Wb(3,"div",3),l.Wb(4,"a",4),l.Wb(5,"div",5),l.Wb(6,"i",6),l.Gc(7,"keyboard_arrow_left"),l.Vb(),l.Vb(),l.Vb(),l.Wb(8,"div",7),l.Gc(9),l.Vb(),l.Wb(10,"a",4),l.Wb(11,"div",8),l.Wb(12,"i",6),l.Gc(13,"keyboard_arrow_right"),l.Vb(),l.Vb(),l.Vb(),l.Vb(),l.Wb(14,"a",4),l.Wb(15,"div",2),l.Wb(16,"i",6),l.Gc(17,"close"),l.Vb(),l.Vb(),l.Vb(),l.Vb(),l.Wb(18,"div",9),l.Wb(19,"div",10),l.Ec(20,R,6,1,"ng-container",11),l.Wb(21,"div"),l.Ec(22,L,2,1,"ng-container",12),l.Ec(23,X,1,1,"ng-template",null,13,l.Fc),l.Vb(),l.Vb(),l.Vb(),l.Vb()),2&e){const e=l.tc(24);l.Cb(4),l.Gb("disabled",!t.previous),l.oc("routerLink",l.qc(13,$,t.previous)),l.Cb(5),l.Hc(t.event?t.event.title||"No title":"????"),l.Cb(1),l.Gb("disabled",!t.next),l.oc("routerLink",l.qc(15,$,t.next)),l.Cb(4),l.oc("routerLink",l.pc(17,j)),l.Cb(6),l.oc("ngIf",t.loading),l.Cb(1),l.Gb("hide",t.loading),l.Cb(1),l.oc("ngIf",!t.editing)("ngIfElse",e)}},directives:[u.a,c.g,i.t,f.c,U,B],styles:[".event-display[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden;flex-direction:column;background-color:#ccc}.event-display[_ngcontent-%COMP%], .header[_ngcontent-%COMP%]{display:flex;align-items:center}.header[_ngcontent-%COMP%]{position:relative;background-color:#1937ea;color:#fff;height:3em;width:100%;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12);z-index:10}.details[_ngcontent-%COMP%]{flex:1;min-width:50%}.details[_ngcontent-%COMP%], .icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.icon[_ngcontent-%COMP%]{height:1.25em;width:1.25em;font-size:2em;margin:0 .5em;border-radius:100%;cursor:pointer}.icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transition:font-size .2s}.icon[_ngcontent-%COMP%]:hover{color:hsla(0,0%,100%,.6)}.icon[_ngcontent-%COMP%]:active   i[_ngcontent-%COMP%]{font-size:.75em}.title[_ngcontent-%COMP%]{font-size:1.6em;min-width:50%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-align:center}.body[_ngcontent-%COMP%]{min-height:50%;max-height:100%;width:100%;flex:1;overflow:auto}.content[_ngcontent-%COMP%]{position:relative;max-width:768px;min-height:100%;margin:auto;background-color:#fff;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.disabled[_ngcontent-%COMP%]{color:hsla(0,0%,100%,.35)!important;pointer-events:none}.disabled[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:active   i[_ngcontent-%COMP%]{font-size:1em!important}.hide[_ngcontent-%COMP%]{display:none;pointer-events:none}[mat-icon-button][_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;font-size:1rem;height:2em;width:2em;margin:0 .5em}"]}),e})();var Q=n("mAda"),q=n("0njA"),K=n("kmnG"),J=n("d3UM"),Z=n("FKr1"),ee=n("Nuht"),te=n("bv9b"),ne=n("V8Ex");function ie(e,t){if(1&e&&(l.Wb(0,"div",5),l.Gc(1),l.Vb()),2&e){const e=l.ic(2);l.Cb(1),l.Hc(e.event.title)}}function oe(e,t){if(1&e&&(l.Wb(0,"div",6),l.Gc(1),l.Vb()),2&e){const e=l.ic(2);l.Cb(1),l.Ic(" No events for ",e.date_display," ")}}function se(e,t){1&e&&(l.Wb(0,"div",19),l.Gc(1,"In Progress"),l.Vb())}function ce(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div",7),l.Wb(1,"a",8),l.ec("tapped",(function(){return l.wc(e),l.ic(2).openDetailsModal()})),l.Wb(2,"div",9),l.Wb(3,"div",10),l.Wb(4,"div"),l.Gc(5),l.Vb(),l.Ec(6,se,2,0,"div",11),l.Vb(),l.Wb(7,"div",12),l.Rb(8,"img",13),l.Vb(),l.Wb(9,"div",14),l.Wb(10,"div",15),l.Gc(11),l.Vb(),l.Wb(12,"div",16),l.Rb(13,"img",17),l.Wb(14,"div",18),l.Gc(15),l.Vb(),l.Vb(),l.Vb(),l.Vb(),l.Vb(),l.Vb()}if(2&e){const e=l.ic(2);l.Cb(5),l.Hc(e.time),l.Cb(1),l.oc("ngIf",e.in_progress),l.Cb(2),l.oc("src","assets/img/"+e.type_image+".svg",l.yc),l.Cb(3),l.Hc(e.event.title),l.Cb(4),l.Hc(e.location||e.event.location_name||"No location")}}function ae(e,t){if(1&e&&(l.Wb(0,"div"),l.Ub(1,1),l.Ec(2,ie,2,1,"div",2),l.Ec(3,oe,2,1,"div",3),l.Ec(4,ce,16,5,"div",4),l.Tb(),l.Vb()),2&e){const e=l.ic();l.Eb("event-item "+e.event.type+" "+e.status),l.Db("id",e.event.id),l.Cb(1),l.oc("ngSwitch",e.event.type),l.Cb(1),l.oc("ngSwitchCase","date"),l.Cb(1),l.oc("ngSwitchCase","empty")}}let re=(()=>{class e extends r.a{constructor(e,t){super(),this._dialog=e,this._service=t}get in_progress(){return"in_progress"===this.event.status}get date_display(){if(!this.event)return"Today";const e=_(this.event.date);return _().isSame(e,"d")?"Today":e.format("DD MMM YYYY")}get location(){if(!this.event||"date"===this.event.type||"empty"===this.event.type)return"No location";const e=this.event;return(e.space_list||[e.space]).map(e=>e.name).join(", ")}get type_image(){return this.event&&"date"!==this.event.type&&"empty"!==this.event.type?this.event.has_visitors?"external":"book_room":"block"}get time(){if(!this.event||"date"===this.event.type||"empty"===this.event.type)return"";const e=this.event;return e.all_day||e.duration>1380?"All Day":_(e.date).format("h:mm A")}get status(){const e=this.event.approval_status||{},t=this.event.space_list||[];for(const o of t){const t=e[o.id]||"";if(t.indexOf("tentative")>=0||0===t.indexOf("not"))return"tentative";if(t.indexOf("declined")>=0)return"declined"}const n=this.event.location||"",i=("string"==typeof n?n:"").toLowerCase();return i.indexOf("tentative")>=0?"tentative":i.indexOf("declined")>=0?"declined":t.length?"approved":""}openDetailsModal(){this.event instanceof m.a&&this._dialog.open(ne.a,{maxHeight:"auto",maxWidth:"auto",width:"auto",height:"auto",hasBackdrop:!1,closeOnNavigation:!0,data:{booking:this.event,as_delegate:this._service.Users.current.email===(this.user||{}).email,delegate:this.user.email,is_first:!1,is_last:!1}})}}return e.\u0275fac=function(t){return new(t||e)(l.Qb(C.b),l.Qb(d.a))},e.\u0275cmp=l.Kb({type:e,selectors:[["schedule-event-item"]],inputs:{event:"event",user:"user"},features:[l.zb],decls:1,vars:1,consts:[[3,"class",4,"ngIf"],[3,"ngSwitch"],["class","day display",4,"ngSwitchCase"],["class","emptied display",4,"ngSwitchCase"],["class","event display",4,"ngSwitchDefault"],[1,"day","display"],[1,"emptied","display"],[1,"event","display"],[3,"tapped"],[1,"content"],[1,"time"],["class","info",4,"ngIf"],[1,"icon"],[3,"src"],[1,"details"],[1,"title","text"],[1,"location","text"],["src","assets/img/location.svg"],[1,"text"],[1,"info"]],template:function(e,t){1&e&&l.Ec(0,ae,5,6,"div",0),2&e&&l.oc("ngIf",t.event)},directives:[i.t,i.x,i.y,i.z,w.c],styles:[".event-item[_ngcontent-%COMP%]{height:5em;width:100%;max-width:100vw;background-color:#f8f8f8;border-bottom:1px solid rgba(0,0,0,.05)}.event-item.date[_ngcontent-%COMP%]{background-color:#ccc}.event-item.empty[_ngcontent-%COMP%]{background-color:#f0f0f0}.event-item.approved[_ngcontent-%COMP%]{background-color:#cff7df}.event-item.tentative[_ngcontent-%COMP%]{background-color:#fff5d0}.event-item.declined[_ngcontent-%COMP%]{background-color:#ffb0b0}.display[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;align-items:center;justify-content:center}.emptied[_ngcontent-%COMP%]{font-size:1.2em;color:rgba(0,0,0,.35)}.day[_ngcontent-%COMP%]{font-size:1.6em}a[_ngcontent-%COMP%]{height:100%;width:100%;color:rgba(0,0,0,.85);text-decoration:none}a[_ngcontent-%COMP%]:hover{background-color:rgba(0,0,0,.05)}.title[_ngcontent-%COMP%]{font-size:1.4em}.icon[_ngcontent-%COMP%]{height:3em;margin:0 .75em}@media only screen and (orientation:portrait) and (max-width:450px){.icon[_ngcontent-%COMP%]{margin-left:0}}@media only screen and (orientation:landscape) and (max-width:800px){.icon[_ngcontent-%COMP%]{margin-left:0}}.icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:3em}.details[_ngcontent-%COMP%]{min-width:50%;flex:1}.content[_ngcontent-%COMP%]{height:100%;max-width:768px;padding:.35em .75em;margin:auto}.content[_ngcontent-%COMP%], .location[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center}.location[_ngcontent-%COMP%]{color:rgba(0,0,0,.6);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.location[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:1em;margin:0 .25em}.location[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{flex:1;min-width:50%}.time[_ngcontent-%COMP%]{width:4.5em;text-align:center;white-space:nowrap}@media only screen and (orientation:portrait) and (max-width:450px){.time[_ngcontent-%COMP%]{transform:rotate(45deg)}}@media only screen and (orientation:landscape) and (max-width:800px){.time[_ngcontent-%COMP%]{transform:rotate(45deg)}}.text[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.info[_ngcontent-%COMP%]{font-size:.7em}"]}),e})();function de(e,t){if(1&e&&(l.Wb(0,"mat-option",19),l.Gc(1),l.Vb()),2&e){const e=t.$implicit;l.oc("value",e),l.Cb(1),l.Ic(" ",null==e?null:e.name," ")}}function le(e,t){if(1&e){const e=l.Xb();l.Wb(0,"mat-form-field",15),l.Wb(1,"mat-select",16,17),l.ec("valueChange",(function(t){return l.wc(e),l.ic().active_user=t}))("valueChange",(function(t){return l.wc(e),l.ic().updateEvents(t)})),l.Ec(3,de,2,2,"mat-option",18),l.Vb(),l.Vb()}if(2&e){const e=l.ic();l.Cb(1),l.oc("value",e.active_user),l.Cb(2),l.oc("ngForOf",e.user_list)}}const he=function(e){return{from:e}};function be(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div",20),l.Wb(1,"a-date-picker",21),l.ec("ngModelChange",(function(t){return l.wc(e),l.ic().updateDate(t)})),l.Vb(),l.Vb()}if(2&e){const e=l.ic();l.Cb(1),l.oc("ngModel",e.date)("options",l.qc(2,he,e.now))}}function ge(e,t){1&e&&l.Rb(0,"mat-progress-bar",22)}function ue(e,t){if(1&e&&(l.Ub(0),l.Rb(1,"schedule-event-item",23),l.Tb()),2&e){const e=t.$implicit,n=l.ic();l.Cb(1),l.oc("user",n.active_user)("event",e)}}const fe=function(){return{class:"material-icons",content:"event"}};let me=(()=>{class e extends r.a{constructor(e,t){super(),this._service=e,this._route=t,this.event_list=new l.n,this.events=[],this.shown_offset=7,this.date_offset=0,this.now=_().valueOf(),this.at_top=!0,this.user_list=[]}ngOnInit(){this.subscription("route.query",this._route.queryParamMap.subscribe(e=>{e.has("email")&&(this.active_user=this._service.Users.item(e.get("email"))||new Q.a(this._service.Users,{email:e.get("email")}))})),this.updateEvents(),this.interval("update_events",()=>this.updateEvents(),1e4),this.subscription("scroll",this.scroll_viewport.elementScrolled().subscribe(()=>this.onScroll())),this.subscription("delegate_list",this._service.Users.listen("delegates").subscribe(e=>{e&&e[0]&&(this.user_list=[this._service.Users.current].concat(e),this.active_user||(this.active_user=this.user_list[0]))}))}updateEvents(){return this.event_promise||(this.event_promise=new Promise(e=>{const t=_().add(this.date_offset,"d").startOf("d"),n=t.add(7,"d").endOf("d");this.loading=!0,this._service.Bookings.query({email:(this.active_user?this.active_user.email:"")||this._service.Users.current.email,from:t.unix(),to:n.unix()}).then(e=>{this._service.Bookings.updateList(this._service.Bookings.list(),e);const i=this.events.filter(e=>{const i=_(e.date);return"date"!==e.type&&"empty"!==e.type&&(i.isBefore(t,"s")||i.isAfter(n,"s"))});this.events=this.processEvents(e,i);const o=this.events.filter(e=>"date"!==e.type&&"empty"!==e.type);this.event_list.emit(o.map(e=>({id:e.id,date:e.date}))),this.timeout("scroll_to",()=>this.scrollTo()),this.loading=!1,delete this.event_promise},()=>{this.loading=!1,delete this.event_promise})})),this.event_promise}processEvents(e,t=[]){let n=[];const i=_();let o=_().startOf("d");const s=o.add(this.shown_offset,"d").endOf("d");for(;o.isBefore(s);o=o.add(1,"d")){const s=o.format("YYYY-MM-DD");n.push({id:s,type:"date",order_id:s,title:o.format("dddd, DD MMM"),is_today:o.isSame(i,"d"),date:o.valueOf()});const c=e=>{const t=_(e.date);return t.isAfter(o,"s")&&t.isBefore(o.endOf("d"),"s")},a=e.filter(c),r=t.filter(c);a.length||r.length?n=n.concat(a).concat(r):n.push({id:`${s}-empty`,type:"empty",order_id:s,title:`No items for ${o.format("dddd, DD MMM")}`,is_today:o.isSame(i,"d"),date:o.valueOf()+1})}return n.sort((e,t)=>e.date-t.date),n=Object(v.k)(n,"id"),n}onScroll(){if(!this.event_promise){this.show_calendar=!1;const e=this.scroll_viewport.getRenderedRange(),t=e.end-e.start,n=this.events[e.start];this.at_top=0===e.start&&this.scroll_viewport.measureScrollOffset()<5,this.date_offset=_(n.date).diff(_(),"d")-1,this.date=_((this.events[t+e.start]||{}).date).subtract(1,"d").valueOf(),e.end>this.events.length-7&&(this.shown_offset+=3,this.updateEvents())}}updateDate(e){const t=_(e);this.date_offset=t.diff(_(),"d")-1,this.shown_offset=Math.max(this.shown_offset,this.date_offset+3),this.scroll_to=t.format("YYYY-MM-DD"),delete this.event_promise,this.show_calendar=!1,this.date=_().add(this.date_offset,"d").valueOf(),this.updateEvents()}scrollTo(){if(this.scroll_to){const e=this.events.findIndex(e=>e.id===this.scroll_to);e>-1&&(this.scroll_viewport.scrollToIndex(e,"smooth"),this.scroll_to=null)}}}return e.\u0275fac=function(t){return new(t||e)(l.Qb(d.a),l.Qb(c.a))},e.\u0275cmp=l.Kb({type:e,selectors:[["schedule-event-list"]],viewQuery:function(e,t){var n;1&e&&l.Cc(s.d,!0),2&e&&l.sc(n=l.fc())&&(t.scroll_viewport=n.first)},outputs:{event_list:"eventList"},features:[l.zb],decls:15,vars:8,consts:[[1,"event-list"],[1,"header","dark-mode"],[1,"user"],["appearance","outline",4,"ngIf"],[1,"flex"],[1,"date"],["mat-icon-button","",3,"tapped"],[3,"icon"],["class","tooltip",4,"ngIf"],[1,"progress"],["mode","indeterminate",4,"ngIf"],[1,"body"],["itemSize","80",1,"viewport",3,"scroll"],[4,"cdkVirtualFor","cdkVirtualForOf"],[1,"footer"],["appearance","outline"],[3,"value","valueChange"],["select",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"tooltip"],[3,"ngModel","options","ngModelChange"],["mode","indeterminate"],[3,"user","event"]],template:function(e,t){1&e&&(l.Wb(0,"div",0),l.Wb(1,"div",1),l.Wb(2,"div",2),l.Ec(3,le,4,2,"mat-form-field",3),l.Vb(),l.Rb(4,"div",4),l.Wb(5,"div",5),l.Wb(6,"button",6),l.ec("tapped",(function(){return t.show_calendar=!t.show_calendar})),l.Rb(7,"app-icon",7),l.Vb(),l.Ec(8,be,2,4,"div",8),l.Vb(),l.Vb(),l.Wb(9,"div",9),l.Ec(10,ge,1,0,"mat-progress-bar",10),l.Vb(),l.Wb(11,"div",11),l.Wb(12,"cdk-virtual-scroll-viewport",12),l.ec("scroll",(function(){return t.onScroll()})),l.Ec(13,ue,2,2,"ng-container",13),l.Vb(),l.Vb(),l.Rb(14,"div",14),l.Vb()),2&e&&(l.Cb(1),l.Gb("scrolled",!t.at_top),l.Cb(2),l.oc("ngIf",t.user_list&&t.user_list.length>1),l.Cb(4),l.oc("icon",l.pc(7,fe)),l.Cb(1),l.oc("ngIf",t.show_calendar),l.Cb(2),l.oc("ngIf",t.loading),l.Cb(3),l.oc("cdkVirtualForOf",t.events))},directives:[i.t,u.b,w.c,q.a,s.d,s.a,s.c,K.b,J.a,i.s,Z.g,ee.a,o.r,o.u,te.a,re],styles:[".event-list[_ngcontent-%COMP%]{top:0;left:0;right:0;overflow:hidden;display:flex;align-items:center;flex-direction:column}.event-list[_ngcontent-%COMP%], .progress[_ngcontent-%COMP%]{position:absolute;bottom:0}.progress[_ngcontent-%COMP%]{width:100%;z-index:999}.header[_ngcontent-%COMP%]{display:flex;align-items:center;background:linear-gradient(90deg,#051c2c,#051c2c 40%,#0b2453 60%,#1f40e6);color:#fff;height:3.5em;width:100%;z-index:10;transition:box-shadow .2s}.header.scrolled[_ngcontent-%COMP%]{box-shadow:0 1px 3px 2px rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.header[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]{height:100%;padding:0 .5em}.date[_ngcontent-%COMP%]{position:relative;margin:.5em}.date[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:1.25rem;height:2em;width:2em}.flex[_ngcontent-%COMP%]{flex:1;min-width:1px}.body[_ngcontent-%COMP%]{min-height:50%;max-height:100%;width:100%;flex:1;background-color:#e6e6e6;overflow:auto}.viewport[_ngcontent-%COMP%]{height:100%;width:100%;overflow:hidden auto}.load-state[_ngcontent-%COMP%]{position:absolute;left:50%;bottom:1em;transform:translateX(-50%);font-size:.75em}.tooltip[_ngcontent-%COMP%]{position:absolute;bottom:-.5em;right:-.25em;transform:translateY(100%);background-color:#fff;padding:.5em;border-radius:4px;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12);z-index:999;color:#000;font-size:1rem}"]}),e})();function ve(e,t){if(1&e&&(l.Ub(0),l.Rb(1,"schedule-view-event",9),l.Tb()),2&e){const e=l.ic();l.Cb(1),l.oc("id",e.id)("next",e.next)("previous",e.previous)}}function pe(e,t){if(1&e){const e=l.Xb();l.Ub(0),l.Wb(1,"schedule-event-list",10),l.ec("eventList",(function(t){return l.wc(e),l.ic().updateEvents(t)})),l.Vb(),l.Tb()}}let _e=(()=>{class e extends r.a{constructor(e,t){super(),this._route=e,this._service=t,this.show_menu=!1}get next(){if(this.events){const e=this.events.findIndex(e=>this.id===e.id)+1;if(e>-1&&this.events[e])return this.events[e].id}return""}get previous(){if(this.events){const e=this.events.findIndex(e=>this.id===e.id)-1;if(e>-1&&this.events[e])return this.events[e].id}return""}ngOnInit(){this.subscription("route.route",this._route.paramMap.subscribe(e=>{e.has("page")&&(this.page=e.get("page")),e.has("id")&&(this.id=e.get("id"))})),this.loadEvents(),this._service.title="My Day"}updateEvents(e){this.events=e,this.saveEvents()}saveEvents(){localStorage&&localStorage.setItem("STAFF.events",JSON.stringify(this.events||[]))}loadEvents(){if(localStorage){const e=localStorage.getItem("STAFF.events");this.events=JSON.parse(e||"[]")}}}return e.\u0275fac=function(t){return new(t||e)(l.Qb(c.a),l.Qb(d.a))},e.\u0275cmp=l.Kb({type:e,selectors:[["app-schedule"]],features:[l.zb],decls:10,vars:4,consts:[[1,"schedule","page"],[1,"header"],[3,"menu","menuChange"],[1,"body"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"footer"],[3,"show","showChange"],[3,"id","next","previous"],[3,"eventList"]],template:function(e,t){1&e&&(l.Wb(0,"div",0),l.Wb(1,"header",1),l.Wb(2,"a-topbar-header",2),l.ec("menuChange",(function(e){return t.show_menu=e})),l.Vb(),l.Vb(),l.Wb(3,"main",3),l.Ub(4,4),l.Ec(5,ve,2,3,"ng-container",5),l.Ec(6,pe,2,0,"ng-container",6),l.Tb(),l.Vb(),l.Wb(7,"footer",7),l.Rb(8,"a-footer-menu"),l.Vb(),l.Vb(),l.Wb(9,"a-overlay-menu",8),l.ec("showChange",(function(e){return t.show_menu=e})),l.Vb()),2&e&&(l.Cb(2),l.oc("menu",t.show_menu),l.Cb(2),l.oc("ngSwitch",t.page),l.Cb(1),l.oc("ngSwitchCase","view"),l.Cb(4),l.oc("show",t.show_menu))},directives:[h.a,i.x,i.y,i.z,b.a,g.a,N,me],styles:[".page[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;align-items:center;flex-direction:column}.page[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}.body[_ngcontent-%COMP%]{position:relative;min-width:50%;flex:1}"]}),e})();const Ce=[{path:"",component:_e},{path:":page",component:_e},{path:":page/:id",component:_e},{path:"**",redirectTo:""}];var we=n("PCNd");n.d(t,"ScheduleModule",(function(){return xe}));let xe=(()=>{class e{}return e.\u0275mod=l.Ob({type:e}),e.\u0275inj=l.Nb({factory:function(t){return new(t||e)},imports:[[i.c,o.l,a.b,o.l,o.B,c.h.forChild(Ce),we.a,s.f]]}),e})()}}]);