(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"7NT8":function(t,e,n){"use strict";n.r(e);var o=n("ofXK"),i=n("tyNb"),s=n("3Pt+"),a=n("IhUT"),c=n("1gA9"),r=n("OaWH"),d=n("IWZj"),l=n("fXoL"),u=n("ocbO"),b=n("mrSG"),h=n("SxV6"),g=n("Kj3r"),p=n("/uUt"),m=n("eIep"),f=n("JIr8"),_=n("lJxs"),C=n("XNiG"),v=n("LRne"),x=n("KsZa"),O=n("/1cH"),w=n("0njA"),M=n("Xa2L"),y=n("FKr1");const k=["input"];function P(t,e){1&t&&l.Rb(0,"mat-spinner",12)}const z=function(){return{type:"icon",class:"material-icons",content:"search"}};function W(t,e){if(1&t){const t=l.Xb();l.Wb(0,"div",4),l.ec("focus",(function(){return l.wc(t),l.ic().focusField()}))("click",(function(){return l.wc(t),l.ic().focusField()})),l.Wb(1,"div",5),l.Rb(2,"app-icon",6),l.Vb(),l.Wb(3,"div",7),l.Wb(4,"input",8,9),l.ec("ngModelChange",(function(e){return l.wc(t),l.ic().search_str=e}))("ngModelChange",(function(e){return l.wc(t),l.ic().search$.next(e)})),l.Vb(),l.Vb(),l.Wb(6,"div",10),l.Ec(7,P,1,0,"mat-spinner",11),l.Vb(),l.Vb()}if(2&t){const t=l.ic(),e=l.tc(2);l.Cb(2),l.oc("icon",l.pc(5,z)),l.Cb(2),l.oc("ngModel",t.search_str)("matAutocomplete",e)("placeholder",t.placeholder||"Search..."),l.Cb(3),l.oc("ngIf",t.loading)}}function V(t,e){if(1&t&&(l.Wb(0,"mat-option",13),l.Wb(1,"div",14),l.Gc(2),l.Vb(),l.Wb(3,"div",15),l.Gc(4),l.Vb(),l.Vb()),2&t){const t=e.$implicit;l.oc("value",t),l.Cb(2),l.Hc(t.name),l.Cb(2),l.Hc(t.level?t.level.name:t.email)}}let I=(()=>{class t extends d.a{constructor(t,e,n){super(),this._service=t,this._route=e,this._router=n,this.results=[],this.search$=new C.a}ngOnInit(){this.subscription("route.params",this._route.paramMap.subscribe(t=>{t.has("search_type")&&(this.type=t.get("search_type"))})),this.search_results$=this.search$.pipe(Object(g.a)(400),Object(p.a)(),Object(m.a)(t=>(this.loading=!0,t.length>=3?this._service.Users.query({q:t.slice(0,3),cache:6e4}):Promise.resolve([]))),Object(f.a)(t=>Object(v.a)([])),Object(_.a)(t=>{const e=this._service.Spaces.list(t=>!0),n=(this.search_str||"").toLowerCase();let o=[];return o="space"===this.type?e:"user"===this.type?t:e.concat(t),this.loading=!1,o.filter(t=>(t.name||"").toLowerCase().indexOf(n)>=0||(t.email||"").toLowerCase().indexOf(n)>=0)})),this.subscription("search_results",this.search_results$.subscribe(t=>{this.results=t}))}ngOnChanges(t){t.autofocus&&this.autofocus&&this.focusField()}focusField(){this.input_field&&this.input_field.nativeElement&&this.input_field.nativeElement.focus()}selectOption(t){this._router.navigate([],t instanceof x.a?{relativeTo:this._route,queryParams:{space:t.id},queryParamsHandling:"merge"}:{relativeTo:this._route,queryParams:{user:t.email},queryParamsHandling:"merge"}),this.search_str=t.name}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(r.a),l.Qb(i.a),l.Qb(i.d))},t.\u0275cmp=l.Kb({type:t,selectors:[["explore-search"]],viewQuery:function(t,e){var n;1&t&&l.Cc(k,!0),2&t&&l.sc(n=l.fc())&&(e.input_field=n.first)},inputs:{type:"type",autofocus:"autofocus",placeholder:"placeholder"},features:[l.zb,l.Ab],decls:4,vars:2,consts:[["class","searchbar","tabindex","0",3,"focus","click",4,"ngIf"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["tabindex","0",1,"searchbar",3,"focus","click"],[1,"prefix"],[3,"icon"],[1,"input"],["type","text",3,"ngModel","matAutocomplete","placeholder","ngModelChange"],["input",""],[1,"suffix"],["diameter","32",4,"ngIf"],["diameter","32"],[3,"value"],[1,"name"],[1,"email"]],template:function(t,e){1&t&&(l.Ec(0,W,8,6,"div",0),l.Wb(1,"mat-autocomplete",1,2),l.ec("optionSelected",(function(t){return e.selectOption(t.option.value)})),l.Ec(3,V,5,3,"mat-option",3),l.Vb()),2&t&&(l.oc("ngIf",e.type),l.Cb(3),l.oc("ngForOf",e.results))},directives:[o.t,O.a,o.s,w.a,s.c,O.d,s.r,s.u,M.c,y.g],styles:[".searchbar[_ngcontent-%COMP%]{display:flex;align-items:center;max-width:calc(100% - 1em);width:calc(100% - 1em);margin:.5em auto;background-color:#fff;border-radius:2em;padding:0 .75em;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}@media only screen and (orientation:portrait) and (max-width:450px){.searchbar[_ngcontent-%COMP%]{border-radius:0;box-shadow:none;margin:0;width:100%;max-width:100%;padding:0 .5em;border-bottom:1px solid #ccc}}@media only screen and (orientation:landscape) and (max-width:800px){.searchbar[_ngcontent-%COMP%]{border-radius:0;box-shadow:none;margin:0;width:100%;max-width:100%;padding:0 .5em;border-bottom:1px solid #ccc}}.prefix[_ngcontent-%COMP%], .suffix[_ngcontent-%COMP%]{font-size:1.5em;min-width:32px;min-height:100%}.input[_ngcontent-%COMP%]{flex:1;min-width:50%}input[_ngcontent-%COMP%]{width:100%;font-size:1em;border:none;outline:none;padding:1em .5em;background:none}.name[_ngcontent-%COMP%]{height:1em}.email[_ngcontent-%COMP%]{font-size:.6em;color:rgba(0,0,0,.65)}"]}),t})();var S=n("xhdr"),E=n("5RMF");function $(t,e){if(1&t&&(l.Wb(0,"div",8),l.Gc(1),l.Vb()),2&t){const t=l.ic(2);l.Cb(1),l.Hc(t.available_until)}}function q(t,e){if(1&t&&(l.Wb(0,"div",1),l.Rb(1,"div",2),l.Wb(2,"div",3),l.Wb(3,"div",4),l.Gc(4),l.Vb(),l.Wb(5,"div",5),l.Wb(6,"div",6),l.Gc(7),l.Vb(),l.Ec(8,$,2,1,"div",7),l.Vb(),l.Vb(),l.Vb()),2&t){const t=l.ic();l.Eb("space-info "+t.quadrant),l.oc("id",t.space.id),l.Cb(4),l.Hc(t.space.name),l.Cb(2),l.Eb(t.status_class),l.Cb(1),l.Hc(t.status),l.Cb(1),l.oc("ngIf","not-bookable"!==t.status_class)}}let R=(()=>{class t extends d.a{constructor(t,e,n){super(),this._data=t,this._position=e,this._service=n}get quadrant(){if(!this._position)return"top left";const t=this._position;return t.x>50&&t.y>50?"bottom right":t.x<50&&t.y>50?"bottom left":t.x>50?"top right":"top left"}get status_class(){return(this.status||"").toLowerCase().split(" ").join("-")}get space(){return this._data?this._data.space:null}get bookings(){return this._data&&this._data.bookings||[]}ngOnInit(){this.processBookings(),this.interval("update_bookings",()=>this.processBookings(),6e4)}processBookings(){if(!this.space)return;const t=Object(E.d)(this.bookings,this.space.bookable,this.space.byRequest({date:this._data.date,duration:30,host:this._service.Users.current}),this._data.date);this.status=t.status,this.available_until=t.available_until}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(c.c),l.Qb(c.b),l.Qb(r.a))},t.\u0275cmp=l.Kb({type:t,selectors:[["a-space-info"]],features:[l.zb],decls:1,vars:1,consts:[[3,"id","class",4,"ngIf"],[3,"id"],[1,"arrow"],[1,"details"],[1,"name"],[1,"availability"],["name","status"],["name","available-until",4,"ngIf"],["name","available-until"]],template:function(t,e){1&t&&l.Ec(0,q,9,8,"div",0),2&t&&l.oc("ngIf",e.space)},directives:[o.t],styles:["[_nghost-%COMP%]{pointer-events:none}.space-info[_ngcontent-%COMP%]{position:absolute;min-width:16em;border-radius:4px;background-color:#fff;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.space-info.top[_ngcontent-%COMP%]{top:0}.space-info.top.left[_ngcontent-%COMP%]{left:0;border-top-left-radius:0}.space-info.top.right[_ngcontent-%COMP%]{right:0;border-top-right-radius:0}.space-info.bottom[_ngcontent-%COMP%]{bottom:0}.space-info.bottom.left[_ngcontent-%COMP%]{left:0;border-bottom-left-radius:0}.space-info.bottom.right[_ngcontent-%COMP%]{right:0;border-bottom-right-radius:0}.top[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{top:2px}.top.left[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{left:2px;border-width:8px 8px 0 0;border-color:#1937ea transparent transparent}.top.right[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{right:2px;border-width:0 8px 8px 0;border-color:transparent #1937ea transparent transparent}.bottom[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{bottom:2px}.bottom.left[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{left:2px;border-width:8px 0 0 8px;border-color:transparent transparent transparent #1937ea}.bottom.right[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{right:2px;border-width:0 0 8px 8px;border-color:transparent transparent #1937ea}.arrow[_ngcontent-%COMP%]{position:absolute;width:0;height:0;border-style:solid}.details[_ngcontent-%COMP%]{padding:1em}.name[_ngcontent-%COMP%]{font-size:1.25em;padding:.2em .4em}.availability[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{padding:.25rem .5rem;display:inline-block}[name=status][_ngcontent-%COMP%]{border-radius:4px;color:#fff;font-size:.8em;margin-right:auto}[name=status].not-bookable[_ngcontent-%COMP%]{background-color:#ccc}[name=status].available[_ngcontent-%COMP%]{background-color:#43a047}[name=status].available-by-request[_ngcontent-%COMP%]{background-color:#ffb300}[name=status].meeting-in-progress[_ngcontent-%COMP%]{background-color:#e53935}"]}),t})();var G=n("Wgwc"),F=n("0IaG"),j=n("4Man"),B=n("bTqV"),D=n("m6yr");const H=function(){return{class:"material-icons",content:"add"}};function U(t,e){if(1&t&&(l.Ub(0),l.Rb(1,"app-icon",5),l.Wb(2,"div",6),l.Gc(3," Book "),l.Wb(4,"span"),l.Gc(5),l.Vb(),l.Gc(6),l.Vb(),l.Tb()),2&t){const t=l.ic(2);l.Cb(1),l.oc("icon",l.pc(3,H)),l.Cb(4),l.Hc(null==t.space?null:t.space.name),l.Cb(1),l.Ic(" ",t.is_now?"from now":"at "+t.time," ")}}function Q(t,e){if(1&t&&(l.Ub(0),l.Wb(1,"div",6),l.Gc(2," Book "),l.Wb(3,"span"),l.Gc(4),l.Vb(),l.Vb(),l.Tb()),2&t){const t=l.ic(2);l.Cb(4),l.Hc(null==t.space?null:t.space.name)}}function T(t,e){if(1&t&&(l.Ub(0),l.Rb(1,"a-booking-form",10),l.Tb()),2&t){const t=l.ic(3);l.Cb(1),l.oc("form",t.form)}}function A(t,e){1&t&&(l.Wb(0,"p"),l.Gc(1,"This space requires approval to reserve"),l.Vb())}function L(t,e){if(1&t&&(l.Ub(0),l.Wb(1,"p"),l.Gc(2),l.Vb(),l.Ec(3,A,2,0,"p",3),l.Tb()),2&t){const t=l.ic(3);l.Cb(2),l.Hc(t.available_until),l.Cb(1),l.oc("ngIf",t.is_requesting)}}function K(t,e){if(1&t&&(l.Wb(0,"main"),l.Ub(1,7),l.Ec(2,T,2,1,"ng-container",8),l.Ec(3,L,4,2,"ng-container",9),l.Tb(),l.Vb()),2&t){const t=l.ic(2);l.Cb(1),l.oc("ngSwitch",t.state),l.Cb(1),l.oc("ngSwitchCase","form")}}function X(t,e){if(1&t){const t=l.Xb();l.Wb(0,"mat-dialog-actions"),l.Wb(1,"footer"),l.Wb(2,"button",11),l.Gc(3,"Cancel"),l.Vb(),l.Wb(4,"button",12),l.ec("tapped",(function(){l.wc(t);const e=l.ic(2);return"form"===e.state?e.book():e.next()})),l.Gc(5),l.Vb(),l.Vb(),l.Vb()}if(2&t){const t=l.ic(2);l.Cb(5),l.Ic(" ","form"===t.state?t.is_requesting?"Request":"Book":"Yes"," ")}}function Y(t,e){if(1&t&&(l.Wb(0,"main"),l.Wb(1,"div",13),l.Wb(2,"div",14),l.Rb(3,"mat-spinner",15),l.Vb(),l.Wb(4,"div",6),l.Gc(5),l.Vb(),l.Vb(),l.Vb()),2&t){const t=l.ic(2);l.Cb(5),l.Hc(t.loading||"Processing request...")}}function N(t,e){if(1&t&&(l.Ub(0),l.Wb(1,"header",2),l.Ec(2,U,7,4,"ng-container",3),l.Ec(3,Q,5,1,"ng-container",3),l.Vb(),l.Wb(4,"mat-dialog-content"),l.Ec(5,K,4,2,"main",0),l.Vb(),l.Ec(6,X,6,1,"mat-dialog-actions",3),l.Ec(7,Y,6,1,"ng-template",null,4,l.Fc),l.Tb()),2&t){const t=l.tc(8),e=l.ic();l.Cb(1),l.Gb("request",e.is_requesting),l.Cb(1),l.oc("ngIf","form"!==e.state),l.Cb(1),l.oc("ngIf","form"===e.state),l.Cb(2),l.oc("ngIf",!e.loading)("ngIfElse",t),l.Cb(1),l.oc("ngIf",!e.loading)}}function J(t,e){if(1&t&&(l.Ub(0),l.Gc(1,"Request for "),l.Wb(2,"span"),l.Gc(3),l.Vb(),l.Gc(4," sent"),l.Tb()),2&t){const t=l.ic(2);l.Cb(3),l.Hc(null==t.space?null:t.space.name)}}function Z(t,e){if(1&t&&(l.Ub(0),l.Gc(1,"Booked "),l.Wb(2,"span"),l.Gc(3),l.Vb(),l.Gc(4),l.Tb()),2&t){const t=l.ic(2);l.Cb(3),l.Hc(null==t.space?null:t.space.name),l.Cb(1),l.Ic(" ",t.is_now?"from now":"at "+t.time,"")}}const tt=function(t){return{class:"material-icons",content:t}};function et(t,e){if(1&t&&(l.Wb(0,"header",16),l.Wb(1,"div",6),l.Ec(2,J,5,1,"ng-container",3),l.Ec(3,Z,5,2,"ng-container",3),l.Vb(),l.Rb(4,"app-icon",5),l.Vb()),2&t){const t=l.ic();l.Gb("request",t.is_requesting),l.Cb(2),l.oc("ngIf",t.is_requesting),l.Cb(1),l.oc("ngIf",!t.is_requesting),l.Cb(1),l.oc("icon",l.qc(5,tt,t.is_requesting?"send":"done"))}}let nt=(()=>{class t extends d.a{constructor(t,e,n,o){super(),this._dialog_ref=t,this._data=e,this._router=n,this._service=o,this.state="info";const i=G(this._data.date);this.booking=new S.a(this._service.Bookings,{title:"Ad-Hoc Booking",date:i.valueOf(),duration:30,room_ids:[this._data.space.id]});const s=Object(E.d)(this._data.bookings,this.space.bookable,this.space.byRequest({date:this._data.date,duration:30,host:this._service.Users.current}),this._data.date);this.available_until=s.available_until}get is_requesting(){const t=this.booking.toJSON(!0);return this.space.byRequest({date:this.booking.changes.date||this.booking.date||G(this._data.date).valueOf(),duration:this.booking.changes.duration||this.booking.duration||30,host:t.organiser||this._service.Users.current})}get date(){return G(this._data.date).format("DD MMM YYYY")}get time(){return G(this._data.date).format("h:mm A")}get space(){return this._data.space}get is_now(){const t=G(),e=G(this._data.date);return t.isSame(e,"m")||t.isAfter(e,"m")}next(){if(this.is_now)this.form=Object(E.a)(this.booking,this._service.Users.current,["space_list","organiser","title","duration"]),this.state="form";else{const t=this.booking.toJSON(!0);localStorage.setItem("ACA_STAFF.booking_form_data",JSON.stringify(Object.assign({id:"ad-hoc"},t))),this._router.navigate(["/book","space"],{queryParams:{back:"/explore"}}),this._dialog_ref.close()}}book(){this.form.valid&&(this.loading="Checking space availability...",this.checkSpaceAvailability().then(()=>{this.booking.save(!0).then(()=>{this.loading=null,this.success=!0,this.timeout("close",()=>this._dialog_ref.close(),5e3)},t=>{this.loading=null,this._service.notifyError(`Error ${this.booking.id?"updating":"creating"} booking: ${t.message||t}}`)})},t=>{this.loading=null,this._service.notifyError(`Error checking space availability: ${t.message||t}`)}))}checkSpaceAvailability(){const t=this.booking.changes.space_list||this.booking.space_list;return new Promise((e,n)=>{this._service.Spaces.available({room_ids:t.map(t=>t.id).join(","),date:this.booking.changes.date||this.booking.date,duration:this.booking.changes.duration||this.booking.duration}).then(t=>{for(const e of t)if(!e.was_available)return n(`${e.name} is not available at the select time period.`);e()},t=>n(t))})}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(F.h),l.Qb(F.a),l.Qb(i.d),l.Qb(r.a))},t.\u0275cmp=l.Kb({type:t,selectors:[["a-explore-booking-modal"]],features:[l.zb],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["done_state",""],["mat-dialog-title",""],[4,"ngIf"],["load_state",""],[3,"icon"],[1,"text"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"form"],["mat-button","","mat-dialog-close","",1,"inverse"],["mat-button","",3,"tapped"],[1,"info-block"],[1,"icon"],["diameter","48"],[1,"success"]],template:function(t,e){if(1&t&&(l.Ec(0,N,9,7,"ng-container",0),l.Ec(1,et,5,7,"ng-template",null,1,l.Fc)),2&t){const t=l.tc(2);l.oc("ngIf",!e.success)("ngIfElse",t)}},directives:[o.t,F.i,F.f,w.a,o.x,o.y,o.z,j.a,F.c,B.b,F.d,D.c,M.c],styles:["[_nghost-%COMP%]{max-width:24em}header[_ngcontent-%COMP%]{color:#fff}header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700}header.success[_ngcontent-%COMP%]{background-color:#43a047}header.request[_ngcontent-%COMP%]{background-color:#ffb300}main[_ngcontent-%COMP%]{padding:0 1em .5em}footer[_ngcontent-%COMP%]{width:100%;text-align:center}button[_ngcontent-%COMP%]{min-width:8em}p[_ngcontent-%COMP%]{margin:.5em 0;font-size:1.25em}"]}),t})();const ot=["space-status",""];function it(t,e){if(1&t){const t=l.Xb();l.Wb(0,"i",3),l.ec("modelChange",(function(n){l.wc(t);const o=e.$implicit;return l.ic(2).processSpaceBookings(o,n)})),l.Vb()}2&t&&l.oc("sys",e.$implicit.id)}function st(t,e){if(1&t&&(l.Wb(0,"div",1),l.Ec(1,it,1,1,"i",2),l.Vb()),2&t){const t=l.ic();l.Cb(1),l.oc("ngForOf",t.space_list)}}const at=["*"];let ct=(()=>{class t extends d.a{constructor(t,e){super(),this._service=t,this._dialog=e,this.status=new l.n,this.listeners=new l.n,this.features=new l.n,this.space_list=[],this.active_bookings={},this.colour_map={}}get is_today(){return G().isSame(G(this.date),"d")}ngOnInit(){this._service.initialised.pipe(Object(h.a)(t=>t)).subscribe(()=>{this.colour_map=this._service.setting("app.explore.colors")||{},this.subscription("spaces",this._service.Spaces.listen("list").subscribe(()=>this.loadSpaces())),this.interval("update_status",()=>{this.updateSpaceBookings(),this.calculateStatus()},6e4)})}ngOnChanges(t){(t.zone||t.date)&&this.loadSpaces(),t.zone&&this.clearSpaces()}ngOnDestroy(){this.clearSpaces()}calculateStatus(){this.timeout("process_statuses",()=>{const t=[];for(const e of this.space_list){const n=this.getStatus(e,this.date),o=e.map_id.indexOf("area")<0?`area-${e.map_id}-status`:e.map_id;t.push({id:o,styles:{fill:this.colour_map[`space-${n}`]||"#000",opacity:.6},status_id:n})}this.status.emit(t)})}getStatus(t,e){if(!t.bookable)return"not-bookable";const n=this.active_bookings[t.id]||[],o=G(e).startOf("m").second(1);if(n.find(t=>{const e=G(t.date).startOf("m"),n=e.add(t.duration,"m");return o.isAfter(e,"s")&&o.isBefore(n,"m")}))return"unavailable";const i={date:G(this.date).valueOf(),duration:30,host:this._service.Users.current},s=t.rulesFor(i);return s.hide?"not-bookable":s.auto_approve?"available":"requestable"}processSpaceBookings(t,e){this.timeout(`space-${t.id}`,()=>{const n=(e||[]).map(e=>new S.a(this._service.Bookings,Object.assign(Object.assign({},e),{room_ids:[t.id]})));this.active_bookings[t.id]=n,this.calculateStatus()},10)}updateSpaceBookings(){this.is_today||this.timeout("update_spaces",()=>{const t=G(this.date).startOf("d");this._service.Spaces.query({from:t.unix(),to:t.endOf("d").unix(),show_declined:!1,zone_ids:this.zone,cache:1e4}).then(t=>{t.forEach(t=>this.processSpaceBookings(t,t.bookings))})},50)}loadSpaces(){this.space_list=this._service.Spaces.list(t=>t.zones.indexOf(this.zone)>=0);const t=[];for(const e of this.space_list){const n=e.map_id.indexOf("area")<0?`area-${e.map_id}-status`:e.map_id;t.push({id:n,event:"mouseenter",callback:()=>this.showSpaceInfo(e)}),t.push({id:n,event:"mouseleave",callback:()=>this.features.emit([])}),e.bookable&&t.push({id:n,event:"click",callback:()=>this.openBookingModal(e)})}this.listeners.emit(t),this.updateSpaceBookings(),this.calculateStatus()}clearSpaces(){delete this.active_bookings,this.active_bookings={}}showSpaceInfo(t){const e=t.map_id.indexOf("area")<0?`area-${t.map_id}-status`:t.map_id;this.features.emit([{id:e,coordinates:null,content:R,data:{space:t,bookings:this.active_bookings[t.id],date:this.date}}])}openBookingModal(t){const e=this.getStatus(t,this.date);"unavailable"!==e&&"not-bookable"!==e?this._dialog.open(nt,{width:"auto",height:"auto",data:{date:this.date,space:t,bookings:this.active_bookings[t.id]}}):this._service.notifyInfo(`${t.name} is unavailable at the selected time. Please select another space or time and try again.`)}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(r.a),l.Qb(F.b))},t.\u0275cmp=l.Kb({type:t,selectors:[["","space-status",""]],inputs:{zone:"zone",date:"date"},outputs:{status:"status",listeners:"listeners",features:"features"},features:[l.zb,l.Ab],attrs:ot,ngContentSelectors:at,decls:2,vars:1,consts:[["class","bindings",4,"ngIf"],[1,"bindings"],["binding","","mod","Bookings","bind","today",3,"sys","modelChange",4,"ngFor","ngForOf"],["binding","","mod","Bookings","bind","today",3,"sys","modelChange"]],template:function(t,e){1&t&&(l.nc(),l.Ec(0,st,2,1,"div",0),l.mc(1)),2&t&&l.oc("ngIf",e.space_list&&e.is_today)},directives:[o.t,o.s,a.a],encapsulation:2}),t})();const rt=["desk-status",""],dt=function(t){return[t]},lt=function(){return[]};function ut(t,e){if(1&t){const t=l.Xb();l.Wb(0,"div",1),l.Wb(1,"i",2),l.ec("modelChange",(function(e){return l.wc(t),l.ic().in_use=e}))("modelChange",(function(){return l.wc(t),l.ic().calculateStatus()})),l.Vb(),l.Wb(2,"i",2),l.ec("modelChange",(function(e){return l.wc(t),l.ic().id_list=e}))("modelChange",(function(){return l.wc(t),l.ic().calculateStatus()})),l.Vb(),l.Wb(3,"i",2),l.ec("modelChange",(function(e){return l.wc(t),l.ic().reserved=e}))("modelChange",(function(){return l.wc(t),l.ic().calculateStatus()})),l.Vb(),l.Wb(4,"i",2),l.ec("modelChange",(function(e){return l.wc(t),l.ic().occupied=e})),l.Vb(),l.Wb(5,"i",2),l.ec("modelChange",(function(e){return l.wc(t),l.ic().free=e})),l.Vb(),l.Wb(6,"i",3),l.ec("modelChange",(function(e){return l.wc(t),l.ic().checkin=e})),l.Vb(),l.Wb(7,"i",4),l.ec("modelChange",(function(e){return l.wc(t),l.ic().cancel=e})),l.Vb(),l.Vb()}if(2&t){const t=l.ic();l.Cb(1),l.oc("model",t.in_use)("sys",t.system_id)("bind",t.zone),l.Cb(1),l.oc("model",t.id_list)("sys",t.system_id)("bind",t.zone+":desk_ids"),l.Cb(1),l.oc("model",t.reserved)("sys",t.system_id)("bind",t.zone+":reserved"),l.Cb(1),l.oc("model",t.occupied)("sys",t.system_id)("bind",t.zone+":occupied_count"),l.Cb(1),l.oc("model",t.free)("sys",t.system_id)("bind",t.zone+":free_count"),l.Cb(1),l.oc("model",t.checkin)("sys",t.system_id)("params",l.qc(21,dt,t.checkin)),l.Cb(1),l.oc("model",t.cancel)("sys",t.system_id)("params",l.pc(23,lt))}}const bt=["*"];let ht=(()=>{class t extends d.a{constructor(t){super(),this._service=t,this.status=new l.n,this.occupied=0,this.free=0,this.colour_map={}}ngOnInit(){this._service.initialised.pipe(Object(h.a)(t=>t)).subscribe(()=>{this.colour_map=this._service.setting("app.explore.colors")||{}})}ngOnChanges(t){t.zone&&this.loadDesks()}calculateStatus(){const t=this.id_list||[],e=[];for(const n of t){const t=(this.in_use||[]).find(t=>t===n),o=(this.reserved||[]).find(t=>t===n),i=t?"unavailable":o?"reserved":"available";e.push({id:n,styles:{fill:this.colour_map[`desk-${i}`],stroke:this.colour_map[`desk-${i}-stroke`]},status_id:i})}this.status.emit(e)}loadDesks(){const t=this._service.Organisation.levelWithID(this.zone);if(!t)return;const e=this._service.Organisation.buildings.find(e=>e.id===t.building_id);if(!e)return;const n=e.systems.desk_management;n&&(this.system_id=n)}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(r.a))},t.\u0275cmp=l.Kb({type:t,selectors:[["","desk-status",""]],inputs:{zone:"zone",checkin:"checkin"},outputs:{status:"status"},features:[l.zb,l.Ab],attrs:rt,ngContentSelectors:bt,decls:2,vars:1,consts:[["class","bindings",4,"ngIf"],[1,"bindings"],["binding","","mod","DeskManagement",3,"model","sys","bind","modelChange"],["binding","","mod","DeskManagement","exec","manual_checkin",3,"model","sys","params","modelChange"],["binding","","mod","DeskManagement","exec","cancel_reservation",3,"model","sys","params","modelChange"]],template:function(t,e){1&t&&(l.nc(),l.mc(0),l.Ec(1,ut,8,24,"div",0)),2&t&&(l.Cb(1),l.oc("ngIf",e.system_id))},directives:[o.t,a.a],encapsulation:2}),t})(),gt=(()=>{class t extends d.a{constructor(t){super(),this._service=t,this.status=new l.n,this.zone_usage={},this.colour_map={}}ngOnInit(){this._service.initialised.pipe(Object(h.a)(t=>t)).subscribe(()=>{this.colour_map=this._service.setting("app.explore.colors")||{}})}ngOnDestroy(){this.clearZones(this.zone)}calculateStatus(){const t=this._service.Organisation.levelWithID(this.zone);if(!t)return;const e=t.settings.min_usage||0,n=[];for(const o in this.zone_usage)if(this.zone_usage[o]&&this.zone_usage.hasOwnProperty(o)){const t=Math.max(e,this.zone_usage[o]),i=t<40?"low":t<75?"medium":"high";n.push({id:o,styles:{fill:this.colour_map[`zone-${i}`]||"#ccc"},status_id:i})}this.status.emit(n)}loadZones(){const t=this._service.Organisation.levelWithID(this.zone);if(!t)return;const e=this._service.Organisation.buildings.find(e=>e.id===t.building_id);if(!e)return;const n=e.systems.floor_management;if(!n)return;this.system_id=n;const o=this._service.Bindings.module(this.system_id,"FloorManagement");o&&(this.subscription(`zone-${this.zone}.binding`,o.binding(this.zone).bind()),this.subscription(`zone-${this.zone}.usage`,o.binding(this.zone).listen(t=>{this.zone_usage=t,this.calculateStatus()})))}clearZones(t){this.unsub(`zone-${t}.binding`),this.unsub(`zone-${t}.usage`),delete this.zone_usage,this.zone_usage={}}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(r.a))},t.\u0275dir=l.Lb({type:t,selectors:[["","zone-status",""]],inputs:{zone:"zone",date:"date"},outputs:{status:"status"},features:[l.zb]}),t})();var pt=n("oTgu");const mt=function(){return{type:"icon",class:"material-icons",content:"add"}},ft=function(){return{type:"icon",class:"material-icons",content:"remove"}},_t=function(){return{type:"icon",class:"material-icons",content:"replay"}};let Ct=(()=>{class t{constructor(){this.zoomChange=new l.n,this.positionChange=new l.n,this.min_zoom=1,this.max_zoom=10}ngOnInit(){}zoomIn(){this.zoom=1.2*(this.zoom||this.min_zoom),this.zoom>this.max_zoom&&(this.zoom=this.max_zoom),this.zoomChange.emit(this.zoom)}zoomOut(){this.zoom=(this.zoom||this.min_zoom)*(1/1.2),this.zoom<this.min_zoom&&(this.zoom=this.min_zoom),this.zoomChange.emit(this.zoom)}reset(){this.zoom=this.min_zoom,this.position={x:.5,y:.5},this.zoomChange.emit(this.zoom),this.positionChange.emit(this.position)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=l.Kb({type:t,selectors:[["a-zoom-controls"]],inputs:{zoom:"zoom",position:"position"},outputs:{zoomChange:"zoomChange",positionChange:"positionChange"},decls:7,vars:6,consts:[[1,"zoom-control"],["mat-icon-button","","name","zoom-in",3,"tapped"],[3,"icon"],["mat-icon-button","","name","zoom-out",3,"tapped"],["mat-icon-button","","name","reset",3,"tapped"]],template:function(t,e){1&t&&(l.Wb(0,"div",0),l.Wb(1,"button",1),l.ec("tapped",(function(){return e.zoomIn()})),l.Rb(2,"app-icon",2),l.Vb(),l.Wb(3,"button",3),l.ec("tapped",(function(){return e.zoomOut()})),l.Rb(4,"app-icon",2),l.Vb(),l.Wb(5,"button",4),l.ec("tapped",(function(){return e.reset()})),l.Rb(6,"app-icon",2),l.Vb(),l.Vb()),2&t&&(l.Cb(2),l.oc("icon",l.pc(3,mt)),l.Cb(2),l.oc("icon",l.pc(4,ft)),l.Cb(2),l.oc("icon",l.pc(5,_t)))},directives:[B.b,D.c,w.a],styles:[".zoom-control[_ngcontent-%COMP%]{flex-direction:column;background-color:#fff;border-radius:8px;overflow:hidden;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.zoom-control[_ngcontent-%COMP%], button[_ngcontent-%COMP%]{display:flex;align-items:center}button[_ngcontent-%COMP%]{justify-content:center;border-radius:0;border-bottom:1px solid #ccc}button[_ngcontent-%COMP%]:last-child{border:none}app-icon[_ngcontent-%COMP%]{font-size:1.2em}"]}),t})();var vt=n("CbDI");function xt(t,e){if(1&t&&(l.Wb(0,"li",10),l.Rb(1,"div",11),l.Wb(2,"div",12),l.Gc(3),l.Vb(),l.Rb(4,"div",11),l.Vb()),2&t){const t=l.ic().$implicit;l.Cb(3),l.Hc(t)}}function Ot(t,e){if(1&t&&(l.Ub(0),l.Rb(1,"app-icon",5),l.Tb()),2&t){const t=l.ic().$implicit;l.Cb(1),l.oc("icon",t.icon)}}function wt(t,e){if(1&t&&l.Rb(0,"div",17),2&t){const t=l.ic().$implicit,e=l.ic(3);l.Dc("background-color",t.color||e.colours[t.key])}}function Mt(t,e){if(1&t&&(l.Wb(0,"li",13),l.Wb(1,"div",14),l.Ec(2,Ot,2,1,"ng-container",15),l.Ec(3,wt,1,2,"ng-template",null,16,l.Fc),l.Vb(),l.Wb(5,"div",12),l.Gc(6),l.Vb(),l.Vb()),2&t){const t=e.$implicit,n=l.tc(4);l.Cb(2),l.oc("ngIf",t.icon)("ngIfElse",n),l.Cb(4),l.Hc(t.name)}}function yt(t,e){if(1&t&&(l.Ub(0),l.Ec(1,xt,5,1,"li",8),l.Ec(2,Mt,7,3,"li",9),l.Tb()),2&t){const t=e.$implicit,n=l.ic(2);l.Cb(1),l.oc("ngIf",n.show_group_names),l.Cb(1),l.oc("ngForOf",n.legend_items[t])}}const kt=function(t){return{class:"material-icons",content:t}};function Pt(t,e){if(1&t){const t=l.Xb();l.Wb(0,"div",1),l.Wb(1,"div",2),l.Wb(2,"div",3),l.ec("tapped",(function(){l.wc(t);const e=l.ic();return e.show_legend=!e.show_legend})),l.Wb(3,"div",4),l.Gc(4),l.Vb(),l.Rb(5,"app-icon",5),l.Vb(),l.Vb(),l.Wb(6,"div",6),l.Wb(7,"ul"),l.Ec(8,yt,3,2,"ng-container",7),l.Vb(),l.Vb(),l.Vb()}if(2&t){const t=l.ic();l.Cb(4),l.Ic("",t.show_legend?"Hide":"Show"," Legend"),l.Cb(1),l.oc("icon",l.qc(10,kt,t.show_legend?"arrow_drop_up":"arrow_drop_down")),l.Cb(1),l.Dc("padding-bottom",t.show_legend?"1em":"")("padding-bottom",t.show_legend?".5em":"")("overflow",t.show_legend?"hidden auto":"hidden"),l.oc("@show",t.show_legend?"show":"hide"),l.Cb(2),l.oc("ngForOf",t.group_names)}}let zt=(()=>{class t extends d.a{constructor(t){super(),this._service=t,this.legend_items={},this.colours={},this.show_legend=!1}get group_names(){return Object.keys(this.legend_items||{})}ngOnInit(){this._service.initialised.pipe(Object(h.a)(t=>t)).subscribe(()=>{const t=this._service.setting("app.explore")||{};this.legend_items=t.legend||{},this.colours=t.colors||{},this.show_group_names=!!t.show_legend_group_names})}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(r.a))},t.\u0275cmp=l.Kb({type:t,selectors:[["a-map-legend"]],features:[l.zb],decls:1,vars:1,consts:[["class","map-legend",4,"ngIf"],[1,"map-legend"],[1,"tag"],[1,"title",3,"tapped"],[1,"text"],[3,"icon"],[1,"contents"],[4,"ngFor","ngForOf"],["class","group",4,"ngIf"],["class","item","name","item.key",4,"ngFor","ngForOf"],[1,"group"],[1,"bar"],[1,"name"],["name","item.key",1,"item"],[1,"ref"],[4,"ngIf","ngIfElse"],["colour_display",""],[1,"colour"]],template:function(t,e){1&t&&l.Ec(0,Pt,9,12,"div",0),2&t&&l.oc("ngIf",e.group_names&&e.group_names.length)},directives:[o.t,D.c,w.a,o.s],styles:[".map-legend[_ngcontent-%COMP%]{position:relative;border-radius:4px 4px 0 0;background-color:#fff;margin-top:.4em;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.tag[_ngcontent-%COMP%]{position:absolute;top:0;left:0;transform:translateY(-100%);overflow:hidden}.title[_ngcontent-%COMP%]{display:flex;align-items:center;border-radius:4px 4px 0 0;background-color:#fff;min-width:50%;flex:1;margin:.5em .5em -1px;padding:.75em .8em .75em 1.5em;font-size:.8em;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.contents[_ngcontent-%COMP%]{overflow:hidden;padding:0 .5em;max-height:50vh;min-width:16em}.group[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.25em .5em;margin:.5em 0;color:rgba(0,0,0,.65)}.group[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{margin:0 .5em}.bar[_ngcontent-%COMP%]{height:1px;min-width:1px;flex:1;background-color:rgba(0,0,0,.65)}ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}li[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:.65em;border-radius:4px;padding:.5em .5em .5em 0}li[_ngcontent-%COMP%]:nth-child(2n){background-color:rgba(0,0,0,.05)}li.group[_ngcontent-%COMP%]{background:none}.ref[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center;margin:0 .5em;height:20px;width:20px;border-radius:100%;border:1px solid rgba(0,0,0,.35);overflow:hidden;background-color:#fff}.colour[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0}app-icon[_ngcontent-%COMP%]{font-size:1.2em}"],data:{animation:[vt.a]}}),t})();var Wt=n("YxBP"),Vt=n("5fZw"),It=n("1DiH");const St=["container"];function Et(t,e){if(1&t&&(l.Wb(0,"div",17),l.Wb(1,"div",18),l.Gc(2),l.Vb(),l.Rb(3,"div",6),l.Vb()),2&t){const t=e.$implicit;l.Dc("left",t.left+"%"),l.Gb("hour",t.is_hour),l.Cb(2),l.Hc(t.name)}}function $t(t,e){if(1&t&&l.Rb(0,"div",19),2&t){const t=l.ic();l.Dc("width",t.offset+"%")}}const qt=function(){return{class:"material-icons",content:"keyboard_arrow_left"}},Rt=function(){return{class:"material-icons",content:"keyboard_arrow_right"}};let Gt=(()=>{class t extends d.a{constructor(t){super(),this._renderer=t,this.dateChange=new l.n,this.blocks=[]}get is_today(){return G().isSame(G(this.date),"d")}get offset(){const t=G();return t.diff(t.startOf("d"),"m")/1440*100}get active_time(){const t=G(this.date),e=t.diff(t.startOf("d"),"m");return{id:t.isSame(G(),"d")?"Today":t.format("DD MMM YYYY"),name:t.format("h:mm A"),left:e/1440*100}}ngOnInit(){this.blocks=this.generateBlocks(),this.interval("check_date",()=>this.checkDate(),15e3)}generateBlocks(){const t=G().startOf("d"),e=t.endOf("d"),n=[];let o=t;for(;o.isBefore(e);){const e=0===o.minute();n.push({id:o.format("HH:mm"),name:e?o.format("h"):"",is_hour:e,left:o.diff(t,"m")/1440*100}),o=o.add(30,"m")}return n}changeDate(t=1){let e=G(this.date);e=e.add(t,"d");const n=G();this.date=e.isBefore(n,"m")?n.valueOf():e.valueOf(),this.dateChange.emit(this.date)}startMove(t){const e=Object(Wt.d)(t);this._start_position=e,this._box=this._container.nativeElement.getBoundingClientRect(),t instanceof MouseEvent?(this.subscription("move",this._renderer.listen("window","mousemove",t=>this.onMove(t))),this.subscription("end",this._renderer.listen("window","mouseup",t=>{this.unsub("move"),this.unsub("end")}))):(this.subscription("move",this._renderer.listen("window","touchmove",t=>this.onMove(t))),this.subscription("end",this._renderer.listen("window","touchend",t=>{this.unsub("move"),this.unsub("end")})))}onMove(t){const e=Object(Wt.d)(t),n=-Math.round((this._start_position.x-e.x)/this._box.width*1440);if(0!==n){let t=G(this.date),o=t;o=o.add(n,"m"),o=o.minute(5*Math.floor(Math.round(o.minute()/5))),this.date=o.valueOf(),this.dateChange.emit(this.date),Math.abs(t.diff(o,"m"))>0&&(this._start_position=e),this.checkDate()}}checkDate(){const t=G(this.date);let e=G();e=e.minute(5*Math.floor(Math.ceil(e.minute()/5))),t.isBefore(e,"m")&&(this.date=e.valueOf(),this.dateChange.emit(this.date))}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(l.E))},t.\u0275cmp=l.Kb({type:t,selectors:[["a-timeline"]],viewQuery:function(t,e){var n;1&t&&l.Cc(St,!0),2&t&&l.sc(n=l.fc())&&(e._container=n.first)},inputs:{date:"date"},outputs:{dateChange:"dateChange"},features:[l.zb],decls:20,vars:13,consts:[[1,"not-mobile"],["explore","",1,"timeline"],["container",""],["class","block",3,"hour","left",4,"ngFor","ngForOf"],["class","offset",3,"width",4,"ngIf"],[1,"active-time"],[1,"bar"],[1,"date"],["mat-icon-button","",3,"disabled","tapped"],[3,"icon"],[1,"text",3,"mousedown","touchstart"],["mat-icon-button","",3,"tapped"],[1,"time",3,"mousedown","touchstart"],[1,"triangle"],[1,"pickers","mobile-only"],["offset","top",3,"ngModel","ngModelChange"],[3,"ngModel","ngModelChange"],[1,"block"],[1,"text"],[1,"offset"]],template:function(t,e){1&t&&(l.Wb(0,"div",0),l.Wb(1,"div",1,2),l.Ec(3,Et,4,5,"div",3),l.Vb(),l.Ec(4,$t,1,2,"div",4),l.Wb(5,"div",5),l.Rb(6,"div",6),l.Wb(7,"div",7),l.Wb(8,"button",8),l.ec("tapped",(function(){return e.changeDate(-1)})),l.Rb(9,"app-icon",9),l.Vb(),l.Wb(10,"div",10),l.ec("mousedown",(function(t){return e.startMove(t)}))("touchstart",(function(t){return e.startMove(t)})),l.Gc(11),l.Vb(),l.Wb(12,"button",11),l.ec("tapped",(function(){return e.changeDate()})),l.Rb(13,"app-icon",9),l.Vb(),l.Vb(),l.Wb(14,"div",12),l.ec("mousedown",(function(t){return e.startMove(t)}))("touchstart",(function(t){return e.startMove(t)})),l.Gc(15),l.Vb(),l.Rb(16,"div",13),l.Vb(),l.Vb(),l.Wb(17,"div",14),l.Wb(18,"a-date-field",15),l.ec("ngModelChange",(function(t){return e.date=t}))("ngModelChange",(function(t){return e.dateChange.emit(t)})),l.Vb(),l.Wb(19,"a-time-field",16),l.ec("ngModelChange",(function(t){return e.date=t}))("ngModelChange",(function(t){return e.dateChange.emit(t)})),l.Vb(),l.Vb()),2&t&&(l.Cb(3),l.oc("ngForOf",e.blocks),l.Cb(1),l.oc("ngIf",e.is_today),l.Cb(1),l.Dc("left",e.active_time.left+"%"),l.Cb(3),l.oc("disabled",e.is_today),l.Cb(1),l.oc("icon",l.pc(11,qt)),l.Cb(2),l.Hc(e.active_time.id),l.Cb(2),l.oc("icon",l.pc(12,Rt)),l.Cb(2),l.Hc(e.active_time.name),l.Cb(3),l.oc("ngModel",e.date),l.Cb(1),l.oc("ngModel",e.date))},directives:[o.s,o.t,B.b,D.c,w.a,Vt.a,s.r,s.u,It.a],styles:["[_nghost-%COMP%]{z-index:10;border-top:1px solid #ccc;background-color:#fff}.timeline[_ngcontent-%COMP%], [_nghost-%COMP%]{position:relative;width:100%;height:3em}@media only screen and (orientation:portrait) and (max-width:450px){.timeline[_ngcontent-%COMP%], [_nghost-%COMP%]{height:3.75em}}@media only screen and (orientation:landscape) and (max-width:800px){.timeline[_ngcontent-%COMP%], [_nghost-%COMP%]{height:3.75em}}.timeline[_ngcontent-%COMP%]{background:linear-gradient(90deg,#051c2c,#051c2c 40%,#0b2453 60%,#1f40e6)}.block[_ngcontent-%COMP%]{position:absolute;top:0;left:0;bottom:0;pointer-events:none}.block.hour[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{height:40%}@media only screen and (orientation:portrait) and (max-width:450px){.block.hour[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{display:initial}}@media only screen and (orientation:landscape) and (max-width:800px){.block.hour[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{display:initial}}.block[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{position:absolute;width:2px;height:20%;bottom:0;left:-1px;background-color:#fff}@media only screen and (orientation:portrait) and (max-width:450px){.block[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{display:none}}@media only screen and (orientation:landscape) and (max-width:800px){.block[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{display:none}}.block[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{position:absolute;bottom:45%;left:0;transform:translateX(-50%);color:#fff}@media only screen and (orientation:portrait) and (max-width:450px){.block[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-size:.8em}}@media only screen and (orientation:landscape) and (max-width:800px){.block[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-size:.8em}}.block[_ngcontent-%COMP%]:first-child{display:none}@media only screen and (orientation:portrait) and (max-width:450px){.block[_ngcontent-%COMP%]:nth-child(4n-1){display:none}}@media only screen and (orientation:landscape) and (max-width:800px){.block[_ngcontent-%COMP%]:nth-child(4n-1){display:none}}.offset[_ngcontent-%COMP%]{background-color:rgba(0,0,0,.65)}.active-time[_ngcontent-%COMP%], .offset[_ngcontent-%COMP%]{position:absolute;top:0;left:0;bottom:0}.active-time[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{width:2px;height:200%;bottom:0;left:-1px}.active-time[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%], .date[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]{position:absolute;background-color:#fff}.date[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]{bottom:100%;left:0;transform:translate(-50%,-.25em);display:flex;align-items:center;overflow:hidden;border-radius:4px;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.date[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{padding:0 .5em;white-space:nowrap}.date[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0}.date[_ngcontent-%COMP%]{transform:translate(-50%,-2.5em)}.time[_ngcontent-%COMP%]{padding:.5em;white-space:nowrap;cursor:-webkit-grab;cursor:grab}.time[_ngcontent-%COMP%]:active{cursor:-webkit-grabbing;cursor:grabbing}.pickers[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.25em}.pickers[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1;margin:.25em}"]}),t})();var Ft=n("bv9b");function jt(t,e){1&t&&l.Rb(0,"mat-progress-bar",18)}function Bt(t,e){if(1&t&&(l.Wb(0,"div",14),l.Wb(1,"div",15),l.Gc(2),l.Vb(),l.Wb(3,"div",16),l.Ec(4,jt,1,0,"mat-progress-bar",17),l.Vb(),l.Vb()),2&t){const t=l.ic();l.Cb(2),l.Hc(t.message),l.Cb(2),l.oc("ngIf",t.loading)}}let Dt=(()=>{class t extends d.a{constructor(t,e){super(),this._service=t,this._route=e,this.center={x:.5,y:.5},this.style_map={},this.status_map={},this.listener_map={},this.feature_map={}}get map_url(){return(this._service.Organisation.levelWithID(this.active_level)||{map_url:""}).map_url||""}ngOnInit(){this._service.initialised.pipe(Object(h.a)(t=>t)).subscribe(()=>{if(!this.active_level){const t=this._service.Organisation.building;t&&t.levels.length&&(this.active_level=t.levels[0].id)}this.subscription("route.query",this._route.queryParamMap.subscribe(t=>{t.has("space")&&this.loadSpaceLocation(t.get("space")),t.has("user")&&this.loadUserLocation(t.get("user")).then(t=>{this.loading=!1,this.message=this.focus?"":`Unable to locate ${t.name}`},t=>{this.loading=!1,this.message="Unable to locate user",t&&404!==t.status&&this._service.notifyError(`Error loading user location. ${t.message}`)})}))})}processStatuses(){const t={};(this.status_map.spaces||[]).forEach(e=>t[`#${e.id}`]=e.styles),(this.status_map.desks||[]).forEach(e=>t[`#${e.id}`]=e.styles),(this.status_map.zones||[]).forEach(e=>t[`#${e.id}`]=e.styles),this.style_map=t}processListeners(){let t=[];t=t.concat(this.listener_map.spaces||[]),t=t.concat(this.listener_map.desks||[]),t=t.concat(this.listener_map.zones||[]),this.listeners=t}processFeatures(){let t=[];this.focus_feature&&(t=t.concat([this.focus_feature])),t=t.concat(this.feature_map.spaces||[]),t=t.concat(this.feature_map.desks||[]),t=t.concat(this.feature_map.zones||[]),this.features=t}loadSpaceLocation(t){const e=this._service.Spaces.list(e=>e.id===t)[0];e&&(this.message=`Loading location of ${e.name}`,this.loading=!0,this.active_level=e.level.id,this.focus=e.map_id,this.focus_feature={id:e.map_id,coordinates:null,content:c.e,data:{text:e.name}},this.zoom=1,this.loading=!1,this.message="",this.processFeatures())}loadUserLocation(t){return Object(b.a)(this,void 0,void 0,(function*(){this.focus=null,this.focus_feature=null,this.loading=!0,this.message="Loading user details...";const e=yield this._service.Users.show(t);if(!e)return e;this.message=`Loading location for ${e.name}...`;const n=yield e.locate();return n?(this.active_level=n.level.id,n.fixed?(this.focus=n.id,this.focus_feature={id:n.id,coordinates:null,content:c.e,data:{text:`${e.name} is here`}},this.zoom=1):(this.focus={x:n.x,y:n.y},this.focus_feature={coordinates:{x:n.x,y:n.y},content:c.f,data:{text:`${e.name} is here`,diameter:n.confidence||5}}),this.zoom=1,this.loading=!1,this.message="",this.processFeatures(),e):e}))}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(r.a),l.Qb(i.a))},t.\u0275cmp=l.Kb({type:t,selectors:[["explore-map-view"]],features:[l.zb],decls:15,vars:16,consts:[[1,"map-view"],[1,"header"],[1,"body"],["hidden","",1,"status-list"],["space-status","",3,"zone","date","status","listeners","features"],["desk-status","",3,"zone","status"],["zone-status","",3,"zone","status"],["overlay","",3,"level","levelChange"],[3,"zoom","center","src","css","listeners","features","focus","zoomChange","centerChange"],["diameter","32"],["overlay","",3,"zoom","position","zoomChange","positionChange"],["overlay",""],["class","message",4,"ngIf"],[3,"date","dateChange"],[1,"message"],[1,"text"],[1,"loader"],["mode","indeterminate",4,"ngIf"],["mode","indeterminate"]],template:function(t,e){1&t&&(l.Wb(0,"div",0),l.Wb(1,"div",1),l.Rb(2,"explore-search"),l.Vb(),l.Wb(3,"div",2),l.Wb(4,"div",3),l.Wb(5,"i",4),l.ec("status",(function(t){return e.status_map.spaces=t,e.processStatuses()}))("listeners",(function(t){return e.listener_map.spaces=t,e.processListeners()}))("features",(function(t){return e.feature_map.spaces=t,e.processFeatures()})),l.Vb(),l.Wb(6,"i",5),l.ec("status",(function(t){return e.status_map.desks=t,e.processStatuses()})),l.Vb(),l.Wb(7,"i",6),l.ec("status",(function(t){return e.status_map.zones=t,e.processStatuses()})),l.Vb(),l.Vb(),l.Wb(8,"a-map-controls",7),l.ec("levelChange",(function(t){return e.active_level=t}))("levelChange",(function(){return e.zoom=1,e.center={x:.5,y:.5}})),l.Vb(),l.Wb(9,"a-map",8),l.ec("zoomChange",(function(t){return e.zoom=t}))("centerChange",(function(t){return e.center=t})),l.Rb(10,"mat-spinner",9),l.Vb(),l.Wb(11,"a-zoom-controls",10),l.ec("zoomChange",(function(t){return e.zoom=t}))("positionChange",(function(t){return e.center=t})),l.Vb(),l.Rb(12,"a-map-legend",11),l.Ec(13,Bt,5,2,"div",12),l.Vb(),l.Wb(14,"a-timeline",13),l.ec("dateChange",(function(t){return e.date=t})),l.Vb(),l.Vb()),2&t&&(l.Cb(5),l.oc("zone",e.active_level)("date",e.date),l.Cb(1),l.oc("zone",e.active_level),l.Cb(1),l.oc("zone",e.active_level),l.Cb(1),l.oc("level",e.active_level),l.Cb(1),l.oc("zoom",e.zoom)("center",e.center)("src",e.map_url)("css",e.style_map)("listeners",e.listeners)("features",e.features)("focus",e.focus),l.Cb(2),l.oc("zoom",e.zoom)("position",e.center),l.Cb(2),l.oc("ngIf",e.message),l.Cb(1),l.oc("date",e.date))},directives:[I,ct,ht,gt,pt.a,c.d,M.c,Ct,zt,o.t,Gt,Ft.a],styles:[".map-view[_ngcontent-%COMP%]{position:absolute;display:flex;align-items:center;flex-direction:column;top:0;left:0;right:0;bottom:0;overflow:hidden}.body[_ngcontent-%COMP%], .header[_ngcontent-%COMP%]{width:100%;background-color:#f8f8f8}.body[_ngcontent-%COMP%]{position:relative;min-height:50%;flex:1;overflow:hidden}.body[_ngcontent-%COMP%], a-map[_ngcontent-%COMP%]{z-index:1}[overlay][_ngcontent-%COMP%]{z-index:10}a-map-controls[_ngcontent-%COMP%]{position:absolute;top:.5em;left:.5em}a-zoom-controls[_ngcontent-%COMP%]{position:absolute;bottom:.5em;right:.5em}a-map-legend[_ngcontent-%COMP%]{bottom:0}a-map-legend[_ngcontent-%COMP%], a-popout-menu[_ngcontent-%COMP%]{position:absolute;left:.5em}a-popout-menu[_ngcontent-%COMP%]{bottom:.5em;z-index:999}.message[_ngcontent-%COMP%]{overflow:hidden;position:absolute;bottom:.5rem;left:50%;transform:translateX(-50%);background-color:#fff;border-radius:4px;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12);max-width:20rem;z-index:999;font-size:.9em}.message[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]{height:4px;width:100%}@media only screen and (orientation:portrait) and (max-width:450px){.message[_ngcontent-%COMP%]{left:.5rem;transform:none}}@media only screen and (orientation:landscape) and (max-width:800px){.message[_ngcontent-%COMP%]{left:.5rem;transform:none}}.message[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{padding:.5rem}"]}),t})();var Ht=n("p5rm"),Ut=n("4Uey");let Qt=(()=>{class t extends d.a{constructor(t){super(),this._service=t}ngOnInit(){this._service.title="Maps"}}return t.\u0275fac=function(e){return new(e||t)(l.Qb(r.a))},t.\u0275cmp=l.Kb({type:t,selectors:[["app-explore"]],features:[l.zb],decls:8,vars:2,consts:[[1,"explore","page"],[1,"header"],[3,"menu","menuChange"],[1,"body"],[1,"footer"],[3,"show","showChange"]],template:function(t,e){1&t&&(l.Wb(0,"div",0),l.Wb(1,"header",1),l.Wb(2,"a-topbar-header",2),l.ec("menuChange",(function(t){return e.show_menu=t})),l.Vb(),l.Vb(),l.Wb(3,"main",3),l.Rb(4,"explore-map-view"),l.Vb(),l.Wb(5,"footer",4),l.Rb(6,"a-footer-menu"),l.Vb(),l.Vb(),l.Wb(7,"a-overlay-menu",5),l.ec("showChange",(function(t){return e.show_menu=t})),l.Vb()),2&t&&(l.Cb(2),l.oc("menu",e.show_menu),l.Cb(5),l.oc("show",e.show_menu))},directives:[u.a,Dt,Ht.a,Ut.a],styles:[".page[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;align-items:center;flex-direction:column}.page[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}.body[_ngcontent-%COMP%]{position:relative;min-width:50%;flex:1}"]}),t})();var Tt=n("PCNd");n.d(e,"ExploreModule",(function(){return Lt}));const At=[{path:"",component:Qt},{path:":search_type",component:Qt}];let Lt=(()=>{class t{}return t.\u0275mod=l.Ob({type:t}),t.\u0275inj=l.Nb({factory:function(e){return new(e||t)},imports:[[o.c,i.h.forChild(At),Tt.a,c.a,a.b,s.l]]}),t})()}}]);