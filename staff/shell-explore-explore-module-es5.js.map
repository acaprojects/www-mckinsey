{"version":3,"sources":["webpack:///src/app/shell/explore/explore.component.ts","webpack:///src/app/shell/explore/explore.component.html","webpack:///src/app/shell/explore/explore.module.ts","webpack:///src/app/shell/explore/map-legend/map-legend.component.ts","webpack:///src/app/shell/explore/map-legend/map-legend.component.html","webpack:///src/app/shell/explore/map-view/map-view.component.html","webpack:///src/app/shell/explore/map-view/map-view.component.ts","webpack:///src/app/shell/explore/overlays/booking-modal/booking-modal.component.ts","webpack:///src/app/shell/explore/overlays/booking-modal/booking-modal.component.html","webpack:///src/app/shell/explore/overlays/space-info/space-info.component.ts","webpack:///src/app/shell/explore/overlays/space-info/space-info.component.html","webpack:///src/app/shell/explore/search/search.component.ts","webpack:///src/app/shell/explore/search/search.component.html","webpack:///src/app/shell/explore/status-managers/desk-status.component.ts","webpack:///src/app/shell/explore/status-managers/space-status.component.ts","webpack:///src/app/shell/explore/timeline/timeline.component.ts","webpack:///src/app/shell/explore/timeline/timeline.component.html","webpack:///src/app/shell/explore/zoom-controls/zoom-controls.component.ts","webpack:///src/app/shell/explore/zoom-controls/zoom-controls.component.html"],"names":["ExploreComponent","_service","title","selector","templateUrl","styleUrls","ROUTES","path","component","ExploreModule","forChild","declarations","imports","ExploreMapLegendComponent","legend_items","colours","show_legend","initialised","pipe","_","subscribe","explore_settings","setting","legend","colors","show_group_names","show_legend_group_names","Object","keys","animations","MapViewComponent","_route","_dialog","_org","_users","_spaces","center","x","y","style_map","listeners","features","status_map","listener_map","feature_map","active_level","bld","building","levels","length","id","settings","subscription","queryParamMap","params","has","loadSpaceLocation","get","loadUserLocation","then","user","loading","message","focus","name","err","status","notifyError","level","levelWithID","building_id","buildings","find","open","data","styles","spaces","forEach","space","desks","desk","zones","zone","concat","focus_feature","space_id","map_id","coordinates","content","text","zoom","processFeatures","user_email","show","locate","location","fixed","diameter","confidence","map_url","booking_details","processStatuses","processListeners","ExploreBookingModalComponent","_dialog_ref","_data","_router","state","date","booking","valueOf","duration","room_ids","bookings","bookable","byRequest","host","current","available_until","is_now","toJSON","localStorage","setItem","JSON","stringify","navigate","queryParams","back","close","form","valid","checkSpaceAvailability","save","success","timeout","changes","space_list","Promise","resolve","reject","available","map","join","was_available","organiser","format","now","isSame","isAfter","ExploreSpaceInfoComponent","_position","processBookings","interval","toLowerCase","split","search$","ExploreSearchComponent","results","paramMap","type","search_results$","query","q","slice","cache","users","filter","search","search_str","item","indexOf","email","result_list","list","autofocus","focusField","input_field","nativeElement","relativeTo","queryParamsHandling","selectOption","ExploreDeskStatusComponent","occupied","free","colour_map","loadDesks","desk_list","id_list","status_list","desk_id","in_use","reserved","push","fill","stroke","status_id","emit","desk_management","systems","system_id","template","ExploreSpaceStatusComponent","active_bookings","listen","loadSpaces","updateSpaceBookings","calculateStatus","clearSpaces","statuses","getStatus","opacity","datetime","startOf","second","current_booking","start","end","add","isBefore","options","rules","rulesFor","hide","auto_approve","bkn_data","is_today","from","unix","to","endOf","show_declined","zone_ids","processSpaceBookings","event","callback","showSpaceInfo","openBookingModal","width","height","notifyInfo","BLOCK_SIZE","MINUTES_IN_DAY","TimelineComponent","_renderer","dateChange","blocks","generateBlocks","checkDate","current_time","is_hour","minute","left","diff","amount","position","_start_position","_box","_container","getBoundingClientRect","MouseEvent","e","onMove","unsub","y_change","time_change","Math","round","old_date","floor","abs","ceil","changeDate","startMove","ZoomControlsComponent","zoomChange","positionChange","min_zoom","max_zoom","zoomIn","zoomOut","reset"],"mappings":"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","file":"shell-explore-explore-module-es5.js","sourcesContent":["import { Component, OnInit } from '@angular/core';\n\nimport { ApplicationService } from 'src/app/services/app.service';\nimport { BaseDirective } from 'src/app/shared/base.directive';\n\n@Component({\n    selector: 'app-explore',\n    templateUrl: './explore.component.html',\n    styleUrls: ['./explore.component.scss']\n})\nexport class ExploreComponent extends BaseDirective implements OnInit {\n    /** Whether to show the overlay menu */\n    public show_menu: boolean;\n\n    constructor(private _service: ApplicationService) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this._service.title = 'Maps';\n    }\n}\n","<div class=\"explore page\">\n    <header class=\"header\">\n        <a-topbar-header [(menu)]=\"show_menu\"></a-topbar-header>\n    </header>\n    <main class=\"body\">\n        <explore-map-view></explore-map-view>\n    </main>\n    <footer class=\"footer\">\n        <a-footer-menu></a-footer-menu>\n    </footer>\n</div>\n<a-overlay-menu [(show)]=\"show_menu\"></a-overlay-menu>","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { RouterModule, Route } from '@angular/router';\nimport { FormsModule } from '@angular/forms';\n\nimport { ComposerModule } from '@placeos/composer';\nimport { AInteractiveMapModule } from '@acaprojects/ngx-interactive-map';\n\nimport { ExploreComponent } from './explore.component';\nimport { SharedContentModule } from 'src/app/shared/shared.module';\nimport { MapViewComponent } from './map-view/map-view.component';\nimport { ExploreSpaceStatusComponent } from './status-managers/space-status.component';\nimport { ExploreDeskStatusComponent } from './status-managers/desk-status.component';\nimport { ZoomControlsComponent } from './zoom-controls/zoom-controls.component';\nimport { ExploreSpaceInfoComponent } from './overlays/space-info/space-info.component';\nimport { ExploreSearchComponent } from './search/search.component';\nimport { ExploreMapLegendComponent } from './map-legend/map-legend.component';\nimport { TimelineComponent } from './timeline/timeline.component';\nimport { ExploreBookingModalComponent } from './overlays/booking-modal/booking-modal.component';\n\nconst ROUTES: Route[] = [\n    { path: '', component: ExploreComponent },\n    { path: ':search_type', component: ExploreComponent }\n];\n\n@NgModule({\n    declarations: [\n        ExploreComponent,\n        MapViewComponent,\n        ExploreSpaceStatusComponent,\n        ExploreDeskStatusComponent,\n        ZoomControlsComponent,\n        ExploreSpaceInfoComponent,\n        ExploreSearchComponent,\n        ExploreMapLegendComponent,\n        TimelineComponent,\n        ExploreBookingModalComponent\n    ],\n    imports: [\n        CommonModule,\n        RouterModule.forChild(ROUTES),\n        SharedContentModule,\n        AInteractiveMapModule,\n        ComposerModule,\n        FormsModule\n    ]\n})\nexport class ExploreModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { first } from 'rxjs/operators';\n\nimport { BaseDirective } from 'src/app/shared/base.directive';\nimport { ApplicationService } from 'src/app/services/app.service';\nimport { HashMap } from 'src/app/shared/utilities/types.utilities';\nimport { MapLegendItem, ExploreMapSettings } from 'src/app/shared/utilities/settings.interfaces';\nimport { ANIMATION_SHOW_CONTRACT_EXPAND } from 'src/app/shared/globals/angular-animations';\n\n@Component({\n    selector: 'a-map-legend',\n    templateUrl: './map-legend.component.html',\n    styleUrls: ['./map-legend.component.scss'],\n    animations: [ANIMATION_SHOW_CONTRACT_EXPAND]\n})\nexport class ExploreMapLegendComponent extends BaseDirective implements OnInit {\n    /** Mapping of legend item groups */\n    public legend_items: HashMap<MapLegendItem[]> = {};\n    /** Mapping of map colours */\n    public colours: HashMap<string> = {};\n    /** Whether group names should be displayed */\n    public show_group_names: boolean;\n    /** Whether the legend items should be shown */\n    public show_legend = false;\n\n    /** List of group names for legend items */\n    public get group_names(): string[] {\n        return Object.keys(this.legend_items);\n    }\n\n    constructor(private _service: ApplicationService) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this._service.initialised.pipe(first(_ => _)).subscribe(() => {\n            const explore_settings: ExploreMapSettings =\n                this._service.setting('app.explore') || ({} as any);\n            this.legend_items = explore_settings.legend || {};\n            this.colours = explore_settings.colors || {};\n            this.show_group_names = !!explore_settings.show_legend_group_names;\n        });\n    }\n}\n","<div class=\"map-legend\" *ngIf=\"group_names && group_names.length\">\n    <div class=\"tag\">\n        <div class=\"title\" (tapped)=\"show_legend = !show_legend\">\n            <div class=\"text\" i18n=\"Explore legend label\">{{ show_legend ? 'Hide' : 'Show' }} Legend</div>\n            <app-icon\n                [icon]=\"{\n                    class: 'material-icons',\n                    content: show_legend ? 'arrow_drop_up' : 'arrow_drop_down'\n                }\"\n            ></app-icon>\n        </div>\n    </div>\n    <div\n        class=\"contents\"\n        [@show]=\"show_legend ? 'show' : 'hide'\"\n        [style.padding-bottom]=\"show_legend ? '1em' : ''\"\n        [style.padding-bottom]=\"show_legend ? '.5em' : ''\"\n        [style.overflow]=\"show_legend ? 'hidden auto' : 'hidden'\"\n    >\n        <ul>\n            <ng-container *ngFor=\"let group of group_names\">\n                <li class=\"group\" *ngIf=\"show_group_names\">\n                    <div class=\"bar\"></div>\n                    <div class=\"name\">{{ group }}</div>\n                    <div class=\"bar\"></div>\n                </li>\n                <li class=\"item\" name=\"item.key\" *ngFor=\"let item of legend_items[group]\">\n                    <div class=\"ref\">\n                        <ng-container *ngIf=\"item.icon; else colour_display\">\n                            <app-icon [icon]=\"item.icon\"></app-icon>\n                        </ng-container>\n                        <ng-template #colour_display>\n                            <div\n                                class=\"colour\"\n                                [style.background-color]=\"item.color || colours[item.key]\"\n                            ></div>\n                        </ng-template>\n                    </div>\n                    <div class=\"name\">{{ item.name }}</div>\n                </li>\n            </ng-container>\n        </ul>\n    </div>\n</div>\n","<div class=\"map-view\">\n    <div class=\"header\">\n        <explore-search></explore-search>\n    </div>\n    <div class=\"body\">\n        <div class=\"status-list\" hidden>\n            <i\n                space-status\n                [zone]=\"active_level\"\n                [date]=\"date\"\n                (status)=\"status_map.spaces = $event; processStatuses()\"\n                (listeners)=\"listener_map.spaces = $event; processListeners()\"\n                (features)=\"feature_map.spaces = $event; processFeatures()\"\n            ></i>\n            <i desk-status [zone]=\"active_level\" (status)=\"status_map.desks = $event; processStatuses()\"></i>\n        </div>\n        <a-map-controls overlay [(level)]=\"active_level\" (levelChange)=\"zoom = 1; center = { x: .5, y: .5 }\"></a-map-controls>\n        <button mat-icon-button class=\"rules\" name=\"booking-rules\" *ngIf=\"has_booking_rules\" (tapped)=\"openBookingRulesModal()\">i</button>\n        <a-map\n            [(zoom)]=\"zoom\"\n            [(center)]=\"center\"\n            [src]=\"map_url\"\n            [css]=\"style_map\"\n            [listeners]=\"listeners\"\n            [features]=\"features\"\n            [focus]=\"focus\"\n        >\n            <mat-spinner diameter=\"32\"></mat-spinner>\n        </a-map>\n        <a-zoom-controls overlay [(zoom)]=\"zoom\" [(position)]=\"center\"></a-zoom-controls>\n        <a-map-legend overlay></a-map-legend>\n        <div class=\"message\" *ngIf=\"message\">\n            <div class=\"text\">{{ message }}</div>\n            <div class=\"loader\">\n                <mat-progress-bar mode=\"indeterminate\" *ngIf=\"loading\"></mat-progress-bar>\n            </div>\n        </div>\n    </div>\n    <a-timeline *ngIf=\"settings.show_timeline\" [(date)]=\"date\"></a-timeline>\n</div>\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport { MapPinComponent } from '@acaprojects/ngx-interactive-map';\nimport { first } from 'rxjs/operators';\n\nimport { ApplicationService } from 'src/app/services/app.service';\nimport { BaseDirective } from 'src/app/shared/base.directive';\nimport { MapStatus, MapListener } from '../status-managers/status.interfaces';\nimport { HashMap, Point } from 'src/app/shared/utilities/types.utilities';\nimport { MapFeature } from '@acaprojects/ngx-interactive-map/lib/helpers/map.interfaces';\nimport { MapRadiusComponent } from '@acaprojects/ngx-interactive-map';\nimport { ExploreMapSettings } from 'src/app/shared/utilities/settings.interfaces';\nimport { MatDialog } from '@angular/material/dialog';\nimport {\n    BookingRulesModalComponent,\n    BookingRulesModalData,\n} from 'src/app/overlays/booking-rules-modal/booking-rules-modal.component';\nimport { Building } from 'src/app/services/data/organisation/building.class';\nimport { OrganisationService } from 'src/app/services/data/organisation/organisation.service';\nimport { SpacesService } from 'src/app/services/data/spaces/spaces.service';\nimport { UsersService } from 'src/app/services/data/users/users.service';\n\n@Component({\n    selector: 'explore-map-view',\n    templateUrl: './map-view.component.html',\n    styleUrls: ['./map-view.component.scss'],\n})\nexport class MapViewComponent extends BaseDirective implements OnInit {\n    /** Zoom level of the map */\n    public zoom: number;\n    /** Center offset of the map */\n    public center: Point = { x: 0.5, y: 0.5 };\n    /** Mapping of elements to CSS styles */\n    public style_map: HashMap<HashMap<string | number>> = {};\n    /** List of listeners for the map */\n    public listeners: MapListener[] = [];\n    /** List of features to render on the map */\n    public features: MapFeature[] = [];\n    /** ID of the active level to display on the map */\n    public active_level: string;\n    /** Mapping of status lists to types */\n    public status_map: { spaces?: MapStatus[]; desks?: MapStatus[]; zones?: MapStatus[] } = {};\n    /** Mapping of listener lists to types */\n    public listener_map: {\n        spaces?: MapListener[];\n        desks?: MapListener[];\n        zones?: MapListener[];\n    } = {};\n    /** Mapping of features lists to types */\n    public feature_map: {\n        spaces?: MapFeature[];\n        desks?: MapFeature[];\n        zones?: MapFeature[];\n    } = {};\n    /** Message to display over the map */\n    public message: string;\n    /** Whether location data is loading */\n    public loading: boolean;\n    /** Point or element on the map to focus */\n    public focus: string | Point;\n    /** Feature on the map to focus */\n    public focus_feature: MapFeature;\n    /** Current shown time */\n    public date: number;\n    /** Application settings for the explore component */\n    public settings: ExploreMapSettings;\n\n    /** URL of the active map */\n    public get map_url(): string {\n        const level = this._org.levelWithID(this.active_level) || { map_url: '' };\n        return level.map_url || '';\n    }\n\n    /** Whether current level has booking rules associated with it */\n    public get has_booking_rules(): boolean {\n        const level = this._org.levelWithID(this.active_level) || {\n            building_id: '',\n        };\n        return !!(this._org.buildings.find((bld) => bld.id === level.building_id) || {})\n            .booking_details;\n    }\n\n    constructor(\n        private _service: ApplicationService,\n        private _route: ActivatedRoute,\n        private _dialog: MatDialog,\n        private _org: OrganisationService,\n        private _users: UsersService,\n        private _spaces: SpacesService\n    ) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this._service.initialised.pipe(first((_) => _)).subscribe(() => {\n            /* istanbul ignore else */\n            if (!this.active_level) {\n                const bld = this._org.building;\n                if (bld && bld.levels.length) {\n                    this.active_level = bld.levels[0].id;\n                }\n            }\n            this.settings = this._service.setting('app.explore') || {};\n            this.subscription(\n                'route.query',\n                this._route.queryParamMap.subscribe((params) => {\n                    /* istanbul ignore else */\n                    if (params.has('space')) {\n                        this.loadSpaceLocation(params.get('space'));\n                    }\n                    /* istanbul ignore else */\n                    if (params.has('user')) {\n                        this.loadUserLocation(params.get('user')).then(\n                            (user) => {\n                                this.loading = false;\n                                this.message = this.focus\n                                    ? ''\n                                    : `Unable to locate ${user ? user.name : params.get('user')}`;\n                            },\n                            (err) => {\n                                this.loading = false;\n                                this.message = `Unable to locate user`;\n                                /* istanbul ignore else */\n                                if (err && err.status !== 404) {\n                                    this._service.notifyError(\n                                        `Error loading user location. ${err.message}`\n                                    );\n                                }\n                            }\n                        );\n                    }\n                })\n            );\n        });\n    }\n\n    public openBookingRulesModal() {\n        const level = this._org.levelWithID(this.active_level) || {\n            building_id: '',\n        };\n        const building: Building =\n            this._org.buildings.find((bld) => bld.id === level.building_id) || ({} as any);\n        this._dialog.open<BookingRulesModalComponent, BookingRulesModalData>(\n            BookingRulesModalComponent,\n            {\n                data: {\n                    building,\n                },\n            }\n        );\n    }\n\n    /**\n     * Process changes to statuses\n     */\n    public processStatuses() {\n        const styles: HashMap<HashMap<string | number>> = {};\n        (this.status_map.spaces || []).forEach((space) => (styles[`#${space.id}`] = space.styles));\n        (this.status_map.desks || []).forEach((desk) => (styles[`#${desk.id}`] = desk.styles));\n        (this.status_map.zones || []).forEach((zone) => (styles[`#${zone.id}`] = zone.styles));\n        this.style_map = styles;\n    }\n\n    /**\n     * Process changes to statuses\n     */\n    public processListeners() {\n        let listeners: MapListener[] = [];\n        listeners = listeners.concat(this.listener_map.spaces || []);\n        listeners = listeners.concat(this.listener_map.desks || []);\n        listeners = listeners.concat(this.listener_map.zones || []);\n        this.listeners = listeners;\n    }\n\n    /**\n     * Process changes to statuses\n     */\n    public processFeatures() {\n        let features: MapFeature[] = [];\n        /* istanbul ignore else */\n        if (this.focus_feature) {\n            features = features.concat([this.focus_feature]);\n        }\n        features = features.concat(this.feature_map.spaces || []);\n        features = features.concat(this.feature_map.desks || []);\n        features = features.concat(this.feature_map.zones || []);\n        this.features = features;\n    }\n\n    /**\n     * Load and store location details for the space\n     * @param space_id Engine system ID of the space to locate\n     */\n    private loadSpaceLocation(space_id: string) {\n        const space = this._spaces.find(space_id);\n        /* istanbul ignore else */\n        if (space) {\n            this.message = `Loading location of ${space.name}`;\n            this.loading = true;\n            this.active_level = space.level.id;\n            this.focus = space.map_id;\n            this.focus_feature = {\n                id: space.map_id,\n                coordinates: null,\n                content: MapPinComponent,\n                data: {\n                    text: space.name,\n                },\n            };\n            this.zoom = 1;\n            this.loading = false;\n            this.message = '';\n            this.processFeatures();\n        }\n    }\n\n    /**\n     * Load and store the location for the user\n     * @param user_email Email address of the selected user\n     */\n    private async loadUserLocation(user_email: string) {\n        this.focus = null;\n        this.focus_feature = null;\n        this.loading = true;\n        this.message = `Loading user details...`;\n        const user = await this._users.show(user_email);\n        /* istanbul ignore else */\n        if (!user) return user;\n        this.message = `Loading location for ${user.name}...`;\n        const location = await user.locate();\n        /* istanbul ignore else */\n        if (!location) return user;\n        this.active_level = location.level.id;\n        if (location.fixed) {\n            this.focus = location.id;\n            this.focus_feature = {\n                id: location.id,\n                coordinates: null,\n                content: MapPinComponent,\n                data: {\n                    text: `${user.name} is here`,\n                },\n            };\n            this.zoom = 1;\n        } else {\n            this.focus = {\n                x: location.x,\n                y: location.y,\n            };\n            this.focus_feature = {\n                coordinates: {\n                    x: location.x,\n                    y: location.y,\n                },\n                content: MapRadiusComponent,\n                data: {\n                    text: `${user.name} is here`,\n                    diameter: location.confidence || 5,\n                },\n            };\n        }\n        this.zoom = 1;\n        this.loading = false;\n        this.message = '';\n        this.processFeatures();\n        return user;\n    }\n}\n","import { Component, Inject } from '@angular/core';\nimport { MAT_DIALOG_DATA, MatDialogRef } from '@angular/material/dialog';\nimport { FormGroup } from '@angular/forms';\nimport { Router } from '@angular/router';\n\nimport { Booking } from 'src/app/services/data/bookings/booking.class';\nimport { ApplicationService } from 'src/app/services/app.service';\nimport { generateBookingForm, statusFromBookings } from 'src/app/services/data/bookings/booking.utilities';\nimport { Space } from 'src/app/services/data/spaces/space.class';\nimport { BaseDirective } from 'src/app/shared/base.directive';\nimport { UsersService } from 'src/app/services/data/users/users.service';\nimport { SpacesService } from 'src/app/services/data/spaces/spaces.service';\n\nimport * as dayjs from 'dayjs';\n\nexport interface ExploreBookingModalData {\n    /** Unix epoch in ms of the booking start time */\n    date: number;\n    /** Space to make the booking in */\n    space: Space;\n    /** List of bookings for the active space at the current time */\n    bookings: Booking[];\n}\n\n@Component({\n    selector: 'a-explore-booking-modal',\n    templateUrl: './booking-modal.component.html',\n    styleUrls: ['./booking-modal.component.scss']\n})\nexport class ExploreBookingModalComponent extends BaseDirective {\n    /**  */\n    public booking: Booking;\n    /** Form fields for new ad-hoc booking */\n    public form: FormGroup;\n    /** Form contents to display */\n    public state: 'info' | 'form' = 'info';\n    /** Description of the current loading state */\n    public loading: string;\n    /** String of time until next booking */\n    public available_until: string;\n    /** Whether booking was successful */\n    public success: boolean;\n\n    public get is_requesting(): boolean {\n        const booking = this.booking.toJSON(true);\n        return this.space.byRequest({\n            date: this.booking.changes.date || this.booking.date || dayjs(this._data.date).valueOf(),\n            duration: this.booking.changes.duration || this.booking.duration || 30,\n            host: booking.organiser || this._users.current\n        });\n    }\n\n    /** Display string for the selected date */\n    public get date(): string {\n        const date = dayjs(this._data.date);\n        return date.format('DD MMM YYYY');\n    }\n\n    /** Display string for the selected time */\n    public get time(): string {\n        const date = dayjs(this._data.date);\n        return date.format('h:mm A');\n    }\n\n    /** Selected space */\n    public get space(): Space {\n        return this._data.space;\n    }\n\n    /** Whether space is being booked for now */\n    public get is_now(): boolean {\n        const now = dayjs();\n        const date = dayjs(this._data.date);\n        return now.isSame(date, 'm') || now.isAfter(date, 'm');\n    }\n\n    constructor(\n        private _dialog_ref: MatDialogRef<ExploreBookingModalComponent>,\n        @Inject(MAT_DIALOG_DATA) private _data: ExploreBookingModalData,\n        private _router: Router,\n        private _service: ApplicationService,\n        private _users: UsersService,\n        private _spaces: SpacesService\n    ) {\n        super();\n        const date = dayjs(this._data.date);\n        this.booking = new Booking({\n            title: 'Ad-Hoc Booking',\n            date: date.valueOf(),\n            duration: 30,\n            room_ids: [this._data.space.id]\n        });\n        const status = statusFromBookings(\n            this._data.bookings,\n            this.space.bookable,\n            this.space.byRequest({\n                date: this._data.date,\n                duration: 30,\n                host: this._users.current\n            }),\n            this._data.date\n        );\n        this.available_until = status.available_until;\n    }\n\n    /**\n     * Move onto the next step of the booking flow\n     */\n    public next() {\n        if (!this.is_now) {\n            const booking = this.booking.toJSON(true);\n            localStorage.setItem('ACA_STAFF.booking_form_data', JSON.stringify({ id: 'ad-hoc', ...booking }));\n            this._router.navigate(['/book', 'space'], { queryParams: { back: '/explore' } });\n            this._dialog_ref.close();\n        } else {\n            this.form = generateBookingForm(this.booking, this._users.current, [\n                'space_list',\n                'organiser',\n                'title',\n                'duration'\n            ]);\n            this.state = 'form';\n        }\n    }\n\n    public book() {\n        /* istanbul ignore else */\n        if (this.form.valid) {\n            this.loading = 'Checking space availability...';\n            this.checkSpaceAvailability().then(\n                () => {\n                    this.booking.save().then(\n                        () => {\n                            this.loading = null;\n                            this.success = true;\n                            this.timeout('close', () => this._dialog_ref.close(), 5000);\n                        },\n                        err => {\n                            this.loading = null;\n                            this._service.notifyError(\n                                `Error ${this.booking.id ? 'updating' : 'creating'} booking: ${err.message || err}}`\n                            );\n                        }\n                    );\n                },\n                err => {\n                    this.loading = null;\n                    this._service.notifyError(`Error checking space availability: ${err.message || err}`);\n                }\n            );\n        }\n    }\n\n    /**\n     * Check whether the selected spaces are available for the selected time period\n     */\n    private checkSpaceAvailability(): Promise<void> {\n        const spaces: Space[] = this.booking.changes.space_list || this.booking.space_list;\n        return new Promise((resolve, reject) => {\n            this._spaces.available({\n                room_ids: spaces.map(space => space.id).join(','),\n                date: this.booking.changes.date || this.booking.date,\n                duration: this.booking.changes.duration || this.booking.duration\n            }).then(\n                space_list => {\n                    for (const space of space_list) {\n                        if (!space.was_available) {\n                            return reject(\n                                `${space.name} is not available at the select time period.`\n                            );\n                        }\n                    }\n                    resolve();\n                },\n                err => reject(err)\n            );\n        });\n    }\n}\n","<ng-container *ngIf=\"!success; else done_state\">\n    <header mat-dialog-title [class.request]=\"is_requesting\">\n        <ng-container *ngIf=\"state !== 'form'\">\n            <app-icon [icon]=\"{ class: 'material-icons', content: 'add' }\"></app-icon>\n            <div class=\"text\">\n                Book <span>{{ space?.name }}</span> {{ is_now ? 'from now' : 'at ' + time }}\n            </div>\n        </ng-container>\n        <ng-container *ngIf=\"state === 'form'\">\n            <div class=\"text\">\n                Book <span>{{ space?.name }}</span>\n            </div>\n        </ng-container>\n    </header>\n    <mat-dialog-content>\n        <main *ngIf=\"!loading; else load_state\">\n            <ng-container [ngSwitch]=\"state\">\n                <ng-container *ngSwitchCase=\"'form'\">\n                    <a-booking-form [form]=\"form\"></a-booking-form>\n                </ng-container>\n                <ng-container *ngSwitchDefault>\n                    <div class=\"details\">\n                        <p>{{ available_until }}</p>\n                        <p *ngIf=\"is_requesting\" i18n=\"Explore booking request details\">\n                            This space requires approval to reserve\n                        </p>\n                    </div>\n                </ng-container>\n            </ng-container>\n        </main>\n    </mat-dialog-content>\n    <mat-dialog-actions *ngIf=\"!loading\">\n        <footer>\n            <button mat-button class=\"inverse\" mat-dialog-close>Cancel</button>\n            <button mat-button (tapped)=\"state === 'form' ? book() : next()\">\n                {{ state === 'form' ? (is_requesting ? 'Request' : 'Book') : 'Yes' }}\n            </button>\n        </footer>\n    </mat-dialog-actions>\n    <ng-template #load_state>\n        <main>\n            <div class=\"info-block\">\n                <div class=\"icon\">\n                    <mat-spinner diameter=\"48\"></mat-spinner>\n                </div>\n                <div class=\"text\">{{ loading || 'Processing request...' }}</div>\n            </div>\n        </main>\n    </ng-template>\n</ng-container>\n<ng-template #done_state>\n    <header class=\"success\" [class.request]=\"is_requesting\">\n        <div class=\"text\">\n            <ng-container *ngIf=\"is_requesting\" i18n=\"Explore booking request sent\">\n                Request for <span>{{ space?.name }}</span> sent\n            </ng-container>\n            <ng-container *ngIf=\"!is_requesting\" i18n=\"Explore booking made\">\n                Booked <span>{{ space?.name }}</span>\n                {{ is_now ? 'from now' : 'at ' + time }}\n            </ng-container>\n        </div>\n        <app-icon\n            [icon]=\"{ class: 'material-icons', content: is_requesting ? 'send' : 'done' }\"\n        ></app-icon>\n    </header>\n</ng-template>\n","import { Component, OnInit, Inject } from '@angular/core';\nimport {\n    MAP_OVERLAY_DATA,\n    MAP_LOCATION\n} from '@acaprojects/ngx-interactive-map';\n\nimport { BaseDirective } from 'src/app/shared/base.directive';\nimport { Space } from 'src/app/services/data/spaces/space.class';\nimport { Booking } from 'src/app/services/data/bookings/booking.class';\nimport { statusFromBookings } from 'src/app/services/data/bookings/booking.utilities';\nimport { ApplicationService } from 'src/app/services/app.service';\nimport { Point } from 'src/app/shared/utilities/types.utilities';\nimport { UsersService } from 'src/app/services/data/users/users.service';\n\nexport interface SpaceInfoData {\n    /** Current time to show details for */\n    date?: number;\n    /** Space to show details for */\n    space: Space;\n    /** Active bookings for the space */\n    bookings: Booking[];\n}\n\n@Component({\n    selector: 'a-space-info',\n    templateUrl: './space-info.component.html',\n    styleUrls: ['./space-info.component.scss']\n})\nexport class ExploreSpaceInfoComponent extends BaseDirective implements OnInit {\n    /** Status of the space */\n    public status: string;\n    /** String of time until next booking */\n    public available_until: string;\n\n    /** Named position of the element location on the map */\n    public get quadrant(): 'top left' | 'top right' | 'bottom left' | 'bottom right' {\n        /* istanbul ignore if */\n        if (!this._position) {\n            return 'top left';\n        }\n        if (this._position.y < .5) {\n            if (this._position.x < .5) {\n                return 'top left';\n            } else {\n                return 'top right';\n            }\n        } else {\n            if (this._position.x < .5) {\n                return 'bottom left';\n            } else {\n                return 'bottom right';\n            }\n        }\n    }\n\n    /** CSS class for the current status of the space */\n    public get status_class(): string {\n        return (this.status || '')\n            .toLowerCase()\n            .split(' ')\n            .join('-');\n    }\n\n    /** Space to display on the component */\n    public get space(): Space {\n        /* istanbul ignore if */\n        if (!this._data) {\n            return null;\n        }\n        return this._data.space;\n    }\n\n    /** List of bookings from the space for the currently displayed time */\n    public get bookings(): Booking[] {\n        /* istanbul ignore if */\n        if (!this._data) {\n            return [];\n        }\n        return this._data.bookings || [];\n    }\n\n    constructor(\n        @Inject(MAP_OVERLAY_DATA) private _data: SpaceInfoData,\n        @Inject(MAP_LOCATION) private _position: Point,\n        private _users: UsersService\n    ) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this.processBookings();\n        this.interval('update_bookings', () => this.processBookings(), 60 * 1000);\n    }\n\n    /**\n     * Calculate availability of space based off given bookings\n     */\n    public processBookings(): void {\n        /* istanbul ignore if */\n        if (!this.space) {\n            return;\n        }\n        const status = statusFromBookings(\n            this.bookings,\n            this.space.bookable,\n            this.space.byRequest({\n                date: this._data.date,\n                duration: 30,\n                host: this._users.current\n            }),\n            this._data.date\n        );\n        this.status = status.status;\n        this.available_until = status.available_until;\n    }\n}\n","<div *ngIf=\"space\" [id]=\"space.id\" [class]=\"'space-info ' + quadrant\">\n    <div class=\"arrow\"></div>\n    <div class=\"details\">\n        <div class=\"name\">{{ space.name }}</div>\n        <div class=\"availability\">\n            <div name=\"status\" [class]=\"status_class\">{{ status }}</div>\n            <div name=\"available-until\" *ngIf=\"status_class !== 'not-bookable'\">{{ available_until }}</div>\n        </div>\n    </div>\n</div>","import {\n    Component,\n    OnInit,\n    Input,\n    OnChanges,\n    SimpleChanges,\n    ViewChild,\n    ElementRef\n} from '@angular/core';\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { catchError, debounceTime, distinctUntilChanged, switchMap, map } from 'rxjs/operators';\nimport { Observable, Subject, of } from 'rxjs';\n\nimport { BaseDirective } from 'src/app/shared/base.directive';\nimport { User } from 'src/app/services/data/users/user.class';\nimport { Space } from 'src/app/services/data/spaces/space.class';\nimport { UsersService } from 'src/app/services/data/users/users.service';\nimport { SpacesService } from 'src/app/services/data/spaces/spaces.service';\n\n// TODO: Add handling for role users. e.g. Fire Wardens, First Aiders\n// TODO: Add handling for searching for features\n// TODO: Add handling for searching for desks\n\n@Component({\n    selector: 'explore-search',\n    templateUrl: './search.component.html',\n    styleUrls: ['./search.component.scss']\n})\nexport class ExploreSearchComponent extends BaseDirective implements OnInit, OnChanges {\n    /** Type of data to show when searching */\n    @Input() public type: 'space' | 'user' | 'feature' | 'desk' | 'any';\n    /** Whether external changes are being processed */\n    @Input() public autofocus: boolean;\n    /** Display string for the placeholder of the search input */\n    @Input() public placeholder: string;\n    /** Whether search data is loading */\n    public loading: boolean;\n    /** Search filter value */\n    public search_str: string;\n    /** List of users from an API search */\n    public search_results$: Observable<(User | Space)[]>;\n    /** Post search and filtering list of items */\n    public results: (User | Space)[] = [];\n    /** Subject holding the value of the search */\n    public search$ = new Subject<string>();\n\n    /** Input field reference */\n    @ViewChild('input', { static: false }) private input_field: ElementRef<HTMLInputElement>;\n\n    constructor(\n        private _users: UsersService,\n        private _spaces: SpacesService,\n        private _route: ActivatedRoute,\n        private _router: Router\n    ) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this.subscription(\n            'route.params',\n            this._route.paramMap.subscribe(params => {\n                if (params.has('search_type')) {\n                    this.type = params.get('search_type') as any;\n                }\n            })\n        );\n        // Listen for input changes\n        this.search_results$ = this.search$.pipe(\n            debounceTime(400),\n            distinctUntilChanged(),\n            switchMap(query => {\n                this.loading = true;\n                return query.length >= 3\n                    ? (this._users.query({\n                          q: query.slice(0, 3),\n                          cache: 60 * 1000\n                      }) as Promise<User[]>)\n                    : Promise.resolve([]);\n            }),\n            catchError(err => of([])),\n            map((users: User[]) => {\n                const spaces = this._spaces.filter(_ => true);\n                const search = (this.search_str || '').toLowerCase();\n                const filter = item =>\n                    (item.name || '').toLowerCase().indexOf(search) >= 0 ||\n                    (item.email || '').toLowerCase().indexOf(search) >= 0;\n                let result_list = [];\n                if (this.type === 'space') {\n                    result_list = spaces;\n                } else if (this.type === 'user') {\n                    result_list = users;\n                } else {\n                    result_list = (spaces as any).concat(users);\n                }\n                this.loading = false;\n                return result_list.filter(filter);\n            })\n        );\n        // Process API results\n        this.subscription(\n            'search_results',\n            this.search_results$.subscribe(list => {\n                this.results = list;\n            })\n        );\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        /* istanbul ignore else */\n        if (changes.autofocus && this.autofocus) {\n            this.focusField();\n        }\n    }\n\n    public focusField() {\n        /* istanbul ignore else */\n        if (this.input_field && this.input_field.nativeElement) {\n            this.input_field.nativeElement.focus();\n        }\n    }\n\n    /**\n     * Update the selected item to display the location for on the map\n     * @param item Space or User to display location for\n     */\n    public selectOption(item: User | Space) {\n        if (item instanceof Space) {\n            this._router.navigate([], {\n                relativeTo: this._route,\n                queryParams: { space: item.id },\n                queryParamsHandling: 'merge'\n            });\n        } else {\n            this._router.navigate([], {\n                relativeTo: this._route,\n                queryParams: { user: item.email },\n                queryParamsHandling: 'merge'\n            });\n        }\n        this.search_str = item.name;\n    }\n}\n","<div class=\"searchbar\" *ngIf=\"type\" tabindex=\"0\" (focus)=\"focusField()\" (click)=\"focusField()\">\n    <div class=\"prefix\">\n        <app-icon [icon]=\"{ type: 'icon', class: 'material-icons', content: 'search' }\"></app-icon>\n    </div>\n    <div class=\"input\">\n        <input\n            #input\n            type=\"text\"\n            [(ngModel)]=\"search_str\"\n            (ngModelChange)=\"search$.next($event)\"\n            [matAutocomplete]=\"auto\"\n            [placeholder]=\"placeholder || 'Search...'\"\n        />\n    </div>\n    <div class=\"suffix\">\n        <mat-spinner *ngIf=\"loading\" diameter=\"32\"></mat-spinner>\n    </div>\n</div>\n<mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)=\"selectOption($event.option.value)\">\n    <mat-option *ngFor=\"let option of results\" [value]=\"option\">\n        <div class=\"name\">{{ option.name }}</div>\n        <div class=\"email\">{{ option.level ? option.level.name : option.email }}</div>\n    </mat-option>\n</mat-autocomplete>\n","import { Component, Output, EventEmitter, OnInit, Input, SimpleChanges, OnChanges } from '@angular/core';\nimport { first } from 'rxjs/operators';\n\nimport { ApplicationService } from 'src/app/services/app.service';\nimport { BaseDirective } from 'src/app/shared/base.directive';\nimport { HashMap } from 'src/app/shared/utilities/types.utilities';\nimport { MapStatus } from './status.interfaces';\nimport { OrganisationService } from 'src/app/services/data/organisation/organisation.service';\n\n@Component({\n    selector: '[desk-status]',\n    template: `\n        <ng-content></ng-content>\n        <div class=\"bindings\" *ngIf=\"system_id\">\n            <!-- BINDINGS -->\n            <i binding [(model)]=\"in_use\" [sys]=\"system_id\" mod=\"DeskManagement\" [bind]=\"zone\" (modelChange)=\"calculateStatus()\"></i>\n            <i binding [(model)]=\"id_list\" [sys]=\"system_id\" mod=\"DeskManagement\" [bind]=\"zone + ':desk_ids'\" (modelChange)=\"calculateStatus()\"></i>\n            <i binding [(model)]=\"reserved\" [sys]=\"system_id\" mod=\"DeskManagement\" [bind]=\"zone + ':reserved'\" (modelChange)=\"calculateStatus()\"></i>\n            <i binding [(model)]=\"occupied\" [sys]=\"system_id\" mod=\"DeskManagement\" [bind]=\"zone + ':occupied_count'\"></i>\n            <i binding [(model)]=\"free\" [sys]=\"system_id\" mod=\"DeskManagement\" [bind]=\"zone + ':free_count'\"></i>\n            <!-- REMOTE EXECUTIONS -->\n            <i binding [(model)]=\"checkin\" [sys]=\"system_id\" mod=\"DeskManagement\" exec=\"manual_checkin\" [params]=\"[checkin]\"></i>\n            <i binding [(model)]=\"cancel\" [sys]=\"system_id\" mod=\"DeskManagement\" exec=\"cancel_reservation\" [params]=\"[]\"></i>\n        </div>\n    `\n})\nexport class ExploreDeskStatusComponent extends BaseDirective implements OnChanges {\n    /** ID of the active level */\n    @Input() public zone: string;\n    /** ID of the desk to checkin */\n    @Input() public checkin: string;\n    /** Emitter for changes to the desk status */\n    @Output() public status = new EventEmitter<MapStatus[]>();\n    /** ID of the desk management system */\n    public system_id: string;\n    /** List of desks for the active level */\n    public id_list: string[];\n    /** List of desk IDs in use on the active level */\n    public in_use: string[];\n    /** List of desk IDs that are reserved on the active level */\n    public reserved: string[];\n    /** Number of occupied desks on the active level */\n    public occupied: number = 0;\n    /** Number of free desks on the active level */\n    public free: number = 0;\n    /** Mapping of colours to statuses */\n    public colour_map: HashMap<string> = {};\n    /** Toggle for cancelling desk reservations */\n    public cancel: boolean;\n\n    constructor(private _service: ApplicationService, private _org: OrganisationService) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this._service.initialised.pipe(first(_ => _)).subscribe(() => {\n            this.colour_map = this._service.setting('app.explore.colors') || {};\n        });\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        if (changes.zone) {\n            this.loadDesks();\n        }\n    }\n\n    public calculateStatus() {\n        const desk_list = this.id_list || [];\n        const status_list: MapStatus[] = [];\n        for (const desk_id of desk_list) {\n            const in_use = (this.in_use || []).find(id => id === desk_id);\n            const reserved = (this.reserved || []).find(id => id === desk_id);\n            const status = in_use ? 'unavailable' : reserved ? 'reserved' : 'available';\n            status_list.push({\n                id: desk_id,\n                styles: {\n                    fill: this.colour_map[`desk-${status}`],\n                    stroke: this.colour_map[`desk-${status}-stroke`],\n                },\n                status_id: status\n            });\n        }\n        this.status.emit(status_list);\n    }\n\n    private loadDesks() {\n        const level = this._org.levelWithID(this.zone);\n        if (!level) { return ; }\n        const building = this._org.buildings.find(bld => bld.id === level.building_id);\n        if (!building) { return; }\n        const desk_management = building.systems.desk_management;\n        if (!desk_management) { return; }\n        this.system_id = desk_management;\n    }\n}\n","import {\n    Component,\n    Input,\n    Output,\n    EventEmitter,\n    OnInit,\n    OnDestroy,\n    SimpleChanges,\n    OnChanges,\n} from '@angular/core';\nimport { first } from 'rxjs/operators';\n\nimport { BaseDirective } from 'src/app/shared/base.directive';\nimport { ApplicationService } from 'src/app/services/app.service';\nimport { Space } from 'src/app/services/data/spaces/space.class';\nimport { HashMap } from 'src/app/shared/utilities/types.utilities';\nimport { Booking } from 'src/app/services/data/bookings/booking.class';\nimport { ExploreSpaceInfoComponent } from '../overlays/space-info/space-info.component';\nimport { MapStatus, MapListener, SpaceStatus } from './status.interfaces';\n\nimport * as dayjs from 'dayjs';\nimport { MatDialog } from '@angular/material/dialog';\nimport {\n    ExploreBookingModalComponent,\n    ExploreBookingModalData,\n} from '../overlays/booking-modal/booking-modal.component';\nimport { MapFeature } from '@acaprojects/ngx-interactive-map/lib/helpers/map.interfaces';\nimport { SpacesService } from 'src/app/services/data/spaces/spaces.service';\nimport { UsersService } from 'src/app/services/data/users/users.service';\n\n@Component({\n    selector: '[space-status]',\n    template: `\n        <div class=\"bindings\" *ngIf=\"space_list && is_today\">\n            <i\n                *ngFor=\"let space of space_list\"\n                binding\n                [sys]=\"space.id\"\n                mod=\"Bookings\"\n                bind=\"today\"\n                (modelChange)=\"processSpaceBookings(space, $event)\"\n            ></i>\n        </div>\n        <ng-content></ng-content>\n    `,\n})\nexport class ExploreSpaceStatusComponent extends BaseDirective\n    implements OnInit, OnChanges, OnDestroy {\n    /** ID of the zone to grab the spaces */\n    @Input() public zone: string;\n    /** Updates the status based of the given time. Unix epoch in milliseconds */\n    @Input() public date: number;\n    /** Emitter for changes to the space status */\n    @Output() public status = new EventEmitter<MapStatus[]>();\n    /** Emitter for changes to the space status */\n    @Output() public listeners = new EventEmitter<MapListener[]>();\n    /** Emitter for changes to the space status */\n    @Output() public features = new EventEmitter<MapFeature[]>();\n    /** List of spaces to grab the statuses for */\n    public space_list: Space[] = [];\n    /** Mapping of spaces to active bookings */\n    public active_bookings: HashMap<Booking[]> = {};\n    /** Mapping of colours to statuses */\n    public colour_map: HashMap<string> = {};\n\n    /** Whether selected date time is the current day */\n    public get is_today() {\n        return dayjs().isSame(dayjs(this.date), 'd');\n    }\n\n    constructor(\n        private _service: ApplicationService,\n        private _users: UsersService,\n        private _spaces: SpacesService,\n        private _dialog: MatDialog\n    ) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this._service.initialised.pipe(first((_) => _)).subscribe(() => {\n            this.colour_map = this._service.setting('app.explore.colors') || {};\n            this.subscription(\n                'spaces',\n                this._spaces.listen('list').subscribe(() => this.loadSpaces())\n            );\n            this.interval(\n                'update_status',\n                () => {\n                    this.updateSpaceBookings();\n                    this.calculateStatus();\n                },\n                60 * 1000\n            );\n        });\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        if (changes.zone || changes.date) {\n            this.loadSpaces();\n        }\n        if (changes.zone) {\n            this.clearSpaces();\n        }\n    }\n\n    public ngOnDestroy() {\n        this.clearSpaces();\n    }\n\n    /**\n     * Determine the availability statuses for all the spaces in the set zone\n     */\n    public calculateStatus() {\n        this.timeout('process_statuses', () => {\n            const statuses: MapStatus[] = [];\n            for (const space of this.space_list) {\n                const status = this.getStatus(space, this.date);\n                const id =\n                    space.map_id.indexOf('area') < 0 ? `area-${space.map_id}-status` : space.map_id;\n                statuses.push({\n                    id,\n                    styles: {\n                        fill: this.colour_map[`space-${status}`] || '#000',\n                        opacity: 0.6,\n                    },\n                    status_id: status,\n                });\n            }\n            this.status.emit(statuses);\n        });\n    }\n\n    /**\n     * Get the status of the space at the set time\n     * @param space Space to get the status for\n     */\n    private getStatus(space: Space, datetime?: number): SpaceStatus {\n        if (!space.bookable) {\n            return 'not-bookable';\n        }\n        const bookings = this.active_bookings[space.id] || [];\n        const date = dayjs(datetime).startOf('m').second(1);\n        const current_booking = bookings.find((booking) => {\n            const start = dayjs(booking.date).startOf('m');\n            const end = start.add(booking.duration, 'm');\n            return date.isAfter(start, 's') && date.isBefore(end, 'm');\n        });\n        if (current_booking) {\n            return 'unavailable';\n        }\n        const options = {\n            date: dayjs(this.date).valueOf(),\n            duration: 30,\n            host: this._users.current,\n        };\n        const rules = space.rulesFor(options);\n        if (rules.hide) {\n            return 'not-bookable';\n        } else if (!rules.auto_approve) {\n            return 'requestable';\n        }\n        return 'available';\n    }\n\n    /**\n     * Process raw booking data for the given space\n     * @param space Space associated with the bookings\n     * @param data List of booking data\n     */\n    public processSpaceBookings(space: Space, data: HashMap[]) {\n        this.timeout(\n            `space-${space.id}`,\n            () => {\n                const bookings = (data || []).map(\n                    (bkn_data) => new Booking({ ...bkn_data, room_ids: [space.id] })\n                );\n                this.active_bookings[space.id] = bookings;\n                this.calculateStatus();\n            },\n            10\n        );\n    }\n\n    /**\n     * Update the booking data for space on future dates\n     */\n    public updateSpaceBookings() {\n        /* istanbul ignore else */\n        if (this.is_today) {\n            return;\n        }\n        this.timeout(\n            'update_spaces',\n            () => {\n                const date = dayjs(this.date).startOf('d');\n                this._spaces\n                    .query({\n                        from: date.unix(),\n                        to: date.endOf('d').unix(),\n                        show_declined: false,\n                        zone_ids: this.zone,\n                        cache: 10 * 1000,\n                    })\n                    .then((spaces) => {\n                        spaces.forEach((space) =>\n                            this.processSpaceBookings(space, [...space.bookings])\n                        );\n                    });\n            },\n            50\n        );\n    }\n\n    /**\n     * Load listeners for space data\n     */\n    private loadSpaces() {\n        this.space_list = this._spaces.filter((space) => space.zones.indexOf(this.zone) >= 0);\n        const listeners: MapListener[] = [];\n        for (const space of this.space_list) {\n            const id =\n                space.map_id.indexOf('area') < 0 ? `area-${space.map_id}-status` : space.map_id;\n            listeners.push({\n                id,\n                event: 'mouseenter',\n                callback: () => this.showSpaceInfo(space),\n            });\n            listeners.push({\n                id,\n                event: 'mouseleave',\n                callback: () => this.features.emit([]),\n            });\n            if (space.bookable) {\n                listeners.push({\n                    id,\n                    event: 'click',\n                    callback: () => this.openBookingModal(space),\n                });\n            }\n        }\n        this.listeners.emit(listeners);\n        this.updateSpaceBookings();\n        this.calculateStatus();\n    }\n\n    /**\n     * Clear current space and booking data\n     */\n    private clearSpaces() {\n        delete this.active_bookings;\n        this.active_bookings = {};\n    }\n\n    /**\n     * Update features to include space info for a space\n     * @param space Space to show details for\n     */\n    private showSpaceInfo(space: Space) {\n        const id = space.map_id.indexOf('area') < 0 ? `area-${space.map_id}-status` : space.map_id;\n        this.features.emit([\n            {\n                id,\n                coordinates: null,\n                content: ExploreSpaceInfoComponent,\n                data: {\n                    space,\n                    bookings: this.active_bookings[space.id],\n                    date: this.date,\n                },\n            },\n        ]);\n    }\n\n    /**\n     * Open explore booking modal for the given space\n     * @param space Space to make booking for\n     */\n    private openBookingModal(space: Space) {\n        const status = this.getStatus(space, this.date);\n        if (status !== 'unavailable' && status !== 'not-bookable') {\n            this._dialog.open<ExploreBookingModalComponent, ExploreBookingModalData>(\n                ExploreBookingModalComponent,\n                {\n                    width: 'auto',\n                    height: 'auto',\n                    data: {\n                        date: this.date,\n                        space,\n                        bookings: this.active_bookings[space.id],\n                    },\n                }\n            );\n        } else {\n            this._service.notifyInfo(\n                `${space.name} is unavailable at the selected time. Please select another space or time and try again.`\n            );\n        }\n    }\n}\n","import {\n    Component,\n    OnInit,\n    Input,\n    Output,\n    EventEmitter,\n    ElementRef,\n    Renderer2,\n    ViewChild,\n} from '@angular/core';\n\nimport { BaseDirective } from 'src/app/shared/base.directive';\nimport { Identity, Point } from 'src/app/shared/utilities/types.utilities';\n\nimport * as dayjs from 'dayjs';\nimport { eventToPoint } from 'src/app/shared/utilities/general.utilities';\n\nconst BLOCK_SIZE = 30;\nconst MINUTES_IN_DAY = 24 * 60;\n\n@Component({\n    selector: 'a-timeline',\n    templateUrl: './timeline.component.html',\n    styleUrls: ['./timeline.component.scss'],\n})\nexport class TimelineComponent extends BaseDirective implements OnInit {\n    /** Currently selected datetime */\n    @Input() public date: number;\n    /** Emitter for changes to the selected datetime */\n    @Output() public dateChange = new EventEmitter<number>();\n    /** List of time blocks to select */\n    public blocks: Identity[] = [];\n    /** Starting point for time move events */\n    private _start_position: Point;\n    /** Bounding box of the timeline container */\n    private _box: ClientRect;\n\n    /** Whether selected date time is the current day */\n    public get is_today() {\n        return dayjs().isSame(dayjs(this.date), 'd');\n    }\n\n    /** Offset of the current time from the start of the day */\n    public get offset() {\n        const date = dayjs();\n        const diff = date.diff(date.startOf('d'), 'm');\n        return (diff / MINUTES_IN_DAY) * 100;\n    }\n\n    /** Details of the currently selected datetime */\n    public get active_time(): Identity {\n        const date = dayjs(this.date);\n        const diff = date.diff(date.startOf('d'), 'm');\n        return {\n            id: date.isSame(dayjs(), 'd') ? 'Today' : date.format('DD MMM YYYY'),\n            name: date.format('h:mm A'),\n            left: (diff / MINUTES_IN_DAY) * 100,\n        };\n    }\n\n    @ViewChild('container', { static: true }) private _container: ElementRef<HTMLDivElement>;\n\n    constructor(private _renderer: Renderer2) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this.blocks = this.generateBlocks();\n        this.interval('check_date', () => this.checkDate(), 15 * 1000);\n    }\n\n    /**\n     * Generate the display blocks for the timeline\n     */\n    public generateBlocks(): Identity[] {\n        const start = dayjs().startOf('d');\n        const end = start.endOf('d');\n        const blocks: Identity[] = [];\n        let current_time = start;\n        while (current_time.isBefore(end)) {\n            const is_hour = current_time.minute() === 0;\n            blocks.push({\n                id: current_time.format('HH:mm'),\n                name: is_hour ? current_time.format('h') : '',\n                is_hour,\n                left: (current_time.diff(start, 'm') / MINUTES_IN_DAY) * 100,\n            });\n            current_time = current_time.add(BLOCK_SIZE, 'm');\n        }\n        return blocks;\n    }\n\n    /**\n     * Change the date of the active date time\n     * @param amount Number of days to change by\n     */\n    public changeDate(amount: number = 1) {\n        let date = dayjs(this.date);\n        date = date.add(amount, 'd');\n        const now = dayjs();\n        this.date = date.isBefore(now, 'm') ? now.valueOf() : date.valueOf();\n        this.dateChange.emit(this.date);\n    }\n\n    public startMove(event: MouseEvent | TouchEvent) {\n        const position = eventToPoint(event);\n        this._start_position = position;\n        this._box = this._container.nativeElement.getBoundingClientRect();\n        const type = event instanceof MouseEvent ? 'mouse' : 'touch';\n        this.subscription(\n            'move',\n            this._renderer.listen('window', `${type}move`, (e) => this.onMove(e))\n        );\n        this.subscription(\n            'end',\n            this._renderer.listen('window', `${type === 'mouse' ? 'mouseup' : 'touchend'}`, (e) => {\n                this.unsub('move');\n                this.unsub('end');\n            })\n        );\n    }\n\n    public onMove(event: MouseEvent | TouchEvent) {\n        const position = eventToPoint(event);\n        const y_change = (this._start_position.x - position.x) / this._box.width;\n        const time_change = -Math.round(y_change * MINUTES_IN_DAY);\n        /* istanbul ignore else */\n        if (time_change !== 0) {\n            let old_date = dayjs(this.date);\n            let date = old_date;\n            date = date.add(time_change, 'm');\n            date = date.minute(Math.floor(Math.round(date.minute() / 5)) * 5);\n            this.date = date.valueOf();\n            this.dateChange.emit(this.date);\n            /* istanbul ignore else */\n            if (Math.abs(old_date.diff(date, 'm')) > 0) {\n                this._start_position = position;\n            }\n            this.checkDate();\n        }\n    }\n\n    /** Check that active datetime is not in the past */\n    private checkDate() {\n        const date = dayjs(this.date);\n        let now = dayjs();\n        now = now.minute(Math.floor(Math.ceil(now.minute() / 5)) * 5);\n        /* istanbul ignore else */\n        if (date.isBefore(now, 'm')) {\n            this.date = now.valueOf();\n            this.dateChange.emit(this.date);\n        }\n    }\n}\n","<div class=\"not-mobile\">\n    <div class=\"timeline\" explore #container>\n        <div\n            class=\"block\"\n            *ngFor=\"let item of blocks\"\n            [class.hour]=\"item.is_hour\"\n            [style.left]=\"item.left + '%'\"\n        >\n            <div class=\"text\">{{ item.name }}</div>\n            <div class=\"bar\"></div>\n        </div>\n    </div>\n    <div class=\"offset\" *ngIf=\"is_today\" [style.width]=\"offset + '%'\"></div>\n    <div class=\"active-time\" [style.left]=\"active_time.left + '%'\">\n        <div class=\"bar\"></div>\n        <div class=\"date\">\n            <button mat-icon-button [disabled]=\"is_today\" (tapped)=\"changeDate(-1)\">\n                <app-icon [icon]=\"{ class: 'material-icons', content: 'keyboard_arrow_left' }\"></app-icon>\n            </button>\n            <div class=\"text\" (mousedown)=\"startMove($event)\" (touchstart)=\"startMove($event)\">{{ active_time.id }}</div>\n            <button mat-icon-button (tapped)=\"changeDate()\">\n                <app-icon [icon]=\"{ class: 'material-icons', content: 'keyboard_arrow_right' }\"></app-icon>\n            </button>\n        </div>\n        <div class=\"time\" (mousedown)=\"startMove($event)\" (touchstart)=\"startMove($event)\">{{ active_time.name }}</div>\n        <div class=\"triangle\"></div>\n    </div>\n</div>\n<div class=\"pickers mobile-only\">\n    <a-date-field [(ngModel)]=\"date\" offset=\"top\" (ngModelChange)=\"dateChange.emit($event)\"></a-date-field>\n    <a-time-field [(ngModel)]=\"date\" (ngModelChange)=\"dateChange.emit($event)\"></a-time-field>\n</div>\n","import { Component, OnInit, Input, Output, EventEmitter } from '@angular/core';\n\nimport { Point } from 'src/app/shared/utilities/types.utilities';\n\n@Component({\n    selector: 'a-zoom-controls',\n    templateUrl: './zoom-controls.component.html',\n    styleUrls: ['./zoom-controls.component.scss']\n})\nexport class ZoomControlsComponent implements OnInit {\n    /** Current zoom level of the map */\n    @Input() public zoom: number;\n    /** Current center position of the map */\n    @Input() public position: Point;\n    /** Emitter for changes to the zoom value */\n    @Output() public zoomChange = new EventEmitter<number>();\n    /** Emitter for changes to the position */\n    @Output() public positionChange = new EventEmitter<Point>();\n\n    public min_zoom: number = 1;\n\n    public max_zoom: number = 10;\n\n    constructor() {}\n\n    public ngOnInit(): void {\n\n    }\n\n    public zoomIn() {\n        this.zoom = (this.zoom || this.min_zoom) * 1.2;\n        if (this.zoom > this.max_zoom) {\n            this.zoom = this.max_zoom;\n        }\n        this.zoomChange.emit(this.zoom);\n    }\n\n    public zoomOut() {\n        this.zoom = (this.zoom || this.min_zoom) * (1 / 1.2);\n        if (this.zoom < this.min_zoom) {\n            this.zoom = this.min_zoom;\n        }\n        this.zoomChange.emit(this.zoom);\n    }\n\n    public reset() {\n        this.zoom = this.min_zoom;\n        this.position = { x: 0.5, y: 0.5 };\n        this.zoomChange.emit(this.zoom);\n        this.positionChange.emit(this.position);\n    }\n}\n","<div class=\"zoom-control\">\n    <button mat-icon-button name=\"zoom-in\" (tapped)=\"zoomIn()\">\n        <app-icon [icon]=\"{ type: 'icon', class: 'material-icons', content: 'add' }\"></app-icon>\n    </button>\n    <button mat-icon-button name=\"zoom-out\" (tapped)=\"zoomOut()\">\n        <app-icon [icon]=\"{ type: 'icon', class: 'material-icons', content: 'remove' }\"></app-icon>\n    </button>\n    <button mat-icon-button name=\"reset\" (tapped)=\"reset()\">\n        <app-icon [icon]=\"{ type: 'icon', class: 'material-icons', content: 'replay' }\"></app-icon>\n    </button>\n</div>\n"]}