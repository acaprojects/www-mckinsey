(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"7NT8":function(t,e,n){"use strict";n.r(e);var o=n("ofXK"),i=n("tyNb"),s=n("3Pt+"),a=n("Cvi9"),c=n("1gA9"),r=n("OaWH"),l=n("IWZj"),d=n("fXoL"),u=n("ocbO"),b=n("mrSG"),p=n("SxV6"),h=n("Kj3r"),g=n("/uUt"),m=n("eIep"),f=n("JIr8"),_=n("lJxs"),v=n("XNiG"),C=n("LRne"),O=n("KsZa"),x=n("/1cH"),M=n("0njA"),w=n("Xa2L"),y=n("FKr1");const P=["input"];function k(t,e){1&t&&d.Rb(0,"mat-spinner",12)}const z=function(){return{type:"icon",class:"material-icons",content:"search"}};function W(t,e){if(1&t){const t=d.Xb();d.Wb(0,"div",4),d.lc("focus",(function(){return d.Dc(t),d.pc().focusField()}))("click",(function(){return d.Dc(t),d.pc().focusField()})),d.Wb(1,"div",5),d.Rb(2,"app-icon",6),d.Vb(),d.Wb(3,"div",7),d.Wb(4,"input",8,9),d.lc("ngModelChange",(function(e){return d.Dc(t),d.pc().search_str=e}))("ngModelChange",(function(e){return d.Dc(t),d.pc().search$.next(e)})),d.Vb(),d.Vb(),d.Wb(6,"div",10),d.Lc(7,k,1,0,"mat-spinner",11),d.Vb(),d.Vb()}if(2&t){const t=d.pc(),e=d.Ac(2);d.Cb(2),d.vc("icon",d.wc(5,z)),d.Cb(2),d.vc("ngModel",t.search_str)("matAutocomplete",e)("placeholder",t.placeholder||"Search..."),d.Cb(3),d.vc("ngIf",t.loading)}}function V(t,e){if(1&t&&(d.Wb(0,"mat-option",13),d.Wb(1,"div",14),d.Nc(2),d.Vb(),d.Wb(3,"div",15),d.Nc(4),d.Vb(),d.Vb()),2&t){const t=e.$implicit;d.vc("value",t),d.Cb(2),d.Oc(t.name),d.Cb(2),d.Oc(t.level?t.level.name:t.email)}}let I=(()=>{class t extends l.a{constructor(t,e,n){super(),this._service=t,this._route=e,this._router=n,this.results=[],this.search$=new v.a}ngOnInit(){this.subscription("route.params",this._route.paramMap.subscribe(t=>{t.has("search_type")&&(this.type=t.get("search_type"))})),this.search_results$=this.search$.pipe(Object(h.a)(400),Object(g.a)(),Object(m.a)(t=>(this.loading=!0,t.length>=3?this._service.Users.query({q:t.slice(0,3),cache:6e4}):Promise.resolve([]))),Object(f.a)(t=>Object(C.a)([])),Object(_.a)(t=>{const e=this._service.Spaces.list(t=>!0),n=(this.search_str||"").toLowerCase();let o=[];return o="space"===this.type?e:"user"===this.type?t:e.concat(t),this.loading=!1,o.filter(t=>(t.name||"").toLowerCase().indexOf(n)>=0||(t.email||"").toLowerCase().indexOf(n)>=0)})),this.subscription("search_results",this.search_results$.subscribe(t=>{this.results=t}))}ngOnChanges(t){t.autofocus&&this.autofocus&&this.focusField()}focusField(){this.input_field&&this.input_field.nativeElement&&this.input_field.nativeElement.focus()}selectOption(t){this._router.navigate([],t instanceof O.a?{relativeTo:this._route,queryParams:{space:t.id},queryParamsHandling:"merge"}:{relativeTo:this._route,queryParams:{user:t.email},queryParamsHandling:"merge"}),this.search_str=t.name}}return t.\u0275fac=function(e){return new(e||t)(d.Qb(r.a),d.Qb(i.a),d.Qb(i.d))},t.\u0275cmp=d.Kb({type:t,selectors:[["explore-search"]],viewQuery:function(t,e){var n;1&t&&d.Jc(P,!0),2&t&&d.zc(n=d.mc())&&(e.input_field=n.first)},inputs:{type:"type",autofocus:"autofocus",placeholder:"placeholder"},features:[d.zb,d.Ab],decls:4,vars:2,consts:[["class","searchbar","tabindex","0",3,"focus","click",4,"ngIf"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["tabindex","0",1,"searchbar",3,"focus","click"],[1,"prefix"],[3,"icon"],[1,"input"],["type","text",3,"ngModel","matAutocomplete","placeholder","ngModelChange"],["input",""],[1,"suffix"],["diameter","32",4,"ngIf"],["diameter","32"],[3,"value"],[1,"name"],[1,"email"]],template:function(t,e){1&t&&(d.Lc(0,W,8,6,"div",0),d.Wb(1,"mat-autocomplete",1,2),d.lc("optionSelected",(function(t){return e.selectOption(t.option.value)})),d.Lc(3,V,5,3,"mat-option",3),d.Vb()),2&t&&(d.vc("ngIf",e.type),d.Cb(3),d.vc("ngForOf",e.results))},directives:[o.t,x.a,o.s,M.a,s.c,x.d,s.r,s.u,w.c,y.g],styles:[".searchbar[_ngcontent-%COMP%]{display:flex;align-items:center;max-width:calc(100% - 1em);width:calc(100% - 1em);margin:.5em auto;background-color:#fff;border-radius:2em;padding:0 .75em;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}@media only screen and (orientation:portrait) and (max-width:450px){.searchbar[_ngcontent-%COMP%]{border-radius:0;box-shadow:none;margin:0;width:100%;max-width:100%;padding:0 .5em;border-bottom:1px solid #ccc}}@media only screen and (orientation:landscape) and (max-width:800px){.searchbar[_ngcontent-%COMP%]{border-radius:0;box-shadow:none;margin:0;width:100%;max-width:100%;padding:0 .5em;border-bottom:1px solid #ccc}}.prefix[_ngcontent-%COMP%], .suffix[_ngcontent-%COMP%]{font-size:1.5em;min-width:32px;min-height:100%}.input[_ngcontent-%COMP%]{flex:1;min-width:50%}input[_ngcontent-%COMP%]{width:100%;font-size:1em;border:none;outline:none;padding:1em .5em;background:none}.name[_ngcontent-%COMP%]{height:1em}.email[_ngcontent-%COMP%]{font-size:.6em;color:rgba(0,0,0,.65)}"]}),t})();var S=n("xhdr"),L=n("5RMF");function $(t,e){if(1&t&&(d.Wb(0,"div",8),d.Nc(1),d.Vb()),2&t){const t=d.pc(2);d.Cb(1),d.Oc(t.available_until)}}function R(t,e){if(1&t&&(d.Wb(0,"div",1),d.Rb(1,"div",2),d.Wb(2,"div",3),d.Wb(3,"div",4),d.Nc(4),d.Vb(),d.Wb(5,"div",5),d.Wb(6,"div",6),d.Nc(7),d.Vb(),d.Lc(8,$,2,1,"div",7),d.Vb(),d.Vb(),d.Vb()),2&t){const t=d.pc();d.Eb("space-info "+t.quadrant),d.vc("id",t.space.id),d.Cb(4),d.Oc(t.space.name),d.Cb(2),d.Eb(t.status_class),d.Cb(1),d.Oc(t.status),d.Cb(1),d.vc("ngIf","not-bookable"!==t.status_class)}}let D=(()=>{class t extends l.a{constructor(t,e,n){super(),this._data=t,this._position=e,this._service=n}get quadrant(){if(!this._position)return"top left";const t=this._position;return t.x>50&&t.y>50?"bottom right":t.x<50&&t.y>50?"bottom left":t.x>50?"top right":"top left"}get status_class(){return(this.status||"").toLowerCase().split(" ").join("-")}get space(){return this._data?this._data.space:null}get bookings(){return this._data&&this._data.bookings||[]}ngOnInit(){this.processBookings(),this.interval("update_bookings",()=>this.processBookings(),6e4)}processBookings(){if(!this.space)return;const t=Object(L.e)(this.bookings,this.space.bookable,this.space.byRequest({date:this._data.date,duration:30,host:this._service.Users.current}),this._data.date);this.status=t.status,this.available_until=t.available_until}}return t.\u0275fac=function(e){return new(e||t)(d.Qb(c.c),d.Qb(c.b),d.Qb(r.a))},t.\u0275cmp=d.Kb({type:t,selectors:[["a-space-info"]],features:[d.zb],decls:1,vars:1,consts:[[3,"id","class",4,"ngIf"],[3,"id"],[1,"arrow"],[1,"details"],[1,"name"],[1,"availability"],["name","status"],["name","available-until",4,"ngIf"],["name","available-until"]],template:function(t,e){1&t&&d.Lc(0,R,9,8,"div",0),2&t&&d.vc("ngIf",e.space)},directives:[o.t],styles:["[_nghost-%COMP%]{pointer-events:none}.space-info[_ngcontent-%COMP%]{position:absolute;min-width:16em;border-radius:4px;background-color:#fff;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.space-info.top[_ngcontent-%COMP%]{top:0}.space-info.top.left[_ngcontent-%COMP%]{left:0;border-top-left-radius:0}.space-info.top.right[_ngcontent-%COMP%]{right:0;border-top-right-radius:0}.space-info.bottom[_ngcontent-%COMP%]{bottom:0}.space-info.bottom.left[_ngcontent-%COMP%]{left:0;border-bottom-left-radius:0}.space-info.bottom.right[_ngcontent-%COMP%]{right:0;border-bottom-right-radius:0}.top[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{top:2px}.top.left[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{left:2px;border-width:8px 8px 0 0;border-color:#1937ea transparent transparent}.top.right[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{right:2px;border-width:0 8px 8px 0;border-color:transparent #1937ea transparent transparent}.bottom[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{bottom:2px}.bottom.left[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{left:2px;border-width:8px 0 0 8px;border-color:transparent transparent transparent #1937ea}.bottom.right[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{right:2px;border-width:0 0 8px 8px;border-color:transparent transparent #1937ea}.arrow[_ngcontent-%COMP%]{position:absolute;width:0;height:0;border-style:solid}.details[_ngcontent-%COMP%]{padding:1em}.name[_ngcontent-%COMP%]{font-size:1.25em;padding:.2em .4em}.availability[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{padding:.25rem .5rem;display:inline-block}[name=status][_ngcontent-%COMP%]{border-radius:4px;color:#fff;font-size:.8em;margin-right:auto}[name=status].not-bookable[_ngcontent-%COMP%]{background-color:#ccc}[name=status].available[_ngcontent-%COMP%]{background-color:#43a047}[name=status].available-by-request[_ngcontent-%COMP%]{background-color:#ffb300}[name=status].meeting-in-progress[_ngcontent-%COMP%]{background-color:#e53935}"]}),t})();var N=n("Wgwc"),A=n("0IaG"),q=n("4Man"),T=n("bTqV"),E=n("m6yr");const j=function(){return{class:"material-icons",content:"add"}};function B(t,e){if(1&t&&(d.Ub(0),d.Rb(1,"app-icon",5),d.Wb(2,"div",6),d.Nc(3," Book "),d.Wb(4,"span"),d.Nc(5),d.Vb(),d.Nc(6),d.Vb(),d.Tb()),2&t){const t=d.pc(2);d.Cb(1),d.vc("icon",d.wc(3,j)),d.Cb(4),d.Oc(null==t.space?null:t.space.name),d.Cb(1),d.Pc(" ",t.is_now?"from now":"at "+t.time," ")}}function F(t,e){if(1&t&&(d.Ub(0),d.Wb(1,"div",6),d.Nc(2," Book "),d.Wb(3,"span"),d.Nc(4),d.Vb(),d.Vb(),d.Tb()),2&t){const t=d.pc(2);d.Cb(4),d.Oc(null==t.space?null:t.space.name)}}function U(t,e){if(1&t&&(d.Ub(0),d.Rb(1,"a-booking-form",10),d.Tb()),2&t){const t=d.pc(3);d.Cb(1),d.vc("form",t.form)}}var Q,K,X;function Y(t,e){1&t&&(d.Wb(0,"p"),d.ac(1,Q),d.Vb())}function G(t,e){if(1&t&&(d.Ub(0),d.Wb(1,"p"),d.Nc(2),d.Vb(),d.Lc(3,Y,2,0,"p",3),d.Tb()),2&t){const t=d.pc(3);d.Cb(2),d.Oc(t.available_until),d.Cb(1),d.vc("ngIf",t.is_requesting)}}function H(t,e){if(1&t&&(d.Wb(0,"main"),d.Ub(1,7),d.Lc(2,U,2,1,"ng-container",8),d.Lc(3,G,4,2,"ng-container",9),d.Tb(),d.Vb()),2&t){const t=d.pc(2);d.Cb(1),d.vc("ngSwitch",t.state),d.Cb(1),d.vc("ngSwitchCase","form")}}function J(t,e){if(1&t){const t=d.Xb();d.Wb(0,"mat-dialog-actions"),d.Wb(1,"footer"),d.Wb(2,"button",11),d.Nc(3,"Cancel"),d.Vb(),d.Wb(4,"button",12),d.lc("tapped",(function(){d.Dc(t);const e=d.pc(2);return"form"===e.state?e.book():e.next()})),d.Nc(5),d.Vb(),d.Vb(),d.Vb()}if(2&t){const t=d.pc(2);d.Cb(5),d.Pc(" ","form"===t.state?t.is_requesting?"Request":"Book":"Yes"," ")}}function Z(t,e){if(1&t&&(d.Wb(0,"main"),d.Wb(1,"div",13),d.Wb(2,"div",14),d.Rb(3,"mat-spinner",15),d.Vb(),d.Wb(4,"div",6),d.Nc(5),d.Vb(),d.Vb(),d.Vb()),2&t){const t=d.pc(2);d.Cb(5),d.Oc(t.loading||"Processing request...")}}function tt(t,e){if(1&t&&(d.Ub(0),d.Wb(1,"header",2),d.Lc(2,B,7,4,"ng-container",3),d.Lc(3,F,5,1,"ng-container",3),d.Vb(),d.Wb(4,"mat-dialog-content"),d.Lc(5,H,4,2,"main",0),d.Vb(),d.Lc(6,J,6,1,"mat-dialog-actions",3),d.Lc(7,Z,6,1,"ng-template",null,4,d.Mc),d.Tb()),2&t){const t=d.Ac(8),e=d.pc();d.Cb(1),d.Gb("request",e.is_requesting),d.Cb(1),d.vc("ngIf","form"!==e.state),d.Cb(1),d.vc("ngIf","form"===e.state),d.Cb(2),d.vc("ngIf",!e.loading)("ngIfElse",t),d.Cb(1),d.vc("ngIf",!e.loading)}}function et(t,e){if(1&t&&(d.Ub(0),d.gc(1,K),d.Rb(2,"span"),d.dc(),d.Tb()),2&t){const t=d.pc(2);d.Cb(2),d.ec(null==t.space?null:t.space.name),d.bc(1)}}function nt(t,e){if(1&t&&(d.Ub(0),d.gc(1,X),d.Rb(2,"span"),d.dc(),d.Tb()),2&t){const t=d.pc(2);d.Cb(2),d.ec(null==t.space?null:t.space.name)(t.is_now?"from now":"at "+t.time),d.bc(1)}}Q=$localize`:Explore booking request details␟ae43d918d086098d3a124366b6b5b88e4c612a48␟6706637016477958969: This space requires approval to reserve `,K=$localize`:Explore booking request sent␟f08971a093a49ced0ebffb96263a7aa014b21e84␟5886681948776197166: Request for ${"\ufffd#2\ufffd"}:START_TAG_SPAN:${"\ufffd0\ufffd"}:INTERPOLATION:${"\ufffd/#2\ufffd"}:CLOSE_TAG_SPAN: sent `,X=$localize`:Explore booking made␟8828182039290aea45ab70d282b087e49cf9323e␟5013504667820723753: Booked ${"\ufffd#2\ufffd"}:START_TAG_SPAN:${"\ufffd0\ufffd"}:INTERPOLATION:${"\ufffd/#2\ufffd"}:CLOSE_TAG_SPAN: ${"\ufffd1\ufffd"}:INTERPOLATION_1: `;const ot=function(t){return{class:"material-icons",content:t}};function it(t,e){if(1&t&&(d.Wb(0,"header",16),d.Wb(1,"div",6),d.Lc(2,et,3,1,"ng-container",3),d.Lc(3,nt,3,2,"ng-container",3),d.Vb(),d.Rb(4,"app-icon",5),d.Vb()),2&t){const t=d.pc();d.Gb("request",t.is_requesting),d.Cb(2),d.vc("ngIf",t.is_requesting),d.Cb(1),d.vc("ngIf",!t.is_requesting),d.Cb(1),d.vc("icon",d.xc(5,ot,t.is_requesting?"send":"done"))}}let st=(()=>{class t extends l.a{constructor(t,e,n,o){super(),this._dialog_ref=t,this._data=e,this._router=n,this._service=o,this.state="info";const i=N(this._data.date);this.booking=new S.a(this._service.Bookings,{title:"Ad-Hoc Booking",date:i.valueOf(),duration:30,room_ids:[this._data.space.id]});const s=Object(L.e)(this._data.bookings,this.space.bookable,this.space.byRequest({date:this._data.date,duration:30,host:this._service.Users.current}),this._data.date);this.available_until=s.available_until}get is_requesting(){const t=this.booking.toJSON(!0);return this.space.byRequest({date:this.booking.changes.date||this.booking.date||N(this._data.date).valueOf(),duration:this.booking.changes.duration||this.booking.duration||30,host:t.organiser||this._service.Users.current})}get date(){return N(this._data.date).format("DD MMM YYYY")}get time(){return N(this._data.date).format("h:mm A")}get space(){return this._data.space}get is_now(){const t=N(),e=N(this._data.date);return t.isSame(e,"m")||t.isAfter(e,"m")}next(){if(this.is_now)this.form=Object(L.a)(this.booking,this._service.Users.current,["space_list","organiser","title","duration"]),this.state="form";else{const t=this.booking.toJSON(!0);localStorage.setItem("ACA_STAFF.booking_form_data",JSON.stringify(Object.assign({id:"ad-hoc"},t))),this._router.navigate(["/book","space"],{queryParams:{back:"/explore"}}),this._dialog_ref.close()}}book(){this.form.valid&&(this.loading="Checking space availability...",this.checkSpaceAvailability().then(()=>{this.booking.save(!0).then(()=>{this.loading=null,this.success=!0,this.timeout("close",()=>this._dialog_ref.close(),5e3)},t=>{this.loading=null,this._service.notifyError(`Error ${this.booking.id?"updating":"creating"} booking: ${t.message||t}}`)})},t=>{this.loading=null,this._service.notifyError(`Error checking space availability: ${t.message||t}`)}))}checkSpaceAvailability(){const t=this.booking.changes.space_list||this.booking.space_list;return new Promise((e,n)=>{this._service.Spaces.available({room_ids:t.map(t=>t.id).join(","),date:this.booking.changes.date||this.booking.date,duration:this.booking.changes.duration||this.booking.duration}).then(t=>{for(const e of t)if(!e.was_available)return n(`${e.name} is not available at the select time period.`);e()},t=>n(t))})}}return t.\u0275fac=function(e){return new(e||t)(d.Qb(A.h),d.Qb(A.a),d.Qb(i.d),d.Qb(r.a))},t.\u0275cmp=d.Kb({type:t,selectors:[["a-explore-booking-modal"]],features:[d.zb],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["done_state",""],["mat-dialog-title",""],[4,"ngIf"],["load_state",""],[3,"icon"],[1,"text"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"form"],["mat-button","","mat-dialog-close","",1,"inverse"],["mat-button","",3,"tapped"],[1,"info-block"],[1,"icon"],["diameter","48"],[1,"success"]],template:function(t,e){if(1&t&&(d.Lc(0,tt,9,7,"ng-container",0),d.Lc(1,it,5,7,"ng-template",null,1,d.Mc)),2&t){const t=d.Ac(2);d.vc("ngIf",!e.success)("ngIfElse",t)}},directives:[o.t,A.i,A.f,M.a,o.x,o.y,o.z,q.a,A.c,T.b,A.d,E.c,w.c],styles:["[_nghost-%COMP%]{max-width:24em}header[_ngcontent-%COMP%]{color:#fff}header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700}header.success[_ngcontent-%COMP%]{background-color:#43a047}header.request[_ngcontent-%COMP%]{background-color:#ffb300}main[_ngcontent-%COMP%]{padding:0 1em .5em}footer[_ngcontent-%COMP%]{width:100%;text-align:center}button[_ngcontent-%COMP%]{min-width:8em}p[_ngcontent-%COMP%]{margin:.5em 0;font-size:1.25em}"]}),t})();const at=["space-status",""];function ct(t,e){if(1&t){const t=d.Xb();d.Wb(0,"i",3),d.lc("modelChange",(function(n){d.Dc(t);const o=e.$implicit;return d.pc(2).processSpaceBookings(o,n)})),d.Vb()}2&t&&d.vc("sys",e.$implicit.id)}function rt(t,e){if(1&t&&(d.Wb(0,"div",1),d.Lc(1,ct,1,1,"i",2),d.Vb()),2&t){const t=d.pc();d.Cb(1),d.vc("ngForOf",t.space_list)}}const lt=["*"];let dt=(()=>{class t extends l.a{constructor(t,e){super(),this._service=t,this._dialog=e,this.status=new d.n,this.listeners=new d.n,this.features=new d.n,this.space_list=[],this.active_bookings={},this.colour_map={}}get is_today(){return N().isSame(N(this.date),"d")}ngOnInit(){this._service.initialised.pipe(Object(p.a)(t=>t)).subscribe(()=>{this.colour_map=this._service.setting("app.explore.colors")||{},this.subscription("spaces",this._service.Spaces.listen("list").subscribe(()=>this.loadSpaces())),this.interval("update_status",()=>{this.updateSpaceBookings(),this.calculateStatus()},6e4)})}ngOnChanges(t){(t.zone||t.date)&&this.loadSpaces(),t.zone&&this.clearSpaces()}ngOnDestroy(){this.clearSpaces()}calculateStatus(){this.timeout("process_statuses",()=>{const t=[];for(const e of this.space_list){const n=this.getStatus(e,this.date),o=e.map_id.indexOf("area")<0?`area-${e.map_id}-status`:e.map_id;t.push({id:o,styles:{fill:this.colour_map[`space-${n}`]||"#000",opacity:.6},status_id:n})}this.status.emit(t)})}getStatus(t,e){if(!t.bookable)return"not-bookable";const n=this.active_bookings[t.id]||[],o=N(e).startOf("m").second(1);if(n.find(t=>{const e=N(t.date).startOf("m"),n=e.add(t.duration,"m");return o.isAfter(e,"s")&&o.isBefore(n,"m")}))return"unavailable";const i={date:N(this.date).valueOf(),duration:30,host:this._service.Users.current},s=t.rulesFor(i);return s.hide?"not-bookable":s.auto_approve?"available":"requestable"}processSpaceBookings(t,e){this.timeout(`space-${t.id}`,()=>{const n=(e||[]).map(e=>new S.a(this._service.Bookings,Object.assign(Object.assign({},e),{room_ids:[t.id]})));this.active_bookings[t.id]=n,this.calculateStatus()},10)}updateSpaceBookings(){this.is_today||this.timeout("update_spaces",()=>{const t=N(this.date).startOf("d");this._service.Spaces.query({from:t.unix(),to:t.endOf("d").unix(),show_declined:!1,zone_ids:this.zone,cache:1e4}).then(t=>{t.forEach(t=>this.processSpaceBookings(t,t.bookings))})},50)}loadSpaces(){this.space_list=this._service.Spaces.list(t=>t.zones.indexOf(this.zone)>=0);const t=[];for(const e of this.space_list){const n=e.map_id.indexOf("area")<0?`area-${e.map_id}-status`:e.map_id;t.push({id:n,event:"mouseenter",callback:()=>this.showSpaceInfo(e)}),t.push({id:n,event:"mouseleave",callback:()=>this.features.emit([])}),e.bookable&&t.push({id:n,event:"click",callback:()=>this.openBookingModal(e)})}this.listeners.emit(t),this.updateSpaceBookings(),this.calculateStatus()}clearSpaces(){delete this.active_bookings,this.active_bookings={}}showSpaceInfo(t){const e=t.map_id.indexOf("area")<0?`area-${t.map_id}-status`:t.map_id;this.features.emit([{id:e,coordinates:null,content:D,data:{space:t,bookings:this.active_bookings[t.id],date:this.date}}])}openBookingModal(t){const e=this.getStatus(t,this.date);"unavailable"!==e&&"not-bookable"!==e?this._dialog.open(st,{width:"auto",height:"auto",data:{date:this.date,space:t,bookings:this.active_bookings[t.id]}}):this._service.notifyInfo(`${t.name} is unavailable at the selected time. Please select another space or time and try again.`)}}return t.\u0275fac=function(e){return new(e||t)(d.Qb(r.a),d.Qb(A.b))},t.\u0275cmp=d.Kb({type:t,selectors:[["","space-status",""]],inputs:{zone:"zone",date:"date"},outputs:{status:"status",listeners:"listeners",features:"features"},features:[d.zb,d.Ab],attrs:at,ngContentSelectors:lt,decls:2,vars:1,consts:[["class","bindings",4,"ngIf"],[1,"bindings"],["binding","","mod","Bookings","bind","today",3,"sys","modelChange",4,"ngFor","ngForOf"],["binding","","mod","Bookings","bind","today",3,"sys","modelChange"]],template:function(t,e){1&t&&(d.uc(),d.Lc(0,rt,2,1,"div",0),d.tc(1)),2&t&&d.vc("ngIf",e.space_list&&e.is_today)},directives:[o.t,o.s,a.a],encapsulation:2}),t})();const ut=["desk-status",""],bt=function(t){return[t]},pt=function(){return[]};function ht(t,e){if(1&t){const t=d.Xb();d.Wb(0,"div",1),d.Wb(1,"i",2),d.lc("modelChange",(function(e){return d.Dc(t),d.pc().in_use=e}))("modelChange",(function(){return d.Dc(t),d.pc().calculateStatus()})),d.Vb(),d.Wb(2,"i",2),d.lc("modelChange",(function(e){return d.Dc(t),d.pc().id_list=e}))("modelChange",(function(){return d.Dc(t),d.pc().calculateStatus()})),d.Vb(),d.Wb(3,"i",2),d.lc("modelChange",(function(e){return d.Dc(t),d.pc().reserved=e}))("modelChange",(function(){return d.Dc(t),d.pc().calculateStatus()})),d.Vb(),d.Wb(4,"i",2),d.lc("modelChange",(function(e){return d.Dc(t),d.pc().occupied=e})),d.Vb(),d.Wb(5,"i",2),d.lc("modelChange",(function(e){return d.Dc(t),d.pc().free=e})),d.Vb(),d.Wb(6,"i",3),d.lc("modelChange",(function(e){return d.Dc(t),d.pc().checkin=e})),d.Vb(),d.Wb(7,"i",4),d.lc("modelChange",(function(e){return d.Dc(t),d.pc().cancel=e})),d.Vb(),d.Vb()}if(2&t){const t=d.pc();d.Cb(1),d.vc("model",t.in_use)("sys",t.system_id)("bind",t.zone),d.Cb(1),d.vc("model",t.id_list)("sys",t.system_id)("bind",t.zone+":desk_ids"),d.Cb(1),d.vc("model",t.reserved)("sys",t.system_id)("bind",t.zone+":reserved"),d.Cb(1),d.vc("model",t.occupied)("sys",t.system_id)("bind",t.zone+":occupied_count"),d.Cb(1),d.vc("model",t.free)("sys",t.system_id)("bind",t.zone+":free_count"),d.Cb(1),d.vc("model",t.checkin)("sys",t.system_id)("params",d.xc(21,bt,t.checkin)),d.Cb(1),d.vc("model",t.cancel)("sys",t.system_id)("params",d.wc(23,pt))}}const gt=["*"];let mt=(()=>{class t extends l.a{constructor(t){super(),this._service=t,this.status=new d.n,this.occupied=0,this.free=0,this.colour_map={}}ngOnInit(){this._service.initialised.pipe(Object(p.a)(t=>t)).subscribe(()=>{this.colour_map=this._service.setting("app.explore.colors")||{}})}ngOnChanges(t){t.zone&&this.loadDesks()}calculateStatus(){const t=this.id_list||[],e=[];for(const n of t){const t=(this.in_use||[]).find(t=>t===n),o=(this.reserved||[]).find(t=>t===n),i=t?"unavailable":o?"reserved":"available";e.push({id:n,styles:{fill:this.colour_map[`desk-${i}`],stroke:this.colour_map[`desk-${i}-stroke`]},status_id:i})}this.status.emit(e)}loadDesks(){const t=this._service.Organisation.levelWithID(this.zone);if(!t)return;const e=this._service.Organisation.buildings.find(e=>e.id===t.building_id);if(!e)return;const n=e.systems.desk_management;n&&(this.system_id=n)}}return t.\u0275fac=function(e){return new(e||t)(d.Qb(r.a))},t.\u0275cmp=d.Kb({type:t,selectors:[["","desk-status",""]],inputs:{zone:"zone",checkin:"checkin"},outputs:{status:"status"},features:[d.zb,d.Ab],attrs:ut,ngContentSelectors:gt,decls:2,vars:1,consts:[["class","bindings",4,"ngIf"],[1,"bindings"],["binding","","mod","DeskManagement",3,"model","sys","bind","modelChange"],["binding","","mod","DeskManagement","exec","manual_checkin",3,"model","sys","params","modelChange"],["binding","","mod","DeskManagement","exec","cancel_reservation",3,"model","sys","params","modelChange"]],template:function(t,e){1&t&&(d.uc(),d.tc(0),d.Lc(1,ht,8,24,"div",0)),2&t&&(d.Cb(1),d.vc("ngIf",e.system_id))},directives:[o.t,a.a],encapsulation:2}),t})(),ft=(()=>{class t extends l.a{constructor(t){super(),this._service=t,this.status=new d.n,this.zone_usage={},this.colour_map={}}ngOnInit(){this._service.initialised.pipe(Object(p.a)(t=>t)).subscribe(()=>{this.colour_map=this._service.setting("app.explore.colors")||{}})}ngOnDestroy(){this.clearZones(this.zone)}calculateStatus(){const t=this._service.Organisation.levelWithID(this.zone);if(!t)return;const e=t.settings.min_usage||0,n=[];for(const o in this.zone_usage)if(this.zone_usage[o]&&this.zone_usage.hasOwnProperty(o)){const t=Math.max(e,this.zone_usage[o]),i=t<40?"low":t<75?"medium":"high";n.push({id:o,styles:{fill:this.colour_map[`zone-${i}`]||"#ccc"},status_id:i})}this.status.emit(n)}loadZones(){const t=this._service.Organisation.levelWithID(this.zone);if(!t)return;const e=this._service.Organisation.buildings.find(e=>e.id===t.building_id);if(!e)return;const n=e.systems.floor_management;if(!n)return;this.system_id=n;const o=this._service.Bindings.module(this.system_id,"FloorManagement");o&&(this.subscription(`zone-${this.zone}.binding`,o.binding(this.zone).bind()),this.subscription(`zone-${this.zone}.usage`,o.binding(this.zone).listen(t=>{this.zone_usage=t,this.calculateStatus()})))}clearZones(t){this.unsub(`zone-${t}.binding`),this.unsub(`zone-${t}.usage`),delete this.zone_usage,this.zone_usage={}}}return t.\u0275fac=function(e){return new(e||t)(d.Qb(r.a))},t.\u0275dir=d.Lb({type:t,selectors:[["","zone-status",""]],inputs:{zone:"zone",date:"date"},outputs:{status:"status"},features:[d.zb]}),t})();var _t=n("oTgu");const vt=function(){return{type:"icon",class:"material-icons",content:"add"}},Ct=function(){return{type:"icon",class:"material-icons",content:"remove"}},Ot=function(){return{type:"icon",class:"material-icons",content:"replay"}};let xt=(()=>{class t{constructor(){this.zoomChange=new d.n,this.positionChange=new d.n,this.min_zoom=1,this.max_zoom=10}ngOnInit(){}zoomIn(){this.zoom=1.2*(this.zoom||this.min_zoom),this.zoom>this.max_zoom&&(this.zoom=this.max_zoom),this.zoomChange.emit(this.zoom)}zoomOut(){this.zoom=(this.zoom||this.min_zoom)*(1/1.2),this.zoom<this.min_zoom&&(this.zoom=this.min_zoom),this.zoomChange.emit(this.zoom)}reset(){this.zoom=this.min_zoom,this.position={x:.5,y:.5},this.zoomChange.emit(this.zoom),this.positionChange.emit(this.position)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=d.Kb({type:t,selectors:[["a-zoom-controls"]],inputs:{zoom:"zoom",position:"position"},outputs:{zoomChange:"zoomChange",positionChange:"positionChange"},decls:7,vars:6,consts:[[1,"zoom-control"],["mat-icon-button","","name","zoom-in",3,"tapped"],[3,"icon"],["mat-icon-button","","name","zoom-out",3,"tapped"],["mat-icon-button","","name","reset",3,"tapped"]],template:function(t,e){1&t&&(d.Wb(0,"div",0),d.Wb(1,"button",1),d.lc("tapped",(function(){return e.zoomIn()})),d.Rb(2,"app-icon",2),d.Vb(),d.Wb(3,"button",3),d.lc("tapped",(function(){return e.zoomOut()})),d.Rb(4,"app-icon",2),d.Vb(),d.Wb(5,"button",4),d.lc("tapped",(function(){return e.reset()})),d.Rb(6,"app-icon",2),d.Vb(),d.Vb()),2&t&&(d.Cb(2),d.vc("icon",d.wc(3,vt)),d.Cb(2),d.vc("icon",d.wc(4,Ct)),d.Cb(2),d.vc("icon",d.wc(5,Ot)))},directives:[T.b,E.c,M.a],styles:[".zoom-control[_ngcontent-%COMP%]{flex-direction:column;background-color:#fff;border-radius:8px;overflow:hidden;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.zoom-control[_ngcontent-%COMP%], button[_ngcontent-%COMP%]{display:flex;align-items:center}button[_ngcontent-%COMP%]{justify-content:center;border-radius:0;border-bottom:1px solid #ccc}button[_ngcontent-%COMP%]:last-child{border:none}app-icon[_ngcontent-%COMP%]{font-size:1.2em}"]}),t})();var Mt,wt=n("CbDI");function yt(t,e){if(1&t&&(d.Wb(0,"li",10),d.Rb(1,"div",11),d.Wb(2,"div",12),d.Nc(3),d.Vb(),d.Rb(4,"div",11),d.Vb()),2&t){const t=d.pc().$implicit;d.Cb(3),d.Oc(t)}}function Pt(t,e){if(1&t&&(d.Ub(0),d.Rb(1,"app-icon",5),d.Tb()),2&t){const t=d.pc().$implicit;d.Cb(1),d.vc("icon",t.icon)}}function kt(t,e){if(1&t&&d.Rb(0,"div",17),2&t){const t=d.pc().$implicit,e=d.pc(3);d.Kc("background-color",t.color||e.colours[t.key])}}function zt(t,e){if(1&t&&(d.Wb(0,"li",13),d.Wb(1,"div",14),d.Lc(2,Pt,2,1,"ng-container",15),d.Lc(3,kt,1,2,"ng-template",null,16,d.Mc),d.Vb(),d.Wb(5,"div",12),d.Nc(6),d.Vb(),d.Vb()),2&t){const t=e.$implicit,n=d.Ac(4);d.Cb(2),d.vc("ngIf",t.icon)("ngIfElse",n),d.Cb(4),d.Oc(t.name)}}function Wt(t,e){if(1&t&&(d.Ub(0),d.Lc(1,yt,5,1,"li",8),d.Lc(2,zt,7,3,"li",9),d.Tb()),2&t){const t=e.$implicit,n=d.pc(2);d.Cb(1),d.vc("ngIf",n.show_group_names),d.Cb(1),d.vc("ngForOf",n.legend_items[t])}}Mt=$localize`:Explore legend label␟fa4c201b0b6ee3362fb02284b734be9e3ec104af␟535043807119140772:${"\ufffd0\ufffd"}:INTERPOLATION: Legend`;const Vt=function(t){return{class:"material-icons",content:t}};function It(t,e){if(1&t){const t=d.Xb();d.Wb(0,"div",1),d.Wb(1,"div",2),d.Wb(2,"div",3),d.lc("tapped",(function(){d.Dc(t);const e=d.pc();return e.show_legend=!e.show_legend})),d.Wb(3,"div",4),d.ac(4,Mt),d.Vb(),d.Rb(5,"app-icon",5),d.Vb(),d.Vb(),d.Wb(6,"div",6),d.Wb(7,"ul"),d.Lc(8,Wt,3,2,"ng-container",7),d.Vb(),d.Vb(),d.Vb()}if(2&t){const t=d.pc();d.Cb(4),d.ec(t.show_legend?"Hide":"Show"),d.bc(4),d.Cb(1),d.vc("icon",d.xc(10,Vt,t.show_legend?"arrow_drop_up":"arrow_drop_down")),d.Cb(1),d.Kc("padding-bottom",t.show_legend?"1em":"")("padding-bottom",t.show_legend?".5em":"")("overflow",t.show_legend?"hidden auto":"hidden"),d.vc("@show",t.show_legend?"show":"hide"),d.Cb(2),d.vc("ngForOf",t.group_names)}}let St=(()=>{class t extends l.a{constructor(t){super(),this._service=t,this.legend_items={},this.colours={},this.show_legend=!1}get group_names(){return Object.keys(this.legend_items||{})}ngOnInit(){this._service.initialised.pipe(Object(p.a)(t=>t)).subscribe(()=>{const t=this._service.setting("app.explore")||{};this.legend_items=t.legend||{},this.colours=t.colors||{},this.show_group_names=!!t.show_legend_group_names})}}return t.\u0275fac=function(e){return new(e||t)(d.Qb(r.a))},t.\u0275cmp=d.Kb({type:t,selectors:[["a-map-legend"]],features:[d.zb],decls:1,vars:1,consts:[["class","map-legend",4,"ngIf"],[1,"map-legend"],[1,"tag"],[1,"title",3,"tapped"],[1,"text"],[3,"icon"],[1,"contents"],[4,"ngFor","ngForOf"],["class","group",4,"ngIf"],["class","item","name","item.key",4,"ngFor","ngForOf"],[1,"group"],[1,"bar"],[1,"name"],["name","item.key",1,"item"],[1,"ref"],[4,"ngIf","ngIfElse"],["colour_display",""],[1,"colour"]],template:function(t,e){1&t&&d.Lc(0,It,9,12,"div",0),2&t&&d.vc("ngIf",e.group_names&&e.group_names.length)},directives:[o.t,E.c,M.a,o.s],styles:[".map-legend[_ngcontent-%COMP%]{position:relative;border-radius:4px 4px 0 0;background-color:#fff;margin-top:.4em;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.tag[_ngcontent-%COMP%]{position:absolute;top:0;left:0;transform:translateY(-100%);overflow:hidden}.title[_ngcontent-%COMP%]{display:flex;align-items:center;border-radius:4px 4px 0 0;background-color:#fff;min-width:50%;flex:1;margin:.5em .5em -1px;padding:.75em .8em .75em 1.5em;font-size:.8em;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.contents[_ngcontent-%COMP%]{overflow:hidden;padding:0 .5em;max-height:50vh;min-width:16em}.group[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.25em .5em;margin:.5em 0;color:rgba(0,0,0,.65)}.group[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{margin:0 .5em}.bar[_ngcontent-%COMP%]{height:1px;min-width:1px;flex:1;background-color:rgba(0,0,0,.65)}ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}li[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:.65em;border-radius:4px;padding:.5em .5em .5em 0}li[_ngcontent-%COMP%]:nth-child(2n){background-color:rgba(0,0,0,.05)}li.group[_ngcontent-%COMP%]{background:none}.ref[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center;margin:0 .5em;height:20px;width:20px;border-radius:100%;border:1px solid rgba(0,0,0,.35);overflow:hidden;background-color:#fff}.colour[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0}app-icon[_ngcontent-%COMP%]{font-size:1.2em}"],data:{animation:[wt.a]}}),t})();var Lt=n("bv9b"),$t=n("YxBP"),Rt=n("5fZw"),Dt=n("1DiH");const Nt=["container"];function At(t,e){if(1&t&&(d.Wb(0,"div",17),d.Wb(1,"div",18),d.Nc(2),d.Vb(),d.Rb(3,"div",6),d.Vb()),2&t){const t=e.$implicit;d.Kc("left",t.left+"%"),d.Gb("hour",t.is_hour),d.Cb(2),d.Oc(t.name)}}function qt(t,e){if(1&t&&d.Rb(0,"div",19),2&t){const t=d.pc();d.Kc("width",t.offset+"%")}}const Tt=function(){return{class:"material-icons",content:"keyboard_arrow_left"}},Et=function(){return{class:"material-icons",content:"keyboard_arrow_right"}};let jt=(()=>{class t extends l.a{constructor(t){super(),this._renderer=t,this.dateChange=new d.n,this.blocks=[]}get is_today(){return N().isSame(N(this.date),"d")}get offset(){const t=N();return t.diff(t.startOf("d"),"m")/1440*100}get active_time(){const t=N(this.date),e=t.diff(t.startOf("d"),"m");return{id:t.isSame(N(),"d")?"Today":t.format("DD MMM YYYY"),name:t.format("h:mm A"),left:e/1440*100}}ngOnInit(){this.blocks=this.generateBlocks(),this.interval("check_date",()=>this.checkDate(),15e3)}generateBlocks(){const t=N().startOf("d"),e=t.endOf("d"),n=[];let o=t;for(;o.isBefore(e);){const e=0===o.minute();n.push({id:o.format("HH:mm"),name:e?o.format("h"):"",is_hour:e,left:o.diff(t,"m")/1440*100}),o=o.add(30,"m")}return n}changeDate(t=1){let e=N(this.date);e=e.add(t,"d");const n=N();this.date=e.isBefore(n,"m")?n.valueOf():e.valueOf(),this.dateChange.emit(this.date)}startMove(t){const e=Object($t.d)(t);this._start_position=e,this._box=this._container.nativeElement.getBoundingClientRect(),t instanceof MouseEvent?(this.subscription("move",this._renderer.listen("window","mousemove",t=>this.onMove(t))),this.subscription("end",this._renderer.listen("window","mouseup",t=>{this.unsub("move"),this.unsub("end")}))):(this.subscription("move",this._renderer.listen("window","touchmove",t=>this.onMove(t))),this.subscription("end",this._renderer.listen("window","touchend",t=>{this.unsub("move"),this.unsub("end")})))}onMove(t){const e=Object($t.d)(t),n=-Math.round((this._start_position.x-e.x)/this._box.width*1440);if(0!==n){let t=N(this.date),o=t;o=o.add(n,"m"),o=o.minute(5*Math.floor(Math.round(o.minute()/5))),this.date=o.valueOf(),this.dateChange.emit(this.date),Math.abs(t.diff(o,"m"))>0&&(this._start_position=e),this.checkDate()}}checkDate(){const t=N(this.date);let e=N();e=e.minute(5*Math.floor(Math.ceil(e.minute()/5))),t.isBefore(e,"m")&&(this.date=e.valueOf(),this.dateChange.emit(this.date))}}return t.\u0275fac=function(e){return new(e||t)(d.Qb(d.E))},t.\u0275cmp=d.Kb({type:t,selectors:[["a-timeline"]],viewQuery:function(t,e){var n;1&t&&d.Jc(Nt,!0),2&t&&d.zc(n=d.mc())&&(e._container=n.first)},inputs:{date:"date"},outputs:{dateChange:"dateChange"},features:[d.zb],decls:20,vars:13,consts:[[1,"not-mobile"],["explore","",1,"timeline"],["container",""],["class","block",3,"hour","left",4,"ngFor","ngForOf"],["class","offset",3,"width",4,"ngIf"],[1,"active-time"],[1,"bar"],[1,"date"],["mat-icon-button","",3,"disabled","tapped"],[3,"icon"],[1,"text",3,"mousedown","touchstart"],["mat-icon-button","",3,"tapped"],[1,"time",3,"mousedown","touchstart"],[1,"triangle"],[1,"pickers","mobile-only"],["offset","top",3,"ngModel","ngModelChange"],[3,"ngModel","ngModelChange"],[1,"block"],[1,"text"],[1,"offset"]],template:function(t,e){1&t&&(d.Wb(0,"div",0),d.Wb(1,"div",1,2),d.Lc(3,At,4,5,"div",3),d.Vb(),d.Lc(4,qt,1,2,"div",4),d.Wb(5,"div",5),d.Rb(6,"div",6),d.Wb(7,"div",7),d.Wb(8,"button",8),d.lc("tapped",(function(){return e.changeDate(-1)})),d.Rb(9,"app-icon",9),d.Vb(),d.Wb(10,"div",10),d.lc("mousedown",(function(t){return e.startMove(t)}))("touchstart",(function(t){return e.startMove(t)})),d.Nc(11),d.Vb(),d.Wb(12,"button",11),d.lc("tapped",(function(){return e.changeDate()})),d.Rb(13,"app-icon",9),d.Vb(),d.Vb(),d.Wb(14,"div",12),d.lc("mousedown",(function(t){return e.startMove(t)}))("touchstart",(function(t){return e.startMove(t)})),d.Nc(15),d.Vb(),d.Rb(16,"div",13),d.Vb(),d.Vb(),d.Wb(17,"div",14),d.Wb(18,"a-date-field",15),d.lc("ngModelChange",(function(t){return e.date=t}))("ngModelChange",(function(t){return e.dateChange.emit(t)})),d.Vb(),d.Wb(19,"a-time-field",16),d.lc("ngModelChange",(function(t){return e.date=t}))("ngModelChange",(function(t){return e.dateChange.emit(t)})),d.Vb(),d.Vb()),2&t&&(d.Cb(3),d.vc("ngForOf",e.blocks),d.Cb(1),d.vc("ngIf",e.is_today),d.Cb(1),d.Kc("left",e.active_time.left+"%"),d.Cb(3),d.vc("disabled",e.is_today),d.Cb(1),d.vc("icon",d.wc(11,Tt)),d.Cb(2),d.Oc(e.active_time.id),d.Cb(2),d.vc("icon",d.wc(12,Et)),d.Cb(2),d.Oc(e.active_time.name),d.Cb(3),d.vc("ngModel",e.date),d.Cb(1),d.vc("ngModel",e.date))},directives:[o.s,o.t,T.b,E.c,M.a,Rt.a,s.r,s.u,Dt.a],styles:["[_nghost-%COMP%]{z-index:10;border-top:1px solid #ccc;background-color:#fff}.timeline[_ngcontent-%COMP%], [_nghost-%COMP%]{position:relative;width:100%;height:3em}@media only screen and (orientation:portrait) and (max-width:450px){.timeline[_ngcontent-%COMP%], [_nghost-%COMP%]{height:3.75em}}@media only screen and (orientation:landscape) and (max-width:800px){.timeline[_ngcontent-%COMP%], [_nghost-%COMP%]{height:3.75em}}.timeline[_ngcontent-%COMP%]{background:linear-gradient(90deg,#051c2c,#051c2c 40%,#0b2453 60%,#1f40e6)}.block[_ngcontent-%COMP%]{position:absolute;top:0;left:0;bottom:0;pointer-events:none}.block.hour[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{height:40%}@media only screen and (orientation:portrait) and (max-width:450px){.block.hour[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{display:initial}}@media only screen and (orientation:landscape) and (max-width:800px){.block.hour[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{display:initial}}.block[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{position:absolute;width:2px;height:20%;bottom:0;left:-1px;background-color:#fff}@media only screen and (orientation:portrait) and (max-width:450px){.block[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{display:none}}@media only screen and (orientation:landscape) and (max-width:800px){.block[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{display:none}}.block[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{position:absolute;bottom:45%;left:0;transform:translateX(-50%);color:#fff}@media only screen and (orientation:portrait) and (max-width:450px){.block[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-size:.8em}}@media only screen and (orientation:landscape) and (max-width:800px){.block[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-size:.8em}}.block[_ngcontent-%COMP%]:first-child{display:none}@media only screen and (orientation:portrait) and (max-width:450px){.block[_ngcontent-%COMP%]:nth-child(4n-1){display:none}}@media only screen and (orientation:landscape) and (max-width:800px){.block[_ngcontent-%COMP%]:nth-child(4n-1){display:none}}.offset[_ngcontent-%COMP%]{background-color:rgba(0,0,0,.65)}.active-time[_ngcontent-%COMP%], .offset[_ngcontent-%COMP%]{position:absolute;top:0;left:0;bottom:0}.active-time[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{width:2px;height:200%;bottom:0;left:-1px}.active-time[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%], .date[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]{position:absolute;background-color:#fff}.date[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]{bottom:100%;left:0;transform:translate(-50%,-.25em);display:flex;align-items:center;overflow:hidden;border-radius:4px;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.date[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{padding:0 .5em;white-space:nowrap}.date[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0}.date[_ngcontent-%COMP%]{transform:translate(-50%,-2.5em)}.time[_ngcontent-%COMP%]{padding:.5em;white-space:nowrap;cursor:-webkit-grab;cursor:grab}.time[_ngcontent-%COMP%]:active{cursor:-webkit-grabbing;cursor:grabbing}.pickers[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.25em}.pickers[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1;margin:.25em}"]}),t})();function Bt(t,e){1&t&&d.Rb(0,"mat-progress-bar",18)}function Ft(t,e){if(1&t&&(d.Wb(0,"div",14),d.Wb(1,"div",15),d.Nc(2),d.Vb(),d.Wb(3,"div",16),d.Lc(4,Bt,1,0,"mat-progress-bar",17),d.Vb(),d.Vb()),2&t){const t=d.pc();d.Cb(2),d.Oc(t.message),d.Cb(2),d.vc("ngIf",t.loading)}}function Ut(t,e){if(1&t){const t=d.Xb();d.Wb(0,"a-timeline",19),d.lc("dateChange",(function(e){return d.Dc(t),d.pc().date=e})),d.Vb()}if(2&t){const t=d.pc();d.vc("date",t.date)}}let Qt=(()=>{class t extends l.a{constructor(t,e){super(),this._service=t,this._route=e,this.center={x:.5,y:.5},this.style_map={},this.status_map={},this.listener_map={},this.feature_map={}}get map_url(){return(this._service.Organisation.levelWithID(this.active_level)||{map_url:""}).map_url||""}ngOnInit(){this._service.initialised.pipe(Object(p.a)(t=>t)).subscribe(()=>{if(!this.active_level){const t=this._service.Organisation.building;t&&t.levels.length&&(this.active_level=t.levels[0].id)}this.settings=this._service.setting("app.explore")||{},this.subscription("route.query",this._route.queryParamMap.subscribe(t=>{t.has("space")&&this.loadSpaceLocation(t.get("space")),t.has("user")&&this.loadUserLocation(t.get("user")).then(t=>{this.loading=!1,this.message=this.focus?"":`Unable to locate ${t.name}`},t=>{this.loading=!1,this.message="Unable to locate user",t&&404!==t.status&&this._service.notifyError(`Error loading user location. ${t.message}`)})}))})}processStatuses(){const t={};(this.status_map.spaces||[]).forEach(e=>t[`#${e.id}`]=e.styles),(this.status_map.desks||[]).forEach(e=>t[`#${e.id}`]=e.styles),(this.status_map.zones||[]).forEach(e=>t[`#${e.id}`]=e.styles),this.style_map=t}processListeners(){let t=[];t=t.concat(this.listener_map.spaces||[]),t=t.concat(this.listener_map.desks||[]),t=t.concat(this.listener_map.zones||[]),this.listeners=t}processFeatures(){let t=[];this.focus_feature&&(t=t.concat([this.focus_feature])),t=t.concat(this.feature_map.spaces||[]),t=t.concat(this.feature_map.desks||[]),t=t.concat(this.feature_map.zones||[]),this.features=t}loadSpaceLocation(t){const e=this._service.Spaces.list(e=>e.id===t)[0];e&&(this.message=`Loading location of ${e.name}`,this.loading=!0,this.active_level=e.level.id,this.focus=e.map_id,this.focus_feature={id:e.map_id,coordinates:null,content:c.e,data:{text:e.name}},this.zoom=1,this.loading=!1,this.message="",this.processFeatures())}loadUserLocation(t){return Object(b.a)(this,void 0,void 0,(function*(){this.focus=null,this.focus_feature=null,this.loading=!0,this.message="Loading user details...";const e=yield this._service.Users.show(t);if(!e)return e;this.message=`Loading location for ${e.name}...`;const n=yield e.locate();return n?(this.active_level=n.level.id,n.fixed?(this.focus=n.id,this.focus_feature={id:n.id,coordinates:null,content:c.e,data:{text:`${e.name} is here`}},this.zoom=1):(this.focus={x:n.x,y:n.y},this.focus_feature={coordinates:{x:n.x,y:n.y},content:c.f,data:{text:`${e.name} is here`,diameter:n.confidence||5}}),this.zoom=1,this.loading=!1,this.message="",this.processFeatures(),e):e}))}}return t.\u0275fac=function(e){return new(e||t)(d.Qb(r.a),d.Qb(i.a))},t.\u0275cmp=d.Kb({type:t,selectors:[["explore-map-view"]],features:[d.zb],decls:15,vars:16,consts:[[1,"map-view"],[1,"header"],[1,"body"],["hidden","",1,"status-list"],["space-status","",3,"zone","date","status","listeners","features"],["desk-status","",3,"zone","status"],["zone-status","",3,"zone","status"],["overlay","",3,"level","levelChange"],[3,"zoom","center","src","css","listeners","features","focus","zoomChange","centerChange"],["diameter","32"],["overlay","",3,"zoom","position","zoomChange","positionChange"],["overlay",""],["class","message",4,"ngIf"],[3,"date","dateChange",4,"ngIf"],[1,"message"],[1,"text"],[1,"loader"],["mode","indeterminate",4,"ngIf"],["mode","indeterminate"],[3,"date","dateChange"]],template:function(t,e){1&t&&(d.Wb(0,"div",0),d.Wb(1,"div",1),d.Rb(2,"explore-search"),d.Vb(),d.Wb(3,"div",2),d.Wb(4,"div",3),d.Wb(5,"i",4),d.lc("status",(function(t){return e.status_map.spaces=t,e.processStatuses()}))("listeners",(function(t){return e.listener_map.spaces=t,e.processListeners()}))("features",(function(t){return e.feature_map.spaces=t,e.processFeatures()})),d.Vb(),d.Wb(6,"i",5),d.lc("status",(function(t){return e.status_map.desks=t,e.processStatuses()})),d.Vb(),d.Wb(7,"i",6),d.lc("status",(function(t){return e.status_map.zones=t,e.processStatuses()})),d.Vb(),d.Vb(),d.Wb(8,"a-map-controls",7),d.lc("levelChange",(function(t){return e.active_level=t}))("levelChange",(function(){return e.zoom=1,e.center={x:.5,y:.5}})),d.Vb(),d.Wb(9,"a-map",8),d.lc("zoomChange",(function(t){return e.zoom=t}))("centerChange",(function(t){return e.center=t})),d.Rb(10,"mat-spinner",9),d.Vb(),d.Wb(11,"a-zoom-controls",10),d.lc("zoomChange",(function(t){return e.zoom=t}))("positionChange",(function(t){return e.center=t})),d.Vb(),d.Rb(12,"a-map-legend",11),d.Lc(13,Ft,5,2,"div",12),d.Vb(),d.Lc(14,Ut,1,1,"a-timeline",13),d.Vb()),2&t&&(d.Cb(5),d.vc("zone",e.active_level)("date",e.date),d.Cb(1),d.vc("zone",e.active_level),d.Cb(1),d.vc("zone",e.active_level),d.Cb(1),d.vc("level",e.active_level),d.Cb(1),d.vc("zoom",e.zoom)("center",e.center)("src",e.map_url)("css",e.style_map)("listeners",e.listeners)("features",e.features)("focus",e.focus),d.Cb(2),d.vc("zoom",e.zoom)("position",e.center),d.Cb(2),d.vc("ngIf",e.message),d.Cb(1),d.vc("ngIf",e.settings.show_timeline))},directives:[I,dt,mt,ft,_t.a,c.d,w.c,xt,St,o.t,Lt.a,jt],styles:[".map-view[_ngcontent-%COMP%]{position:absolute;display:flex;align-items:center;flex-direction:column;top:0;left:0;right:0;bottom:0;overflow:hidden}.body[_ngcontent-%COMP%], .header[_ngcontent-%COMP%]{width:100%;background-color:#f8f8f8}.body[_ngcontent-%COMP%]{position:relative;min-height:50%;flex:1;overflow:hidden}.body[_ngcontent-%COMP%], a-map[_ngcontent-%COMP%]{z-index:1}[overlay][_ngcontent-%COMP%]{z-index:10}a-map-controls[_ngcontent-%COMP%]{position:absolute;top:.5em;left:.5em}a-zoom-controls[_ngcontent-%COMP%]{position:absolute;bottom:.5em;right:.5em}a-map-legend[_ngcontent-%COMP%]{bottom:0}a-map-legend[_ngcontent-%COMP%], a-popout-menu[_ngcontent-%COMP%]{position:absolute;left:.5em}a-popout-menu[_ngcontent-%COMP%]{bottom:.5em;z-index:999}.message[_ngcontent-%COMP%]{overflow:hidden;position:absolute;bottom:.5rem;left:50%;transform:translateX(-50%);background-color:#fff;border-radius:4px;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12);max-width:20rem;z-index:999;font-size:.9em}.message[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]{height:4px;width:100%}@media only screen and (orientation:portrait) and (max-width:450px){.message[_ngcontent-%COMP%]{left:.5rem;transform:none}}@media only screen and (orientation:landscape) and (max-width:800px){.message[_ngcontent-%COMP%]{left:.5rem;transform:none}}.message[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{padding:.5rem}"]}),t})();var Kt=n("p5rm"),Xt=n("4Uey");let Yt=(()=>{class t extends l.a{constructor(t){super(),this._service=t}ngOnInit(){this._service.title="Maps"}}return t.\u0275fac=function(e){return new(e||t)(d.Qb(r.a))},t.\u0275cmp=d.Kb({type:t,selectors:[["app-explore"]],features:[d.zb],decls:8,vars:2,consts:[[1,"explore","page"],[1,"header"],[3,"menu","menuChange"],[1,"body"],[1,"footer"],[3,"show","showChange"]],template:function(t,e){1&t&&(d.Wb(0,"div",0),d.Wb(1,"header",1),d.Wb(2,"a-topbar-header",2),d.lc("menuChange",(function(t){return e.show_menu=t})),d.Vb(),d.Vb(),d.Wb(3,"main",3),d.Rb(4,"explore-map-view"),d.Vb(),d.Wb(5,"footer",4),d.Rb(6,"a-footer-menu"),d.Vb(),d.Vb(),d.Wb(7,"a-overlay-menu",5),d.lc("showChange",(function(t){return e.show_menu=t})),d.Vb()),2&t&&(d.Cb(2),d.vc("menu",e.show_menu),d.Cb(5),d.vc("show",e.show_menu))},directives:[u.a,Qt,Kt.a,Xt.a],styles:[".page[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;align-items:center;flex-direction:column}.page[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}.body[_ngcontent-%COMP%]{position:relative;min-width:50%;flex:1}"]}),t})();var Gt=n("PCNd");n.d(e,"ExploreModule",(function(){return Jt}));const Ht=[{path:"",component:Yt},{path:":search_type",component:Yt}];let Jt=(()=>{class t{}return t.\u0275mod=d.Ob({type:t}),t.\u0275inj=d.Nb({factory:function(e){return new(e||t)},imports:[[o.c,i.h.forChild(Ht),Gt.a,c.a,a.b,s.l]]}),t})()}}]);