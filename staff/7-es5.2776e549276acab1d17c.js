function _templateObject4(){var e=_taggedTemplateLiteral([":Explore legend label\u241ffa4c201b0b6ee3362fb02284b734be9e3ec104af\u241f535043807119140772:",":INTERPOLATION: Legend"]);return _templateObject4=function(){return e},e}function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i,a=!0,r=!1;return{s:function(){o=e[Symbol.iterator]()},n:function(){var e=o.next();return a=e.done,e},e:function(e){r=!0,i=e},f:function(){try{a||null==o.return||o.return()}finally{if(r)throw i}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function _templateObject3(){var e=_taggedTemplateLiteral([":Explore booking made\u241f8828182039290aea45ab70d282b087e49cf9323e\u241f5013504667820723753: Booked ",":START_TAG_SPAN:",":INTERPOLATION:",":CLOSE_TAG_SPAN: ",":INTERPOLATION_1: "]);return _templateObject3=function(){return e},e}function _templateObject2(){var e=_taggedTemplateLiteral([":Explore booking request sent\u241ff08971a093a49ced0ebffb96263a7aa014b21e84\u241f5886681948776197166: Request for ",":START_TAG_SPAN:",":INTERPOLATION:",":CLOSE_TAG_SPAN: sent "]);return _templateObject2=function(){return e},e}function _templateObject(){var e=_taggedTemplateLiteral([":Explore booking request details\u241fae43d918d086098d3a124366b6b5b88e4c612a48\u241f6706637016477958969: This space requires approval to reserve "]);return _templateObject=function(){return e},e}function _taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){return function(){var t,n=_getPrototypeOf(e);if(_isNativeReflectConstruct()){var o=_getPrototypeOf(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return _possibleConstructorReturn(this,t)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"7NT8":function(e,t,n){"use strict";n.r(t);var o=n("ofXK"),i=n("tyNb"),a=n("3Pt+"),r=n("Cvi9"),s=n("1gA9"),c=n("OaWH"),u=n("IWZj"),l=n("fXoL"),d=n("ocbO"),b=n("mrSG"),f=n("SxV6"),p=n("Kj3r"),g=n("/uUt"),m=n("eIep"),h=n("JIr8"),_=n("lJxs"),v=n("XNiG"),C=n("LRne"),y=n("KsZa"),O=n("/1cH"),k=n("0njA"),x=n("Xa2L"),w=n("FKr1"),M=["input"];function P(e,t){1&e&&l.Rb(0,"mat-spinner",12)}var z=function(){return{type:"icon",class:"material-icons",content:"search"}};function W(e,t){if(1&e){var n=l.Xb();l.Wb(0,"div",4),l.lc("focus",(function(){return l.Dc(n),l.pc().focusField()}))("click",(function(){return l.Dc(n),l.pc().focusField()})),l.Wb(1,"div",5),l.Rb(2,"app-icon",6),l.Vb(),l.Wb(3,"div",7),l.Wb(4,"input",8,9),l.lc("ngModelChange",(function(e){return l.Dc(n),l.pc().search_str=e}))("ngModelChange",(function(e){return l.Dc(n),l.pc().search$.next(e)})),l.Vb(),l.Vb(),l.Wb(6,"div",10),l.Lc(7,P,1,0,"mat-spinner",11),l.Vb(),l.Vb()}if(2&e){var o=l.pc(),i=l.Ac(2);l.Cb(2),l.vc("icon",l.wc(5,z)),l.Cb(2),l.vc("ngModel",o.search_str)("matAutocomplete",i)("placeholder",o.placeholder||"Search..."),l.Cb(3),l.vc("ngIf",o.loading)}}function V(e,t){if(1&e&&(l.Wb(0,"mat-option",13),l.Wb(1,"div",14),l.Nc(2),l.Vb(),l.Wb(3,"div",15),l.Nc(4),l.Vb(),l.Vb()),2&e){var n=t.$implicit;l.vc("value",n),l.Cb(2),l.Oc(n.name),l.Cb(2),l.Oc(n.level?n.level.name:n.email)}}var S,I=((S=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,o,i){var a;return _classCallCheck(this,n),(a=t.call(this))._service=e,a._route=o,a._router=i,a.results=[],a.search$=new v.a,a}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;this.subscription("route.params",this._route.paramMap.subscribe((function(t){t.has("search_type")&&(e.type=t.get("search_type"))}))),this.search_results$=this.search$.pipe(Object(p.a)(400),Object(g.a)(),Object(m.a)((function(t){return e.loading=!0,t.length>=3?e._service.Users.query({q:t.slice(0,3),cache:6e4}):Promise.resolve([])})),Object(h.a)((function(e){return Object(C.a)([])})),Object(_.a)((function(t){var n=e._service.Spaces.list((function(e){return!0})),o=(e.search_str||"").toLowerCase(),i=[];return i="space"===e.type?n:"user"===e.type?t:n.concat(t),e.loading=!1,i.filter((function(e){return(e.name||"").toLowerCase().indexOf(o)>=0||(e.email||"").toLowerCase().indexOf(o)>=0}))}))),this.subscription("search_results",this.search_results$.subscribe((function(t){e.results=t})))}},{key:"ngOnChanges",value:function(e){e.autofocus&&this.autofocus&&this.focusField()}},{key:"focusField",value:function(){this.input_field&&this.input_field.nativeElement&&this.input_field.nativeElement.focus()}},{key:"selectOption",value:function(e){this._router.navigate([],e instanceof y.a?{relativeTo:this._route,queryParams:{space:e.id},queryParamsHandling:"merge"}:{relativeTo:this._route,queryParams:{user:e.email},queryParamsHandling:"merge"}),this.search_str=e.name}}]),n}(u.a)).\u0275fac=function(e){return new(e||S)(l.Qb(c.a),l.Qb(i.a),l.Qb(i.d))},S.\u0275cmp=l.Kb({type:S,selectors:[["explore-search"]],viewQuery:function(e,t){var n;1&e&&l.Jc(M,!0),2&e&&l.zc(n=l.mc())&&(t.input_field=n.first)},inputs:{type:"type",autofocus:"autofocus",placeholder:"placeholder"},features:[l.zb,l.Ab],decls:4,vars:2,consts:[["class","searchbar","tabindex","0",3,"focus","click",4,"ngIf"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["tabindex","0",1,"searchbar",3,"focus","click"],[1,"prefix"],[3,"icon"],[1,"input"],["type","text",3,"ngModel","matAutocomplete","placeholder","ngModelChange"],["input",""],[1,"suffix"],["diameter","32",4,"ngIf"],["diameter","32"],[3,"value"],[1,"name"],[1,"email"]],template:function(e,t){1&e&&(l.Lc(0,W,8,6,"div",0),l.Wb(1,"mat-autocomplete",1,2),l.lc("optionSelected",(function(e){return t.selectOption(e.option.value)})),l.Lc(3,V,5,3,"mat-option",3),l.Vb()),2&e&&(l.vc("ngIf",t.type),l.Cb(3),l.vc("ngForOf",t.results))},directives:[o.t,O.a,o.s,k.a,a.c,O.d,a.r,a.u,x.c,w.g],styles:[".searchbar[_ngcontent-%COMP%]{display:flex;align-items:center;max-width:calc(100% - 1em);width:calc(100% - 1em);margin:.5em auto;background-color:#fff;border-radius:2em;padding:0 .75em;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}@media only screen and (orientation:portrait) and (max-width:450px){.searchbar[_ngcontent-%COMP%]{border-radius:0;box-shadow:none;margin:0;width:100%;max-width:100%;padding:0 .5em;border-bottom:1px solid #ccc}}@media only screen and (orientation:landscape) and (max-width:800px){.searchbar[_ngcontent-%COMP%]{border-radius:0;box-shadow:none;margin:0;width:100%;max-width:100%;padding:0 .5em;border-bottom:1px solid #ccc}}.prefix[_ngcontent-%COMP%], .suffix[_ngcontent-%COMP%]{font-size:1.5em;min-width:32px;min-height:100%}.input[_ngcontent-%COMP%]{flex:1;min-width:50%}input[_ngcontent-%COMP%]{width:100%;font-size:1em;border:none;outline:none;padding:1em .5em;background:none}.name[_ngcontent-%COMP%]{height:1em}.email[_ngcontent-%COMP%]{font-size:.6em;color:rgba(0,0,0,.65)}"]}),S),L=n("xhdr"),R=n("5RMF");function j(e,t){if(1&e&&(l.Wb(0,"div",8),l.Nc(1),l.Vb()),2&e){var n=l.pc(2);l.Cb(1),l.Oc(n.available_until)}}function T(e,t){if(1&e&&(l.Wb(0,"div",1),l.Rb(1,"div",2),l.Wb(2,"div",3),l.Wb(3,"div",4),l.Nc(4),l.Vb(),l.Wb(5,"div",5),l.Wb(6,"div",6),l.Nc(7),l.Vb(),l.Lc(8,j,2,1,"div",7),l.Vb(),l.Vb(),l.Vb()),2&e){var n=l.pc();l.Eb("space-info "+n.quadrant),l.vc("id",n.space.id),l.Cb(4),l.Oc(n.space.name),l.Cb(2),l.Eb(n.status_class),l.Cb(1),l.Oc(n.status),l.Cb(1),l.vc("ngIf","not-bookable"!==n.status_class)}}var A,D,N,E,q=((A=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,o,i){var a;return _classCallCheck(this,n),(a=t.call(this))._data=e,a._position=o,a._service=i,a}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;this.processBookings(),this.interval("update_bookings",(function(){return e.processBookings()}),6e4)}},{key:"processBookings",value:function(){if(this.space){var e=Object(R.e)(this.bookings,this.space.bookable,this.space.byRequest({date:this._data.date,duration:30,host:this._service.Users.current}),this._data.date);this.status=e.status,this.available_until=e.available_until}}},{key:"quadrant",get:function(){if(!this._position)return"top left";var e=this._position;return e.x>50&&e.y>50?"bottom right":e.x<50&&e.y>50?"bottom left":e.x>50?"top right":"top left"}},{key:"status_class",get:function(){return(this.status||"").toLowerCase().split(" ").join("-")}},{key:"space",get:function(){return this._data?this._data.space:null}},{key:"bookings",get:function(){return this._data&&this._data.bookings||[]}}]),n}(u.a)).\u0275fac=function(e){return new(e||A)(l.Qb(s.c),l.Qb(s.b),l.Qb(c.a))},A.\u0275cmp=l.Kb({type:A,selectors:[["a-space-info"]],features:[l.zb],decls:1,vars:1,consts:[[3,"id","class",4,"ngIf"],[3,"id"],[1,"arrow"],[1,"details"],[1,"name"],[1,"availability"],["name","status"],["name","available-until",4,"ngIf"],["name","available-until"]],template:function(e,t){1&e&&l.Lc(0,T,9,8,"div",0),2&e&&l.vc("ngIf",t.space)},directives:[o.t],styles:["[_nghost-%COMP%]{pointer-events:none}.space-info[_ngcontent-%COMP%]{position:absolute;min-width:16em;border-radius:4px;background-color:#fff;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.space-info.top[_ngcontent-%COMP%]{top:0}.space-info.top.left[_ngcontent-%COMP%]{left:0;border-top-left-radius:0}.space-info.top.right[_ngcontent-%COMP%]{right:0;border-top-right-radius:0}.space-info.bottom[_ngcontent-%COMP%]{bottom:0}.space-info.bottom.left[_ngcontent-%COMP%]{left:0;border-bottom-left-radius:0}.space-info.bottom.right[_ngcontent-%COMP%]{right:0;border-bottom-right-radius:0}.top[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{top:2px}.top.left[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{left:2px;border-width:8px 8px 0 0;border-color:#1937ea transparent transparent}.top.right[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{right:2px;border-width:0 8px 8px 0;border-color:transparent #1937ea transparent transparent}.bottom[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{bottom:2px}.bottom.left[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{left:2px;border-width:8px 0 0 8px;border-color:transparent transparent transparent #1937ea}.bottom.right[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{right:2px;border-width:0 0 8px 8px;border-color:transparent transparent #1937ea}.arrow[_ngcontent-%COMP%]{position:absolute;width:0;height:0;border-style:solid}.details[_ngcontent-%COMP%]{padding:1em}.name[_ngcontent-%COMP%]{font-size:1.25em;padding:.2em .4em}.availability[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{padding:.25rem .5rem;display:inline-block}[name=status][_ngcontent-%COMP%]{border-radius:4px;color:#fff;font-size:.8em;margin-right:auto}[name=status].not-bookable[_ngcontent-%COMP%]{background-color:#ccc}[name=status].available[_ngcontent-%COMP%]{background-color:#43a047}[name=status].available-by-request[_ngcontent-%COMP%]{background-color:#ffb300}[name=status].meeting-in-progress[_ngcontent-%COMP%]{background-color:#e53935}"]}),A),F=n("Wgwc"),B=n("0IaG"),U=n("4Man"),Q=n("bTqV"),K=n("m6yr"),$=function(){return{class:"material-icons",content:"add"}};function H(e,t){if(1&e&&(l.Ub(0),l.Rb(1,"app-icon",5),l.Wb(2,"div",6),l.Nc(3," Book "),l.Wb(4,"span"),l.Nc(5),l.Vb(),l.Nc(6),l.Vb(),l.Tb()),2&e){var n=l.pc(2);l.Cb(1),l.vc("icon",l.wc(3,$)),l.Cb(4),l.Oc(null==n.space?null:n.space.name),l.Cb(1),l.Pc(" ",n.is_now?"from now":"at "+n.time," ")}}function X(e,t){if(1&e&&(l.Ub(0),l.Wb(1,"div",6),l.Nc(2," Book "),l.Wb(3,"span"),l.Nc(4),l.Vb(),l.Vb(),l.Tb()),2&e){var n=l.pc(2);l.Cb(4),l.Oc(null==n.space?null:n.space.name)}}function Y(e,t){if(1&e&&(l.Ub(0),l.Rb(1,"a-booking-form",10),l.Tb()),2&e){var n=l.pc(3);l.Cb(1),l.vc("form",n.form)}}function G(e,t){1&e&&(l.Wb(0,"p"),l.ac(1,D),l.Vb())}function J(e,t){if(1&e&&(l.Ub(0),l.Wb(1,"p"),l.Nc(2),l.Vb(),l.Lc(3,G,2,0,"p",3),l.Tb()),2&e){var n=l.pc(3);l.Cb(2),l.Oc(n.available_until),l.Cb(1),l.vc("ngIf",n.is_requesting)}}function Z(e,t){if(1&e&&(l.Wb(0,"main"),l.Ub(1,7),l.Lc(2,Y,2,1,"ng-container",8),l.Lc(3,J,4,2,"ng-container",9),l.Tb(),l.Vb()),2&e){var n=l.pc(2);l.Cb(1),l.vc("ngSwitch",n.state),l.Cb(1),l.vc("ngSwitchCase","form")}}function ee(e,t){if(1&e){var n=l.Xb();l.Wb(0,"mat-dialog-actions"),l.Wb(1,"footer"),l.Wb(2,"button",11),l.Nc(3,"Cancel"),l.Vb(),l.Wb(4,"button",12),l.lc("tapped",(function(){l.Dc(n);var e=l.pc(2);return"form"===e.state?e.book():e.next()})),l.Nc(5),l.Vb(),l.Vb(),l.Vb()}if(2&e){var o=l.pc(2);l.Cb(5),l.Pc(" ","form"===o.state?o.is_requesting?"Request":"Book":"Yes"," ")}}function te(e,t){if(1&e&&(l.Wb(0,"main"),l.Wb(1,"div",13),l.Wb(2,"div",14),l.Rb(3,"mat-spinner",15),l.Vb(),l.Wb(4,"div",6),l.Nc(5),l.Vb(),l.Vb(),l.Vb()),2&e){var n=l.pc(2);l.Cb(5),l.Oc(n.loading||"Processing request...")}}function ne(e,t){if(1&e&&(l.Ub(0),l.Wb(1,"header",2),l.Lc(2,H,7,4,"ng-container",3),l.Lc(3,X,5,1,"ng-container",3),l.Vb(),l.Wb(4,"mat-dialog-content"),l.Lc(5,Z,4,2,"main",0),l.Vb(),l.Lc(6,ee,6,1,"mat-dialog-actions",3),l.Lc(7,te,6,1,"ng-template",null,4,l.Mc),l.Tb()),2&e){var n=l.Ac(8),o=l.pc();l.Cb(1),l.Gb("request",o.is_requesting),l.Cb(1),l.vc("ngIf","form"!==o.state),l.Cb(1),l.vc("ngIf","form"===o.state),l.Cb(2),l.vc("ngIf",!o.loading)("ngIfElse",n),l.Cb(1),l.vc("ngIf",!o.loading)}}function oe(e,t){if(1&e&&(l.Ub(0),l.gc(1,N),l.Rb(2,"span"),l.dc(),l.Tb()),2&e){var n=l.pc(2);l.Cb(2),l.ec(null==n.space?null:n.space.name),l.bc(1)}}function ie(e,t){if(1&e&&(l.Ub(0),l.gc(1,E),l.Rb(2,"span"),l.dc(),l.Tb()),2&e){var n=l.pc(2);l.Cb(2),l.ec(null==n.space?null:n.space.name)(n.is_now?"from now":"at "+n.time),l.bc(1)}}D=$localize(_templateObject()),N=$localize(_templateObject2(),"\ufffd#2\ufffd","\ufffd0\ufffd","\ufffd/#2\ufffd"),E=$localize(_templateObject3(),"\ufffd#2\ufffd","\ufffd0\ufffd","\ufffd/#2\ufffd","\ufffd1\ufffd");var ae=function(e){return{class:"material-icons",content:e}};function re(e,t){if(1&e&&(l.Wb(0,"header",16),l.Wb(1,"div",6),l.Lc(2,oe,3,1,"ng-container",3),l.Lc(3,ie,3,2,"ng-container",3),l.Vb(),l.Rb(4,"app-icon",5),l.Vb()),2&e){var n=l.pc();l.Gb("request",n.is_requesting),l.Cb(2),l.vc("ngIf",n.is_requesting),l.Cb(1),l.vc("ngIf",!n.is_requesting),l.Cb(1),l.vc("icon",l.xc(5,ae,n.is_requesting?"send":"done"))}}var se,ce=((se=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,o,i,a){var r;_classCallCheck(this,n),(r=t.call(this))._dialog_ref=e,r._data=o,r._router=i,r._service=a,r.state="info";var s=F(r._data.date);r.booking=new L.a(r._service.Bookings,{title:"Ad-Hoc Booking",date:s.valueOf(),duration:30,room_ids:[r._data.space.id]});var c=Object(R.e)(r._data.bookings,r.space.bookable,r.space.byRequest({date:r._data.date,duration:30,host:r._service.Users.current}),r._data.date);return r.available_until=c.available_until,r}return _createClass(n,[{key:"next",value:function(){if(this.is_now)this.form=Object(R.a)(this.booking,this._service.Users.current,["space_list","organiser","title","duration"]),this.state="form";else{var e=this.booking.toJSON(!0);localStorage.setItem("ACA_STAFF.booking_form_data",JSON.stringify(Object.assign({id:"ad-hoc"},e))),this._router.navigate(["/book","space"],{queryParams:{back:"/explore"}}),this._dialog_ref.close()}}},{key:"book",value:function(){var e=this;this.form.valid&&(this.loading="Checking space availability...",this.checkSpaceAvailability().then((function(){e.booking.save(!0).then((function(){e.loading=null,e.success=!0,e.timeout("close",(function(){return e._dialog_ref.close()}),5e3)}),(function(t){e.loading=null,e._service.notifyError("Error ".concat(e.booking.id?"updating":"creating"," booking: ").concat(t.message||t,"}"))}))}),(function(t){e.loading=null,e._service.notifyError("Error checking space availability: ".concat(t.message||t))})))}},{key:"checkSpaceAvailability",value:function(){var e=this,t=this.booking.changes.space_list||this.booking.space_list;return new Promise((function(n,o){e._service.Spaces.available({room_ids:t.map((function(e){return e.id})).join(","),date:e.booking.changes.date||e.booking.date,duration:e.booking.changes.duration||e.booking.duration}).then((function(e){var t,i=_createForOfIteratorHelper(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(!a.was_available)return o("".concat(a.name," is not available at the select time period."))}}catch(r){i.e(r)}finally{i.f()}n()}),(function(e){return o(e)}))}))}},{key:"is_requesting",get:function(){var e=this.booking.toJSON(!0);return this.space.byRequest({date:this.booking.changes.date||this.booking.date||F(this._data.date).valueOf(),duration:this.booking.changes.duration||this.booking.duration||30,host:e.organiser||this._service.Users.current})}},{key:"date",get:function(){return F(this._data.date).format("DD MMM YYYY")}},{key:"time",get:function(){return F(this._data.date).format("h:mm A")}},{key:"space",get:function(){return this._data.space}},{key:"is_now",get:function(){var e=F(),t=F(this._data.date);return e.isSame(t,"m")||e.isAfter(t,"m")}}]),n}(u.a)).\u0275fac=function(e){return new(e||se)(l.Qb(B.h),l.Qb(B.a),l.Qb(i.d),l.Qb(c.a))},se.\u0275cmp=l.Kb({type:se,selectors:[["a-explore-booking-modal"]],features:[l.zb],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["done_state",""],["mat-dialog-title",""],[4,"ngIf"],["load_state",""],[3,"icon"],[1,"text"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"form"],["mat-button","","mat-dialog-close","",1,"inverse"],["mat-button","",3,"tapped"],[1,"info-block"],[1,"icon"],["diameter","48"],[1,"success"]],template:function(e,t){if(1&e&&(l.Lc(0,ne,9,7,"ng-container",0),l.Lc(1,re,5,7,"ng-template",null,1,l.Mc)),2&e){var n=l.Ac(2);l.vc("ngIf",!t.success)("ngIfElse",n)}},directives:[o.t,B.i,B.f,k.a,o.x,o.y,o.z,U.a,B.c,Q.b,B.d,K.c,x.c],styles:["[_nghost-%COMP%]{max-width:24em}header[_ngcontent-%COMP%]{color:#fff}header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700}header.success[_ngcontent-%COMP%]{background-color:#43a047}header.request[_ngcontent-%COMP%]{background-color:#ffb300}main[_ngcontent-%COMP%]{padding:0 1em .5em}footer[_ngcontent-%COMP%]{width:100%;text-align:center}button[_ngcontent-%COMP%]{min-width:8em}p[_ngcontent-%COMP%]{margin:.5em 0;font-size:1.25em}"]}),se),ue=["space-status",""];function le(e,t){if(1&e){var n=l.Xb();l.Wb(0,"i",3),l.lc("modelChange",(function(e){l.Dc(n);var o=t.$implicit;return l.pc(2).processSpaceBookings(o,e)})),l.Vb()}2&e&&l.vc("sys",t.$implicit.id)}function de(e,t){if(1&e&&(l.Wb(0,"div",1),l.Lc(1,le,1,1,"i",2),l.Vb()),2&e){var n=l.pc();l.Cb(1),l.vc("ngForOf",n.space_list)}}var be,fe=["*"],pe=((be=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,o){var i;return _classCallCheck(this,n),(i=t.call(this))._service=e,i._dialog=o,i.status=new l.n,i.listeners=new l.n,i.features=new l.n,i.space_list=[],i.active_bookings={},i.colour_map={},i}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;this._service.initialised.pipe(Object(f.a)((function(e){return e}))).subscribe((function(){e.colour_map=e._service.setting("app.explore.colors")||{},e.subscription("spaces",e._service.Spaces.listen("list").subscribe((function(){return e.loadSpaces()}))),e.interval("update_status",(function(){e.updateSpaceBookings(),e.calculateStatus()}),6e4)}))}},{key:"ngOnChanges",value:function(e){(e.zone||e.date)&&this.loadSpaces(),e.zone&&this.clearSpaces()}},{key:"ngOnDestroy",value:function(){this.clearSpaces()}},{key:"calculateStatus",value:function(){var e=this;this.timeout("process_statuses",(function(){var t,n=[],o=_createForOfIteratorHelper(e.space_list);try{for(o.s();!(t=o.n()).done;){var i=t.value,a=e.getStatus(i,e.date),r=i.map_id.indexOf("area")<0?"area-".concat(i.map_id,"-status"):i.map_id;n.push({id:r,styles:{fill:e.colour_map["space-".concat(a)]||"#000",opacity:.6},status_id:a})}}catch(s){o.e(s)}finally{o.f()}e.status.emit(n)}))}},{key:"getStatus",value:function(e,t){if(!e.bookable)return"not-bookable";var n=this.active_bookings[e.id]||[],o=F(t).startOf("m").second(1);if(n.find((function(e){var t=F(e.date).startOf("m"),n=t.add(e.duration,"m");return o.isAfter(t,"s")&&o.isBefore(n,"m")})))return"unavailable";var i={date:F(this.date).valueOf(),duration:30,host:this._service.Users.current},a=e.rulesFor(i);return a.hide?"not-bookable":a.auto_approve?"available":"requestable"}},{key:"processSpaceBookings",value:function(e,t){var n=this;this.timeout("space-".concat(e.id),(function(){var o=(t||[]).map((function(t){return new L.a(n._service.Bookings,Object.assign(Object.assign({},t),{room_ids:[e.id]}))}));n.active_bookings[e.id]=o,n.calculateStatus()}),10)}},{key:"updateSpaceBookings",value:function(){var e=this;this.is_today||this.timeout("update_spaces",(function(){var t=F(e.date).startOf("d");e._service.Spaces.query({from:t.unix(),to:t.endOf("d").unix(),show_declined:!1,zone_ids:e.zone,cache:1e4}).then((function(t){t.forEach((function(t){return e.processSpaceBookings(t,t.bookings)}))}))}),50)}},{key:"loadSpaces",value:function(){var e=this;this.space_list=this._service.Spaces.list((function(t){return t.zones.indexOf(e.zone)>=0}));var t,n=[],o=_createForOfIteratorHelper(this.space_list);try{var i=function(){var o=t.value,i=o.map_id.indexOf("area")<0?"area-".concat(o.map_id,"-status"):o.map_id;n.push({id:i,event:"mouseenter",callback:function(){return e.showSpaceInfo(o)}}),n.push({id:i,event:"mouseleave",callback:function(){return e.features.emit([])}}),o.bookable&&n.push({id:i,event:"click",callback:function(){return e.openBookingModal(o)}})};for(o.s();!(t=o.n()).done;)i()}catch(a){o.e(a)}finally{o.f()}this.listeners.emit(n),this.updateSpaceBookings(),this.calculateStatus()}},{key:"clearSpaces",value:function(){delete this.active_bookings,this.active_bookings={}}},{key:"showSpaceInfo",value:function(e){var t=e.map_id.indexOf("area")<0?"area-".concat(e.map_id,"-status"):e.map_id;this.features.emit([{id:t,coordinates:null,content:q,data:{space:e,bookings:this.active_bookings[e.id],date:this.date}}])}},{key:"openBookingModal",value:function(e){var t=this.getStatus(e,this.date);"unavailable"!==t&&"not-bookable"!==t?this._dialog.open(ce,{width:"auto",height:"auto",data:{date:this.date,space:e,bookings:this.active_bookings[e.id]}}):this._service.notifyInfo("".concat(e.name," is unavailable at the selected time. Please select another space or time and try again."))}},{key:"is_today",get:function(){return F().isSame(F(this.date),"d")}}]),n}(u.a)).\u0275fac=function(e){return new(e||be)(l.Qb(c.a),l.Qb(B.b))},be.\u0275cmp=l.Kb({type:be,selectors:[["","space-status",""]],inputs:{zone:"zone",date:"date"},outputs:{status:"status",listeners:"listeners",features:"features"},features:[l.zb,l.Ab],attrs:ue,ngContentSelectors:fe,decls:2,vars:1,consts:[["class","bindings",4,"ngIf"],[1,"bindings"],["binding","","mod","Bookings","bind","today",3,"sys","modelChange",4,"ngFor","ngForOf"],["binding","","mod","Bookings","bind","today",3,"sys","modelChange"]],template:function(e,t){1&e&&(l.uc(),l.Lc(0,de,2,1,"div",0),l.tc(1)),2&e&&l.vc("ngIf",t.space_list&&t.is_today)},directives:[o.t,o.s,r.a],encapsulation:2}),be),ge=["desk-status",""],me=function(e){return[e]},he=function(){return[]};function _e(e,t){if(1&e){var n=l.Xb();l.Wb(0,"div",1),l.Wb(1,"i",2),l.lc("modelChange",(function(e){return l.Dc(n),l.pc().in_use=e}))("modelChange",(function(){return l.Dc(n),l.pc().calculateStatus()})),l.Vb(),l.Wb(2,"i",2),l.lc("modelChange",(function(e){return l.Dc(n),l.pc().id_list=e}))("modelChange",(function(){return l.Dc(n),l.pc().calculateStatus()})),l.Vb(),l.Wb(3,"i",2),l.lc("modelChange",(function(e){return l.Dc(n),l.pc().reserved=e}))("modelChange",(function(){return l.Dc(n),l.pc().calculateStatus()})),l.Vb(),l.Wb(4,"i",2),l.lc("modelChange",(function(e){return l.Dc(n),l.pc().occupied=e})),l.Vb(),l.Wb(5,"i",2),l.lc("modelChange",(function(e){return l.Dc(n),l.pc().free=e})),l.Vb(),l.Wb(6,"i",3),l.lc("modelChange",(function(e){return l.Dc(n),l.pc().checkin=e})),l.Vb(),l.Wb(7,"i",4),l.lc("modelChange",(function(e){return l.Dc(n),l.pc().cancel=e})),l.Vb(),l.Vb()}if(2&e){var o=l.pc();l.Cb(1),l.vc("model",o.in_use)("sys",o.system_id)("bind",o.zone),l.Cb(1),l.vc("model",o.id_list)("sys",o.system_id)("bind",o.zone+":desk_ids"),l.Cb(1),l.vc("model",o.reserved)("sys",o.system_id)("bind",o.zone+":reserved"),l.Cb(1),l.vc("model",o.occupied)("sys",o.system_id)("bind",o.zone+":occupied_count"),l.Cb(1),l.vc("model",o.free)("sys",o.system_id)("bind",o.zone+":free_count"),l.Cb(1),l.vc("model",o.checkin)("sys",o.system_id)("params",l.xc(21,me,o.checkin)),l.Cb(1),l.vc("model",o.cancel)("sys",o.system_id)("params",l.wc(23,he))}}var ve,Ce,ye,Oe,ke=["*"],xe=((Ce=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var o;return _classCallCheck(this,n),(o=t.call(this))._service=e,o.status=new l.n,o.occupied=0,o.free=0,o.colour_map={},o}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;this._service.initialised.pipe(Object(f.a)((function(e){return e}))).subscribe((function(){e.colour_map=e._service.setting("app.explore.colors")||{}}))}},{key:"ngOnChanges",value:function(e){e.zone&&this.loadDesks()}},{key:"calculateStatus",value:function(){var e,t=this,n=this.id_list||[],o=[],i=_createForOfIteratorHelper(n);try{var a=function(){var n=e.value,i=(t.in_use||[]).find((function(e){return e===n})),a=(t.reserved||[]).find((function(e){return e===n})),r=i?"unavailable":a?"reserved":"available";o.push({id:n,styles:{fill:t.colour_map["desk-".concat(r)],stroke:t.colour_map["desk-".concat(r,"-stroke")]},status_id:r})};for(i.s();!(e=i.n()).done;)a()}catch(r){i.e(r)}finally{i.f()}this.status.emit(o)}},{key:"loadDesks",value:function(){var e=this._service.Organisation.levelWithID(this.zone);if(e){var t=this._service.Organisation.buildings.find((function(t){return t.id===e.building_id}));if(t){var n=t.systems.desk_management;n&&(this.system_id=n)}}}}]),n}(u.a)).\u0275fac=function(e){return new(e||Ce)(l.Qb(c.a))},Ce.\u0275cmp=l.Kb({type:Ce,selectors:[["","desk-status",""]],inputs:{zone:"zone",checkin:"checkin"},outputs:{status:"status"},features:[l.zb,l.Ab],attrs:ge,ngContentSelectors:ke,decls:2,vars:1,consts:[["class","bindings",4,"ngIf"],[1,"bindings"],["binding","","mod","DeskManagement",3,"model","sys","bind","modelChange"],["binding","","mod","DeskManagement","exec","manual_checkin",3,"model","sys","params","modelChange"],["binding","","mod","DeskManagement","exec","cancel_reservation",3,"model","sys","params","modelChange"]],template:function(e,t){1&e&&(l.uc(),l.tc(0),l.Lc(1,_e,8,24,"div",0)),2&e&&(l.Cb(1),l.vc("ngIf",t.system_id))},directives:[o.t,r.a],encapsulation:2}),Ce),we=((ve=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var o;return _classCallCheck(this,n),(o=t.call(this))._service=e,o.status=new l.n,o.zone_usage={},o.colour_map={},o}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;this._service.initialised.pipe(Object(f.a)((function(e){return e}))).subscribe((function(){e.colour_map=e._service.setting("app.explore.colors")||{}}))}},{key:"ngOnDestroy",value:function(){this.clearZones(this.zone)}},{key:"calculateStatus",value:function(){var e=this._service.Organisation.levelWithID(this.zone);if(e){var t=e.settings.min_usage||0,n=[];for(var o in this.zone_usage)if(this.zone_usage[o]&&this.zone_usage.hasOwnProperty(o)){var i=Math.max(t,this.zone_usage[o]),a=i<40?"low":i<75?"medium":"high";n.push({id:o,styles:{fill:this.colour_map["zone-".concat(a)]||"#ccc"},status_id:a})}this.status.emit(n)}}},{key:"loadZones",value:function(){var e=this,t=this._service.Organisation.levelWithID(this.zone);if(t){var n=this._service.Organisation.buildings.find((function(e){return e.id===t.building_id}));if(n){var o=n.systems.floor_management;if(o){this.system_id=o;var i=this._service.Bindings.module(this.system_id,"FloorManagement");i&&(this.subscription("zone-".concat(this.zone,".binding"),i.binding(this.zone).bind()),this.subscription("zone-".concat(this.zone,".usage"),i.binding(this.zone).listen((function(t){e.zone_usage=t,e.calculateStatus()}))))}}}}},{key:"clearZones",value:function(e){this.unsub("zone-".concat(e,".binding")),this.unsub("zone-".concat(e,".usage")),delete this.zone_usage,this.zone_usage={}}}]),n}(u.a)).\u0275fac=function(e){return new(e||ve)(l.Qb(c.a))},ve.\u0275dir=l.Lb({type:ve,selectors:[["","zone-status",""]],inputs:{zone:"zone",date:"date"},outputs:{status:"status"},features:[l.zb]}),ve),Me=n("oTgu"),Pe=function(){return{type:"icon",class:"material-icons",content:"add"}},ze=function(){return{type:"icon",class:"material-icons",content:"remove"}},We=function(){return{type:"icon",class:"material-icons",content:"replay"}},Ve=((ye=function(){function e(){_classCallCheck(this,e),this.zoomChange=new l.n,this.positionChange=new l.n,this.min_zoom=1,this.max_zoom=10}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"zoomIn",value:function(){this.zoom=1.2*(this.zoom||this.min_zoom),this.zoom>this.max_zoom&&(this.zoom=this.max_zoom),this.zoomChange.emit(this.zoom)}},{key:"zoomOut",value:function(){this.zoom=(this.zoom||this.min_zoom)*(1/1.2),this.zoom<this.min_zoom&&(this.zoom=this.min_zoom),this.zoomChange.emit(this.zoom)}},{key:"reset",value:function(){this.zoom=this.min_zoom,this.position={x:.5,y:.5},this.zoomChange.emit(this.zoom),this.positionChange.emit(this.position)}}]),e}()).\u0275fac=function(e){return new(e||ye)},ye.\u0275cmp=l.Kb({type:ye,selectors:[["a-zoom-controls"]],inputs:{zoom:"zoom",position:"position"},outputs:{zoomChange:"zoomChange",positionChange:"positionChange"},decls:7,vars:6,consts:[[1,"zoom-control"],["mat-icon-button","","name","zoom-in",3,"tapped"],[3,"icon"],["mat-icon-button","","name","zoom-out",3,"tapped"],["mat-icon-button","","name","reset",3,"tapped"]],template:function(e,t){1&e&&(l.Wb(0,"div",0),l.Wb(1,"button",1),l.lc("tapped",(function(){return t.zoomIn()})),l.Rb(2,"app-icon",2),l.Vb(),l.Wb(3,"button",3),l.lc("tapped",(function(){return t.zoomOut()})),l.Rb(4,"app-icon",2),l.Vb(),l.Wb(5,"button",4),l.lc("tapped",(function(){return t.reset()})),l.Rb(6,"app-icon",2),l.Vb(),l.Vb()),2&e&&(l.Cb(2),l.vc("icon",l.wc(3,Pe)),l.Cb(2),l.vc("icon",l.wc(4,ze)),l.Cb(2),l.vc("icon",l.wc(5,We)))},directives:[Q.b,K.c,k.a],styles:[".zoom-control[_ngcontent-%COMP%]{flex-direction:column;background-color:#fff;border-radius:8px;overflow:hidden;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.zoom-control[_ngcontent-%COMP%], button[_ngcontent-%COMP%]{display:flex;align-items:center}button[_ngcontent-%COMP%]{justify-content:center;border-radius:0;border-bottom:1px solid #ccc}button[_ngcontent-%COMP%]:last-child{border:none}app-icon[_ngcontent-%COMP%]{font-size:1.2em}"]}),ye),Se=n("CbDI");function Ie(e,t){if(1&e&&(l.Wb(0,"li",10),l.Rb(1,"div",11),l.Wb(2,"div",12),l.Nc(3),l.Vb(),l.Rb(4,"div",11),l.Vb()),2&e){var n=l.pc().$implicit;l.Cb(3),l.Oc(n)}}function Le(e,t){if(1&e&&(l.Ub(0),l.Rb(1,"app-icon",5),l.Tb()),2&e){var n=l.pc().$implicit;l.Cb(1),l.vc("icon",n.icon)}}function Re(e,t){if(1&e&&l.Rb(0,"div",17),2&e){var n=l.pc().$implicit,o=l.pc(3);l.Kc("background-color",n.color||o.colours[n.key])}}function je(e,t){if(1&e&&(l.Wb(0,"li",13),l.Wb(1,"div",14),l.Lc(2,Le,2,1,"ng-container",15),l.Lc(3,Re,1,2,"ng-template",null,16,l.Mc),l.Vb(),l.Wb(5,"div",12),l.Nc(6),l.Vb(),l.Vb()),2&e){var n=t.$implicit,o=l.Ac(4);l.Cb(2),l.vc("ngIf",n.icon)("ngIfElse",o),l.Cb(4),l.Oc(n.name)}}function Te(e,t){if(1&e&&(l.Ub(0),l.Lc(1,Ie,5,1,"li",8),l.Lc(2,je,7,3,"li",9),l.Tb()),2&e){var n=t.$implicit,o=l.pc(2);l.Cb(1),l.vc("ngIf",o.show_group_names),l.Cb(1),l.vc("ngForOf",o.legend_items[n])}}Oe=$localize(_templateObject4(),"\ufffd0\ufffd");var Ae=function(e){return{class:"material-icons",content:e}};function De(e,t){if(1&e){var n=l.Xb();l.Wb(0,"div",1),l.Wb(1,"div",2),l.Wb(2,"div",3),l.lc("tapped",(function(){l.Dc(n);var e=l.pc();return e.show_legend=!e.show_legend})),l.Wb(3,"div",4),l.ac(4,Oe),l.Vb(),l.Rb(5,"app-icon",5),l.Vb(),l.Vb(),l.Wb(6,"div",6),l.Wb(7,"ul"),l.Lc(8,Te,3,2,"ng-container",7),l.Vb(),l.Vb(),l.Vb()}if(2&e){var o=l.pc();l.Cb(4),l.ec(o.show_legend?"Hide":"Show"),l.bc(4),l.Cb(1),l.vc("icon",l.xc(10,Ae,o.show_legend?"arrow_drop_up":"arrow_drop_down")),l.Cb(1),l.Kc("padding-bottom",o.show_legend?"1em":"")("padding-bottom",o.show_legend?".5em":"")("overflow",o.show_legend?"hidden auto":"hidden"),l.vc("@show",o.show_legend?"show":"hide"),l.Cb(2),l.vc("ngForOf",o.group_names)}}var Ne,Ee=((Ne=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var o;return _classCallCheck(this,n),(o=t.call(this))._service=e,o.legend_items={},o.colours={},o.show_legend=!1,o}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;this._service.initialised.pipe(Object(f.a)((function(e){return e}))).subscribe((function(){var t=e._service.setting("app.explore")||{};e.legend_items=t.legend||{},e.colours=t.colors||{},e.show_group_names=!!t.show_legend_group_names}))}},{key:"group_names",get:function(){return Object.keys(this.legend_items||{})}}]),n}(u.a)).\u0275fac=function(e){return new(e||Ne)(l.Qb(c.a))},Ne.\u0275cmp=l.Kb({type:Ne,selectors:[["a-map-legend"]],features:[l.zb],decls:1,vars:1,consts:[["class","map-legend",4,"ngIf"],[1,"map-legend"],[1,"tag"],[1,"title",3,"tapped"],[1,"text"],[3,"icon"],[1,"contents"],[4,"ngFor","ngForOf"],["class","group",4,"ngIf"],["class","item","name","item.key",4,"ngFor","ngForOf"],[1,"group"],[1,"bar"],[1,"name"],["name","item.key",1,"item"],[1,"ref"],[4,"ngIf","ngIfElse"],["colour_display",""],[1,"colour"]],template:function(e,t){1&e&&l.Lc(0,De,9,12,"div",0),2&e&&l.vc("ngIf",t.group_names&&t.group_names.length)},directives:[o.t,K.c,k.a,o.s],styles:[".map-legend[_ngcontent-%COMP%]{position:relative;border-radius:4px 4px 0 0;background-color:#fff;margin-top:.4em;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.tag[_ngcontent-%COMP%]{position:absolute;top:0;left:0;transform:translateY(-100%);overflow:hidden}.title[_ngcontent-%COMP%]{display:flex;align-items:center;border-radius:4px 4px 0 0;background-color:#fff;min-width:50%;flex:1;margin:.5em .5em -1px;padding:.75em .8em .75em 1.5em;font-size:.8em;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.contents[_ngcontent-%COMP%]{overflow:hidden;padding:0 .5em;max-height:50vh;min-width:16em}.group[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.25em .5em;margin:.5em 0;color:rgba(0,0,0,.65)}.group[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{margin:0 .5em}.bar[_ngcontent-%COMP%]{height:1px;min-width:1px;flex:1;background-color:rgba(0,0,0,.65)}ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}li[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:.65em;border-radius:4px;padding:.5em .5em .5em 0}li[_ngcontent-%COMP%]:nth-child(2n){background-color:rgba(0,0,0,.05)}li.group[_ngcontent-%COMP%]{background:none}.ref[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center;margin:0 .5em;height:20px;width:20px;border-radius:100%;border:1px solid rgba(0,0,0,.35);overflow:hidden;background-color:#fff}.colour[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0}app-icon[_ngcontent-%COMP%]{font-size:1.2em}"],data:{animation:[Se.a]}}),Ne),qe=n("bv9b"),Fe=n("YxBP"),Be=n("5fZw"),Ue=n("1DiH"),Qe=["container"];function Ke(e,t){if(1&e&&(l.Wb(0,"div",17),l.Wb(1,"div",18),l.Nc(2),l.Vb(),l.Rb(3,"div",6),l.Vb()),2&e){var n=t.$implicit;l.Kc("left",n.left+"%"),l.Gb("hour",n.is_hour),l.Cb(2),l.Oc(n.name)}}function $e(e,t){if(1&e&&l.Rb(0,"div",19),2&e){var n=l.pc();l.Kc("width",n.offset+"%")}}var He,Xe=function(){return{class:"material-icons",content:"keyboard_arrow_left"}},Ye=function(){return{class:"material-icons",content:"keyboard_arrow_right"}},Ge=((He=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var o;return _classCallCheck(this,n),(o=t.call(this))._renderer=e,o.dateChange=new l.n,o.blocks=[],o}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;this.blocks=this.generateBlocks(),this.interval("check_date",(function(){return e.checkDate()}),15e3)}},{key:"generateBlocks",value:function(){for(var e=F().startOf("d"),t=e.endOf("d"),n=[],o=e;o.isBefore(t);){var i=0===o.minute();n.push({id:o.format("HH:mm"),name:i?o.format("h"):"",is_hour:i,left:o.diff(e,"m")/1440*100}),o=o.add(30,"m")}return n}},{key:"changeDate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=F(this.date);t=t.add(e,"d");var n=F();this.date=t.isBefore(n,"m")?n.valueOf():t.valueOf(),this.dateChange.emit(this.date)}},{key:"startMove",value:function(e){var t=this,n=Object(Fe.d)(e);this._start_position=n,this._box=this._container.nativeElement.getBoundingClientRect(),e instanceof MouseEvent?(this.subscription("move",this._renderer.listen("window","mousemove",(function(e){return t.onMove(e)}))),this.subscription("end",this._renderer.listen("window","mouseup",(function(e){t.unsub("move"),t.unsub("end")})))):(this.subscription("move",this._renderer.listen("window","touchmove",(function(e){return t.onMove(e)}))),this.subscription("end",this._renderer.listen("window","touchend",(function(e){t.unsub("move"),t.unsub("end")}))))}},{key:"onMove",value:function(e){var t=Object(Fe.d)(e),n=-Math.round((this._start_position.x-t.x)/this._box.width*1440);if(0!==n){var o=F(this.date),i=o;i=(i=i.add(n,"m")).minute(5*Math.floor(Math.round(i.minute()/5))),this.date=i.valueOf(),this.dateChange.emit(this.date),Math.abs(o.diff(i,"m"))>0&&(this._start_position=t),this.checkDate()}}},{key:"checkDate",value:function(){var e=F(this.date),t=F();t=t.minute(5*Math.floor(Math.ceil(t.minute()/5))),e.isBefore(t,"m")&&(this.date=t.valueOf(),this.dateChange.emit(this.date))}},{key:"is_today",get:function(){return F().isSame(F(this.date),"d")}},{key:"offset",get:function(){var e=F();return e.diff(e.startOf("d"),"m")/1440*100}},{key:"active_time",get:function(){var e=F(this.date),t=e.diff(e.startOf("d"),"m");return{id:e.isSame(F(),"d")?"Today":e.format("DD MMM YYYY"),name:e.format("h:mm A"),left:t/1440*100}}}]),n}(u.a)).\u0275fac=function(e){return new(e||He)(l.Qb(l.E))},He.\u0275cmp=l.Kb({type:He,selectors:[["a-timeline"]],viewQuery:function(e,t){var n;1&e&&l.Jc(Qe,!0),2&e&&l.zc(n=l.mc())&&(t._container=n.first)},inputs:{date:"date"},outputs:{dateChange:"dateChange"},features:[l.zb],decls:20,vars:13,consts:[[1,"not-mobile"],["explore","",1,"timeline"],["container",""],["class","block",3,"hour","left",4,"ngFor","ngForOf"],["class","offset",3,"width",4,"ngIf"],[1,"active-time"],[1,"bar"],[1,"date"],["mat-icon-button","",3,"disabled","tapped"],[3,"icon"],[1,"text",3,"mousedown","touchstart"],["mat-icon-button","",3,"tapped"],[1,"time",3,"mousedown","touchstart"],[1,"triangle"],[1,"pickers","mobile-only"],["offset","top",3,"ngModel","ngModelChange"],[3,"ngModel","ngModelChange"],[1,"block"],[1,"text"],[1,"offset"]],template:function(e,t){1&e&&(l.Wb(0,"div",0),l.Wb(1,"div",1,2),l.Lc(3,Ke,4,5,"div",3),l.Vb(),l.Lc(4,$e,1,2,"div",4),l.Wb(5,"div",5),l.Rb(6,"div",6),l.Wb(7,"div",7),l.Wb(8,"button",8),l.lc("tapped",(function(){return t.changeDate(-1)})),l.Rb(9,"app-icon",9),l.Vb(),l.Wb(10,"div",10),l.lc("mousedown",(function(e){return t.startMove(e)}))("touchstart",(function(e){return t.startMove(e)})),l.Nc(11),l.Vb(),l.Wb(12,"button",11),l.lc("tapped",(function(){return t.changeDate()})),l.Rb(13,"app-icon",9),l.Vb(),l.Vb(),l.Wb(14,"div",12),l.lc("mousedown",(function(e){return t.startMove(e)}))("touchstart",(function(e){return t.startMove(e)})),l.Nc(15),l.Vb(),l.Rb(16,"div",13),l.Vb(),l.Vb(),l.Wb(17,"div",14),l.Wb(18,"a-date-field",15),l.lc("ngModelChange",(function(e){return t.date=e}))("ngModelChange",(function(e){return t.dateChange.emit(e)})),l.Vb(),l.Wb(19,"a-time-field",16),l.lc("ngModelChange",(function(e){return t.date=e}))("ngModelChange",(function(e){return t.dateChange.emit(e)})),l.Vb(),l.Vb()),2&e&&(l.Cb(3),l.vc("ngForOf",t.blocks),l.Cb(1),l.vc("ngIf",t.is_today),l.Cb(1),l.Kc("left",t.active_time.left+"%"),l.Cb(3),l.vc("disabled",t.is_today),l.Cb(1),l.vc("icon",l.wc(11,Xe)),l.Cb(2),l.Oc(t.active_time.id),l.Cb(2),l.vc("icon",l.wc(12,Ye)),l.Cb(2),l.Oc(t.active_time.name),l.Cb(3),l.vc("ngModel",t.date),l.Cb(1),l.vc("ngModel",t.date))},directives:[o.s,o.t,Q.b,K.c,k.a,Be.a,a.r,a.u,Ue.a],styles:["[_nghost-%COMP%]{z-index:10;border-top:1px solid #ccc;background-color:#fff}.timeline[_ngcontent-%COMP%], [_nghost-%COMP%]{position:relative;width:100%;height:3em}@media only screen and (orientation:portrait) and (max-width:450px){.timeline[_ngcontent-%COMP%], [_nghost-%COMP%]{height:3.75em}}@media only screen and (orientation:landscape) and (max-width:800px){.timeline[_ngcontent-%COMP%], [_nghost-%COMP%]{height:3.75em}}.timeline[_ngcontent-%COMP%]{background:linear-gradient(90deg,#051c2c,#051c2c 40%,#0b2453 60%,#1f40e6)}.block[_ngcontent-%COMP%]{position:absolute;top:0;left:0;bottom:0;pointer-events:none}.block.hour[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{height:40%}@media only screen and (orientation:portrait) and (max-width:450px){.block.hour[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{display:initial}}@media only screen and (orientation:landscape) and (max-width:800px){.block.hour[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{display:initial}}.block[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{position:absolute;width:2px;height:20%;bottom:0;left:-1px;background-color:#fff}@media only screen and (orientation:portrait) and (max-width:450px){.block[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{display:none}}@media only screen and (orientation:landscape) and (max-width:800px){.block[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{display:none}}.block[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{position:absolute;bottom:45%;left:0;transform:translateX(-50%);color:#fff}@media only screen and (orientation:portrait) and (max-width:450px){.block[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-size:.8em}}@media only screen and (orientation:landscape) and (max-width:800px){.block[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-size:.8em}}.block[_ngcontent-%COMP%]:first-child{display:none}@media only screen and (orientation:portrait) and (max-width:450px){.block[_ngcontent-%COMP%]:nth-child(4n-1){display:none}}@media only screen and (orientation:landscape) and (max-width:800px){.block[_ngcontent-%COMP%]:nth-child(4n-1){display:none}}.offset[_ngcontent-%COMP%]{background-color:rgba(0,0,0,.65)}.active-time[_ngcontent-%COMP%], .offset[_ngcontent-%COMP%]{position:absolute;top:0;left:0;bottom:0}.active-time[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{width:2px;height:200%;bottom:0;left:-1px}.active-time[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%], .date[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]{position:absolute;background-color:#fff}.date[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]{bottom:100%;left:0;transform:translate(-50%,-.25em);display:flex;align-items:center;overflow:hidden;border-radius:4px;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.date[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{padding:0 .5em;white-space:nowrap}.date[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0}.date[_ngcontent-%COMP%]{transform:translate(-50%,-2.5em)}.time[_ngcontent-%COMP%]{padding:.5em;white-space:nowrap;cursor:-webkit-grab;cursor:grab}.time[_ngcontent-%COMP%]:active{cursor:-webkit-grabbing;cursor:grabbing}.pickers[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.25em}.pickers[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1;margin:.25em}"]}),He);function Je(e,t){1&e&&l.Rb(0,"mat-progress-bar",18)}function Ze(e,t){if(1&e&&(l.Wb(0,"div",14),l.Wb(1,"div",15),l.Nc(2),l.Vb(),l.Wb(3,"div",16),l.Lc(4,Je,1,0,"mat-progress-bar",17),l.Vb(),l.Vb()),2&e){var n=l.pc();l.Cb(2),l.Oc(n.message),l.Cb(2),l.vc("ngIf",n.loading)}}function et(e,t){if(1&e){var n=l.Xb();l.Wb(0,"a-timeline",19),l.lc("dateChange",(function(e){return l.Dc(n),l.pc().date=e})),l.Vb()}if(2&e){var o=l.pc();l.vc("date",o.date)}}var tt,nt,ot=((tt=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,o){var i;return _classCallCheck(this,n),(i=t.call(this))._service=e,i._route=o,i.center={x:.5,y:.5},i.style_map={},i.status_map={},i.listener_map={},i.feature_map={},i}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;this._service.initialised.pipe(Object(f.a)((function(e){return e}))).subscribe((function(){if(!e.active_level){var t=e._service.Organisation.building;t&&t.levels.length&&(e.active_level=t.levels[0].id)}e.settings=e._service.setting("app.explore")||{},e.subscription("route.query",e._route.queryParamMap.subscribe((function(t){t.has("space")&&e.loadSpaceLocation(t.get("space")),t.has("user")&&e.loadUserLocation(t.get("user")).then((function(t){e.loading=!1,e.message=e.focus?"":"Unable to locate ".concat(t.name)}),(function(t){e.loading=!1,e.message="Unable to locate user",t&&404!==t.status&&e._service.notifyError("Error loading user location. ".concat(t.message))}))})))}))}},{key:"processStatuses",value:function(){var e={};(this.status_map.spaces||[]).forEach((function(t){return e["#".concat(t.id)]=t.styles})),(this.status_map.desks||[]).forEach((function(t){return e["#".concat(t.id)]=t.styles})),(this.status_map.zones||[]).forEach((function(t){return e["#".concat(t.id)]=t.styles})),this.style_map=e}},{key:"processListeners",value:function(){var e=[];e=(e=(e=e.concat(this.listener_map.spaces||[])).concat(this.listener_map.desks||[])).concat(this.listener_map.zones||[]),this.listeners=e}},{key:"processFeatures",value:function(){var e=[];this.focus_feature&&(e=e.concat([this.focus_feature])),e=(e=(e=e.concat(this.feature_map.spaces||[])).concat(this.feature_map.desks||[])).concat(this.feature_map.zones||[]),this.features=e}},{key:"loadSpaceLocation",value:function(e){var t=this._service.Spaces.list((function(t){return t.id===e}))[0];t&&(this.message="Loading location of ".concat(t.name),this.loading=!0,this.active_level=t.level.id,this.focus=t.map_id,this.focus_feature={id:t.map_id,coordinates:null,content:s.e,data:{text:t.name}},this.zoom=1,this.loading=!1,this.message="",this.processFeatures())}},{key:"loadUserLocation",value:function(e){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.focus=null,this.focus_feature=null,this.loading=!0,this.message="Loading user details...",t.next=3,this._service.Users.show(e);case 3:if(n=t.sent){t.next=6;break}return t.abrupt("return",n);case 6:return this.message="Loading location for ".concat(n.name,"..."),t.next=9,n.locate();case 9:return o=t.sent,t.abrupt("return",o?(this.active_level=o.level.id,o.fixed?(this.focus=o.id,this.focus_feature={id:o.id,coordinates:null,content:s.e,data:{text:"".concat(n.name," is here")}},this.zoom=1):(this.focus={x:o.x,y:o.y},this.focus_feature={coordinates:{x:o.x,y:o.y},content:s.f,data:{text:"".concat(n.name," is here"),diameter:o.confidence||5}}),this.zoom=1,this.loading=!1,this.message="",this.processFeatures(),n):n);case 11:case"end":return t.stop()}}),t,this)})))}},{key:"map_url",get:function(){return(this._service.Organisation.levelWithID(this.active_level)||{map_url:""}).map_url||""}}]),n}(u.a)).\u0275fac=function(e){return new(e||tt)(l.Qb(c.a),l.Qb(i.a))},tt.\u0275cmp=l.Kb({type:tt,selectors:[["explore-map-view"]],features:[l.zb],decls:15,vars:16,consts:[[1,"map-view"],[1,"header"],[1,"body"],["hidden","",1,"status-list"],["space-status","",3,"zone","date","status","listeners","features"],["desk-status","",3,"zone","status"],["zone-status","",3,"zone","status"],["overlay","",3,"level","levelChange"],[3,"zoom","center","src","css","listeners","features","focus","zoomChange","centerChange"],["diameter","32"],["overlay","",3,"zoom","position","zoomChange","positionChange"],["overlay",""],["class","message",4,"ngIf"],[3,"date","dateChange",4,"ngIf"],[1,"message"],[1,"text"],[1,"loader"],["mode","indeterminate",4,"ngIf"],["mode","indeterminate"],[3,"date","dateChange"]],template:function(e,t){1&e&&(l.Wb(0,"div",0),l.Wb(1,"div",1),l.Rb(2,"explore-search"),l.Vb(),l.Wb(3,"div",2),l.Wb(4,"div",3),l.Wb(5,"i",4),l.lc("status",(function(e){return t.status_map.spaces=e,t.processStatuses()}))("listeners",(function(e){return t.listener_map.spaces=e,t.processListeners()}))("features",(function(e){return t.feature_map.spaces=e,t.processFeatures()})),l.Vb(),l.Wb(6,"i",5),l.lc("status",(function(e){return t.status_map.desks=e,t.processStatuses()})),l.Vb(),l.Wb(7,"i",6),l.lc("status",(function(e){return t.status_map.zones=e,t.processStatuses()})),l.Vb(),l.Vb(),l.Wb(8,"a-map-controls",7),l.lc("levelChange",(function(e){return t.active_level=e}))("levelChange",(function(){return t.zoom=1,t.center={x:.5,y:.5}})),l.Vb(),l.Wb(9,"a-map",8),l.lc("zoomChange",(function(e){return t.zoom=e}))("centerChange",(function(e){return t.center=e})),l.Rb(10,"mat-spinner",9),l.Vb(),l.Wb(11,"a-zoom-controls",10),l.lc("zoomChange",(function(e){return t.zoom=e}))("positionChange",(function(e){return t.center=e})),l.Vb(),l.Rb(12,"a-map-legend",11),l.Lc(13,Ze,5,2,"div",12),l.Vb(),l.Lc(14,et,1,1,"a-timeline",13),l.Vb()),2&e&&(l.Cb(5),l.vc("zone",t.active_level)("date",t.date),l.Cb(1),l.vc("zone",t.active_level),l.Cb(1),l.vc("zone",t.active_level),l.Cb(1),l.vc("level",t.active_level),l.Cb(1),l.vc("zoom",t.zoom)("center",t.center)("src",t.map_url)("css",t.style_map)("listeners",t.listeners)("features",t.features)("focus",t.focus),l.Cb(2),l.vc("zoom",t.zoom)("position",t.center),l.Cb(2),l.vc("ngIf",t.message),l.Cb(1),l.vc("ngIf",t.settings.show_timeline))},directives:[I,pe,xe,we,Me.a,s.d,x.c,Ve,Ee,o.t,qe.a,Ge],styles:[".map-view[_ngcontent-%COMP%]{position:absolute;display:flex;align-items:center;flex-direction:column;top:0;left:0;right:0;bottom:0;overflow:hidden}.body[_ngcontent-%COMP%], .header[_ngcontent-%COMP%]{width:100%;background-color:#f8f8f8}.body[_ngcontent-%COMP%]{position:relative;min-height:50%;flex:1;overflow:hidden}.body[_ngcontent-%COMP%], a-map[_ngcontent-%COMP%]{z-index:1}[overlay][_ngcontent-%COMP%]{z-index:10}a-map-controls[_ngcontent-%COMP%]{position:absolute;top:.5em;left:.5em}a-zoom-controls[_ngcontent-%COMP%]{position:absolute;bottom:.5em;right:.5em}a-map-legend[_ngcontent-%COMP%]{bottom:0}a-map-legend[_ngcontent-%COMP%], a-popout-menu[_ngcontent-%COMP%]{position:absolute;left:.5em}a-popout-menu[_ngcontent-%COMP%]{bottom:.5em;z-index:999}.message[_ngcontent-%COMP%]{overflow:hidden;position:absolute;bottom:.5rem;left:50%;transform:translateX(-50%);background-color:#fff;border-radius:4px;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12);max-width:20rem;z-index:999;font-size:.9em}.message[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]{height:4px;width:100%}@media only screen and (orientation:portrait) and (max-width:450px){.message[_ngcontent-%COMP%]{left:.5rem;transform:none}}@media only screen and (orientation:landscape) and (max-width:800px){.message[_ngcontent-%COMP%]{left:.5rem;transform:none}}.message[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{padding:.5rem}"]}),tt),it=n("p5rm"),at=n("4Uey"),rt=((nt=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var o;return _classCallCheck(this,n),(o=t.call(this))._service=e,o}return _createClass(n,[{key:"ngOnInit",value:function(){this._service.title="Maps"}}]),n}(u.a)).\u0275fac=function(e){return new(e||nt)(l.Qb(c.a))},nt.\u0275cmp=l.Kb({type:nt,selectors:[["app-explore"]],features:[l.zb],decls:8,vars:2,consts:[[1,"explore","page"],[1,"header"],[3,"menu","menuChange"],[1,"body"],[1,"footer"],[3,"show","showChange"]],template:function(e,t){1&e&&(l.Wb(0,"div",0),l.Wb(1,"header",1),l.Wb(2,"a-topbar-header",2),l.lc("menuChange",(function(e){return t.show_menu=e})),l.Vb(),l.Vb(),l.Wb(3,"main",3),l.Rb(4,"explore-map-view"),l.Vb(),l.Wb(5,"footer",4),l.Rb(6,"a-footer-menu"),l.Vb(),l.Vb(),l.Wb(7,"a-overlay-menu",5),l.lc("showChange",(function(e){return t.show_menu=e})),l.Vb()),2&e&&(l.Cb(2),l.vc("menu",t.show_menu),l.Cb(5),l.vc("show",t.show_menu))},directives:[d.a,ot,it.a,at.a],styles:[".page[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;align-items:center;flex-direction:column}.page[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}.body[_ngcontent-%COMP%]{position:relative;min-width:50%;flex:1}"]}),nt),st=n("PCNd");n.d(t,"ExploreModule",(function(){return lt}));var ct,ut=[{path:"",component:rt},{path:":search_type",component:rt}],lt=((ct=function e(){_classCallCheck(this,e)}).\u0275mod=l.Ob({type:ct}),ct.\u0275inj=l.Nb({factory:function(e){return new(e||ct)},imports:[[o.c,i.h.forChild(ut),st.a,s.a,r.b,a.l]]}),ct)}}]);