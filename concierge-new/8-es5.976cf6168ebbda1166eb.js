function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(t){return function(){var e,n=_getPrototypeOf(t);if(_isNativeReflectConstruct()){var i=_getPrototypeOf(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return _possibleConstructorReturn(this,e)}}function _possibleConstructorReturn(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"7R+x":function(t,e,n){"use strict";n.r(e);var i=n("ofXK"),o=n("tyNb"),a=n("3Pt+"),c=n("xhdr"),r=n("fXoL"),s=n("0IaG"),l=n("IWZj"),d=n("g+Po"),b=n("OaWH"),f=n("bTqV"),u=n("0njA"),g=n("mAda"),m=n("kmnG"),h=n("qFsG"),p=n("m6yr");function v(t,e){if(1&t){var n=r.Xb();r.Wb(0,"form",4),r.Wb(1,"div",5),r.Wb(2,"div",6),r.Wb(3,"label",7),r.Gc(4,"Name"),r.Vb(),r.Wb(5,"mat-form-field",8),r.Wb(6,"input",9),r.ec("blur",(function(){return r.wc(n),r.ic().updatePerson()})),r.Vb(),r.Wb(7,"mat-error"),r.Gc(8,"Title is required"),r.Vb(),r.Vb(),r.Vb(),r.Wb(9,"div",10),r.Wb(10,"label",11),r.Gc(11,"Email Address"),r.Vb(),r.Wb(12,"mat-form-field",8),r.Wb(13,"input",12),r.ec("blur",(function(){return r.wc(n),r.ic().updatePerson()})),r.Vb(),r.Wb(14,"mat-error"),r.Gc(15,"A valid email address is required"),r.Vb(),r.Vb(),r.Vb(),r.Vb(),r.Vb()}if(2&t){var i=r.ic();r.oc("formGroup",i.form)}}var _,C=function(){return{class:"material-icons",content:"face"}},O=((_=function(t){_inherits(n,t);var e=_createSuper(n);function n(t){var i;return _classCallCheck(this,n),(i=e.call(this))._service=t,i.personChange=new r.o,i}return _createClass(n,[{key:"ngOnChanges",value:function(t){t.person&&(delete this.form,this.form=new a.i({name:new a.f(this.person.name,[a.F.minLength(2)]),email:new a.f(this.person.email,[a.F.required,a.F.email])}))}},{key:"updatePerson",value:function(){this.form.markAllAsTouched(),this.form.valid&&(this.person=new g.a(this._service.Users,Object.assign(Object.assign({},this.form.value),{visitor:!0})),this.personChange.emit(this.person))}}]),n}(l.a)).\u0275fac=function(t){return new(t||_)(r.Qb(b.a))},_.\u0275cmp=r.Kb({type:_,selectors:[["a-visitor-form"]],inputs:{event:"event",person:"person",field:"field"},outputs:{personChange:"personChange"},features:[r.zb,r.Ab],decls:4,vars:3,consts:[[1,"icon"],[3,"icon"],[3,"formGroup",4,"ngIf"],[1,"bar"],[3,"formGroup"],[1,"details"],[1,"name"],["for","name"],["appearance","outline"],["matInput","","name","name","placeholder","Name","formControlName","name",3,"blur"],[1,"email"],["for","email"],["matInput","","name","email","type","email","placeholder","Email Address","formControlName","email",3,"blur"]],template:function(t,e){1&t&&(r.Wb(0,"div",0),r.Rb(1,"app-icon",1),r.Vb(),r.Ec(2,v,16,1,"form",2),r.Rb(3,"div",3)),2&t&&(r.Cb(1),r.oc("icon",r.pc(2,C)),r.Cb(1),r.oc("ngIf",e.form))},directives:[u.a,i.t,a.H,a.s,a.j,m.b,h.a,a.c,a.r,a.h,m.a],styles:["[_nghost-%COMP%]{position:relative;display:flex;align-items:center;padding-left:4em;flex:1;transition:opacity .2s}.not-match[_nghost-%COMP%]{opacity:.35;background-color:#fff}[_nghost-%COMP%]:last-child   .details[_ngcontent-%COMP%]{border:none}.details[_ngcontent-%COMP%]{display:flex;flex:1;min-width:50%;align-items:center;height:4em}label[_ngcontent-%COMP%]{display:none}mat-form-field[_ngcontent-%COMP%]{height:3.25em;width:100%}mat-form-field[_ngcontent-%COMP%]   mat-error[_ngcontent-%COMP%]{margin-top:-.5em}.actions[_ngcontent-%COMP%]{width:4em}.email[_ngcontent-%COMP%], .name[_ngcontent-%COMP%]{flex:1;min-width:25%;margin-right:.5em}.icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:2em;width:2em;margin-right:.5em;border-radius:100%;background-color:#ccc;font-size:1.5em}.title[_ngcontent-%COMP%]{flex:1;min-width:1em}.user[_ngcontent-%COMP%]{display:flex;align-items:center;font-weight:400}form[_ngcontent-%COMP%]{flex:1}.staff[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:1.5em;width:1.5em;margin-right:.5em;border-radius:4px;border:3px solid #1937ea;font-weight:600;font-size:.8em;color:#1937ea}.bar[_ngcontent-%COMP%]{position:absolute;width:1.5em;top:50%;left:2.15em;height:2px;min-height:0;background-color:#999;transform:translateY(-50%)}.empty[_ngcontent-%COMP%]{width:4.5em}"]}),_),P=function(){return{class:"material-icons",content:"delete"}};function M(t,e){if(1&t){var n=r.Xb();r.Wb(0,"div",23),r.Wb(1,"a-visitor-form",24),r.ec("personChange",(function(t){r.wc(n);var e=r.ic().index;return r.ic(3).replaceVisitor(t,e)})),r.Vb(),r.Wb(2,"button",25),r.ec("tapped",(function(){r.wc(n);var t=r.ic(),e=t.$implicit,i=t.index;return r.ic(3).removeVisitor(e,i)})),r.Rb(3,"app-icon",6),r.Vb(),r.Vb()}if(2&t){var i=r.ic().$implicit,o=r.ic(3);r.Cb(1),r.oc("event",o.event)("person",i),r.Cb(2),r.oc("icon",r.pc(3,P))}}function y(t,e){if(1&t&&(r.Ub(0),r.Ec(1,M,4,4,"div",22),r.Tb()),2&t){var n=e.$implicit;r.Cb(1),r.oc("ngIf",n.external)}}var w=function(){return{class:"material-icons",content:"event"}},k=function(){return{class:"material-icons",content:"add"}};function V(t,e){if(1&t){var n=r.Xb();r.Wb(0,"div",3),r.Wb(1,"div",4),r.Wb(2,"div",5),r.Rb(3,"app-icon",6),r.Vb(),r.Wb(4,"div",7),r.Gc(5),r.Wb(6,"span"),r.Gc(7),r.Vb(),r.Vb(),r.Wb(8,"div",8),r.Wb(9,"div",9),r.Gc(10,"S"),r.Vb(),r.Wb(11,"div",10),r.Gc(12),r.Vb(),r.Vb(),r.Wb(13,"div",11),r.Wb(14,"label",12),r.Gc(15,"Title"),r.Vb(),r.Wb(16,"mat-form-field",13),r.Rb(17,"input",14),r.Wb(18,"mat-error"),r.Gc(19,"Title is required"),r.Vb(),r.Vb(),r.Vb(),r.Rb(20,"div",15),r.Vb(),r.Wb(21,"div",16),r.Rb(22,"div",17),r.Ec(23,y,2,1,"ng-container",18),r.Wb(24,"button",19),r.ec("tapped",(function(){return r.wc(n),r.ic(2).addVisitor()})),r.Wb(25,"div",20),r.Wb(26,"div",5),r.Rb(27,"app-icon",6),r.Vb(),r.Wb(28,"div",21),r.Gc(29,"Add visitor"),r.Vb(),r.Rb(30,"div",17),r.Vb(),r.Vb(),r.Vb(),r.Vb()}if(2&t){var i=r.ic(2);r.Cb(3),r.oc("icon",r.pc(9,w)),r.Cb(2),r.Ic("",i.event.start_time," "),r.Cb(2),r.Ic(" - ",i.event.duration>0?i.event.end_time:"",""),r.Cb(5),r.Hc((null==i.event.organiser?null:i.event.organiser.name)||i.event.organiser_email),r.Cb(11),r.oc("ngForOf",i.attendees)("ngForTrackBy",i.trackByFn),r.Cb(1),r.Gb("add",!0),r.Cb(3),r.oc("icon",r.pc(10,k))}}function x(t,e){if(1&t&&(r.Wb(0,"form",1),r.Ec(1,V,31,11,"div",2),r.Vb()),2&t){var n=r.ic();r.oc("formGroup",n.form),r.Cb(1),r.oc("ngIf",n.event)}}var W,I=((W=function(){function t(e){_classCallCheck(this,t),this._service=e,this.attendees=[]}return _createClass(t,[{key:"ngOnChanges",value:function(t){(t.event||t.form)&&(this.attendees=this.form.controls.attendees.value)}},{key:"addVisitor",value:function(){var t=this.form.controls.attendees.value;t.push(new g.a(this._service.Users,{visitor:!0})),this.form.controls.attendees.setValue(t)}},{key:"replaceVisitor",value:function(t,e){var n=this.attendees;n.splice(e,1,t),this.attendees=n,console.log("Visitor:",t),this._service.Users.addFrom("visitor-modal",t.toJSON(),"other"),this.form.controls.attendees.setValue(n)}},{key:"removeVisitor",value:function(t,e){var n=this.attendees;n.splice(e,1),this.form.controls.attendees.setValue(n)}},{key:"trackByFn",value:function(t,e){return e?e.id:null}}]),t}()).\u0275fac=function(t){return new(t||W)(r.Qb(b.a))},W.\u0275cmp=r.Kb({type:W,selectors:[["a-event-form"]],inputs:{event:"event",form:"form"},features:[r.Ab],decls:1,vars:1,consts:[[3,"formGroup",4,"ngIf"],[3,"formGroup"],["class","visitor-booking",4,"ngIf"],[1,"visitor-booking"],[1,"details"],[1,"icon"],[3,"icon"],[1,"time"],[1,"host"],[1,"staff"],[1,"name"],[1,"title"],["for","title"],["appearance","outline"],["matInput","","name","title","placeholder","Meeting Title","formControlName","title"],[1,"actions"],[1,"attendees"],[1,"bar"],[4,"ngFor","ngForOf","ngForTrackBy"],["mat-button","","type","button",3,"tapped"],[1,"content"],[1,"text"],["class","visitor",4,"ngIf"],[1,"visitor"],[3,"event","person","personChange"],["mat-icon-button","",3,"tapped"]],template:function(t,e){1&t&&r.Ec(0,x,2,2,"form",0),2&t&&r.oc("ngIf",e.form)},directives:[i.t,a.H,a.s,a.j,u.a,m.b,h.a,a.c,a.r,a.h,m.a,i.s,f.b,p.c,O],styles:["[_nghost-%COMP%]{font-size:.9em}.visitor-booking[_ngcontent-%COMP%]{transition:background .2s;background-color:#fff;border-bottom:1px solid rgba(0,0,0,.1)}.showing[_ngcontent-%COMP%]{background-color:#f0f0f0}.showing[_ngcontent-%COMP%]   .toggle[_ngcontent-%COMP%]{color:#1937ea}.details[_ngcontent-%COMP%]{position:relative;z-index:10;display:flex;align-items:center;padding:.5em 0;transition:opacity .2s}.details.blur[_ngcontent-%COMP%]{opacity:.35;background-color:#fff}.details[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:0 .5em}.details[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{width:5.75rem;font-size:.9em}.details[_ngcontent-%COMP%]   .host[_ngcontent-%COMP%]{width:13.25em}.details[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%]{width:12em}.icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:2em;width:2em;border-radius:100%;background-color:#ccc;font-size:1.5em}.time[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:rgba(0,0,0,.65)}.title[_ngcontent-%COMP%]{flex:1;min-width:1em;width:18.25em}.host[_ngcontent-%COMP%]{display:flex;align-items:center;font-weight:400}.status[_ngcontent-%COMP%]{font-size:.9em;font-weight:500;width:3.5em}.staff[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:1.5em;width:1.5em;margin-right:.5em;border-radius:4px;border:3px solid #1937ea;font-weight:600;font-size:.8em;color:#1937ea}.attendees[_ngcontent-%COMP%]{position:relative}.attendees[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{position:absolute;top:-.65em;left:2.15em;width:2px;background-color:#999;bottom:2em}.toggle[_ngcontent-%COMP%]{font-size:1.2rem}label[_ngcontent-%COMP%]{display:none}mat-form-field[_ngcontent-%COMP%]{height:3.25em;width:100%}mat-form-field[_ngcontent-%COMP%]   mat-error[_ngcontent-%COMP%]{margin-top:-.5em}.actions[_ngcontent-%COMP%]{width:4em}.add[_ngcontent-%COMP%]{position:relative;background:none;border:none;padding-left:4em;color:rgba(0,0,0,.85);height:4em;width:100%;border-radius:0}.add[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%], .add[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{display:flex;align-items:center}.add[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{justify-content:center;height:2em;width:2em;margin-right:.5em;border-radius:100%;border:2px dotted rgba(0,0,0,.6);background:none;color:rgba(0,0,0,.6);font-size:1.5em}.add[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{position:absolute;width:1.5em;top:50%;left:2.25em;height:2px;min-height:0;background-color:#999;transform:translateY(-50%)}.visitor[_ngcontent-%COMP%]{display:flex;align-items:center}.visitor[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:2.25em}"]}),W),G=n("Xa2L"),R=function(){return{type:"icon",class:"material-icons",content:"close"}};function E(t,e){1&t&&(r.Wb(0,"button",5),r.Rb(1,"app-icon",6),r.Vb()),2&t&&(r.Cb(1),r.oc("icon",r.pc(1,R)))}function j(t,e){if(1&t&&(r.Wb(0,"main"),r.Rb(1,"a-event-form",7),r.Vb()),2&t){var n=r.ic();r.Cb(1),r.oc("form",n.form)("event",n.booking)}}function z(t,e){if(1&t){var n=r.Xb();r.Wb(0,"button",10),r.ec("tapped",(function(){return r.wc(n),r.ic(2).delete()})),r.Gc(1,"Delete"),r.Vb()}}function T(t,e){if(1&t){var n=r.Xb();r.Wb(0,"mat-dialog-actions"),r.Wb(1,"footer"),r.Wb(2,"button",8),r.ec("tapped",(function(){return r.wc(n),r.ic().save()})),r.Gc(3,"Save"),r.Vb(),r.Ec(4,z,2,0,"button",9),r.Vb(),r.Vb()}if(2&t){var i=r.ic();r.Cb(2),r.oc("disabled",!i.has_attendees),r.Cb(2),r.oc("ngIf",i.booking.id)}}function F(t,e){if(1&t&&(r.Wb(0,"main",11),r.Wb(1,"div",12),r.Wb(2,"div",13),r.Rb(3,"mat-spinner",14),r.Vb(),r.Wb(4,"div",15),r.Gc(5),r.Vb(),r.Vb(),r.Vb()),2&t){var n=r.ic();r.Cb(5),r.Hc(n.loading)}}var S,A=((S=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,i,o,a){var c;return _classCallCheck(this,n),(c=e.call(this))._service=t,c._dialog_ref=i,c._dialog=o,c._data=a,c.event=new r.o,c}return _createClass(n,[{key:"ngOnInit",value:function(){var t=this;this.form=new a.i({title:new a.f(this.booking.title,[a.F.required]),attendees:new a.f(this.booking.attendees,[a.F.minLength(1)])}),this.subscription("title",this.form.controls.title.valueChanges.subscribe((function(e){return t.booking.storePendingChange("title",e)}))),this.subscription("attendees",this.form.controls.attendees.valueChanges.subscribe((function(e){t.booking.storePendingChange("attendee_emails",e.map((function(t){return t.email})))})))}},{key:"delete",value:function(){var t=this,e=this._dialog.open(d.b,Object.assign(Object.assign({},d.a),{data:{title:"Delete meeting",content:"Are you sure you wish to delete this meeting?",icon:{type:"icon",class:"material-icons",content:"delete"},action:"Ok"}}));this.subscription("confirm",e.componentInstance.event.subscribe((function(n){"done"===n.reason&&t.booking.id&&(t.loading="Deleting visitor booking...",t._dialog_ref.disableClose=!0,t.booking.delete().then((function(e){t.event.emit({reason:"done"}),t._service.notifySuccess("Successfully removed visitors."),t._dialog_ref.close()}),(function(e){t.loading=null,t._service.notifyError("Failed to remove visitors. Error: ".concat(e.message||e)),t._dialog_ref.disableClose=!1}))),e.close()}))),e.afterClosed().subscribe((function(){return t.unsub("confirm")}))}},{key:"save",value:function(){var t=this;this.timeout("save",(function(){t.loading="Saving visitor booking...",t.form.markAllAsTouched(),t._dialog_ref.disableClose=!0,t.booking.has_changes&&t.form.valid&&t.booking.save().then((function(e){t.event.emit({reason:"done",metadata:e}),t._service.notifySuccess(t.booking.id?"Successfully updated visitors.":"Successfully added visitors."),t._dialog_ref.close()}),(function(e){t.loading=null,t._service.notifyError("Failed to ".concat(t.booking.id?"update":"add"," visitors. Error: ").concat(e.message||e)),t._dialog_ref.disableClose=!1}))}))}},{key:"booking",get:function(){return this._data.booking}},{key:"has_attendees",get:function(){return this.form&&this.form.controls.attendees.value&&this.form.controls.attendees.value.length}}]),n}(l.a)).\u0275fac=function(t){return new(t||S)(r.Qb(b.a),r.Qb(s.h),r.Qb(s.b),r.Qb(s.a))},S.\u0275cmp=r.Kb({type:S,selectors:[["a-visitors-form-modal"]],outputs:{event:"event"},features:[r.zb],decls:9,vars:5,consts:[[1,"heading"],["mat-icon-button","","mat-dialog-close","",4,"ngIf"],[4,"ngIf","ngIfElse"],[4,"ngIf"],["load_state",""],["mat-icon-button","","mat-dialog-close",""],[3,"icon"],[3,"form","event"],["mat-button","",3,"disabled","tapped"],["mat-button","","class","error",3,"tapped",4,"ngIf"],["mat-button","",1,"error",3,"tapped"],[2,"min-height","12em"],[1,"info-block","center"],[1,"icon"],["diameter","32"],[1,"text"]],template:function(t,e){if(1&t&&(r.Wb(0,"header"),r.Wb(1,"div",0),r.Gc(2),r.Vb(),r.Ec(3,E,2,2,"button",1),r.Vb(),r.Wb(4,"mat-dialog-content"),r.Ec(5,j,2,2,"main",2),r.Vb(),r.Ec(6,T,5,2,"mat-dialog-actions",3),r.Ec(7,F,6,1,"ng-template",null,4,r.Fc)),2&t){var n=r.tc(8);r.Cb(2),r.Ic("",e.booking.id?"Edit":"New"," Visitors"),r.Cb(1),r.oc("ngIf",!e.loading),r.Cb(2),r.oc("ngIf",!e.loading)("ngIfElse",n),r.Cb(1),r.oc("ngIf",!e.loading)}},directives:[i.t,s.f,f.b,s.d,u.a,I,s.c,p.c,G.c],styles:[".heading[_ngcontent-%COMP%]{flex:1;min-width:50%}footer[_ngcontent-%COMP%]{width:100%;text-align:center}footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:10em}main[_ngcontent-%COMP%]{position:relative;min-width:24em}"]}),S),N=n("Wgwc"),L=n("BAfr"),Q=n("ocbO"),H=n("XNiG"),$=n("LRne"),X=n("SxV6"),q=n("Kj3r"),D=n("/uUt"),B=n("eIep"),K=n("JIr8"),U=n("lJxs"),Y=n("bv9b"),J=n("CbDI"),Z=n("Qu3c"),tt=n("YoI9"),et=n("q/DJ");function nt(t,e){1&t&&(r.Wb(0,"div",15),r.Gc(1,"S"),r.Vb())}function it(t,e){if(1&t&&(r.Wb(0,"div",16),r.Gc(1),r.Vb()),2&t){var n=r.ic();r.Cb(1),r.Hc(n.status)}}var ot=function(){return{class:"material-icons",content:"event_available"}};function at(t,e){1&t&&r.Rb(0,"action-icon",1),2&t&&r.oc("icon",r.pc(1,ot))}var ct,rt=function(){return{class:"material-icons",content:"face"}},st=function(){return{class:"material-icons",content:"mail"}},lt=((ct=function(){function t(e,n){_classCallCheck(this,t),this._element=e,this._renderer=n}return _createClass(t,[{key:"ngOnChanges",value:function(t){t.search&&(this.search&&!this.is_match?this._renderer.addClass(this._element.nativeElement,"not-match"):this._renderer.removeClass(this._element.nativeElement,"not-match"))}},{key:"is_match",get:function(){var t=(this.search||"").toLowerCase();return this.person.name.toLowerCase().indexOf(t)>=0||this.person.email.toLowerCase().indexOf(t)>=0}},{key:"mail_url",get:function(){return"mailto:".concat(this.person.email,'?subject="').concat(this.event.title,'"%20at%20').concat(this.event.start_time,",%20").concat(this.event.date_string).concat(this.event.organiser_email.toLowerCase()!==this.person.email?"&cc="+this.event.organiser_email:"")}}]),t}()).\u0275fac=function(t){return new(t||ct)(r.Qb(r.l),r.Qb(r.F))},ct.\u0275cmp=r.Kb({type:ct,selectors:[["a-visitor"]],inputs:{event:"event",person:"person",search:"search"},features:[r.Ab],decls:18,vars:13,consts:[[1,"icon"],[3,"icon"],[1,"details"],[1,"user"],["class","staff",4,"ngIf"],[1,"name"],[1,"title"],["class","status",4,"ngIf"],[1,"actions"],["mat-icon-button","","matTooltip","Email Visitor",3,"href"],["mat-icon-button","","matTooltip","Checkin Visitor"],[3,"icon",4,"ngIf"],["mat-icon-button","",3,"disabled"],[1,"empty"],[1,"bar"],[1,"staff"],[1,"status"]],template:function(t,e){1&t&&(r.Wb(0,"div",0),r.Rb(1,"app-icon",1),r.Vb(),r.Wb(2,"div",2),r.Wb(3,"div",3),r.Ec(4,nt,2,0,"div",4),r.Wb(5,"div",5),r.Gc(6),r.Vb(),r.Vb(),r.Rb(7,"div",6),r.Ec(8,it,2,1,"div",7),r.Wb(9,"div",8),r.Wb(10,"a",9),r.jc(11,"safe"),r.Rb(12,"action-icon",1),r.Vb(),r.Wb(13,"button",10),r.Ec(14,at,1,2,"action-icon",11),r.Vb(),r.Rb(15,"button",12),r.Vb(),r.Rb(16,"div",13),r.Vb(),r.Rb(17,"div",14)),2&t&&(r.Cb(1),r.oc("icon",r.pc(11,rt)),r.Cb(3),r.oc("ngIf",!e.person.external),r.Cb(2),r.Hc((null==e.person?null:e.person.name)||(null==e.person?null:e.person.email)),r.Cb(2),r.oc("ngIf",e.person.external),r.Cb(2),r.oc("href",r.lc(11,8,e.mail_url,"url"),r.yc),r.Cb(2),r.oc("icon",r.pc(12,st)),r.Cb(2),r.oc("ngIf",e.person.external),r.Cb(1),r.oc("disabled",!0))},directives:[u.a,i.t,f.a,Z.a,tt.a,f.b],pipes:[et.b],styles:["[_nghost-%COMP%]{position:relative;display:flex;align-items:center;padding-left:4em;transition:opacity .2s}.not-match[_nghost-%COMP%]{opacity:.35;background-color:#fff}[_nghost-%COMP%]:last-child   .details[_ngcontent-%COMP%]{border:none}.details[_ngcontent-%COMP%]{flex:1;min-width:50%;height:4em;border-bottom:1px solid rgba(0,0,0,.1)}.details[_ngcontent-%COMP%], .icon[_ngcontent-%COMP%]{display:flex;align-items:center}.icon[_ngcontent-%COMP%]{justify-content:center;height:2em;width:2em;margin-right:.5em;border-radius:100%;border:2px dotted rgba(0,0,0,.6);color:rgba(0,0,0,.6);font-size:1.5em}.title[_ngcontent-%COMP%]{flex:1;min-width:1em}.user[_ngcontent-%COMP%]{font-weight:400}.staff[_ngcontent-%COMP%], .user[_ngcontent-%COMP%]{display:flex;align-items:center}.staff[_ngcontent-%COMP%]{justify-content:center;height:1.5em;width:1.5em;margin-right:.5em;border-radius:4px;border:3px solid #1937ea;font-weight:600;font-size:.8em;color:#1937ea}.bar[_ngcontent-%COMP%]{position:absolute;width:1.5em;top:50%;left:2.15em;height:2px;min-height:0;background-color:#999;transform:translateY(-50%)}.empty[_ngcontent-%COMP%]{width:4.5em}"]}),ct);function dt(t,e){if(1&t&&(r.Ub(0),r.Gc(1),r.Wb(2,"span"),r.Gc(3),r.Vb(),r.Tb()),2&t){var n=r.ic(2);r.Cb(1),r.Ic(" ",n.event.start_time," "),r.Cb(2),r.Ic(" - ",n.event.duration>0?n.event.end_time:"","")}}function bt(t,e){1&t&&(r.Ub(0),r.Gc(1,"All Day"),r.Tb())}function ft(t,e){if(1&t&&r.Rb(0,"a-visitor",22),2&t){var n=e.$implicit,i=r.ic(2);r.oc("event",i.event)("person",n)("search",i.search)}}var ut=function(){return{class:"material-icons",content:"event"}},gt=function(){return{class:"material-icons",content:"mail"}},mt=function(){return{class:"material-icons",content:"event_available"}},ht=function(){return{class:"material-icons",content:"edit"}},pt=function(t){return{class:"material-icons",content:t}};function vt(t,e){if(1&t){var n=r.Xb();r.Wb(0,"div",1),r.Wb(1,"div",2),r.Wb(2,"div",3),r.Rb(3,"app-icon",4),r.Vb(),r.Wb(4,"div",5),r.Ec(5,dt,4,2,"ng-container",6),r.Ec(6,bt,2,0,"ng-container",6),r.Vb(),r.Wb(7,"div",7),r.Wb(8,"div",8),r.Gc(9,"S"),r.Vb(),r.Wb(10,"div",9),r.Gc(11),r.Vb(),r.Vb(),r.Wb(12,"div",10),r.Gc(13),r.Vb(),r.Wb(14,"div",11),r.Gc(15),r.Vb(),r.Wb(16,"div",12),r.Gc(17),r.Vb(),r.Wb(18,"div",13),r.Wb(19,"a",14),r.jc(20,"safe"),r.Rb(21,"action-icon",4),r.Vb(),r.Wb(22,"button",15),r.Rb(23,"action-icon",4),r.Vb(),r.Wb(24,"button",16),r.ec("tapped",(function(){return r.wc(n),r.ic().openEditModal()})),r.Rb(25,"action-icon",4),r.Vb(),r.Vb(),r.Wb(26,"div",17),r.Wb(27,"button",18),r.ec("tapped",(function(){r.wc(n);var t=r.ic();return t.show_attendees=!t.show_attendees})),r.Rb(28,"app-icon",4),r.Vb(),r.Vb(),r.Vb(),r.Wb(29,"div",19),r.Rb(30,"div",20),r.Ec(31,ft,1,3,"a-visitor",21),r.Vb(),r.Vb()}if(2&t){var i=r.ic();r.Gb("showing",i.show_attendees),r.Cb(1),r.Gb("blur",i.search),r.Cb(2),r.oc("icon",r.pc(21,ut)),r.Cb(2),r.oc("ngIf",!i.event.all_day),r.Cb(1),r.oc("ngIf",i.event.all_day),r.Cb(5),r.Hc((null==i.event.organiser?null:i.event.organiser.name)||i.event.organiser_email),r.Cb(2),r.Hc(i.event.title),r.Cb(2),r.Hc((null==i.event.space?null:i.event.space.name)||i.event.location),r.Cb(2),r.Hc(i.status),r.Cb(2),r.oc("href",r.lc(20,18,i.mail_url,"url"),r.yc),r.Cb(2),r.oc("icon",r.pc(22,gt)),r.Cb(2),r.oc("icon",r.pc(23,mt)),r.Cb(2),r.oc("icon",r.pc(24,ht)),r.Cb(3),r.oc("icon",r.qc(25,pt,i.show_attendees?"keyboard_arrow_down":"keyboard_arrow_right")),r.Cb(1),r.oc("@show",i.show_attendees?"show":"hide"),r.Cb(2),r.oc("ngForOf",i.event.attendees)}}var _t,Ct=((_t=function(){function t(e){_classCallCheck(this,t),this._dialog=e}return _createClass(t,[{key:"ngOnChanges",value:function(t){t.search&&(this.show_attendees=!!this.search)}},{key:"openEditModal",value:function(){this._dialog.open(A,{data:{booking:this.event}})}},{key:"status",get:function(){var t=this.event.checked_in instanceof Array?this.event.checked_in:[],e=this.event.attendees.reduce((function(e,n){return n.external&&(e.count++,t.indexOf(n.email)>=0&&e.checked_in++),e}),{checked_in:0,count:0}),n=e.checked_in,i=e.count;return"".concat(n," / ").concat(i)}},{key:"mail_url",get:function(){return"mailto:".concat(this.event.attendee_emails.join(","),'?Subject="').concat(this.event.title,'"%20at%20').concat(this.event.start_time,",%20").concat(this.event.date_string)}}]),t}()).\u0275fac=function(t){return new(t||_t)(r.Qb(s.b))},_t.\u0275cmp=r.Kb({type:_t,selectors:[["a-visitor-booking"]],inputs:{event:"event",search:"search"},features:[r.Ab],decls:1,vars:1,consts:[["class","visitor-booking",3,"showing",4,"ngIf"],[1,"visitor-booking"],[1,"details"],[1,"icon"],[3,"icon"],[1,"time"],[4,"ngIf"],[1,"host"],[1,"staff"],[1,"name"],[1,"title"],[1,"location"],[1,"status"],[1,"actions"],["mat-icon-button","","matTooltip","Email Visitors",3,"href"],["mat-icon-button","","matTooltip","Checkin All Visitors"],["mat-icon-button","","matTooltip","Edit Visitors",3,"tapped"],[1,"toggle"],["mat-icon-button","",3,"tapped"],[1,"attendees"],[1,"bar"],[3,"event","person","search",4,"ngFor","ngForOf"],[3,"event","person","search"]],template:function(t,e){1&t&&r.Ec(0,vt,32,27,"div",0),2&t&&r.oc("ngIf",e.event)},directives:[i.t,u.a,f.a,Z.a,tt.a,f.b,p.c,i.s,lt],pipes:[et.b],styles:["[_nghost-%COMP%]{font-size:.9em}.visitor-booking[_ngcontent-%COMP%]{transition:background .2s;background-color:#fff;border-bottom:1px solid rgba(0,0,0,.1)}.showing[_ngcontent-%COMP%]{background-color:#f0f0f0}.showing[_ngcontent-%COMP%]   .toggle[_ngcontent-%COMP%]{color:#1937ea}.details[_ngcontent-%COMP%]{position:relative;z-index:10;display:flex;align-items:center;padding:.5em 0;transition:opacity .2s}.details.blur[_ngcontent-%COMP%]{opacity:.35;background-color:#fff}.details[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:0 .5em}.details[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{width:7.75rem;font-size:.9em}.details[_ngcontent-%COMP%]   .host[_ngcontent-%COMP%]{width:13.25em}.details[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%]{width:12em}.icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:2em;width:2em;border-radius:100%;background-color:#ccc;font-size:1.5em}.time[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:rgba(0,0,0,.65)}.title[_ngcontent-%COMP%]{flex:1;min-width:1em}.host[_ngcontent-%COMP%]{display:flex;align-items:center;font-weight:400}.status[_ngcontent-%COMP%]{font-size:.9em;font-weight:500;width:3.5em}.staff[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:1.5em;width:1.5em;margin-right:.5em;border-radius:4px;border:3px solid #1937ea;font-weight:600;font-size:.8em;color:#1937ea}.attendees[_ngcontent-%COMP%]{position:relative}.attendees[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{position:absolute;top:-.65em;left:2.15em;width:2px;background-color:#999;bottom:2em}.toggle[_ngcontent-%COMP%]{font-size:1.2rem}"],data:{animation:[J.a]}}),_t);function Ot(t,e){1&t&&(r.Wb(0,"div",12),r.Rb(1,"mat-progress-bar",13),r.Vb())}function Pt(t,e){1&t&&(r.Wb(0,"div",16),r.Rb(1,"div",17),r.Vb())}function Mt(t,e){1&t&&(r.Wb(0,"div",16),r.Rb(1,"div",17),r.Vb())}function yt(t,e){if(1&t&&(r.Ub(0),r.Rb(1,"a-visitor-booking",18),r.Ec(2,Mt,2,0,"div",14),r.Tb()),2&t){var n=e.$implicit,i=e.index,o=r.ic(2);r.Cb(1),r.oc("event",n)("search",o.search),r.Cb(1),r.oc("ngIf","Today"===o.date_display&&o.active_index===i)}}function wt(t,e){if(1&t&&(r.Ub(0),r.Ec(1,Pt,2,0,"div",14),r.Ec(2,yt,3,3,"ng-container",15),r.Tb()),2&t){var n=r.ic();r.Cb(1),r.oc("ngIf","Today"===n.date_display&&-1===n.active_index),r.Cb(1),r.oc("ngForOf",n.filtered_bookings)}}var kt=function(){return{class:"material-icons",content:"close"}};function Vt(t,e){if(1&t&&(r.Wb(0,"div",19),r.Wb(1,"div",3),r.Rb(2,"app-icon",20),r.Vb(),r.Wb(3,"div",21),r.Gc(4),r.Vb(),r.Vb()),2&t){var n=r.ic();r.Cb(2),r.oc("icon",r.pc(3,kt)),r.Cb(2),r.Jc("No visitors ",n.search?'matching "'+n.search+'"':""," for ",n.date_display,"")}}var xt,Wt=((xt=function(t){_inherits(n,t);var e=_createSuper(n);function n(t){var i;return _classCallCheck(this,n),(i=e.call(this))._service=t,i.visitor_bookings=[],i.filtered_bookings=[],i.search$=new H.a,i}return _createClass(n,[{key:"ngOnInit",value:function(){var t=this;this._service.Organisation.initialised.pipe(Object(X.a)((function(t){return t}))).subscribe((function(){t.initBookings(),t.subscription("building",t._service.Organisation.listen("active_building").subscribe((function(e){return t.search$.next("".concat(t.date,"|").concat(e.id))}))),t.interval("update_bookings",(function(){return t.search$.next("".concat(t.date,"|").concat(N().unix()))}),3e4)}))}},{key:"ngOnChanges",value:function(t){t.date&&this.search$.next("".concat(this.date)),t.search&&(this.filtered_bookings=this.filter(this.search))}},{key:"filter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=t.toLowerCase();return(this.visitor_bookings||[]).filter((function(t){return t.attendees.find((function(t){return t.name.toLowerCase().indexOf(e)>=0||t.email.toLowerCase().indexOf(e)>=0}))}))}},{key:"initBookings",value:function(){var t=this;this.search_results$=this.search$.pipe(Object(q.a)(100),Object(D.a)(),Object(B.a)((function(e){t.loading=!0;var n=N(t.date).startOf("d");return t._service.Spaces.query({zone_ids:t._service.Organisation.building.id,available_from:n.unix(),available_to:n.endOf("d").unix()})})),Object(K.a)((function(t){return Object($.a)([])})),Object(U.a)((function(e){var n=e.reduce((function(e,n){return e.concat(n.bookingsFor(t.date))}),[]);return n.sort((function(t,e){return t.date-e.date})),n.filter((function(t){return t.has_visitors}))}))),this.subscription("search_results",this.search_results$.subscribe((function(e){t.loading=!1,t.visitor_bookings=e,t.filtered_bookings=t.filter(t.search)})))}},{key:"date_display",get:function(){var t=N(this.date);return t.isSame(N(),"d")?"Today":t.format("DD MMM YYYY")}},{key:"active_index",get:function(){if("Today"===this.date_display){var t=N().startOf("m").valueOf();return this.filtered_bookings.findIndex((function(e){return t>e.date}))}return-1}}]),n}(l.a)).\u0275fac=function(t){return new(t||xt)(r.Qb(b.a))},xt.\u0275cmp=r.Kb({type:xt,selectors:[["visitor-timeline"]],inputs:{date:"date",search:"search"},features:[r.zb,r.Ab],decls:18,vars:3,consts:[[1,"visitor-timeline"],["class","loader",4,"ngIf"],[1,"heading"],[1,"icon"],[1,"time"],[1,"host"],[1,"title"],[1,"location"],[1,"state"],[1,"list"],[4,"ngIf","ngIfElse"],["empty_state",""],[1,"loader"],["mode","indeterminate"],["class","current-line",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"current-line"],[1,"triangle"],[3,"event","search"],[1,"info-block"],[3,"icon"],[1,"text"]],template:function(t,e){if(1&t&&(r.Wb(0,"div",0),r.Ec(1,Ot,2,0,"div",1),r.Wb(2,"div",2),r.Rb(3,"div",3),r.Wb(4,"div",4),r.Gc(5,"Time"),r.Vb(),r.Wb(6,"div",5),r.Gc(7,"Host"),r.Vb(),r.Wb(8,"div",6),r.Gc(9,"Title"),r.Vb(),r.Wb(10,"div",7),r.Gc(11,"Location"),r.Vb(),r.Wb(12,"div",8),r.Gc(13,"Status"),r.Vb(),r.Vb(),r.Wb(14,"div",9),r.Ec(15,wt,3,2,"ng-container",10),r.Vb(),r.Vb(),r.Ec(16,Vt,5,4,"ng-template",null,11,r.Fc)),2&t){var n=r.tc(17);r.Cb(1),r.oc("ngIf",e.loading),r.Cb(14),r.oc("ngIf",e.filtered_bookings&&e.filtered_bookings.length)("ngIfElse",n)}},directives:[i.t,Y.a,i.s,Ct,u.a],styles:[".visitor-timeline[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;height:100%;width:100%;background-color:#ecf1f5}.heading[_ngcontent-%COMP%], a-visitor-booking[_ngcontent-%COMP%]{width:100%;border-bottom:1px solid rgba(0,0,0,.1)}.heading[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;font-weight:400;font-size:.8em;z-index:1}.heading[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{padding:.25em 0;text-transform:capitalize}.heading[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:5.5em}.heading[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{width:10em}.heading[_ngcontent-%COMP%]   .host[_ngcontent-%COMP%]{width:16em}.heading[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{flex:1}.heading[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%]{width:14.25em}.heading[_ngcontent-%COMP%]   .state[_ngcontent-%COMP%]{width:19.25em}.current-line[_ngcontent-%COMP%]{position:relative;width:100%;height:2px;background-color:#1937ea;z-index:99}.current-line[_ngcontent-%COMP%]   .triangle[_ngcontent-%COMP%]{position:absolute;top:50%;left:0;transform:translateY(-50%);width:0;height:0;border-color:transparent transparent transparent #1937ea;border-style:solid;border-width:6px 0 6px 6px}.list[_ngcontent-%COMP%]{min-height:50%;flex:1;width:100%;overflow:auto}.loader[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;right:0;height:4px;z-index:999}"]}),xt),It=function(){return{class:"material-icons",content:"close"}};function Gt(t,e){if(1&t){var n=r.Xb();r.Wb(0,"button",13),r.ec("tapped",(function(){return r.wc(n),r.ic().search_str=""})),r.Rb(1,"app-icon",14),r.Vb()}2&t&&(r.Cb(1),r.oc("icon",r.pc(1,It)))}var Rt,Et=function(){return{class:"material-icons",content:"search"}},jt=((Rt=function(){function t(e,n){_classCallCheck(this,t),this._dialog=e,this._service=n}return _createClass(t,[{key:"ngOnInit",value:function(){}},{key:"newVisitorMeeting",value:function(){var t=N();t=t.minute(5*Math.ceil(t.minute()/5));var e=this._service.Organisation.building,n=this._service.Spaces.item(e.visitor_space||e.holding_bay),i=new c.a(this._service.Bookings,{date:t.valueOf(),duration:-1,room_id:[n.email]});this._dialog.open(A,{data:{booking:i}})}}]),t}()).\u0275fac=function(t){return new(t||Rt)(r.Qb(s.b),r.Qb(b.a))},Rt.\u0275cmp=r.Kb({type:Rt,selectors:[["app-visitors"]],decls:17,vars:9,consts:[[1,"visitors"],[1,"group"],[3,"date","dateChange"],[1,"input-wrapper"],["appearance","outline"],["matPrefix","",3,"icon"],["matInput","","name","visitor-name","placeholder","Search...",3,"ngModel","ngModelChange"],["mat-icon-button","","matSuffix","",3,"tapped",4,"ngIf"],[3,"date","search"],["mat-button","",1,"new-item",3,"touchrelease"],[1,"content"],[1,"material-icons"],[1,"text"],["mat-icon-button","","matSuffix","",3,"tapped"],[3,"icon"]],template:function(t,e){1&t&&(r.Wb(0,"div",0),r.Rb(1,"a-sidebar"),r.Wb(2,"div",1),r.Wb(3,"a-topbar-header",2),r.ec("dateChange",(function(t){return e.date=t}))("dateChange",(function(){return e.search_str=""})),r.Wb(4,"div",3),r.Wb(5,"mat-form-field",4),r.Rb(6,"app-icon",5),r.Wb(7,"input",6),r.ec("ngModelChange",(function(t){return e.search_str=t})),r.Vb(),r.Ec(8,Gt,2,2,"button",7),r.Vb(),r.Vb(),r.Vb(),r.Wb(9,"main"),r.Rb(10,"visitor-timeline",8),r.Vb(),r.Vb(),r.Wb(11,"button",9),r.ec("touchrelease",(function(){return e.newVisitorMeeting()})),r.Wb(12,"div",10),r.Wb(13,"div",11),r.Gc(14,"add"),r.Vb(),r.Wb(15,"div",12),r.Gc(16,"Add Visitors"),r.Vb(),r.Vb(),r.Vb(),r.Vb()),2&t&&(r.Cb(3),r.oc("date",e.date),r.Cb(2),r.Gb("rounded",!0),r.Cb(1),r.oc("icon",r.pc(8,Et)),r.Cb(1),r.oc("ngModel",e.search_str),r.Cb(1),r.oc("ngIf",e.search_str),r.Cb(2),r.oc("date",e.date)("search",e.search_str))},directives:[L.a,Q.a,m.b,u.a,m.h,h.a,a.c,a.r,a.u,i.t,Wt,f.b,p.c,m.i],styles:[".visitors[_ngcontent-%COMP%], [_nghost-%COMP%], main[_ngcontent-%COMP%]{height:100%;width:100%}.visitors[_ngcontent-%COMP%]{display:flex;height:100%}.input-wrapper[_ngcontent-%COMP%]{height:3.5em;padding:0 .5em}.input-wrapper[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{font-size:1.25em}main[_ngcontent-%COMP%]{height:calc(100% - 3.5em)}.group[_ngcontent-%COMP%]{flex:1;min-width:12em}.topbar[_ngcontent-%COMP%]{padding:.1em 0 .1em .5em;height:3.5em}.topbar[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{margin-right:.5em}.new-item[_ngcontent-%COMP%]{position:absolute;bottom:1em;right:1em;z-index:999;cursor:pointer;height:1.5em;min-width:1.5em;padding:0;border-radius:.8em;font-size:1.75em;border:none;transition:padding .2s;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.new-item[_ngcontent-%COMP%], .new-item[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{align-items:center;justify-content:center}.new-item[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex}.new-item[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{width:0;overflow:hidden;opacity:0;transition:width .2s,opacity .2s;font-size:1.2rem}.new-item[_ngcontent-%COMP%]:hover{padding:0 .5em}.new-item[_ngcontent-%COMP%]:hover   .text[_ngcontent-%COMP%]{width:7em;opacity:1}"]}),Rt),zt=n("PCNd");n.d(e,"VisitorsModule",(function(){return St}));var Tt,Ft=[{path:"",component:jt},{path:":level",component:jt},{path:"**",redirectTo:""}],St=((Tt=function t(){_classCallCheck(this,t)}).\u0275mod=r.Ob({type:Tt}),Tt.\u0275inj=r.Nb({factory:function(t){return new(t||Tt)},imports:[[i.c,a.l,a.B,o.g.forChild(Ft),zt.a]]}),Tt)}}]);