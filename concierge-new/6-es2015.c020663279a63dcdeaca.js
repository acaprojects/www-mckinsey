(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{QM1m:function(e,t,n){"use strict";n.r(t);var i=n("ofXK"),o=n("tyNb"),c=n("IWZj"),s=n("SxV6"),a=n("xUvU"),r=n("xhdr"),l=n("fXoL"),d=n("OaWH"),g=n("0IaG"),b=n("BAfr"),h=n("ocbO"),p=n("kmnG"),v=n("d3UM"),f=n("3Pt+"),u=n("1jcm"),_=n("TnpO"),m=n("Wgwc"),C=n("m6yr"),O=n("bv9b"),M=n("5+WD"),w=n("g+Po"),P=n("9Kh7"),y=n("0njA"),x=n("Xa2L"),k=n("bTqV");const V=function(e){return{class:"material-icons",content:e}};function W(e,t){if(1&e&&l.Rb(0,"app-icon",18),2&e){const e=l.ic(2);l.oc("icon",l.qc(1,V,e.event.approved?"done":e.event.declined?"event_busy":""))}}function E(e,t){1&e&&l.Rb(0,"mat-spinner",19)}function I(e,t){if(1&e&&(l.Wb(0,"div",20),l.Wb(1,"div",10),l.Gc(2,"Booked by:\xa0"),l.Vb(),l.Wb(3,"div",11),l.Gc(4),l.Vb(),l.Vb()),2&e){const e=l.ic(2);l.Cb(3),l.oc("title","Booked By: "+((null==e.event.creator?null:e.event.creator.name)||e.event.creator)),l.Cb(1),l.Ic(" ",(null==e.event.creator?null:e.event.creator.name)||e.event.creator," ")}}function D(e,t){if(1&e&&(l.Wb(0,"div",21),l.Wb(1,"div",14),l.Gc(2),l.Vb(),l.Vb()),2&e){const e=l.ic(2);l.oc("title","Welcomed by: "+e.event.notify_users[0]),l.Cb(2),l.Ic("Welcomed by: ",e.event.notify_users[0],"")}}function G(e,t){1&e&&(l.Wb(0,"div",13),l.Wb(1,"div",14),l.Gc(2,"Catered"),l.Vb(),l.Vb())}const z=function(){return{class:"material-icons",content:"restaurant"}};function R(e,t){if(1&e){const e=l.Xb();l.Wb(0,"button",22),l.ec("touchrelease",(function(){l.wc(e);const t=l.ic(2);return t.viewOrder(t.order.id)})),l.Rb(1,"app-icon",18),l.Vb()}2&e&&(l.Cb(1),l.oc("icon",l.pc(1,z)))}function S(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div",1),l.Rb(1,"div"),l.Wb(2,"div",2),l.ec("touchrelease",(function(){return l.wc(e),l.ic().view()})),l.Wb(3,"div",3),l.Wb(4,"div",4),l.Gc(5),l.Vb(),l.Wb(6,"div",5),l.Ec(7,W,1,3,"app-icon",6),l.Ec(8,E,1,0,"mat-spinner",7),l.Vb(),l.Vb(),l.Wb(9,"div",8),l.Wb(10,"div",9),l.Wb(11,"div",10),l.Gc(12,"Host:\xa0"),l.Vb(),l.Wb(13,"div",11),l.Gc(14),l.Vb(),l.Vb(),l.Ec(15,I,5,2,"div",12),l.Wb(16,"div",13),l.Wb(17,"div",11),l.Gc(18),l.Vb(),l.Vb(),l.Wb(19,"div",13),l.Wb(20,"div",14),l.Gc(21),l.Vb(),l.Vb(),l.Ec(22,D,3,2,"div",15),l.Ec(23,G,3,0,"div",16),l.Vb(),l.Vb(),l.Ec(24,R,2,2,"button",17),l.Vb()}if(2&e){const e=l.ic();l.Dc("top",e.top+"%")("left",e.left+"%")("width",e.fixed?"15rem":e.width+"%")("height",e.fixed?3*e.height+"rem":e.height+"%"),l.Gb("fixed",e.fixed)("inactive",!e.active),l.oc("id","event-"+e.event.local_id),l.Cb(1),l.Eb("overflow"+(e.type?" "+e.type:"")),l.Dc("top",0-e.overflow_top+"%")("bottom",0-e.overflow_bottom+"%"),l.Cb(1),l.Eb("event"+(e.type?" "+e.type:"")+(e.top>50?" low":"")),l.Dc("z-index",((null==e.overlap?null:e.overlap.index)||0)+2),l.Cb(3),l.Hc(e.event.all_day?"All Day":e.period),l.Cb(2),l.oc("ngIf",!e.loading&&(e.event.declined||e.event.approved)),l.Cb(1),l.oc("ngIf",e.loading),l.Cb(5),l.oc("title","Host: "+((null==e.event.organiser?null:e.event.organiser.name)||e.event.organiser)),l.Cb(1),l.Ic(" ",(null==e.event.organiser?null:e.event.organiser.name)||e.event.organiser," "),l.Cb(1),l.oc("ngIf",e.event.creator&&e.event.creator.email!==e.event.organiser.email),l.Cb(2),l.oc("title","Title: "+e.event.title),l.Cb(1),l.Hc(e.event.title),l.Cb(3),l.Kc(" ",e.event.attendees&&e.event.attendees.length||"No"," Attendee",1===(null==e.event.attendees?null:e.event.attendees.length)?"":"s","",e.expected?"("+e.expected+" Expected)":""," "),l.Cb(1),l.oc("ngIf",e.event.notify_users),l.Cb(1),l.oc("ngIf",e.has_catering),l.Cb(1),l.oc("ngIf",e.has_catering)}}let B=(()=>{class e extends c.a{constructor(e,t,n){super(),this._service=e,this._dialog=t,this._router=n,this.position=new l.o}get type(){if(!this.event||!this.event.type)return"";if(this.event.declined)return"cancelled";const e=this.event.type;return"internal"===e&&this.event.has_visitors?"external":e}get period(){return`${this.event?this.event.time_period:""}`}get expected(){return this.space&&(this.event.expected_attendees||{})[this.space.id]||0}get has_catering(){return!!this.event&&!!(this.event.catering||[]).find(e=>this.event.space.id===e.location_id)}get order(){return(this.event.catering||[]).find(e=>e.location_id===this.space.id)}view(){this._dialog.open(_.a,{maxHeight:"95vh",maxWidth:"95vw",data:{booking:this.event}})}get active(){const e=this._service.get("CONCIERGE.day_view.viewing");return!e||e.id===this.event.id}ngOnChanges(e){(e.event||e.overlap||e.date)&&this.calculatePosition()}viewOrder(e){if(this.event&&this.event.catering){if(sessionStorage){sessionStorage.setItem("CONCIERGE.view_order",e);const t=JSON.stringify(Object.assign(Object.assign({},this.event),{room:Object.assign(Object.assign({},this.space),{bookings:[]})}));sessionStorage.setItem("CONCIERGE.order_booking",t)}this._router.navigate(["/catering","orders"],{queryParams:{booking:this.event.id,view:e}})}}calculatePosition(){if(this.event){const e=this.overlap||{index:0,total:1},t=m(this.date).startOf("d"),n=m(this.event.date).startOf("m"),i=+n.diff(t,"h",!0).toFixed(3),o=Math.min(this.event.duration,Math.abs(t.diff(n.add(this.event.duration,"m"),"m")));this.top=Math.max(0,i/24*100),this.height=Math.min(100-this.top,this.fixed?o/60:o/60/24*100),this.position.emit({top:this.top,height:o/60/24*100}),this.width=Math.min(100,100/e.total+5),this.left=Math.min(100-this.width,this.width*e.index-5*e.index),this.overflow_top=100*(this.event.setup?this.event.setup/o:-.1),this.overflow_bottom=100*(this.event.breakdown?this.event.breakdown/o:-.1)}}}return e.\u0275fac=function(t){return new(t||e)(l.Qb(d.a),l.Qb(g.b),l.Qb(o.c))},e.\u0275cmp=l.Kb({type:e,selectors:[["day-view-space-event"]],inputs:{event:"event",date:"date",space:"space",fixed:"fixed",overlap:"overlap",loading:"loading"},outputs:{position:"position"},features:[l.zb,l.Ab],decls:1,vars:1,consts:[["class","event-container",3,"id","fixed","inactive","top","left","width","height",4,"ngIf"],[1,"event-container",3,"id"],[3,"touchrelease"],[1,"header"],[1,"text"],[1,"handle"],[3,"icon",4,"ngIf"],["diameter","16",4,"ngIf"],[1,"body"],[1,"field","host"],[1,"label"],[1,"value",3,"title"],["class","field booked-by",4,"ngIf"],[1,"field"],[1,"value"],["class","field",3,"title",4,"ngIf"],["class","field",4,"ngIf"],["class","catering-icon","mat-icon-button","",3,"touchrelease",4,"ngIf"],[3,"icon"],["diameter","16"],[1,"field","booked-by"],[1,"field",3,"title"],["mat-icon-button","",1,"catering-icon",3,"touchrelease"]],template:function(e,t){1&e&&l.Ec(0,S,25,37,"div",0),2&e&&l.oc("ngIf",t.event)},directives:[i.t,C.c,y.a,x.c,k.b],styles:[".event-container[_ngcontent-%COMP%]{position:absolute;pointer-events:auto;transition:-webkit-filter .2s;transition:filter .2s;transition:filter .2s,-webkit-filter .2s}.event-container[_ngcontent-%COMP%]:hover{-webkit-filter:none;filter:none}.event-container[_ngcontent-%COMP%]:hover   .catering-icon[_ngcontent-%COMP%]{z-index:999}.event-container[_ngcontent-%COMP%]:hover   .event[_ngcontent-%COMP%]{z-index:999!important;bottom:auto;min-height:100%;left:5px;right:5px}.event-container[_ngcontent-%COMP%]:hover   .event.low[_ngcontent-%COMP%]{bottom:0;top:auto}.event-container.fixed[_ngcontent-%COMP%]:hover   .event[_ngcontent-%COMP%]{z-index:999!important;top:0;left:1px;right:1px;bottom:0}.overflow[_ngcontent-%COMP%]{position:absolute;top:2px;left:2px;right:2px;bottom:2px;border-radius:4px;background-color:rgba(31,64,230,.2)}.overflow.internal[_ngcontent-%COMP%]{background-color:rgba(230,159,199,.2)}.overflow.external[_ngcontent-%COMP%]{background-color:rgba(140,90,200,.2)}.overflow.training[_ngcontent-%COMP%]{background-color:rgba(240,231,0,.2)}.overflow.interview[_ngcontent-%COMP%]{background-color:rgba(52,141,2,.2)}.overflow.setup[_ngcontent-%COMP%]{background-color:rgba(211,47,47,.2)}.overflow.cancelled[_ngcontent-%COMP%]{background-color:rgba(97,114,136,.2)}.event[_ngcontent-%COMP%]{position:absolute;overflow:hidden;top:0;left:1px;right:1px;bottom:0;border-radius:4px;background-color:#fff;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12);transition:bottom .2s,top .2s,left .2s,right .2s;border:1px solid #1f40e6}.event[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:#1f40e6}.event[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{background-color:rgba(31,64,230,.2)}.event.pending[_ngcontent-%COMP%]{border-color:rgba(31,64,230,.4)}.event.pending[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:rgba(31,64,230,.4)}.event.internal[_ngcontent-%COMP%]{border-color:#e69fc7}.event.internal[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:#e69fc7}.event.internal[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{background-color:rgba(230,159,199,.2)}.event.internal.pending[_ngcontent-%COMP%]{border-color:rgba(230,159,199,.4)}.event.internal.pending[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:rgba(230,159,199,.4)}.event.external[_ngcontent-%COMP%]{border-color:#8c5ac8}.event.external[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:#8c5ac8}.event.external[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{background-color:rgba(140,90,200,.2)}.event.external.pending[_ngcontent-%COMP%]{border-color:rgba(140,90,200,.4)}.event.external.pending[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:rgba(140,90,200,.4)}.event.training[_ngcontent-%COMP%]{border-color:#f0e700}.event.training[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:#f0e700}.event.training[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{background-color:rgba(240,231,0,.2)}.event.training.pending[_ngcontent-%COMP%]{border-color:rgba(240,231,0,.4)}.event.training.pending[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:rgba(240,231,0,.4)}.event.interview[_ngcontent-%COMP%]{border-color:#348d02}.event.interview[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:#348d02}.event.interview[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{background-color:rgba(52,141,2,.2)}.event.interview.pending[_ngcontent-%COMP%]{border-color:rgba(52,141,2,.4)}.event.interview.pending[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:rgba(52,141,2,.4)}.event.setup[_ngcontent-%COMP%]{border-color:#d32f2f}.event.setup[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:#d32f2f}.event.setup[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{background-color:rgba(211,47,47,.2)}.event.setup.pending[_ngcontent-%COMP%]{border-color:rgba(211,47,47,.4)}.event.setup.pending[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:rgba(211,47,47,.4)}.event.cancelled[_ngcontent-%COMP%]{border-color:#617288}.event.cancelled[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:#617288}.event.cancelled[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{background-color:rgba(97,114,136,.2)}.event.cancelled.pending[_ngcontent-%COMP%]{border-color:rgba(97,114,136,.4)}.event.cancelled.pending[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:rgba(97,114,136,.4)}.inactive[_ngcontent-%COMP%]{-webkit-filter:blur(1px) grayscale(80%);filter:blur(1px) grayscale(80%)}.header[_ngcontent-%COMP%]{display:flex;align-items:center;height:1.5em}.header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-size:.8em;padding:1em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;min-width:50%}.handle[_ngcontent-%COMP%]{height:100%;width:1.8em;background-color:#1f40e6;color:#fff;display:flex;align-items:center;justify-content:center}.body[_ngcontent-%COMP%]{padding:1em;font-size:.8em}.field[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:.5em}.field[_ngcontent-%COMP%]:last-child{margin:none}.host[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-style:italic}.catering-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;position:absolute;bottom:-4px;right:4px;height:2.5em;width:2.5em;background-color:#fff;border:1px solid #ccc;z-index:100;font-size:.6em}spinner[_ngcontent-%COMP%]{font-size:.3em}"]}),e})();const F=["view"];function $(e,t){if(1&e&&(l.Wb(0,"div",9),l.Wb(1,"div",10),l.Rb(2,"day-view-space-event",11),l.Vb(),l.Vb()),2&e){const e=l.ic().$implicit,t=l.ic();l.Cb(2),l.oc("fixed",!0)("space",t.space)("event",e)}}function j(e,t){if(1&e&&l.Rb(0,"div",12),2&e){const e=l.ic().$implicit,t=l.ic();l.Dc("top",(t.top||(t.position_list[e.id]?t.position_list[e.id].top:0))+"%")("height",(t.position_list[e.id]?t.position_list[e.id].height:100)+"%")}}function T(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div",5),l.ec("cdkDragStarted",(function(){return l.wc(e),l.ic().initDrag()}))("cdkDragMoved",(function(t){return l.wc(e),l.ic().updateDragTop(t)}))("cdkDragReleased",(function(){return l.wc(e),l.ic().endDrag()})),l.Wb(1,"day-view-space-event",6),l.ec("position",(function(n){l.wc(e);const i=t.$implicit,o=l.ic();return o.position_list?o.position_list[i.id]=n:""})),l.Vb(),l.Ec(2,$,3,3,"div",7),l.Ec(3,j,1,4,"div",8),l.Vb()}if(2&e){const e=t.$implicit,n=l.ic();l.Dc("display",!1!==n.in_view?"":"none"),l.oc("cdkDragDisabled","upcoming"!==e.status||e.declined||!n.settings.dragdrop),l.Cb(1),l.oc("space",n.space)("date",n.date)("event",e)("loading",n.loading?n.loading[e.id]:null)("overlap",n.overlap_details?n.overlap_details[e.id]:null)}}function A(e,t){1&e&&(l.Wb(0,"div",13),l.Wb(1,"div",14),l.Gc(2,"Moving meeting"),l.Vb(),l.Wb(3,"div",15),l.Rb(4,"mat-spinner",16),l.Vb(),l.Vb())}const L=function(){return[]},N=function(e,t){return{top:e,list:t}};let H=(()=>{class e extends c.a{constructor(e,t){super(),this._service=e,this._dialog=t,this.legend={},this.inView=new l.o,this.dragging=new l.o,this.overlap_details={},this.position_list={},this.settings={}}get events(){return this.space?(this.space.bookingsFor(this.date)||[]).filter(e=>(this.override_state&&this.override_state===e.icaluid&&(this.loading[e.id]=!0),e.declined?(!this.overflow_only||e.setup||e.breakdown)&&this.legend.declined:(!this.overflow_only||e.setup||e.breakdown)&&this.legend[e.type])):[]}ngOnInit(){this._service.initialised.pipe(Object(s.a)(e=>e)).subscribe(()=>{this.settings=this._service.setting("app.day_view")||{},this.subscription("breakdown",this._service.listen("APP.breakdown",e=>{this.overflow_only=e})),this.subscription("legend",this._service.listen("CONCIERGE.legend",e=>{this.legend=e||{}}))})}ngOnChanges(e){e.scroll&&this.checkInView(),e.last_update&&this.timeout("update_overlaps",()=>this.calculateOverlaps(),1e3)}trackByFn(e,t){return t.id||e}calculateOverlaps(){const e=this.events.sort((e,t)=>e.date-t.date||e.duration-t.duration||(e.title||"").localeCompare(t.title||""));e.forEach(e=>this.overlap_details[e.id]={index:0,total:1});for(const t of e){const n=m(t.date).startOf("m"),i=m(n).add(t.duration,"m").startOf("m");let o=1,c=0;const s=[];for(const a of e)if(t.id!==a.id){const r=m(a.date).startOf("m"),l=m(r).add(a.duration,"m").startOf("m");(n.isSame(r,"m")||n.isAfter(r,"m")&&n.isBefore(l,"m")||i.isSame(l,"m")||i.isAfter(r,"m")&&i.isBefore(l,"m"))&&(o++,s.push(t),e.findIndex(e=>e.id===t.id)>e.findIndex(e=>e.id===a.id)&&c++)}this.overlap_details[t.id]={index:Math.max(0,c),total:o}}}checkInView(){if(this.view&&this.view.nativeElement){const e=this.view.nativeElement;this.in_view=e.offsetLeft+this.scroll>=-240&&e.offsetLeft+this.scroll<=window.innerWidth,this.inView.emit(this.in_view)}}initDrag(){this.box=this.view.nativeElement.getBoundingClientRect(),console.log("Drag Start"),this.dragging.emit(!0)}endDrag(){this.timeout("end_drag",()=>this.top=0,10),console.log("Drag End"),this.dragging.emit(!1)}updateDragTop(e){if(e.delta.y){const t=15*Math.round((e.pointerPosition.y-this.box.top-this.scroll_top)/this.box.height*24*60/15)/60;this.top=t/24*100}}drop(e){const t=e.item.element.nativeElement.id,n=e.previousContainer.data.list.find(e=>e.id===t);if(!n)return;const i=Math.round((e.previousContainer.data.top||0)/100*24*60),o=m(n.date),c=o.startOf("d").minute(i);if(m().startOf("m").isAfter(c,"m"))return this._service.notifyError("Meetings cannot be moved into the past");this.loading[n.id]=!0,this.override_state=n.icaluid;let s=n.space,a=`Update ${n.organiser.name}'s meeting in "${(n.space||{}).name}" from ${o.format("h:mm A")} to ${c.format("h:mm A")}`,r=`Successfully updated meeting time from ${o.format("h:mm A")} to ${c.format("h:mm A")}`,l=Object.assign(Object.assign({},n),{old_date:n.date,date:c.valueOf()});if(e.container!==e.previousContainer&&(s=this._service.Spaces.item(e.container.id.replace("space-col-","")),l.from_room=n.space.email,a=`Move ${n.organiser.name}'s meeting in "${(n.space||{}).name}" to "${s.name}" at ${c.format("h:mm A")}`,r=`Successfully moved booking to "${s.name}" at ${c.format("h:mm A")}`),s===n.space&&c.isSame(o,"m"))return this.loading[n.id]=!1,void(this.override_state=null);const d=[s,...n.space_list.filter(e=>e.id!==n.space.id)];if(d.reduce((e,t)=>e.add(t.id),new Set).size<d.length)return this.loading[n.id]=!1,this.override_state=null,this._service.notifyError("The meeting is already in this room");l.space=d,this.checkCollisions(d,c.valueOf(),n.duration,n.icaluid).then(()=>{this.moveBooking(a,l).then(e=>{this.override_state=null,this._service.notifySuccess(r)},e=>{this.loading[n.id]=!1,this.override_state=null,"User cancelled"!==e&&this._service.notifyError(`Error: ${e}`)})},()=>{this.loading[n.id]=!1,this.override_state=null,this._service.notifyError("Updated meeting time clashes with another")})}checkCollisions(e,t,n,i){return new Promise((o,c)=>{this._service.Spaces.available({room_ids:e.map(e=>e.id).join(","),date:t,duration:n,ignore:i,hide_bookings:!0}).then(t=>{t.length===e.length?o():c()},()=>c())})}moveBooking(e,t){return new Promise((n,i)=>{const o=this._dialog.open(w.b,{data:{title:"Update meeting",content:e,icon:{type:"icon",class:"material-icons",content:"event_available"},action:"Ok"}});this.subscription("confirm",o.componentInstance.event.subscribe(e=>{"done"===e.reason&&t.save().then(e=>n(e),e=>i(e)),o.close()})),o.afterClosed().subscribe(()=>this.unsub("confirm"))})}}return e.\u0275fac=function(t){return new(t||e)(l.Qb(d.a),l.Qb(g.b))},e.\u0275cmp=l.Kb({type:e,selectors:[["day-view-space"]],viewQuery:function(e,t){var n;1&e&&l.Cc(F,!0),2&e&&l.sc(n=l.fc())&&(t.view=n.first)},inputs:{space_list:"space_list",date:"date",space:"space",scroll:"scroll",overflow_only:"overflow_only",legend:"legend",scroll_top:["scrollTop","scroll_top"],last_update:["lastUpdate","last_update"]},outputs:{inView:"inView",dragging:"dragging"},features:[l.zb,l.Ab],decls:5,vars:10,consts:[["cdkDropList","","cdkDropListSortingDisabled","","scrollContainer","#day-view-scroll",1,"space-display",3,"cdkDropListConnectedTo","cdkDropListData","id","cdkDropListDropped"],["view",""],["cdkDrag","",1,"drop-zone"],["cdkDrag","",3,"display","cdkDragDisabled","cdkDragStarted","cdkDragMoved","cdkDragReleased",4,"ngFor","ngForOf","ngForTrackBy"],["class","moving",4,"ngIf"],["cdkDrag","",3,"cdkDragDisabled","cdkDragStarted","cdkDragMoved","cdkDragReleased"],[3,"space","date","event","loading","overlap","position"],["class","event-preview",4,"cdkDragPreview"],["class","event-placeholder",3,"top","height",4,"cdkDragPlaceholder"],[1,"event-preview"],[1,"content"],[3,"fixed","space","event"],[1,"event-placeholder"],[1,"moving"],[1,"text"],[1,"spinner"],["diameter","32"]],template:function(e,t){1&e&&(l.Wb(0,"div",0,1),l.ec("cdkDropListDropped",(function(e){return t.drop(e)})),l.Rb(2,"div",2),l.Ec(3,T,4,8,"div",3),l.Vb(),l.Ec(4,A,5,0,"div",4)),2&e&&(l.oc("cdkDropListConnectedTo",t.space_list||l.pc(6,L))("cdkDropListData",l.rc(7,N,t.top,t.events))("id","space-col-"+(null==t.space?null:t.space.id)),l.Cb(3),l.oc("ngForOf",t.events)("ngForTrackBy",t.trackByFn),l.Cb(1),l.oc("ngIf",t.override_state))},directives:[M.e,P.a,M.a,i.s,i.t,B,M.d,M.c,x.c],styles:[".space-display[_ngcontent-%COMP%]{position:relative;height:100%;width:100%;overflow:hidden;pointer-events:auto}.event-preview[_ngcontent-%COMP%], .space-display[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{pointer-events:none}.event-placeholder[_ngcontent-%COMP%]{position:absolute;width:calc(100% - .5em);margin:0 .25em;border:3px dashed #969696;background-color:rgba(0,0,0,.2);border-radius:4px;transform:none!important;z-index:99999}.drop-zone[_ngcontent-%COMP%]{position:relative;height:100%;width:100%;pointer-events:none}.cdk-drag[_ngcontent-%COMP%], .drop-zone[_ngcontent-%COMP%]{transform:none!important}.cdk-drag[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.cdk-drag-disabled[_ngcontent-%COMP%]{cursor:auto}.moving[_ngcontent-%COMP%]{position:fixed;bottom:1.5em;left:50%;transform:translateX(-50%);padding:.5em 1em;border-radius:1.5em;display:flex;align-items:center;background-color:#fff;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12);z-index:999}.moving[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{margin-left:.5em}.moving[_ngcontent-%COMP%]   spinner[_ngcontent-%COMP%]{font-size:.25em}"]}),e})();var Q=n("R0Ic"),Y=n("4kJo"),X=n("q/DJ");function U(e,t){1&e&&l.Rb(0,"div")}const q=function(){return{class:"material-icons",content:"email"}},K=function(){return{class:"material-icons",content:"phone"}};function J(e,t){if(1&e&&(l.Wb(0,"div",19),l.Wb(1,"label"),l.Gc(2,"Booked by:"),l.Vb(),l.Wb(3,"div",20),l.Wb(4,"div",7),l.Gc(5),l.Vb(),l.Wb(6,"div",21),l.Wb(7,"a",22),l.Rb(8,"app-icon",9),l.Vb(),l.Wb(9,"a",22),l.Rb(10,"app-icon",9),l.Vb(),l.Vb(),l.Vb(),l.Vb()),2&e){const e=l.ic(3);l.Cb(5),l.Hc(null==e.event.creator?null:e.event.creator.name),l.Cb(2),l.oc("href","mailto:"+(null==e.event.creator?null:e.event.creator.email),l.yc)("disabled",!(null!=e.event.creator&&e.event.creator.email)),l.Cb(1),l.oc("icon",l.pc(7,q)),l.Cb(1),l.oc("href","tel:"+(null==e.event.creator?null:e.event.creator.phone),l.yc)("disabled",!(null!=e.event.creator&&e.event.creator.phone)),l.Cb(1),l.oc("icon",l.pc(8,K))}}function Z(e,t){if(1&e&&(l.Wb(0,"div",26),l.Gc(1),l.Vb()),2&e){const e=t.$implicit;l.Cb(1),l.Hc(e.name)}}function ee(e,t){if(1&e&&(l.Wb(0,"div",19),l.Wb(1,"label"),l.Gc(2,"Notes:"),l.Vb(),l.Rb(3,"div",27),l.jc(4,"safe"),l.Vb()),2&e){const e=l.ic(3);l.Cb(3),l.oc("innerHTML",l.kc(4,1,e.description||""),l.xc)}}function te(e,t){if(1&e&&(l.Wb(0,"div",18),l.Wb(1,"div",19),l.Wb(2,"label"),l.Gc(3,"Host:"),l.Vb(),l.Wb(4,"div",20),l.Wb(5,"div",7),l.Gc(6),l.Vb(),l.Wb(7,"div",21),l.Wb(8,"a",22),l.Rb(9,"app-icon",9),l.Vb(),l.Wb(10,"a",22),l.Rb(11,"app-icon",9),l.Vb(),l.Vb(),l.Vb(),l.Vb(),l.Ec(12,J,11,9,"div",23),l.Wb(13,"div",24),l.Wb(14,"label"),l.Gc(15,"Attendees:"),l.Vb(),l.Wb(16,"div",20),l.Ec(17,Z,2,1,"div",25),l.Vb(),l.Vb(),l.Wb(18,"div",19),l.Wb(19,"label"),l.Gc(20,"Welcomed by:"),l.Vb(),l.Wb(21,"div",20),l.Gc(22),l.Vb(),l.Vb(),l.Wb(23,"div",19),l.Wb(24,"label"),l.Gc(25,"Catering:"),l.Vb(),l.Wb(26,"div",20),l.Gc(27),l.Vb(),l.Vb(),l.Ec(28,ee,5,3,"div",23),l.Vb()),2&e){const e=l.ic(2);l.oc("@show",void 0),l.Cb(6),l.Hc(null==e.event.organiser?null:e.event.organiser.name),l.Cb(2),l.oc("href","mailto:"+(null==e.event.organiser?null:e.event.organiser.email),l.yc)("disabled",!(null!=e.event.organiser&&e.event.organiser.email)),l.Cb(1),l.oc("icon",l.pc(13,q)),l.Cb(1),l.oc("href","tel:"+(null==e.event.organiser?null:e.event.organiser.phone),l.yc)("disabled",!(null!=e.event.organiser&&e.event.organiser.phone)),l.Cb(1),l.oc("icon",l.pc(14,K)),l.Cb(1),l.oc("ngIf",e.event.creator&&e.event.organiser&&e.event.organiser.email!==e.event.creator.email),l.Cb(5),l.oc("ngForOf",e.event.attendees),l.Cb(5),l.Hc(e.notifyee),l.Cb(5),l.Hc(e.has_catering?"Catered":"No Catering"),l.Cb(1),l.oc("ngIf",e.description)}}function ne(e,t){1&e&&(l.Wb(0,"div",28),l.Wb(1,"div",29),l.Wb(2,"div",30),l.Rb(3,"mat-spinner",31),l.Vb(),l.Wb(4,"div",7),l.Gc(5,"Processing request..."),l.Vb(),l.Vb(),l.Vb())}const ie=function(){return{class:"material-icons",content:"search"}},oe=function(e){return{class:"material-icons",content:e}};function ce(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div"),l.Wb(1,"div",1),l.Wb(2,"div",2),l.Rb(3,"a-user-avatar",3),l.Vb(),l.Wb(4,"div",4),l.Wb(5,"div",5),l.Gc(6),l.Ec(7,U,1,0,"div",6),l.Vb(),l.Wb(8,"div",7),l.Gc(9),l.Vb(),l.Vb(),l.Wb(10,"button",8),l.ec("touchrelease",(function(){return l.wc(e),l.ic().view()})),l.Rb(11,"app-icon",9),l.Vb(),l.Vb(),l.Wb(12,"div",10),l.Wb(13,"div",11),l.Rb(14,"div",12),l.Wb(15,"app-icon",13),l.ec("touchrelease",(function(){l.wc(e);const t=l.ic();return t.shown=!t.shown})),l.Vb(),l.Rb(16,"div",12),l.Vb(),l.Ec(17,te,29,15,"div",14),l.Vb(),l.Wb(18,"div",15),l.Wb(19,"button",16),l.ec("touchrelease",(function(){return l.wc(e),l.ic().accept()})),l.Gc(20),l.Vb(),l.Wb(21,"button",16),l.ec("touchrelease",(function(){return l.wc(e),l.ic().decline()})),l.Gc(22),l.Vb(),l.Vb(),l.Ec(23,ne,6,0,"div",17),l.Vb()}if(2&e){const e=l.ic();l.Eb("approval-event"+(e.type?" "+e.type:"")),l.Db("event-id",e.event.id),l.Cb(3),l.oc("user",e.event.organiser),l.Cb(3),l.Jc(" ",e.event.all_day?"All Day":e.event.start_time+" - "+e.event.end_time," ",e.event.space?"in "+e.event.space.name:""," "),l.Cb(1),l.oc("ngIf",e.was_edited),l.Cb(2),l.Ic("",e.event.title," "),l.Cb(2),l.oc("icon",l.pc(18,ie)),l.Cb(4),l.oc("icon",l.qc(19,oe,"keyboard_arrow_"+(e.shown?"up":"down"))),l.Cb(2),l.oc("ngIf",e.shown),l.Cb(2),l.Gb("accepted",e.event.approved),l.Cb(1),l.Ic(" Accept",e.event.approved?"ed":""," "),l.Cb(1),l.Gb("declined",e.event.declined),l.Cb(1),l.Ic(" Decline",e.event.declined?"d":""," "),l.Cb(1),l.oc("ngIf",e.loading)}}const se={};let ae=(()=>{class e extends c.a{constructor(e,t){super(),this._service=e,this._dialog=t,this.acting=new l.o}get was_edited(){return this.event&&this.event.edits.length>0}get type(){return this.event?this.event.type:""}get notifyee(){return"Concierge"}get description(){return this.event&&this.event.notes?(this.event.notes.find(e=>"description"===e.type)||{message:""}).message:""}get has_catering(){return!!this.event&&!!(this.event.catering||[]).find(e=>this.event.space.id===e.location_id)}view(){this.timeout("view",()=>{this._dialog.open(_.a,{data:{booking:this.event}}),this._service.set("CONCIERGE.day_view.viewing",this.event)},50)}accept(){this.acting.emit(!0);const e=this._dialog.open(w.b,{data:{title:"Approve Meeting",content:`Approve ${this.event.organiser.name||this.event.organiser}'s meeting in "${this.event.space.name}" at ${this.event.start_time} for ${this.event.length_string} on ${this.event.date_string}`,icon:{type:"icon",class:"material-icons",content:"event_available"},action:"Ok"}});e.componentInstance.event.subscribe(t=>{"done"===t.reason&&(this.loading=!0,this._service.Bookings.accept(this.event.id,{comment:"",room_id:this.event.space.id}).then(()=>{this._service.notifySuccess("Meeting approved."),this.event.approval_status[this.event.space.id]="accepted",se[this.event.id]="accepted",this._service.set("BOOKING.states",se),this.loading=!1,this.acting.emit(!1)},()=>{this.acting.emit(!1),this._service.notifyError("Error approving meeting."),this.loading=!1})),e.close()})}decline(){this.acting.emit(!0);const e=this._dialog.open(w.b,{data:{title:"Decline Meeting",content:`Decline ${this.event.organiser.name||this.event.organiser}'s meeting in "${this.event.space.name}" at ${this.event.start_time} for ${this.event.length_string} on ${this.event.date_string}`,icon:{type:"icon",class:"material-icons",content:"event_busy"},action:"Ok"}});e.componentInstance.event.subscribe(t=>{if("done"===t.reason){this.loading=!0;const e=this.event;this.loading=!0,this._service.Bookings.decline(e.id,{booking_id:e.id,organiser:e.organiser.email,icaluid:e.icaluid,start:Math.floor(e.date/1e3),end:Math.floor(e.date/1e3)+60*e.duration,room_id:e.space.id}).then(()=>{this._service.notifySuccess("Meeting declined."),this.event.approval_status[e.space.id]="declined",se[this.event.id]="declined",this._service.set("BOOKING.states",se),this.loading=!1,this.acting.emit(!1)},()=>{this.acting.emit(!1),this._service.notifyError("Error declining meeting."),this.loading=!1})}e.close()})}}return e.\u0275fac=function(t){return new(t||e)(l.Qb(d.a),l.Qb(g.b))},e.\u0275cmp=l.Kb({type:e,selectors:[["approvals-event"]],inputs:{event:"event"},outputs:{acting:"acting"},features:[l.zb],decls:1,vars:1,consts:[[3,"class",4,"ngIf"],[1,"header"],[1,"avatar"],[3,"user"],[1,"details"],[1,"text","bold"],[4,"ngIf"],[1,"text"],["mat-icon-button","",1,"search",3,"touchrelease"],[3,"icon"],[1,"body"],[1,"control"],[1,"bar"],[3,"icon","touchrelease"],["class","contents",4,"ngIf"],[1,"footer"],["mat-button","",1,"inverse",3,"touchrelease"],["class","load-state",4,"ngIf"],[1,"contents"],[1,"field"],[1,"value"],[1,"actions"],["mat-icon-button","",3,"href","disabled"],["class","field",4,"ngIf"],[1,"field","multiline"],["class","attendee",4,"ngFor","ngForOf"],[1,"attendee"],[1,"value",3,"innerHTML"],[1,"load-state"],[1,"no-item","center"],[1,"icon"],["diameter","32"]],template:function(e,t){1&e&&l.Ec(0,ce,24,21,"div",0),2&e&&l.oc("ngIf",t.event)},directives:[i.t,Y.a,k.b,C.c,y.a,k.a,i.s,x.c],pipes:[X.b],styles:[".approval-event[_ngcontent-%COMP%]{position:relative;width:100%;background-color:#fff;font-size:.8em;margin:.5em 1px;border:2px solid #1f40e6;border-right-width:4px}.approval-event.internal[_ngcontent-%COMP%]{border-color:#e69fc7}.approval-event.external[_ngcontent-%COMP%]{border-color:#8c5ac8}.approval-event.training[_ngcontent-%COMP%]{border-color:#f0e700}.approval-event.interview[_ngcontent-%COMP%]{border-color:#348d02}.approval-event.setup[_ngcontent-%COMP%]{border-color:#d32f2f}.approval-event.cancelled[_ngcontent-%COMP%]{border-color:#617288}.header[_ngcontent-%COMP%]{display:flex;align-items:center;padding:1em}.avatar[_ngcontent-%COMP%]{font-size:1.2em}.details[_ngcontent-%COMP%]{padding:.5em;max-width:calc(100% - 4em)}.footer[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;width:100%}.load-state[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,100%,.85)}.control[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:0 1em;margin-bottom:.5em}.control[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{height:1px;min-width:1px;flex:1;background-color:#ccc}.control[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{height:1em;width:1em;font-size:1.5em;margin:0 .5em;cursor:pointer}.contents[_ngcontent-%COMP%]{padding:0 1em 1em;overflow:hidden}.text[_ngcontent-%COMP%]{display:flex;align-items:center}.text[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{height:6px;width:6px;border-radius:100%;background-color:#ffb300;margin:.25em}.field[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:.5em}.field[_ngcontent-%COMP%]:last-child{margin-bottom:0}.field[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{display:flex;align-items:center;padding:0 .5em}.field[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{flex:1;min-width:50%}.field.multiline[_ngcontent-%COMP%]{align-items:flex-start}.field.multiline[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.no-item[_ngcontent-%COMP%]{font-size:.6em;color:#000}.no-item[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{margin:0;font-size:.75em}button[mat-button][_ngcontent-%COMP%]{flex:1;min-width:30%;background-color:#f7f8ff;transition:color .2s,background-color .2s;border:1px solid #ccc;color:rgba(0,0,0,.85);cursor:pointer}button[mat-button].accepted[_ngcontent-%COMP%], button[mat-button].declined[_ngcontent-%COMP%]{pointer-events:none;color:#fff}button[mat-button].accepted[_ngcontent-%COMP%]{background-color:#43a047}button[mat-button].declined[_ngcontent-%COMP%]{background-color:#e53935}.bold[_ngcontent-%COMP%]{font-weight:500}.actions[_ngcontent-%COMP%]{display:flex;align-items:center}[mat-icon-button][_ngcontent-%COMP%]{background-color:#1937ea;color:#fff;border:1px solid #1937ea;margin:.3em}[mat-icon-button][disabled][_ngcontent-%COMP%]{background-color:#f0f0f0;color:rgba(0,0,0,.35);border-color:rgba(0,0,0,.35)}[mat-icon-button].search[_ngcontent-%COMP%]{position:absolute;top:.5em;right:.5em;font-size:.8em}"],data:{animation:[Object(Q.n)("show",[Object(Q.m)(":enter",[Object(Q.l)({opacity:0,height:0}),Object(Q.e)(200,Object(Q.l)({opacity:1,height:"*"}))]),Object(Q.m)(":leave",[Object(Q.l)({opacity:1,height:"*"}),Object(Q.e)(200,Object(Q.l)({opacity:0,height:0}))])])]}}),e})();function re(e,t){if(1&e){const e=l.Xb();l.Wb(0,"approvals-event",9),l.ec("acting",(function(t){return l.wc(e),l.ic(2).waiting_on_event=t})),l.Vb()}2&e&&l.oc("event",t.$implicit)}function le(e,t){if(1&e&&(l.Wb(0,"div",4),l.Wb(1,"div",5),l.Rb(2,"div",6),l.Wb(3,"div",7),l.Gc(4),l.Vb(),l.Rb(5,"div",6),l.Vb(),l.Ec(6,re,1,1,"approvals-event",8),l.Vb()),2&e){const e=l.ic();l.Cb(4),l.Hc(e.date_display),l.Cb(2),l.oc("ngForOf",e.events)("ngForTrackBy",e.trackByFn)}}function de(e,t){1&e&&(l.Wb(0,"div",10),l.Wb(1,"div",11),l.Wb(2,"div",12),l.Rb(3,"mat-spinner",13),l.Vb(),l.Vb(),l.Vb())}function ge(e,t){1&e&&(l.Wb(0,"div",15),l.Wb(1,"div",12),l.Wb(2,"i",16),l.Gc(3,"close"),l.Vb(),l.Vb(),l.Wb(4,"div",17),l.Gc(5,"No meetings pending approval"),l.Vb(),l.Vb())}function be(e,t){if(1&e&&l.Ec(0,ge,6,0,"div",14),2&e){const e=l.ic();l.oc("ngIf",!e.loading)}}let he=(()=>{class e extends c.a{constructor(e){super(),this._service=e,this.events=[],this.space_list=[]}get date_display(){const e=m().startOf("d"),t=m(this.date).startOf("d");return e.isSame(t,"d")?"Today":1===t.diff(e,"d")?"Tomorrow":1===e.diff(t,"d")?"Yesterday":t.format("DD MMM YYYY")}ngOnInit(){this.subscription("building",this._service.listen("APP.level",e=>{const t=this._service.Organisation.building;this.space_list=this._service.Spaces.list(n=>n.zones.indexOf(-1===e?t.id:e)>=0).map(e=>e.name),this.processMeetings(),this.getMonthlyPending()})),this.getMonthlyPending(),this.interval("monthly_pending",()=>this.getMonthlyPending(),6e5)}ngOnChanges(e){e.date&&(this.events=[],this.processMeetings(),this.interval("process_meetings",()=>this.processMeetings(),1e3),m(e.date.previousValue).isSame(m(e.date.currentValue),"M")||(this.getMonthlyPending(),this.interval("monthly_pending",()=>this.getMonthlyPending(),6e5)))}trackByFn(e,t){return t.id||e}updateMeetings(){const e=this._service.get("APP.level"),t=-1===e?this._service.Organisation.building.id:e,n=m(this.date).startOf("d"),i=n.endOf("d");this.loading=!0,this._service.Spaces.query({zone_ids:t,available_from:n.unix(),available_to:i.unix()}).then(e=>{this.space_list=e.map(e=>e.id),this.processMeetings(),this.loading=!1})}processMeetings(){if(this.waiting_on_event)return;this.events=this.process(this.date);const e=this._service.get("CONCIERGE.pending_bookings")||{};e[m(this.date).format("YYYY-MM-DD")]=this.events.length,this._service.set("CONCIERGE.pending_bookings",e)}process(e){let t=[];for(const n of this.space_list){const i=this._service.Spaces.item(n);i&&(t=t.concat(i.bookingsFor(e).filter(e=>e.tentative)))}return t.sort((e,t)=>e.date-t.date)}getMonthlyPending(){const e=m().startOf("d");let t=m(this.date).startOf("M");const n=t.endOf("M");if(e.isAfter(n,"m"))return;e.isAfter(t,"m")&&(t=e);const i=this._service.get("APP.level"),o=(-1===i?null:i)||this._service.Organisation.building.id;console.log("Get Monthly:",t.format("MMMM YYYY")),this._service.Spaces.query({zone_ids:o,available_from:t.unix(),available_to:n.unix()}).then(e=>{const i=this._service.get("CONCIERGE.pending_bookings")||{};for(let o=t;o.isBefore(n,"m");o=o.add(1,"d")){const e=this.process(o.valueOf());i[o.format("YYYY-MM-DD")]=e.length}this._service.set("CONCIERGE.pending_bookings",i)})}}return e.\u0275fac=function(t){return new(t||e)(l.Qb(d.a))},e.\u0275cmp=l.Kb({type:e,selectors:[["day-view-approvals-view"]],inputs:{date:"date"},features:[l.zb,l.Ab],decls:5,vars:3,consts:[[1,"approvals-view"],["class","content",4,"ngIf","ngIfElse"],["class","load-state",4,"ngIf"],["empty_state",""],[1,"content"],[1,"date"],[1,"bar"],[1,"display"],[3,"event","acting",4,"ngFor","ngForOf","ngForTrackBy"],[3,"event","acting"],[1,"load-state"],[1,"no-item","center"],[1,"icon"],["diameter","32"],["class","info-block center",4,"ngIf"],[1,"info-block","center"],[1,"material-icons"],[1,"text"]],template:function(e,t){if(1&e&&(l.Wb(0,"div",0),l.Ec(1,le,7,3,"div",1),l.Ec(2,de,4,0,"div",2),l.Vb(),l.Ec(3,be,1,1,"ng-template",null,3,l.Fc)),2&e){const e=l.tc(4);l.Cb(1),l.oc("ngIf",t.events&&t.events.length)("ngIfElse",e),l.Cb(1),l.oc("ngIf",t.loading)}},directives:[i.t,i.s,ae,x.c],styles:[".approvals-view[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden auto;background-color:#eee}.no-item[_ngcontent-%COMP%]{font-size:.7em}.date[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;margin:.5em 0}.bar[_ngcontent-%COMP%]{height:1px;min-width:1px;flex:1}.bar[_ngcontent-%COMP%], .display[_ngcontent-%COMP%]{background-color:#707070}.display[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:.5em 1.5em;height:1.5em;border-radius:.8em;color:#fff;font-size:.8em}.load-state[_ngcontent-%COMP%]{position:absolute;left:50%;bottom:4px;transform:translateX(-50%);background-color:#fff;z-index:999;border-radius:4px;height:3em;width:3em;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.load-state[_ngcontent-%COMP%]   spinner[_ngcontent-%COMP%]{font-size:.4em}"]}),e})();const pe=["scroll_area"];function ve(e,t){1&e&&(l.Wb(0,"div",17),l.Rb(1,"mat-progress-bar",18),l.Vb())}function fe(e,t){if(1&e&&(l.Wb(0,"div",19),l.Wb(1,"div",20),l.Wb(2,"div",4),l.Gc(3),l.Vb(),l.Rb(4,"div",21),l.Vb(),l.Wb(5,"div",22),l.Gc(6),l.Vb(),l.Vb()),2&e){const e=t.$implicit;l.oc("title",e.long_name),l.Cb(3),l.Hc(e.name),l.Cb(3),l.Jc(" Capacity - ",e.capacity||"0"," ",1===e.capacity?"person":"people"," ")}}function ue(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div",23),l.Wb(1,"div",19),l.Wb(2,"div",4),l.Gc(3,"Holding Bay"),l.Vb(),l.Rb(4,"div",21),l.Vb(),l.Wb(5,"div",24),l.ec("touchrelease",(function(){l.wc(e);const t=l.ic();return t.show_holding_bay=!t.show_holding_bay})),l.Wb(6,"div",21),l.Wb(7,"i",25),l.Gc(8),l.Vb(),l.Vb(),l.Vb(),l.Vb()}if(2&e){const e=l.ic();l.Gb("show",e.show_holding_bay),l.Cb(1),l.oc("title",e.holding_bay.name),l.Cb(7),l.Hc(e.show_holding_bay?"keyboard_arrow_right":"event_available")}}function _e(e,t){if(1&e&&(l.Wb(0,"div",26),l.Wb(1,"div",27),l.Gc(2),l.Vb(),l.Vb()),2&e){const e=t.$implicit,n=l.ic();l.Cb(1),l.Gb("active",n.is_today&&e.id===n.active_hour),l.Cb(1),l.Ic(" ",e.name," ")}}function me(e,t){1&e&&(l.Wb(0,"div",26),l.Rb(1,"div",28),l.Vb())}function Ce(e,t){if(1&e){const e=l.Xb();l.Wb(0,"div",29),l.Wb(1,"day-view-space",30),l.ec("dragging",(function(t){return l.wc(e),l.ic().dragChange(t)}))("inView",(function(n){l.wc(e);const i=t.$implicit;return l.ic().in_view[i.id]=n})),l.Vb(),l.Vb()}if(2&e){const e=t.$implicit,n=l.ic();l.Dc("min-height",3*n.time_blocks.length+"rem"),l.Cb(1),l.oc("space_list",n.space_zones)("date",n.date)("space",e)("legend",n.legend_map)("overflow_only",n.overflow_only)("scroll",0-n.scroll_left)("scrollTop",n.scroll_offset-n.scroll_top)("lastUpdate",n.last_update)}}function Oe(e,t){if(1&e&&(l.Wb(0,"div",31),l.jc(1,"safe"),l.Rb(2,"div",32),l.Vb()),2&e){const e=l.ic();l.Dc("top",l.lc(1,2,"calc("+e.now*e.time_blocks.length*3+"rem - "+e.scroll_top+"px)","style"))}}function Me(e,t){if(1&e){const e=l.Xb();l.Wb(0,"day-view-space",35),l.ec("dragging",(function(t){return l.wc(e),l.ic(2).dragChange(t)}))("inView",(function(t){l.wc(e);const n=l.ic(2);return n.in_view[n.holding_bay.id]=t})),l.Vb()}if(2&e){const e=l.ic(2);l.oc("date",e.date)("space",e.holding_bay)("lastUpdate",e.last_update)}}function we(e,t){if(1&e&&(l.Wb(0,"div",23),l.Ec(1,Me,1,3,"day-view-space",33),l.Rb(2,"day-view-approvals-view",34),l.Vb()),2&e){const e=l.ic();l.Gb("show",e.show_holding_bay),l.Cb(1),l.oc("ngIf",e.holding_bay),l.Cb(1),l.oc("date",e.date)}}let Pe=(()=>{class e extends c.a{constructor(e,t,n,i){super(),this._service=e,this._route=t,this._renderer=n,this._dialog=i,this.legend=[],this.time_blocks=this.generateTimeBlocks(),this.scroll_top=0,this.scroll_left=0,this.scroll_offset=0,this.spaces=[],this.filtered_spaces=[],this.in_view={},this.loading_space={},this.last_update=0,this.show_holding_bay=!0}onResize(){this.scroll_area.nativeElement&&(this.box=this.scroll_area.nativeElement.getBoundingClientRect())}get legend_map(){const e={};return(this.legend||[]).forEach(t=>e[t]=!0),e}get is_loading(){return this.loading||Object.keys(this.loading_space).reduce((e,t)=>e||this.loading_space[t],!1)}get holding_bay(){const e=this._service.Organisation.building;return e&&e.holding_bay?this._service.Spaces.item(e.holding_bay):null}ngOnInit(){this._service.initialised.pipe(Object(s.a)(e=>e)).subscribe(()=>{this.init(),this.updateTime(),this.interval("time",()=>this.updateTime(),15e3)})}ngOnChanges(e){if(this._service.Spaces.is_initialised){if(e.date&&(this.is_today=m().isSame(m(this.date),"d"),this.updateBookings(),this.interval("bookings",()=>this.updateBookings(),3e4)),e.level){const e=this.level?this.level:(this._service.Organisation.building||{}).id;this.spaces=this._service.Spaces.list(t=>t.zones.indexOf(e)>=0)||[],this.initSpaces(),this.updateBookings(),this.interval("bookings",()=>this.updateBookings(),3e4)}e.room_type&&this.initSpaces()}else this._service.Spaces.initialised.pipe(Object(s.a)(e=>e)).subscribe(()=>{this.ngOnChanges(e)})}init(){this._service.Spaces.initialised.pipe(Object(s.a)(e=>e)).subscribe(()=>{this._service.title="Day View",this.subscription("viewing",this._service.listen("CONCIERGE.day_view.viewing",e=>this.scrollIntoView(e))),this.subscription("route.query",this._route.queryParamMap.subscribe(e=>{if(e.has("view")){this.view_id=e.get("view");const t=localStorage.getItem("CONCIERGE.view_booking");if(t){const e=new r.a(this._service.Bookings,JSON.parse(t));this.view(e),localStorage.removeItem("CONCIERGE.view_booking")}}})),this.updateBookings(),this.interval("bookings",()=>this.updateBookings(),3e4),this.interval("scroll",()=>{this.scroll_area&&this.scroll_area.nativeElement&&this.updateScroll({target:this.scroll_area.nativeElement})},1e3),this.scroll_area.nativeElement&&(this.box=this.scroll_area.nativeElement.getBoundingClientRect())})}get space_zones(){return this.spaces.map(e=>`space-col-${e.id}`)}updateScroll(e){this.scroll_top=e.target.scrollTop,this.scroll_left=e.target.scrollLeft}generateTimeBlocks(){const e=[],t=m().startOf("h");for(let n=0;n<24;n++)e.push({id:t.hour(n).format("HH:mm"),name:t.hour(n).format("h:mm A")});return e}updateTime(){const e=m();this.now=(e.hour()+e.minute()/60)/24,this.active_hour=e.startOf("h").format("HH:mm")}updateBookings(){const e=this.spaces.filter(e=>!1!==this.in_view[e.id]);if(e.length){e.forEach(e=>this.loading_space[e.id]=!0);const t=m(this.date).startOf("d"),n=t.endOf("d"),i=e.reduce((e,t)=>e+(e?",":"")+t.id,""),o=this._service.get("APP.level"),c=[-1===o?this._service.Organisation.building.id:o];this.space_type&&c.push(this.space_type),this.loading=!0,this._service.Spaces.query({room_ids:i,zone_ids:c.join(","),available_from:t.unix(),available_to:n.unix()}).then(e=>{e.forEach(e=>{if(this.view_id){const t=e.bookings.find(e=>e.id===this.view_id);t&&this.view(t)}const t=this.filtered_spaces.find(t=>t.id===e.id);t&&(t._bookings=e._bookings)}),delete this.loading_space,this.last_update=m().valueOf(),this.loading_space={},this.loading=!1},()=>this.loading=!1)}}view(e){console.log("View:",e.id),this._dialog.open(_.a,{data:{booking:e}}),this.view_id=null}scrollIntoView(e){if(e&&this.scroll_area&&this.scroll_area.nativeElement){const t=this.scroll_area.nativeElement.querySelector(`#event-${e.id}`);if(t){const e=this.scroll_area.nativeElement.getBoundingClientRect(),n=t.getBoundingClientRect();this.scroll_area.nativeElement.scrollTo({left:n.left-e.left+this.scroll_area.nativeElement.scrollLeft,top:n.top-e.top+this.scroll_area.nativeElement.scrollTop,behavior:"smooth"})}}}scrollView(e,t){(e||t)&&(this.scroll_area.nativeElement.scrollTop+=t||0,this.scroll_area.nativeElement.scrollLeft+=e||0,(t&&this.scroll_area.nativeElement.scrollTop>=this.scroll_area.nativeElement.scrollHeight||e&&this.scroll_area.nativeElement.scrollLeft>=this.scroll_area.nativeElement.scrollWidth||t&&this.scroll_area.nativeElement.scrollTop<=0||e&&this.scroll_area.nativeElement.scrollLeft<=0)&&this.clearInterval("auto_scroll"),this.updateScroll({target:this.scroll_area.nativeElement}))}clearSelected(){this._service.set("CONCIERGE.day_view.viewing",null)}cancelScroll(){this.clearInterval("auto_scroll")}dragChange(e){e?(this.scroll_offset=this.scroll_area.nativeElement.scrollTop,this.subscription("listen_move",this._renderer.listen("window","mousemove",e=>{const t=e.clientX,n=e.clientY,i=n>this.box.bottom-.05*this.box.height?1:n<this.box.top+.05*this.box.height?-1:0,o=t>this.box.right-.05*this.box.width?1:t<this.box.left+.05*this.box.height?-1:0;this.scrollView(5*o,5*i),this.interval("auto_scroll",()=>this.scrollView(10*o,10*i),10)})),this.clearInterval("bookings")):(this.interval("bookings",()=>this.updateBookings(),3e4),this.clearInterval("auto_scroll"),this.unsub("listen_move"))}initSpaces(){const e=this.holding_bay;this.filtered_spaces=this.spaces.filter(t=>(!this.space_type||t.zones.indexOf(this.space_type)>=0)&&(!e||t.id!==e.id)&&t.bookable),this.filtered_spaces.sort((e,t)=>(e.name||"").localeCompare(t.name))}}return e.\u0275fac=function(t){return new(t||e)(l.Qb(d.a),l.Qb(o.a),l.Qb(l.F),l.Qb(g.b))},e.\u0275cmp=l.Kb({type:e,selectors:[["day-view-timeline"]],viewQuery:function(e,t){var n;1&e&&l.Cc(pe,!0),2&e&&l.sc(n=l.fc())&&(t.scroll_area=n.first)},hostBindings:function(e,t){1&e&&l.ec("resize",(function(){return t.onResize()}),!1,l.vc)},inputs:{date:"date",level:"level",space_type:"space_type",legend:"legend",overflow_only:"overflow_only",loading:"loading"},features:[l.zb,l.Ab],decls:22,vars:14,consts:[[1,"timeline"],["class","loader",4,"ngIf"],[1,"header"],[1,"time-blocks"],[1,"text"],[1,"flex"],[1,"group"],["class","space-header",3,"title",4,"ngFor","ngForOf"],["class","sidebar",3,"show",4,"ngIf"],[1,"body",3,"touchrelease"],["class","block",4,"ngFor","ngForOf"],["id","day-view-scroll",1,"flex","content",3,"scroll"],["scroll_area",""],[1,"time-lines"],[1,"space-day"],["class","space","cdkDropListGroup","",3,"min-height",4,"ngFor","ngForOf"],["class","now-line",3,"top",4,"ngIf"],[1,"loader"],["mode","indeterminate"],[1,"space-header",3,"title"],[1,"details"],[1,"icon"],[1,"capacity"],[1,"sidebar"],[1,"tag",3,"touchrelease"],[1,"material-icons"],[1,"block"],["div","",1,"hour"],[1,"line"],["cdkDropListGroup","",1,"space"],[3,"space_list","date","space","legend","overflow_only","scroll","scrollTop","lastUpdate","dragging","inView"],[1,"now-line"],[1,"knob"],[3,"date","space","lastUpdate","dragging","inView",4,"ngIf"],[3,"date"],[3,"date","space","lastUpdate","dragging","inView"]],template:function(e,t){1&e&&(l.Wb(0,"div",0),l.Ec(1,ve,2,0,"div",1),l.Wb(2,"div",2),l.Wb(3,"div",3),l.Wb(4,"div",4),l.Gc(5,"Time"),l.Vb(),l.Vb(),l.Wb(6,"div",5),l.Wb(7,"div",6),l.Ec(8,fe,7,4,"div",7),l.Vb(),l.Vb(),l.Ec(9,ue,9,4,"div",8),l.Vb(),l.Wb(10,"div",9),l.ec("touchrelease",(function(){return t.clearSelected()})),l.Wb(11,"div",3),l.Wb(12,"div",6),l.Ec(13,_e,3,3,"div",10),l.Vb(),l.Vb(),l.Wb(14,"div",11,12),l.ec("scroll",(function(e){return t.updateScroll(e)})),l.Wb(16,"div",13),l.Ec(17,me,2,0,"div",10),l.Vb(),l.Wb(18,"div",14),l.Ec(19,Ce,2,10,"div",15),l.Vb(),l.Vb(),l.Ec(20,Oe,3,5,"div",16),l.Ec(21,we,3,4,"div",8),l.Vb(),l.Vb()),2&e&&(l.Cb(1),l.oc("ngIf",t.is_loading),l.Cb(6),l.Dc("left",0-t.scroll_left+"px"),l.Cb(1),l.oc("ngForOf",t.filtered_spaces),l.Cb(1),l.oc("ngIf",t.holding_bay),l.Cb(3),l.Dc("top",0-t.scroll_top+"px"),l.Cb(1),l.oc("ngForOf",t.time_blocks),l.Cb(3),l.Dc("min-width",15*t.filtered_spaces.length+"rem"),l.Cb(1),l.oc("ngForOf",t.time_blocks),l.Cb(2),l.oc("ngForOf",t.filtered_spaces),l.Cb(1),l.oc("ngIf",t.is_today),l.Cb(1),l.oc("ngIf",t.holding_bay))},directives:[i.t,i.s,C.c,O.a,M.f,H,he],pipes:[X.b],styles:[".timeline[_ngcontent-%COMP%]{position:relative;height:100%;flex-direction:column;background-color:#ecf1f5}.header[_ngcontent-%COMP%], .timeline[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center}.header[_ngcontent-%COMP%]{border-bottom:1px solid #ccc;height:3em}.header[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%]{overflow:hidden;height:100%}.header[_ngcontent-%COMP%]   .group[_ngcontent-%COMP%]{position:absolute;display:flex;align-items:center;top:0;left:0;bottom:0}.header[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{margin-left:.5em}.header[_ngcontent-%COMP%]   spinner[_ngcontent-%COMP%]{font-size:.25em}.body[_ngcontent-%COMP%]{position:relative;width:100%;flex:1;min-height:50%;overflow:hidden}.body[_ngcontent-%COMP%], .body[_ngcontent-%COMP%]   .group[_ngcontent-%COMP%]{display:flex;align-items:center}.body[_ngcontent-%COMP%]   .group[_ngcontent-%COMP%]{position:absolute;flex-direction:column;top:0;left:0;right:0}.time-blocks[_ngcontent-%COMP%]{position:relative;width:6em;border-right:1px solid #ccc;height:100%;overflow:hidden}.time-blocks[_ngcontent-%COMP%]   .block[_ngcontent-%COMP%]:first-child{opacity:0}.time-blocks[_ngcontent-%COMP%] > .text[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:100%;width:100%}.flex[_ngcontent-%COMP%]{position:relative;flex:1;min-width:5em}.content[_ngcontent-%COMP%]{overflow:auto;background-color:#fff;height:100%}.time-lines[_ngcontent-%COMP%]{position:absolute;width:100%;pointer-events:none}.time-lines[_ngcontent-%COMP%]   .block[_ngcontent-%COMP%]{border-bottom:1px solid rgba(0,0,0,.1)}.time-lines[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]{position:absolute;top:50%;border-bottom:1px dashed rgba(0,0,0,.1);width:100%}.block[_ngcontent-%COMP%]{position:relative;width:100%;height:3rem;box-sizing:border-box;font-size:.8em}.hour[_ngcontent-%COMP%]{position:absolute;top:0;transform:translateY(-50%);text-align:center;width:100%;transition:color .2s}.hour.active[_ngcontent-%COMP%]{color:#1937ea}.space-header[_ngcontent-%COMP%]{flex-direction:column;border-right:1px solid rgba(0,0,0,.1);height:100%;width:15rem;padding:.25em 1em}.space-header[_ngcontent-%COMP%], .space-header[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.space-header[_ngcontent-%COMP%]   .capacity[_ngcontent-%COMP%]{font-size:.7em;text-align:center}.space-header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:.9em}.space-day[_ngcontent-%COMP%]{display:flex}.space[_ngcontent-%COMP%]{border-right:1px solid rgba(0,0,0,.1);min-height:50vh;min-width:15rem;max-width:15rem;pointer-events:none}.now-line[_ngcontent-%COMP%]{position:absolute;left:6em;right:0;top:0;border:1px solid #1937ea;pointer-events:none;z-index:101}.now-line[_ngcontent-%COMP%]   .knob[_ngcontent-%COMP%]{position:absolute;top:0;left:-1px;transform:translate(-50%,-50%);height:12px;width:12px;border-radius:100%;background-color:#1937ea}.sidebar[_ngcontent-%COMP%]{position:relative;border-left:1px solid #ccc;height:100%;background-color:rgba(0,0,0,.05);z-index:102;width:0;transition:width .2s}.sidebar.show[_ngcontent-%COMP%]{width:24em}.sidebar[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{border:none}.sidebar[_ngcontent-%COMP%]   .space-header[_ngcontent-%COMP%]{width:100%}.auto-scroll[_ngcontent-%COMP%]{position:absolute;top:3em;left:6em;right:0;bottom:0;pointer-events:none}@media only screen and (orientation:portrait) and (max-width:450px){.auto-scroll[_ngcontent-%COMP%]{display:none}}@media only screen and (orientation:landscape) and (max-width:800px){.auto-scroll[_ngcontent-%COMP%]{display:none}}.auto-scroll[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{pointer-events:auto}.auto-scroll[_ngcontent-%COMP%]   .bottom[_ngcontent-%COMP%], .auto-scroll[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]{position:absolute;left:0;right:0;height:32px}.auto-scroll[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]{top:0}.auto-scroll[_ngcontent-%COMP%]   .bottom[_ngcontent-%COMP%]{bottom:0}.auto-scroll[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%], .auto-scroll[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;width:32px}.auto-scroll[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{top:0}.auto-scroll[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{bottom:0}.tag[_ngcontent-%COMP%]{position:absolute;left:1px;top:50%;height:2.5em;transform:translate(-100%,-50%);border-radius:1.3em 0 0 1.3em;background-color:#fff;border:1px solid #ccc!important;border-right:none!important}.tag[_ngcontent-%COMP%], .tag[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{display:flex;align-items:center}.tag[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{justify-content:center;height:1.25em;width:1.25em;font-size:2em;margin:0 .1em}.loader[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;right:0;height:4px;z-index:999}"]}),e})();var ye=n("FKr1");function xe(e,t){if(1&e&&(l.Wb(0,"mat-option",15),l.Gc(1),l.Vb()),2&e){const e=t.$implicit;l.oc("value",e.id),l.Cb(1),l.Ic(" ",e.name," ")}}function ke(e,t){if(1&e){const e=l.Xb();l.Wb(0,"mat-form-field",5),l.Wb(1,"mat-select",14),l.ec("ngModelChange",(function(t){return l.wc(e),l.ic().active_level=t}))("ngModelChange",(function(){return l.wc(e),l.ic().updateLevel()})),l.Ec(2,xe,2,2,"mat-option",7),l.Vb(),l.Vb()}if(2&e){const e=l.ic();l.Cb(1),l.oc("ngModel",e.active_level),l.Cb(1),l.oc("ngForOf",e.levels)}}function Ve(e,t){if(1&e&&(l.Wb(0,"mat-option",15),l.Gc(1),l.Vb()),2&e){const e=t.$implicit;l.oc("value",e.id),l.Cb(1),l.Ic(" ",e.name," ")}}function We(e,t){if(1&e){const e=l.Xb();l.Wb(0,"mat-form-field",5),l.Wb(1,"mat-select",14),l.ec("ngModelChange",(function(t){return l.wc(e),l.ic().active_type=t})),l.Ec(2,Ve,2,2,"mat-option",7),l.Vb(),l.Vb()}if(2&e){const e=l.ic();l.Cb(1),l.oc("ngModel",e.active_type),l.Cb(1),l.oc("ngForOf",e.space_types)}}function Ee(e,t){if(1&e&&(l.Wb(0,"mat-option",15),l.Wb(1,"div",16),l.Wb(2,"div",13),l.Gc(3),l.Vb(),l.Wb(4,"div",17),l.Rb(5,"div",18),l.Vb(),l.Vb(),l.Vb()),2&e){const e=t.$implicit;l.oc("value",e.id),l.Cb(3),l.Hc(e.name),l.Cb(2),l.Dc("background-color",e.color)}}let Ie=(()=>{class e extends c.a{constructor(e,t,n,i){super(),this._service=e,this._dialog=t,this._router=n,this._route=i,this.active_level="",this.active_type="",this.levels=[],this.space_types=[],this.legend=[],this.legend_keys=[{name:"Internal",id:"internal",color:"#E69FC7"},{name:"Client",id:"client",color:"#1F40E6"},{name:"External",id:"external",color:"#8C5AC8"},{name:"Setup",id:"setup",color:"#d32f2f"},{name:"Training",id:"training",color:"#F0E700"},{name:"Interview",id:"interview",color:"#348D02"}]}ngOnInit(){this._service.initialised.pipe(Object(s.a)(e=>e)).subscribe(()=>{this.legend=this.legend_keys.map(e=>`${e.id}`),this.subscription("route.params",this._route.paramMap.subscribe(e=>{if(e.has("level")&&this.active_level!==e.get("level")){const t=this._service.Organisation.levelWithID(e.get("level"));if(t){const e=this._service.Organisation.buildings.find(e=>e.id===t.building_id);e&&(this.active_level=t.id,this._service.Organisation.building=e)}}})),this.subscription("building",this._service.Organisation.listen("active_building").subscribe(()=>{const e=this._service.Organisation.building||{levels:[]};e.levels.find(e=>e.id===this.active_level)||(this.active_level=(e.levels[0]||{id:""}).id,this.updateLevel()),this.levels=[{id:"",name:"All Levels"}].concat(e.levels||[]),this.levels.sort((e,t)=>(e.name||"").localeCompare(t.name||"")),this.space_types=[{id:"",name:"All Space Types"}].concat(this._service.Organisation.space_types)}))})}newMeeting(){this._dialog.open(a.a,{data:{booking:new r.a(this._service.Bookings,{})}})}updateLevel(){this._router.navigate(["/day-view",this.active_level])}}return e.\u0275fac=function(t){return new(t||e)(l.Qb(d.a),l.Qb(g.b),l.Qb(o.c),l.Qb(o.a))},e.\u0275cmp=l.Kb({type:e,selectors:[["a-day-view"]],features:[l.zb],decls:22,vars:11,consts:[[1,"day-view"],[1,"group"],[3,"date","dateChange"],[1,"topbar"],["appearance","outline",4,"ngIf"],["appearance","outline"],["multiple","","placeholder","No items shown",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["labelPosition","before","title","Only show meetings with setup and breakdown times",3,"ngModel","ngModelChange"],[3,"date","level","legend","overflow_only","space_type"],["mat-button","",1,"new-item",3,"touchrelease"],[1,"content"],[1,"material-icons"],[1,"text"],[3,"ngModel","ngModelChange"],[3,"value"],[1,"key"],[1,"colour"],[1,"blob"]],template:function(e,t){1&e&&(l.Wb(0,"div",0),l.Rb(1,"a-sidebar"),l.Wb(2,"div",1),l.Wb(3,"a-topbar-header",2),l.ec("dateChange",(function(e){return t.date=e})),l.Wb(4,"div",3),l.Ec(5,ke,3,2,"mat-form-field",4),l.Ec(6,We,3,2,"mat-form-field",4),l.Wb(7,"mat-form-field",5),l.Wb(8,"mat-select",6),l.ec("ngModelChange",(function(e){return t.legend=e})),l.Wb(9,"mat-select-trigger"),l.Gc(10,"Legend"),l.Vb(),l.Ec(11,Ee,6,4,"mat-option",7),l.Vb(),l.Vb(),l.Wb(12,"mat-slide-toggle",8),l.ec("ngModelChange",(function(e){return t.only_overflow=e})),l.Gc(13," Only Setup/Breakdown "),l.Vb(),l.Vb(),l.Vb(),l.Wb(14,"main"),l.Rb(15,"day-view-timeline",9),l.Vb(),l.Vb(),l.Wb(16,"button",10),l.ec("touchrelease",(function(){return t.newMeeting()})),l.Wb(17,"div",11),l.Wb(18,"div",12),l.Gc(19,"add"),l.Vb(),l.Wb(20,"div",13),l.Gc(21,"New Meeting"),l.Vb(),l.Vb(),l.Vb(),l.Vb()),2&e&&(l.Cb(3),l.oc("date",t.date),l.Cb(2),l.oc("ngIf",t.levels&&t.levels.length>1),l.Cb(1),l.oc("ngIf",t.space_types&&t.space_types.length>1),l.Cb(2),l.oc("ngModel",t.legend),l.Cb(3),l.oc("ngForOf",t.legend_keys),l.Cb(1),l.oc("ngModel",t.only_overflow),l.Cb(3),l.oc("date",t.date)("level",t.active_level)("legend",t.legend)("overflow_only",t.only_overflow)("space_type",t.active_type))},directives:[b.a,h.a,i.t,p.b,v.a,f.r,f.u,v.c,i.s,u.a,Pe,k.b,C.c,ye.g],styles:[".day-view[_ngcontent-%COMP%], [_nghost-%COMP%], main[_ngcontent-%COMP%]{height:100%;width:100%}.day-view[_ngcontent-%COMP%]{display:flex;height:100%}main[_ngcontent-%COMP%]{height:calc(100% - 3.5em)}.group[_ngcontent-%COMP%]{flex:1;min-width:12em}.topbar[_ngcontent-%COMP%]{padding:.1em 0 .1em .5em;height:3.5em}.topbar[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{margin-right:.5em;width:10em}.key[_ngcontent-%COMP%]{display:flex;align-items:center}.key[_ngcontent-%COMP%]:hover   .blob[_ngcontent-%COMP%]{height:16px;width:16px}.key[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{flex:1;min-width:50%}.key[_ngcontent-%COMP%]   .colour[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:16px;width:16px}.key[_ngcontent-%COMP%]   .blob[_ngcontent-%COMP%]{height:8px;width:8px;border-radius:100%;transition:height .2s,width .2s}.new-item[_ngcontent-%COMP%]{position:absolute;bottom:1em;right:1em;z-index:999;cursor:pointer;height:1.5em;min-width:1.5em;padding:0;border-radius:.8em;font-size:1.75em;border:none;transition:padding .2s;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.new-item[_ngcontent-%COMP%], .new-item[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{align-items:center;justify-content:center}.new-item[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex}.new-item[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{width:0;overflow:hidden;opacity:0;transition:width .2s,opacity .2s;font-size:1.2rem}.new-item[_ngcontent-%COMP%]:hover{padding:0 .5em}.new-item[_ngcontent-%COMP%]:hover   .text[_ngcontent-%COMP%]{width:7em;opacity:1}"]}),e})();var De=n("PCNd");n.d(t,"DayViewModule",(function(){return ze}));const Ge=[{path:"",component:Ie},{path:":level",component:Ie},{path:"**",redirectTo:""}];let ze=(()=>{class e{}return e.\u0275mod=l.Ob({type:e}),e.\u0275inj=l.Nb({factory:function(t){return new(t||e)},imports:[[i.c,f.l,o.g.forChild(Ge),De.a]]}),e})()}}]);