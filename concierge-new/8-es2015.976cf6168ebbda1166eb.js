(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"7R+x":function(t,e,n){"use strict";n.r(e);var i=n("ofXK"),o=n("tyNb"),s=n("3Pt+"),c=n("xhdr"),a=n("fXoL"),r=n("0IaG"),d=n("IWZj"),l=n("g+Po"),b=n("OaWH"),g=n("bTqV"),m=n("0njA"),h=n("mAda"),f=n("kmnG"),u=n("qFsG"),p=n("m6yr");function _(t,e){if(1&t){const t=a.Xb();a.Wb(0,"form",4),a.Wb(1,"div",5),a.Wb(2,"div",6),a.Wb(3,"label",7),a.Gc(4,"Name"),a.Vb(),a.Wb(5,"mat-form-field",8),a.Wb(6,"input",9),a.ec("blur",(function(){return a.wc(t),a.ic().updatePerson()})),a.Vb(),a.Wb(7,"mat-error"),a.Gc(8,"Title is required"),a.Vb(),a.Vb(),a.Vb(),a.Wb(9,"div",10),a.Wb(10,"label",11),a.Gc(11,"Email Address"),a.Vb(),a.Wb(12,"mat-form-field",8),a.Wb(13,"input",12),a.ec("blur",(function(){return a.wc(t),a.ic().updatePerson()})),a.Vb(),a.Wb(14,"mat-error"),a.Gc(15,"A valid email address is required"),a.Vb(),a.Vb(),a.Vb(),a.Vb(),a.Vb()}if(2&t){const t=a.ic();a.oc("formGroup",t.form)}}const v=function(){return{class:"material-icons",content:"face"}};let C=(()=>{class t extends d.a{constructor(t){super(),this._service=t,this.personChange=new a.o}ngOnChanges(t){t.person&&(delete this.form,this.form=new s.i({name:new s.f(this.person.name,[s.F.minLength(2)]),email:new s.f(this.person.email,[s.F.required,s.F.email])}))}updatePerson(){this.form.markAllAsTouched(),this.form.valid&&(this.person=new h.a(this._service.Users,Object.assign(Object.assign({},this.form.value),{visitor:!0})),this.personChange.emit(this.person))}}return t.\u0275fac=function(e){return new(e||t)(a.Qb(b.a))},t.\u0275cmp=a.Kb({type:t,selectors:[["a-visitor-form"]],inputs:{event:"event",person:"person",field:"field"},outputs:{personChange:"personChange"},features:[a.zb,a.Ab],decls:4,vars:3,consts:[[1,"icon"],[3,"icon"],[3,"formGroup",4,"ngIf"],[1,"bar"],[3,"formGroup"],[1,"details"],[1,"name"],["for","name"],["appearance","outline"],["matInput","","name","name","placeholder","Name","formControlName","name",3,"blur"],[1,"email"],["for","email"],["matInput","","name","email","type","email","placeholder","Email Address","formControlName","email",3,"blur"]],template:function(t,e){1&t&&(a.Wb(0,"div",0),a.Rb(1,"app-icon",1),a.Vb(),a.Ec(2,_,16,1,"form",2),a.Rb(3,"div",3)),2&t&&(a.Cb(1),a.oc("icon",a.pc(2,v)),a.Cb(1),a.oc("ngIf",e.form))},directives:[m.a,i.t,s.H,s.s,s.j,f.b,u.a,s.c,s.r,s.h,f.a],styles:["[_nghost-%COMP%]{position:relative;display:flex;align-items:center;padding-left:4em;flex:1;transition:opacity .2s}.not-match[_nghost-%COMP%]{opacity:.35;background-color:#fff}[_nghost-%COMP%]:last-child   .details[_ngcontent-%COMP%]{border:none}.details[_ngcontent-%COMP%]{display:flex;flex:1;min-width:50%;align-items:center;height:4em}label[_ngcontent-%COMP%]{display:none}mat-form-field[_ngcontent-%COMP%]{height:3.25em;width:100%}mat-form-field[_ngcontent-%COMP%]   mat-error[_ngcontent-%COMP%]{margin-top:-.5em}.actions[_ngcontent-%COMP%]{width:4em}.email[_ngcontent-%COMP%], .name[_ngcontent-%COMP%]{flex:1;min-width:25%;margin-right:.5em}.icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:2em;width:2em;margin-right:.5em;border-radius:100%;background-color:#ccc;font-size:1.5em}.title[_ngcontent-%COMP%]{flex:1;min-width:1em}.user[_ngcontent-%COMP%]{display:flex;align-items:center;font-weight:400}form[_ngcontent-%COMP%]{flex:1}.staff[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:1.5em;width:1.5em;margin-right:.5em;border-radius:4px;border:3px solid #1937ea;font-weight:600;font-size:.8em;color:#1937ea}.bar[_ngcontent-%COMP%]{position:absolute;width:1.5em;top:50%;left:2.15em;height:2px;min-height:0;background-color:#999;transform:translateY(-50%)}.empty[_ngcontent-%COMP%]{width:4.5em}"]}),t})();const O=function(){return{class:"material-icons",content:"delete"}};function M(t,e){if(1&t){const t=a.Xb();a.Wb(0,"div",23),a.Wb(1,"a-visitor-form",24),a.ec("personChange",(function(e){a.wc(t);const n=a.ic().index;return a.ic(3).replaceVisitor(e,n)})),a.Vb(),a.Wb(2,"button",25),a.ec("tapped",(function(){a.wc(t);const e=a.ic(),n=e.$implicit,i=e.index;return a.ic(3).removeVisitor(n,i)})),a.Rb(3,"app-icon",6),a.Vb(),a.Vb()}if(2&t){const t=a.ic().$implicit,e=a.ic(3);a.Cb(1),a.oc("event",e.event)("person",t),a.Cb(2),a.oc("icon",a.pc(3,O))}}function P(t,e){if(1&t&&(a.Ub(0),a.Ec(1,M,4,4,"div",22),a.Tb()),2&t){const t=e.$implicit;a.Cb(1),a.oc("ngIf",t.external)}}const w=function(){return{class:"material-icons",content:"event"}},V=function(){return{class:"material-icons",content:"add"}};function x(t,e){if(1&t){const t=a.Xb();a.Wb(0,"div",3),a.Wb(1,"div",4),a.Wb(2,"div",5),a.Rb(3,"app-icon",6),a.Vb(),a.Wb(4,"div",7),a.Gc(5),a.Wb(6,"span"),a.Gc(7),a.Vb(),a.Vb(),a.Wb(8,"div",8),a.Wb(9,"div",9),a.Gc(10,"S"),a.Vb(),a.Wb(11,"div",10),a.Gc(12),a.Vb(),a.Vb(),a.Wb(13,"div",11),a.Wb(14,"label",12),a.Gc(15,"Title"),a.Vb(),a.Wb(16,"mat-form-field",13),a.Rb(17,"input",14),a.Wb(18,"mat-error"),a.Gc(19,"Title is required"),a.Vb(),a.Vb(),a.Vb(),a.Rb(20,"div",15),a.Vb(),a.Wb(21,"div",16),a.Rb(22,"div",17),a.Ec(23,P,2,1,"ng-container",18),a.Wb(24,"button",19),a.ec("tapped",(function(){return a.wc(t),a.ic(2).addVisitor()})),a.Wb(25,"div",20),a.Wb(26,"div",5),a.Rb(27,"app-icon",6),a.Vb(),a.Wb(28,"div",21),a.Gc(29,"Add visitor"),a.Vb(),a.Rb(30,"div",17),a.Vb(),a.Vb(),a.Vb(),a.Vb()}if(2&t){const t=a.ic(2);a.Cb(3),a.oc("icon",a.pc(9,w)),a.Cb(2),a.Ic("",t.event.start_time," "),a.Cb(2),a.Ic(" - ",t.event.duration>0?t.event.end_time:"",""),a.Cb(5),a.Hc((null==t.event.organiser?null:t.event.organiser.name)||t.event.organiser_email),a.Cb(11),a.oc("ngForOf",t.attendees)("ngForTrackBy",t.trackByFn),a.Cb(1),a.Gb("add",!0),a.Cb(3),a.oc("icon",a.pc(10,V))}}function y(t,e){if(1&t&&(a.Wb(0,"form",1),a.Ec(1,x,31,11,"div",2),a.Vb()),2&t){const t=a.ic();a.oc("formGroup",t.form),a.Cb(1),a.oc("ngIf",t.event)}}let W=(()=>{class t{constructor(t){this._service=t,this.attendees=[]}ngOnChanges(t){(t.event||t.form)&&(this.attendees=this.form.controls.attendees.value)}addVisitor(){const t=this.form.controls.attendees.value;t.push(new h.a(this._service.Users,{visitor:!0})),this.form.controls.attendees.setValue(t)}replaceVisitor(t,e){const n=this.attendees;n.splice(e,1,t),this.attendees=n,console.log("Visitor:",t),this._service.Users.addFrom("visitor-modal",t.toJSON(),"other"),this.form.controls.attendees.setValue(n)}removeVisitor(t,e){const n=this.attendees;n.splice(e,1),this.form.controls.attendees.setValue(n)}trackByFn(t,e){return e?e.id:null}}return t.\u0275fac=function(e){return new(e||t)(a.Qb(b.a))},t.\u0275cmp=a.Kb({type:t,selectors:[["a-event-form"]],inputs:{event:"event",form:"form"},features:[a.Ab],decls:1,vars:1,consts:[[3,"formGroup",4,"ngIf"],[3,"formGroup"],["class","visitor-booking",4,"ngIf"],[1,"visitor-booking"],[1,"details"],[1,"icon"],[3,"icon"],[1,"time"],[1,"host"],[1,"staff"],[1,"name"],[1,"title"],["for","title"],["appearance","outline"],["matInput","","name","title","placeholder","Meeting Title","formControlName","title"],[1,"actions"],[1,"attendees"],[1,"bar"],[4,"ngFor","ngForOf","ngForTrackBy"],["mat-button","","type","button",3,"tapped"],[1,"content"],[1,"text"],["class","visitor",4,"ngIf"],[1,"visitor"],[3,"event","person","personChange"],["mat-icon-button","",3,"tapped"]],template:function(t,e){1&t&&a.Ec(0,y,2,2,"form",0),2&t&&a.oc("ngIf",e.form)},directives:[i.t,s.H,s.s,s.j,m.a,f.b,u.a,s.c,s.r,s.h,f.a,i.s,g.b,p.c,C],styles:["[_nghost-%COMP%]{font-size:.9em}.visitor-booking[_ngcontent-%COMP%]{transition:background .2s;background-color:#fff;border-bottom:1px solid rgba(0,0,0,.1)}.showing[_ngcontent-%COMP%]{background-color:#f0f0f0}.showing[_ngcontent-%COMP%]   .toggle[_ngcontent-%COMP%]{color:#1937ea}.details[_ngcontent-%COMP%]{position:relative;z-index:10;display:flex;align-items:center;padding:.5em 0;transition:opacity .2s}.details.blur[_ngcontent-%COMP%]{opacity:.35;background-color:#fff}.details[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:0 .5em}.details[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{width:5.75rem;font-size:.9em}.details[_ngcontent-%COMP%]   .host[_ngcontent-%COMP%]{width:13.25em}.details[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%]{width:12em}.icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:2em;width:2em;border-radius:100%;background-color:#ccc;font-size:1.5em}.time[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:rgba(0,0,0,.65)}.title[_ngcontent-%COMP%]{flex:1;min-width:1em;width:18.25em}.host[_ngcontent-%COMP%]{display:flex;align-items:center;font-weight:400}.status[_ngcontent-%COMP%]{font-size:.9em;font-weight:500;width:3.5em}.staff[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:1.5em;width:1.5em;margin-right:.5em;border-radius:4px;border:3px solid #1937ea;font-weight:600;font-size:.8em;color:#1937ea}.attendees[_ngcontent-%COMP%]{position:relative}.attendees[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{position:absolute;top:-.65em;left:2.15em;width:2px;background-color:#999;bottom:2em}.toggle[_ngcontent-%COMP%]{font-size:1.2rem}label[_ngcontent-%COMP%]{display:none}mat-form-field[_ngcontent-%COMP%]{height:3.25em;width:100%}mat-form-field[_ngcontent-%COMP%]   mat-error[_ngcontent-%COMP%]{margin-top:-.5em}.actions[_ngcontent-%COMP%]{width:4em}.add[_ngcontent-%COMP%]{position:relative;background:none;border:none;padding-left:4em;color:rgba(0,0,0,.85);height:4em;width:100%;border-radius:0}.add[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%], .add[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{display:flex;align-items:center}.add[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{justify-content:center;height:2em;width:2em;margin-right:.5em;border-radius:100%;border:2px dotted rgba(0,0,0,.6);background:none;color:rgba(0,0,0,.6);font-size:1.5em}.add[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{position:absolute;width:1.5em;top:50%;left:2.25em;height:2px;min-height:0;background-color:#999;transform:translateY(-50%)}.visitor[_ngcontent-%COMP%]{display:flex;align-items:center}.visitor[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:2.25em}"]}),t})();var k=n("Xa2L");const I=function(){return{type:"icon",class:"material-icons",content:"close"}};function G(t,e){1&t&&(a.Wb(0,"button",5),a.Rb(1,"app-icon",6),a.Vb()),2&t&&(a.Cb(1),a.oc("icon",a.pc(1,I)))}function E(t,e){if(1&t&&(a.Wb(0,"main"),a.Rb(1,"a-event-form",7),a.Vb()),2&t){const t=a.ic();a.Cb(1),a.oc("form",t.form)("event",t.booking)}}function R(t,e){if(1&t){const t=a.Xb();a.Wb(0,"button",10),a.ec("tapped",(function(){return a.wc(t),a.ic(2).delete()})),a.Gc(1,"Delete"),a.Vb()}}function j(t,e){if(1&t){const t=a.Xb();a.Wb(0,"mat-dialog-actions"),a.Wb(1,"footer"),a.Wb(2,"button",8),a.ec("tapped",(function(){return a.wc(t),a.ic().save()})),a.Gc(3,"Save"),a.Vb(),a.Ec(4,R,2,0,"button",9),a.Vb(),a.Vb()}if(2&t){const t=a.ic();a.Cb(2),a.oc("disabled",!t.has_attendees),a.Cb(2),a.oc("ngIf",t.booking.id)}}function z(t,e){if(1&t&&(a.Wb(0,"main",11),a.Wb(1,"div",12),a.Wb(2,"div",13),a.Rb(3,"mat-spinner",14),a.Vb(),a.Wb(4,"div",15),a.Gc(5),a.Vb(),a.Vb(),a.Vb()),2&t){const t=a.ic();a.Cb(5),a.Hc(t.loading)}}let $=(()=>{class t extends d.a{constructor(t,e,n,i){super(),this._service=t,this._dialog_ref=e,this._dialog=n,this._data=i,this.event=new a.o}get booking(){return this._data.booking}get has_attendees(){return this.form&&this.form.controls.attendees.value&&this.form.controls.attendees.value.length}ngOnInit(){this.form=new s.i({title:new s.f(this.booking.title,[s.F.required]),attendees:new s.f(this.booking.attendees,[s.F.minLength(1)])}),this.subscription("title",this.form.controls.title.valueChanges.subscribe(t=>this.booking.storePendingChange("title",t))),this.subscription("attendees",this.form.controls.attendees.valueChanges.subscribe(t=>{this.booking.storePendingChange("attendee_emails",t.map(t=>t.email))}))}delete(){const t=this._dialog.open(l.b,Object.assign(Object.assign({},l.a),{data:{title:"Delete meeting",content:"Are you sure you wish to delete this meeting?",icon:{type:"icon",class:"material-icons",content:"delete"},action:"Ok"}}));this.subscription("confirm",t.componentInstance.event.subscribe(e=>{"done"===e.reason&&this.booking.id&&(this.loading="Deleting visitor booking...",this._dialog_ref.disableClose=!0,this.booking.delete().then(t=>{this.event.emit({reason:"done"}),this._service.notifySuccess("Successfully removed visitors."),this._dialog_ref.close()},t=>{this.loading=null,this._service.notifyError(`Failed to remove visitors. Error: ${t.message||t}`),this._dialog_ref.disableClose=!1})),t.close()})),t.afterClosed().subscribe(()=>this.unsub("confirm"))}save(){this.timeout("save",()=>{this.loading="Saving visitor booking...",this.form.markAllAsTouched(),this._dialog_ref.disableClose=!0,this.booking.has_changes&&this.form.valid&&this.booking.save().then(t=>{this.event.emit({reason:"done",metadata:t}),this._service.notifySuccess(this.booking.id?"Successfully updated visitors.":"Successfully added visitors."),this._dialog_ref.close()},t=>{this.loading=null,this._service.notifyError(`Failed to ${this.booking.id?"update":"add"} visitors. Error: ${t.message||t}`),this._dialog_ref.disableClose=!1})})}}return t.\u0275fac=function(e){return new(e||t)(a.Qb(b.a),a.Qb(r.h),a.Qb(r.b),a.Qb(r.a))},t.\u0275cmp=a.Kb({type:t,selectors:[["a-visitors-form-modal"]],outputs:{event:"event"},features:[a.zb],decls:9,vars:5,consts:[[1,"heading"],["mat-icon-button","","mat-dialog-close","",4,"ngIf"],[4,"ngIf","ngIfElse"],[4,"ngIf"],["load_state",""],["mat-icon-button","","mat-dialog-close",""],[3,"icon"],[3,"form","event"],["mat-button","",3,"disabled","tapped"],["mat-button","","class","error",3,"tapped",4,"ngIf"],["mat-button","",1,"error",3,"tapped"],[2,"min-height","12em"],[1,"info-block","center"],[1,"icon"],["diameter","32"],[1,"text"]],template:function(t,e){if(1&t&&(a.Wb(0,"header"),a.Wb(1,"div",0),a.Gc(2),a.Vb(),a.Ec(3,G,2,2,"button",1),a.Vb(),a.Wb(4,"mat-dialog-content"),a.Ec(5,E,2,2,"main",2),a.Vb(),a.Ec(6,j,5,2,"mat-dialog-actions",3),a.Ec(7,z,6,1,"ng-template",null,4,a.Fc)),2&t){const t=a.tc(8);a.Cb(2),a.Ic("",e.booking.id?"Edit":"New"," Visitors"),a.Cb(1),a.oc("ngIf",!e.loading),a.Cb(2),a.oc("ngIf",!e.loading)("ngIfElse",t),a.Cb(1),a.oc("ngIf",!e.loading)}},directives:[i.t,r.f,g.b,r.d,m.a,W,r.c,p.c,k.c],styles:[".heading[_ngcontent-%COMP%]{flex:1;min-width:50%}footer[_ngcontent-%COMP%]{width:100%;text-align:center}footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:10em}main[_ngcontent-%COMP%]{position:relative;min-width:24em}"]}),t})();var F=n("Wgwc"),T=n("BAfr"),A=n("ocbO"),S=n("XNiG"),L=n("LRne"),Q=n("SxV6"),H=n("Kj3r"),N=n("/uUt"),X=n("eIep"),q=n("JIr8"),B=n("lJxs"),K=n("bv9b"),U=n("CbDI"),Y=n("Qu3c"),D=n("YoI9"),J=n("q/DJ");function Z(t,e){1&t&&(a.Wb(0,"div",15),a.Gc(1,"S"),a.Vb())}function tt(t,e){if(1&t&&(a.Wb(0,"div",16),a.Gc(1),a.Vb()),2&t){const t=a.ic();a.Cb(1),a.Hc(t.status)}}const et=function(){return{class:"material-icons",content:"event_available"}};function nt(t,e){1&t&&a.Rb(0,"action-icon",1),2&t&&a.oc("icon",a.pc(1,et))}const it=function(){return{class:"material-icons",content:"face"}},ot=function(){return{class:"material-icons",content:"mail"}};let st=(()=>{class t{constructor(t,e){this._element=t,this._renderer=e}get is_match(){const t=(this.search||"").toLowerCase();return this.person.name.toLowerCase().indexOf(t)>=0||this.person.email.toLowerCase().indexOf(t)>=0}get mail_url(){return`mailto:${this.person.email}?subject="${this.event.title}"%20at%20${this.event.start_time},%20${this.event.date_string}${this.event.organiser_email.toLowerCase()!==this.person.email?"&cc="+this.event.organiser_email:""}`}ngOnChanges(t){t.search&&(this.search&&!this.is_match?this._renderer.addClass(this._element.nativeElement,"not-match"):this._renderer.removeClass(this._element.nativeElement,"not-match"))}}return t.\u0275fac=function(e){return new(e||t)(a.Qb(a.l),a.Qb(a.F))},t.\u0275cmp=a.Kb({type:t,selectors:[["a-visitor"]],inputs:{event:"event",person:"person",search:"search"},features:[a.Ab],decls:18,vars:13,consts:[[1,"icon"],[3,"icon"],[1,"details"],[1,"user"],["class","staff",4,"ngIf"],[1,"name"],[1,"title"],["class","status",4,"ngIf"],[1,"actions"],["mat-icon-button","","matTooltip","Email Visitor",3,"href"],["mat-icon-button","","matTooltip","Checkin Visitor"],[3,"icon",4,"ngIf"],["mat-icon-button","",3,"disabled"],[1,"empty"],[1,"bar"],[1,"staff"],[1,"status"]],template:function(t,e){1&t&&(a.Wb(0,"div",0),a.Rb(1,"app-icon",1),a.Vb(),a.Wb(2,"div",2),a.Wb(3,"div",3),a.Ec(4,Z,2,0,"div",4),a.Wb(5,"div",5),a.Gc(6),a.Vb(),a.Vb(),a.Rb(7,"div",6),a.Ec(8,tt,2,1,"div",7),a.Wb(9,"div",8),a.Wb(10,"a",9),a.jc(11,"safe"),a.Rb(12,"action-icon",1),a.Vb(),a.Wb(13,"button",10),a.Ec(14,nt,1,2,"action-icon",11),a.Vb(),a.Rb(15,"button",12),a.Vb(),a.Rb(16,"div",13),a.Vb(),a.Rb(17,"div",14)),2&t&&(a.Cb(1),a.oc("icon",a.pc(11,it)),a.Cb(3),a.oc("ngIf",!e.person.external),a.Cb(2),a.Hc((null==e.person?null:e.person.name)||(null==e.person?null:e.person.email)),a.Cb(2),a.oc("ngIf",e.person.external),a.Cb(2),a.oc("href",a.lc(11,8,e.mail_url,"url"),a.yc),a.Cb(2),a.oc("icon",a.pc(12,ot)),a.Cb(2),a.oc("ngIf",e.person.external),a.Cb(1),a.oc("disabled",!0))},directives:[m.a,i.t,g.a,Y.a,D.a,g.b],pipes:[J.b],styles:["[_nghost-%COMP%]{position:relative;display:flex;align-items:center;padding-left:4em;transition:opacity .2s}.not-match[_nghost-%COMP%]{opacity:.35;background-color:#fff}[_nghost-%COMP%]:last-child   .details[_ngcontent-%COMP%]{border:none}.details[_ngcontent-%COMP%]{flex:1;min-width:50%;height:4em;border-bottom:1px solid rgba(0,0,0,.1)}.details[_ngcontent-%COMP%], .icon[_ngcontent-%COMP%]{display:flex;align-items:center}.icon[_ngcontent-%COMP%]{justify-content:center;height:2em;width:2em;margin-right:.5em;border-radius:100%;border:2px dotted rgba(0,0,0,.6);color:rgba(0,0,0,.6);font-size:1.5em}.title[_ngcontent-%COMP%]{flex:1;min-width:1em}.user[_ngcontent-%COMP%]{font-weight:400}.staff[_ngcontent-%COMP%], .user[_ngcontent-%COMP%]{display:flex;align-items:center}.staff[_ngcontent-%COMP%]{justify-content:center;height:1.5em;width:1.5em;margin-right:.5em;border-radius:4px;border:3px solid #1937ea;font-weight:600;font-size:.8em;color:#1937ea}.bar[_ngcontent-%COMP%]{position:absolute;width:1.5em;top:50%;left:2.15em;height:2px;min-height:0;background-color:#999;transform:translateY(-50%)}.empty[_ngcontent-%COMP%]{width:4.5em}"]}),t})();function ct(t,e){if(1&t&&(a.Ub(0),a.Gc(1),a.Wb(2,"span"),a.Gc(3),a.Vb(),a.Tb()),2&t){const t=a.ic(2);a.Cb(1),a.Ic(" ",t.event.start_time," "),a.Cb(2),a.Ic(" - ",t.event.duration>0?t.event.end_time:"","")}}function at(t,e){1&t&&(a.Ub(0),a.Gc(1,"All Day"),a.Tb())}function rt(t,e){if(1&t&&a.Rb(0,"a-visitor",22),2&t){const t=e.$implicit,n=a.ic(2);a.oc("event",n.event)("person",t)("search",n.search)}}const dt=function(){return{class:"material-icons",content:"event"}},lt=function(){return{class:"material-icons",content:"mail"}},bt=function(){return{class:"material-icons",content:"event_available"}},gt=function(){return{class:"material-icons",content:"edit"}},mt=function(t){return{class:"material-icons",content:t}};function ht(t,e){if(1&t){const t=a.Xb();a.Wb(0,"div",1),a.Wb(1,"div",2),a.Wb(2,"div",3),a.Rb(3,"app-icon",4),a.Vb(),a.Wb(4,"div",5),a.Ec(5,ct,4,2,"ng-container",6),a.Ec(6,at,2,0,"ng-container",6),a.Vb(),a.Wb(7,"div",7),a.Wb(8,"div",8),a.Gc(9,"S"),a.Vb(),a.Wb(10,"div",9),a.Gc(11),a.Vb(),a.Vb(),a.Wb(12,"div",10),a.Gc(13),a.Vb(),a.Wb(14,"div",11),a.Gc(15),a.Vb(),a.Wb(16,"div",12),a.Gc(17),a.Vb(),a.Wb(18,"div",13),a.Wb(19,"a",14),a.jc(20,"safe"),a.Rb(21,"action-icon",4),a.Vb(),a.Wb(22,"button",15),a.Rb(23,"action-icon",4),a.Vb(),a.Wb(24,"button",16),a.ec("tapped",(function(){return a.wc(t),a.ic().openEditModal()})),a.Rb(25,"action-icon",4),a.Vb(),a.Vb(),a.Wb(26,"div",17),a.Wb(27,"button",18),a.ec("tapped",(function(){a.wc(t);const e=a.ic();return e.show_attendees=!e.show_attendees})),a.Rb(28,"app-icon",4),a.Vb(),a.Vb(),a.Vb(),a.Wb(29,"div",19),a.Rb(30,"div",20),a.Ec(31,rt,1,3,"a-visitor",21),a.Vb(),a.Vb()}if(2&t){const t=a.ic();a.Gb("showing",t.show_attendees),a.Cb(1),a.Gb("blur",t.search),a.Cb(2),a.oc("icon",a.pc(21,dt)),a.Cb(2),a.oc("ngIf",!t.event.all_day),a.Cb(1),a.oc("ngIf",t.event.all_day),a.Cb(5),a.Hc((null==t.event.organiser?null:t.event.organiser.name)||t.event.organiser_email),a.Cb(2),a.Hc(t.event.title),a.Cb(2),a.Hc((null==t.event.space?null:t.event.space.name)||t.event.location),a.Cb(2),a.Hc(t.status),a.Cb(2),a.oc("href",a.lc(20,18,t.mail_url,"url"),a.yc),a.Cb(2),a.oc("icon",a.pc(22,lt)),a.Cb(2),a.oc("icon",a.pc(23,bt)),a.Cb(2),a.oc("icon",a.pc(24,gt)),a.Cb(3),a.oc("icon",a.qc(25,mt,t.show_attendees?"keyboard_arrow_down":"keyboard_arrow_right")),a.Cb(1),a.oc("@show",t.show_attendees?"show":"hide"),a.Cb(2),a.oc("ngForOf",t.event.attendees)}}let ft=(()=>{class t{constructor(t){this._dialog=t}get status(){const t=this.event.checked_in instanceof Array?this.event.checked_in:[],{checked_in:e,count:n}=this.event.attendees.reduce((e,n)=>(n.external&&(e.count++,t.indexOf(n.email)>=0&&e.checked_in++),e),{checked_in:0,count:0});return`${e} / ${n}`}get mail_url(){return`mailto:${this.event.attendee_emails.join(",")}?Subject="${this.event.title}"%20at%20${this.event.start_time},%20${this.event.date_string}`}ngOnChanges(t){t.search&&(this.show_attendees=!!this.search)}openEditModal(){this._dialog.open($,{data:{booking:this.event}})}}return t.\u0275fac=function(e){return new(e||t)(a.Qb(r.b))},t.\u0275cmp=a.Kb({type:t,selectors:[["a-visitor-booking"]],inputs:{event:"event",search:"search"},features:[a.Ab],decls:1,vars:1,consts:[["class","visitor-booking",3,"showing",4,"ngIf"],[1,"visitor-booking"],[1,"details"],[1,"icon"],[3,"icon"],[1,"time"],[4,"ngIf"],[1,"host"],[1,"staff"],[1,"name"],[1,"title"],[1,"location"],[1,"status"],[1,"actions"],["mat-icon-button","","matTooltip","Email Visitors",3,"href"],["mat-icon-button","","matTooltip","Checkin All Visitors"],["mat-icon-button","","matTooltip","Edit Visitors",3,"tapped"],[1,"toggle"],["mat-icon-button","",3,"tapped"],[1,"attendees"],[1,"bar"],[3,"event","person","search",4,"ngFor","ngForOf"],[3,"event","person","search"]],template:function(t,e){1&t&&a.Ec(0,ht,32,27,"div",0),2&t&&a.oc("ngIf",e.event)},directives:[i.t,m.a,g.a,Y.a,D.a,g.b,p.c,i.s,st],pipes:[J.b],styles:["[_nghost-%COMP%]{font-size:.9em}.visitor-booking[_ngcontent-%COMP%]{transition:background .2s;background-color:#fff;border-bottom:1px solid rgba(0,0,0,.1)}.showing[_ngcontent-%COMP%]{background-color:#f0f0f0}.showing[_ngcontent-%COMP%]   .toggle[_ngcontent-%COMP%]{color:#1937ea}.details[_ngcontent-%COMP%]{position:relative;z-index:10;display:flex;align-items:center;padding:.5em 0;transition:opacity .2s}.details.blur[_ngcontent-%COMP%]{opacity:.35;background-color:#fff}.details[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:0 .5em}.details[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{width:7.75rem;font-size:.9em}.details[_ngcontent-%COMP%]   .host[_ngcontent-%COMP%]{width:13.25em}.details[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%]{width:12em}.icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:2em;width:2em;border-radius:100%;background-color:#ccc;font-size:1.5em}.time[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:rgba(0,0,0,.65)}.title[_ngcontent-%COMP%]{flex:1;min-width:1em}.host[_ngcontent-%COMP%]{display:flex;align-items:center;font-weight:400}.status[_ngcontent-%COMP%]{font-size:.9em;font-weight:500;width:3.5em}.staff[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:1.5em;width:1.5em;margin-right:.5em;border-radius:4px;border:3px solid #1937ea;font-weight:600;font-size:.8em;color:#1937ea}.attendees[_ngcontent-%COMP%]{position:relative}.attendees[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{position:absolute;top:-.65em;left:2.15em;width:2px;background-color:#999;bottom:2em}.toggle[_ngcontent-%COMP%]{font-size:1.2rem}"],data:{animation:[U.a]}}),t})();function ut(t,e){1&t&&(a.Wb(0,"div",12),a.Rb(1,"mat-progress-bar",13),a.Vb())}function pt(t,e){1&t&&(a.Wb(0,"div",16),a.Rb(1,"div",17),a.Vb())}function _t(t,e){1&t&&(a.Wb(0,"div",16),a.Rb(1,"div",17),a.Vb())}function vt(t,e){if(1&t&&(a.Ub(0),a.Rb(1,"a-visitor-booking",18),a.Ec(2,_t,2,0,"div",14),a.Tb()),2&t){const t=e.$implicit,n=e.index,i=a.ic(2);a.Cb(1),a.oc("event",t)("search",i.search),a.Cb(1),a.oc("ngIf","Today"===i.date_display&&i.active_index===n)}}function Ct(t,e){if(1&t&&(a.Ub(0),a.Ec(1,pt,2,0,"div",14),a.Ec(2,vt,3,3,"ng-container",15),a.Tb()),2&t){const t=a.ic();a.Cb(1),a.oc("ngIf","Today"===t.date_display&&-1===t.active_index),a.Cb(1),a.oc("ngForOf",t.filtered_bookings)}}const Ot=function(){return{class:"material-icons",content:"close"}};function Mt(t,e){if(1&t&&(a.Wb(0,"div",19),a.Wb(1,"div",3),a.Rb(2,"app-icon",20),a.Vb(),a.Wb(3,"div",21),a.Gc(4),a.Vb(),a.Vb()),2&t){const t=a.ic();a.Cb(2),a.oc("icon",a.pc(3,Ot)),a.Cb(2),a.Jc("No visitors ",t.search?'matching "'+t.search+'"':""," for ",t.date_display,"")}}let Pt=(()=>{class t extends d.a{constructor(t){super(),this._service=t,this.visitor_bookings=[],this.filtered_bookings=[],this.search$=new S.a}get date_display(){const t=F(this.date);return t.isSame(F(),"d")?"Today":t.format("DD MMM YYYY")}get active_index(){if("Today"===this.date_display){const t=F().startOf("m").valueOf();return this.filtered_bookings.findIndex(e=>t>e.date)}return-1}ngOnInit(){this._service.Organisation.initialised.pipe(Object(Q.a)(t=>t)).subscribe(()=>{this.initBookings(),this.subscription("building",this._service.Organisation.listen("active_building").subscribe(t=>this.search$.next(`${this.date}|${t.id}`))),this.interval("update_bookings",()=>this.search$.next(`${this.date}|${F().unix()}`),3e4)})}ngOnChanges(t){t.date&&this.search$.next(`${this.date}`),t.search&&(this.filtered_bookings=this.filter(this.search))}filter(t=""){const e=t.toLowerCase();return(this.visitor_bookings||[]).filter(t=>t.attendees.find(t=>t.name.toLowerCase().indexOf(e)>=0||t.email.toLowerCase().indexOf(e)>=0))}initBookings(){this.search_results$=this.search$.pipe(Object(H.a)(100),Object(N.a)(),Object(X.a)(t=>{this.loading=!0;const e=F(this.date).startOf("d");return this._service.Spaces.query({zone_ids:this._service.Organisation.building.id,available_from:e.unix(),available_to:e.endOf("d").unix()})}),Object(q.a)(t=>Object(L.a)([])),Object(B.a)(t=>{const e=t.reduce((t,e)=>t.concat(e.bookingsFor(this.date)),[]);return e.sort((t,e)=>t.date-e.date),e.filter(t=>t.has_visitors)})),this.subscription("search_results",this.search_results$.subscribe(t=>{this.loading=!1,this.visitor_bookings=t,this.filtered_bookings=this.filter(this.search)}))}}return t.\u0275fac=function(e){return new(e||t)(a.Qb(b.a))},t.\u0275cmp=a.Kb({type:t,selectors:[["visitor-timeline"]],inputs:{date:"date",search:"search"},features:[a.zb,a.Ab],decls:18,vars:3,consts:[[1,"visitor-timeline"],["class","loader",4,"ngIf"],[1,"heading"],[1,"icon"],[1,"time"],[1,"host"],[1,"title"],[1,"location"],[1,"state"],[1,"list"],[4,"ngIf","ngIfElse"],["empty_state",""],[1,"loader"],["mode","indeterminate"],["class","current-line",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"current-line"],[1,"triangle"],[3,"event","search"],[1,"info-block"],[3,"icon"],[1,"text"]],template:function(t,e){if(1&t&&(a.Wb(0,"div",0),a.Ec(1,ut,2,0,"div",1),a.Wb(2,"div",2),a.Rb(3,"div",3),a.Wb(4,"div",4),a.Gc(5,"Time"),a.Vb(),a.Wb(6,"div",5),a.Gc(7,"Host"),a.Vb(),a.Wb(8,"div",6),a.Gc(9,"Title"),a.Vb(),a.Wb(10,"div",7),a.Gc(11,"Location"),a.Vb(),a.Wb(12,"div",8),a.Gc(13,"Status"),a.Vb(),a.Vb(),a.Wb(14,"div",9),a.Ec(15,Ct,3,2,"ng-container",10),a.Vb(),a.Vb(),a.Ec(16,Mt,5,4,"ng-template",null,11,a.Fc)),2&t){const t=a.tc(17);a.Cb(1),a.oc("ngIf",e.loading),a.Cb(14),a.oc("ngIf",e.filtered_bookings&&e.filtered_bookings.length)("ngIfElse",t)}},directives:[i.t,K.a,i.s,ft,m.a],styles:[".visitor-timeline[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;height:100%;width:100%;background-color:#ecf1f5}.heading[_ngcontent-%COMP%], a-visitor-booking[_ngcontent-%COMP%]{width:100%;border-bottom:1px solid rgba(0,0,0,.1)}.heading[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;font-weight:400;font-size:.8em;z-index:1}.heading[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{padding:.25em 0;text-transform:capitalize}.heading[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:5.5em}.heading[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{width:10em}.heading[_ngcontent-%COMP%]   .host[_ngcontent-%COMP%]{width:16em}.heading[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{flex:1}.heading[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%]{width:14.25em}.heading[_ngcontent-%COMP%]   .state[_ngcontent-%COMP%]{width:19.25em}.current-line[_ngcontent-%COMP%]{position:relative;width:100%;height:2px;background-color:#1937ea;z-index:99}.current-line[_ngcontent-%COMP%]   .triangle[_ngcontent-%COMP%]{position:absolute;top:50%;left:0;transform:translateY(-50%);width:0;height:0;border-color:transparent transparent transparent #1937ea;border-style:solid;border-width:6px 0 6px 6px}.list[_ngcontent-%COMP%]{min-height:50%;flex:1;width:100%;overflow:auto}.loader[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;right:0;height:4px;z-index:999}"]}),t})();const wt=function(){return{class:"material-icons",content:"close"}};function Vt(t,e){if(1&t){const t=a.Xb();a.Wb(0,"button",13),a.ec("tapped",(function(){return a.wc(t),a.ic().search_str=""})),a.Rb(1,"app-icon",14),a.Vb()}2&t&&(a.Cb(1),a.oc("icon",a.pc(1,wt)))}const xt=function(){return{class:"material-icons",content:"search"}};let yt=(()=>{class t{constructor(t,e){this._dialog=t,this._service=e}ngOnInit(){}newVisitorMeeting(){let t=F();t=t.minute(5*Math.ceil(t.minute()/5));const e=this._service.Organisation.building,n=this._service.Spaces.item(e.visitor_space||e.holding_bay),i=new c.a(this._service.Bookings,{date:t.valueOf(),duration:-1,room_id:[n.email]});this._dialog.open($,{data:{booking:i}})}}return t.\u0275fac=function(e){return new(e||t)(a.Qb(r.b),a.Qb(b.a))},t.\u0275cmp=a.Kb({type:t,selectors:[["app-visitors"]],decls:17,vars:9,consts:[[1,"visitors"],[1,"group"],[3,"date","dateChange"],[1,"input-wrapper"],["appearance","outline"],["matPrefix","",3,"icon"],["matInput","","name","visitor-name","placeholder","Search...",3,"ngModel","ngModelChange"],["mat-icon-button","","matSuffix","",3,"tapped",4,"ngIf"],[3,"date","search"],["mat-button","",1,"new-item",3,"touchrelease"],[1,"content"],[1,"material-icons"],[1,"text"],["mat-icon-button","","matSuffix","",3,"tapped"],[3,"icon"]],template:function(t,e){1&t&&(a.Wb(0,"div",0),a.Rb(1,"a-sidebar"),a.Wb(2,"div",1),a.Wb(3,"a-topbar-header",2),a.ec("dateChange",(function(t){return e.date=t}))("dateChange",(function(){return e.search_str=""})),a.Wb(4,"div",3),a.Wb(5,"mat-form-field",4),a.Rb(6,"app-icon",5),a.Wb(7,"input",6),a.ec("ngModelChange",(function(t){return e.search_str=t})),a.Vb(),a.Ec(8,Vt,2,2,"button",7),a.Vb(),a.Vb(),a.Vb(),a.Wb(9,"main"),a.Rb(10,"visitor-timeline",8),a.Vb(),a.Vb(),a.Wb(11,"button",9),a.ec("touchrelease",(function(){return e.newVisitorMeeting()})),a.Wb(12,"div",10),a.Wb(13,"div",11),a.Gc(14,"add"),a.Vb(),a.Wb(15,"div",12),a.Gc(16,"Add Visitors"),a.Vb(),a.Vb(),a.Vb(),a.Vb()),2&t&&(a.Cb(3),a.oc("date",e.date),a.Cb(2),a.Gb("rounded",!0),a.Cb(1),a.oc("icon",a.pc(8,xt)),a.Cb(1),a.oc("ngModel",e.search_str),a.Cb(1),a.oc("ngIf",e.search_str),a.Cb(2),a.oc("date",e.date)("search",e.search_str))},directives:[T.a,A.a,f.b,m.a,f.h,u.a,s.c,s.r,s.u,i.t,Pt,g.b,p.c,f.i],styles:[".visitors[_ngcontent-%COMP%], [_nghost-%COMP%], main[_ngcontent-%COMP%]{height:100%;width:100%}.visitors[_ngcontent-%COMP%]{display:flex;height:100%}.input-wrapper[_ngcontent-%COMP%]{height:3.5em;padding:0 .5em}.input-wrapper[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{font-size:1.25em}main[_ngcontent-%COMP%]{height:calc(100% - 3.5em)}.group[_ngcontent-%COMP%]{flex:1;min-width:12em}.topbar[_ngcontent-%COMP%]{padding:.1em 0 .1em .5em;height:3.5em}.topbar[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{margin-right:.5em}.new-item[_ngcontent-%COMP%]{position:absolute;bottom:1em;right:1em;z-index:999;cursor:pointer;height:1.5em;min-width:1.5em;padding:0;border-radius:.8em;font-size:1.75em;border:none;transition:padding .2s;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.new-item[_ngcontent-%COMP%], .new-item[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{align-items:center;justify-content:center}.new-item[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex}.new-item[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{width:0;overflow:hidden;opacity:0;transition:width .2s,opacity .2s;font-size:1.2rem}.new-item[_ngcontent-%COMP%]:hover{padding:0 .5em}.new-item[_ngcontent-%COMP%]:hover   .text[_ngcontent-%COMP%]{width:7em;opacity:1}"]}),t})();var Wt=n("PCNd");n.d(e,"VisitorsModule",(function(){return It}));const kt=[{path:"",component:yt},{path:":level",component:yt},{path:"**",redirectTo:""}];let It=(()=>{class t{}return t.\u0275mod=a.Ob({type:t}),t.\u0275inj=a.Nb({factory:function(e){return new(e||t)},imports:[[i.c,s.l,s.B,o.g.forChild(kt),Wt.a]]}),t})()}}]);