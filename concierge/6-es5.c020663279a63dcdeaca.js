function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o,r=!0,a=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return r=e.done,e},e:function(e){a=!0,o=e},f:function(){try{r||null==i.return||i.return()}finally{if(a)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){return function(){var t,n=_getPrototypeOf(e);if(_isNativeReflectConstruct()){var i=_getPrototypeOf(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return _possibleConstructorReturn(this,t)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{QM1m:function(e,t,n){"use strict";n.r(t);var i=n("ofXK"),o=n("tyNb"),r=n("IWZj"),a=n("SxV6"),c=n("xUvU"),s=n("xhdr"),l=n("fXoL"),d=n("OaWH"),g=n("0IaG"),v=n("BAfr"),u=n("ocbO"),b=n("kmnG"),f=n("d3UM"),p=n("3Pt+"),h=n("1jcm"),_=n("TnpO"),m=n("Wgwc"),C=n("m6yr"),O=n("bv9b"),y=n("5+WD"),M=n("g+Po"),w=n("9Kh7"),P=n("0njA"),k=n("Xa2L"),x=n("bTqV"),V=function(e){return{class:"material-icons",content:e}};function W(e,t){if(1&e&&l.Rb(0,"app-icon",18),2&e){var n=l.ic(2);l.oc("icon",l.qc(1,V,n.event.approved?"done":n.event.declined?"event_busy":""))}}function E(e,t){1&e&&l.Rb(0,"mat-spinner",19)}function I(e,t){if(1&e&&(l.Wb(0,"div",20),l.Wb(1,"div",10),l.Gc(2,"Booked by:\xa0"),l.Vb(),l.Wb(3,"div",11),l.Gc(4),l.Vb(),l.Vb()),2&e){var n=l.ic(2);l.Cb(3),l.oc("title","Booked By: "+((null==n.event.creator?null:n.event.creator.name)||n.event.creator)),l.Cb(1),l.Ic(" ",(null==n.event.creator?null:n.event.creator.name)||n.event.creator," ")}}function D(e,t){if(1&e&&(l.Wb(0,"div",21),l.Wb(1,"div",14),l.Gc(2),l.Vb(),l.Vb()),2&e){var n=l.ic(2);l.oc("title","Welcomed by: "+n.event.notify_users[0]),l.Cb(2),l.Ic("Welcomed by: ",n.event.notify_users[0],"")}}function S(e,t){1&e&&(l.Wb(0,"div",13),l.Wb(1,"div",14),l.Gc(2,"Catered"),l.Vb(),l.Vb())}var G=function(){return{class:"material-icons",content:"restaurant"}};function R(e,t){if(1&e){var n=l.Xb();l.Wb(0,"button",22),l.ec("touchrelease",(function(){l.wc(n);var e=l.ic(2);return e.viewOrder(e.order.id)})),l.Rb(1,"app-icon",18),l.Vb()}2&e&&(l.Cb(1),l.oc("icon",l.pc(1,G)))}function z(e,t){if(1&e){var n=l.Xb();l.Wb(0,"div",1),l.Rb(1,"div"),l.Wb(2,"div",2),l.ec("touchrelease",(function(){return l.wc(n),l.ic().view()})),l.Wb(3,"div",3),l.Wb(4,"div",4),l.Gc(5),l.Vb(),l.Wb(6,"div",5),l.Ec(7,W,1,3,"app-icon",6),l.Ec(8,E,1,0,"mat-spinner",7),l.Vb(),l.Vb(),l.Wb(9,"div",8),l.Wb(10,"div",9),l.Wb(11,"div",10),l.Gc(12,"Host:\xa0"),l.Vb(),l.Wb(13,"div",11),l.Gc(14),l.Vb(),l.Vb(),l.Ec(15,I,5,2,"div",12),l.Wb(16,"div",13),l.Wb(17,"div",11),l.Gc(18),l.Vb(),l.Vb(),l.Wb(19,"div",13),l.Wb(20,"div",14),l.Gc(21),l.Vb(),l.Vb(),l.Ec(22,D,3,2,"div",15),l.Ec(23,S,3,0,"div",16),l.Vb(),l.Vb(),l.Ec(24,R,2,2,"button",17),l.Vb()}if(2&e){var i=l.ic();l.Dc("top",i.top+"%")("left",i.left+"%")("width",i.fixed?"15rem":i.width+"%")("height",i.fixed?3*i.height+"rem":i.height+"%"),l.Gb("fixed",i.fixed)("inactive",!i.active),l.oc("id","event-"+i.event.local_id),l.Cb(1),l.Eb("overflow"+(i.type?" "+i.type:"")),l.Dc("top",0-i.overflow_top+"%")("bottom",0-i.overflow_bottom+"%"),l.Cb(1),l.Eb("event"+(i.type?" "+i.type:"")+(i.top>50?" low":"")),l.Dc("z-index",((null==i.overlap?null:i.overlap.index)||0)+2),l.Cb(3),l.Hc(i.event.all_day?"All Day":i.period),l.Cb(2),l.oc("ngIf",!i.loading&&(i.event.declined||i.event.approved)),l.Cb(1),l.oc("ngIf",i.loading),l.Cb(5),l.oc("title","Host: "+((null==i.event.organiser?null:i.event.organiser.name)||i.event.organiser)),l.Cb(1),l.Ic(" ",(null==i.event.organiser?null:i.event.organiser.name)||i.event.organiser," "),l.Cb(1),l.oc("ngIf",i.event.creator&&i.event.creator.email!==i.event.organiser.email),l.Cb(2),l.oc("title","Title: "+i.event.title),l.Cb(1),l.Hc(i.event.title),l.Cb(3),l.Kc(" ",i.event.attendees&&i.event.attendees.length||"No"," Attendee",1===(null==i.event.attendees?null:i.event.attendees.length)?"":"s","",i.expected?"("+i.expected+" Expected)":""," "),l.Cb(1),l.oc("ngIf",i.event.notify_users),l.Cb(1),l.oc("ngIf",i.has_catering),l.Cb(1),l.oc("ngIf",i.has_catering)}}var A,j=((A=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i,o){var r;return _classCallCheck(this,n),(r=t.call(this))._service=e,r._dialog=i,r._router=o,r.position=new l.o,r}return _createClass(n,[{key:"view",value:function(){this._dialog.open(_.a,{maxHeight:"95vh",maxWidth:"95vw",data:{booking:this.event}})}},{key:"ngOnChanges",value:function(e){(e.event||e.overlap||e.date)&&this.calculatePosition()}},{key:"viewOrder",value:function(e){if(this.event&&this.event.catering){if(sessionStorage){sessionStorage.setItem("CONCIERGE.view_order",e);var t=JSON.stringify(Object.assign(Object.assign({},this.event),{room:Object.assign(Object.assign({},this.space),{bookings:[]})}));sessionStorage.setItem("CONCIERGE.order_booking",t)}this._router.navigate(["/catering","orders"],{queryParams:{booking:this.event.id,view:e}})}}},{key:"calculatePosition",value:function(){if(this.event){var e=this.overlap||{index:0,total:1},t=m(this.date).startOf("d"),n=m(this.event.date).startOf("m"),i=+n.diff(t,"h",!0).toFixed(3),o=Math.min(this.event.duration,Math.abs(t.diff(n.add(this.event.duration,"m"),"m")));this.top=Math.max(0,i/24*100),this.height=Math.min(100-this.top,this.fixed?o/60:o/60/24*100),this.position.emit({top:this.top,height:o/60/24*100}),this.width=Math.min(100,100/e.total+5),this.left=Math.min(100-this.width,this.width*e.index-5*e.index),this.overflow_top=100*(this.event.setup?this.event.setup/o:-.1),this.overflow_bottom=100*(this.event.breakdown?this.event.breakdown/o:-.1)}}},{key:"type",get:function(){if(!this.event||!this.event.type)return"";if(this.event.declined)return"cancelled";var e=this.event.type;return"internal"===e&&this.event.has_visitors?"external":e}},{key:"period",get:function(){return"".concat(this.event?this.event.time_period:"")}},{key:"expected",get:function(){return this.space&&(this.event.expected_attendees||{})[this.space.id]||0}},{key:"has_catering",get:function(){var e=this;return!!this.event&&!!(this.event.catering||[]).find((function(t){return e.event.space.id===t.location_id}))}},{key:"order",get:function(){var e=this;return(this.event.catering||[]).find((function(t){return t.location_id===e.space.id}))}},{key:"active",get:function(){var e=this._service.get("CONCIERGE.day_view.viewing");return!e||e.id===this.event.id}}]),n}(r.a)).\u0275fac=function(e){return new(e||A)(l.Qb(d.a),l.Qb(g.b),l.Qb(o.c))},A.\u0275cmp=l.Kb({type:A,selectors:[["day-view-space-event"]],inputs:{event:"event",date:"date",space:"space",fixed:"fixed",overlap:"overlap",loading:"loading"},outputs:{position:"position"},features:[l.zb,l.Ab],decls:1,vars:1,consts:[["class","event-container",3,"id","fixed","inactive","top","left","width","height",4,"ngIf"],[1,"event-container",3,"id"],[3,"touchrelease"],[1,"header"],[1,"text"],[1,"handle"],[3,"icon",4,"ngIf"],["diameter","16",4,"ngIf"],[1,"body"],[1,"field","host"],[1,"label"],[1,"value",3,"title"],["class","field booked-by",4,"ngIf"],[1,"field"],[1,"value"],["class","field",3,"title",4,"ngIf"],["class","field",4,"ngIf"],["class","catering-icon","mat-icon-button","",3,"touchrelease",4,"ngIf"],[3,"icon"],["diameter","16"],[1,"field","booked-by"],[1,"field",3,"title"],["mat-icon-button","",1,"catering-icon",3,"touchrelease"]],template:function(e,t){1&e&&l.Ec(0,z,25,37,"div",0),2&e&&l.oc("ngIf",t.event)},directives:[i.t,C.c,P.a,k.c,x.b],styles:[".event-container[_ngcontent-%COMP%]{position:absolute;pointer-events:auto;transition:-webkit-filter .2s;transition:filter .2s;transition:filter .2s,-webkit-filter .2s}.event-container[_ngcontent-%COMP%]:hover{-webkit-filter:none;filter:none}.event-container[_ngcontent-%COMP%]:hover   .catering-icon[_ngcontent-%COMP%]{z-index:999}.event-container[_ngcontent-%COMP%]:hover   .event[_ngcontent-%COMP%]{z-index:999!important;bottom:auto;min-height:100%;left:5px;right:5px}.event-container[_ngcontent-%COMP%]:hover   .event.low[_ngcontent-%COMP%]{bottom:0;top:auto}.event-container.fixed[_ngcontent-%COMP%]:hover   .event[_ngcontent-%COMP%]{z-index:999!important;top:0;left:1px;right:1px;bottom:0}.overflow[_ngcontent-%COMP%]{position:absolute;top:2px;left:2px;right:2px;bottom:2px;border-radius:4px;background-color:rgba(31,64,230,.2)}.overflow.internal[_ngcontent-%COMP%]{background-color:rgba(230,159,199,.2)}.overflow.external[_ngcontent-%COMP%]{background-color:rgba(140,90,200,.2)}.overflow.training[_ngcontent-%COMP%]{background-color:rgba(240,231,0,.2)}.overflow.interview[_ngcontent-%COMP%]{background-color:rgba(52,141,2,.2)}.overflow.setup[_ngcontent-%COMP%]{background-color:rgba(211,47,47,.2)}.overflow.cancelled[_ngcontent-%COMP%]{background-color:rgba(97,114,136,.2)}.event[_ngcontent-%COMP%]{position:absolute;overflow:hidden;top:0;left:1px;right:1px;bottom:0;border-radius:4px;background-color:#fff;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12);transition:bottom .2s,top .2s,left .2s,right .2s;border:1px solid #1f40e6}.event[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:#1f40e6}.event[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{background-color:rgba(31,64,230,.2)}.event.pending[_ngcontent-%COMP%]{border-color:rgba(31,64,230,.4)}.event.pending[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:rgba(31,64,230,.4)}.event.internal[_ngcontent-%COMP%]{border-color:#e69fc7}.event.internal[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:#e69fc7}.event.internal[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{background-color:rgba(230,159,199,.2)}.event.internal.pending[_ngcontent-%COMP%]{border-color:rgba(230,159,199,.4)}.event.internal.pending[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:rgba(230,159,199,.4)}.event.external[_ngcontent-%COMP%]{border-color:#8c5ac8}.event.external[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:#8c5ac8}.event.external[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{background-color:rgba(140,90,200,.2)}.event.external.pending[_ngcontent-%COMP%]{border-color:rgba(140,90,200,.4)}.event.external.pending[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:rgba(140,90,200,.4)}.event.training[_ngcontent-%COMP%]{border-color:#f0e700}.event.training[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:#f0e700}.event.training[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{background-color:rgba(240,231,0,.2)}.event.training.pending[_ngcontent-%COMP%]{border-color:rgba(240,231,0,.4)}.event.training.pending[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:rgba(240,231,0,.4)}.event.interview[_ngcontent-%COMP%]{border-color:#348d02}.event.interview[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:#348d02}.event.interview[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{background-color:rgba(52,141,2,.2)}.event.interview.pending[_ngcontent-%COMP%]{border-color:rgba(52,141,2,.4)}.event.interview.pending[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:rgba(52,141,2,.4)}.event.setup[_ngcontent-%COMP%]{border-color:#d32f2f}.event.setup[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:#d32f2f}.event.setup[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{background-color:rgba(211,47,47,.2)}.event.setup.pending[_ngcontent-%COMP%]{border-color:rgba(211,47,47,.4)}.event.setup.pending[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:rgba(211,47,47,.4)}.event.cancelled[_ngcontent-%COMP%]{border-color:#617288}.event.cancelled[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:#617288}.event.cancelled[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{background-color:rgba(97,114,136,.2)}.event.cancelled.pending[_ngcontent-%COMP%]{border-color:rgba(97,114,136,.4)}.event.cancelled.pending[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{background-color:rgba(97,114,136,.4)}.inactive[_ngcontent-%COMP%]{-webkit-filter:blur(1px) grayscale(80%);filter:blur(1px) grayscale(80%)}.header[_ngcontent-%COMP%]{display:flex;align-items:center;height:1.5em}.header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-size:.8em;padding:1em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;min-width:50%}.handle[_ngcontent-%COMP%]{height:100%;width:1.8em;background-color:#1f40e6;color:#fff;display:flex;align-items:center;justify-content:center}.body[_ngcontent-%COMP%]{padding:1em;font-size:.8em}.field[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:.5em}.field[_ngcontent-%COMP%]:last-child{margin:none}.host[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-style:italic}.catering-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;position:absolute;bottom:-4px;right:4px;height:2.5em;width:2.5em;background-color:#fff;border:1px solid #ccc;z-index:100;font-size:.6em}spinner[_ngcontent-%COMP%]{font-size:.3em}"]}),A),T=["view"];function F(e,t){if(1&e&&(l.Wb(0,"div",9),l.Wb(1,"div",10),l.Rb(2,"day-view-space-event",11),l.Vb(),l.Vb()),2&e){var n=l.ic().$implicit,i=l.ic();l.Cb(2),l.oc("fixed",!0)("space",i.space)("event",n)}}function B(e,t){if(1&e&&l.Rb(0,"div",12),2&e){var n=l.ic().$implicit,i=l.ic();l.Dc("top",(i.top||(i.position_list[n.id]?i.position_list[n.id].top:0))+"%")("height",(i.position_list[n.id]?i.position_list[n.id].height:100)+"%")}}function H(e,t){if(1&e){var n=l.Xb();l.Wb(0,"div",5),l.ec("cdkDragStarted",(function(){return l.wc(n),l.ic().initDrag()}))("cdkDragMoved",(function(e){return l.wc(n),l.ic().updateDragTop(e)}))("cdkDragReleased",(function(){return l.wc(n),l.ic().endDrag()})),l.Wb(1,"day-view-space-event",6),l.ec("position",(function(e){l.wc(n);var i=t.$implicit,o=l.ic();return o.position_list?o.position_list[i.id]=e:""})),l.Vb(),l.Ec(2,F,3,3,"div",7),l.Ec(3,B,1,4,"div",8),l.Vb()}if(2&e){var i=t.$implicit,o=l.ic();l.Dc("display",!1!==o.in_view?"":"none"),l.oc("cdkDragDisabled","upcoming"!==i.status||i.declined||!o.settings.dragdrop),l.Cb(1),l.oc("space",o.space)("date",o.date)("event",i)("loading",o.loading?o.loading[i.id]:null)("overlap",o.overlap_details?o.overlap_details[i.id]:null)}}function L(e,t){1&e&&(l.Wb(0,"div",13),l.Wb(1,"div",14),l.Gc(2,"Moving meeting"),l.Vb(),l.Wb(3,"div",15),l.Rb(4,"mat-spinner",16),l.Vb(),l.Vb())}var N,Q=function(){return[]},Y=function(e,t){return{top:e,list:t}},X=((N=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i){var o;return _classCallCheck(this,n),(o=t.call(this))._service=e,o._dialog=i,o.legend={},o.inView=new l.o,o.dragging=new l.o,o.overlap_details={},o.position_list={},o.settings={},o}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;this._service.initialised.pipe(Object(a.a)((function(e){return e}))).subscribe((function(){e.settings=e._service.setting("app.day_view")||{},e.subscription("breakdown",e._service.listen("APP.breakdown",(function(t){e.overflow_only=t}))),e.subscription("legend",e._service.listen("CONCIERGE.legend",(function(t){e.legend=t||{}})))}))}},{key:"ngOnChanges",value:function(e){var t=this;e.scroll&&this.checkInView(),e.last_update&&this.timeout("update_overlaps",(function(){return t.calculateOverlaps()}),1e3)}},{key:"trackByFn",value:function(e,t){return t.id||e}},{key:"calculateOverlaps",value:function(){var e=this,t=this.events.sort((function(e,t){return e.date-t.date||e.duration-t.duration||(e.title||"").localeCompare(t.title||"")}));t.forEach((function(t){return e.overlap_details[t.id]={index:0,total:1}}));var n,i=_createForOfIteratorHelper(t);try{var o=function(){var i,o=n.value,r=m(o.date).startOf("m"),a=m(r).add(o.duration,"m").startOf("m"),c=1,s=0,l=[],d=_createForOfIteratorHelper(t);try{var g=function(){var e=i.value;if(o.id!==e.id){var n=m(e.date).startOf("m"),d=m(n).add(e.duration,"m").startOf("m");(r.isSame(n,"m")||r.isAfter(n,"m")&&r.isBefore(d,"m")||a.isSame(d,"m")||a.isAfter(n,"m")&&a.isBefore(d,"m"))&&(c++,l.push(o),t.findIndex((function(e){return e.id===o.id}))>t.findIndex((function(t){return t.id===e.id}))&&s++)}};for(d.s();!(i=d.n()).done;)g()}catch(v){d.e(v)}finally{d.f()}e.overlap_details[o.id]={index:Math.max(0,s),total:c}};for(i.s();!(n=i.n()).done;)o()}catch(r){i.e(r)}finally{i.f()}}},{key:"checkInView",value:function(){if(this.view&&this.view.nativeElement){var e=this.view.nativeElement;this.in_view=e.offsetLeft+this.scroll>=-240&&e.offsetLeft+this.scroll<=window.innerWidth,this.inView.emit(this.in_view)}}},{key:"initDrag",value:function(){this.box=this.view.nativeElement.getBoundingClientRect(),console.log("Drag Start"),this.dragging.emit(!0)}},{key:"endDrag",value:function(){var e=this;this.timeout("end_drag",(function(){return e.top=0}),10),console.log("Drag End"),this.dragging.emit(!1)}},{key:"updateDragTop",value:function(e){if(e.delta.y){var t=15*Math.round((e.pointerPosition.y-this.box.top-this.scroll_top)/this.box.height*24*60/15)/60;this.top=t/24*100}}},{key:"drop",value:function(e){var t=this,n=e.item.element.nativeElement.id,i=e.previousContainer.data.list.find((function(e){return e.id===n}));if(i){var o=Math.round((e.previousContainer.data.top||0)/100*24*60),r=m(i.date),a=r.startOf("d").minute(o);if(m().startOf("m").isAfter(a,"m"))return this._service.notifyError("Meetings cannot be moved into the past");this.loading[i.id]=!0,this.override_state=i.icaluid;var c=i.space,s="Update ".concat(i.organiser.name,"'s meeting in \"").concat((i.space||{}).name,'" from ').concat(r.format("h:mm A")," to ").concat(a.format("h:mm A")),l="Successfully updated meeting time from ".concat(r.format("h:mm A")," to ").concat(a.format("h:mm A")),d=Object.assign(Object.assign({},i),{old_date:i.date,date:a.valueOf()});if(e.container!==e.previousContainer&&(c=this._service.Spaces.item(e.container.id.replace("space-col-","")),d.from_room=i.space.email,s="Move ".concat(i.organiser.name,"'s meeting in \"").concat((i.space||{}).name,'" to "').concat(c.name,'" at ').concat(a.format("h:mm A")),l='Successfully moved booking to "'.concat(c.name,'" at ').concat(a.format("h:mm A"))),c===i.space&&a.isSame(r,"m"))return this.loading[i.id]=!1,void(this.override_state=null);var g=[c].concat(_toConsumableArray(i.space_list.filter((function(e){return e.id!==i.space.id}))));if(g.reduce((function(e,t){return e.add(t.id)}),new Set).size<g.length)return this.loading[i.id]=!1,this.override_state=null,this._service.notifyError("The meeting is already in this room");d.space=g,this.checkCollisions(g,a.valueOf(),i.duration,i.icaluid).then((function(){t.moveBooking(s,d).then((function(e){t.override_state=null,t._service.notifySuccess(l)}),(function(e){t.loading[i.id]=!1,t.override_state=null,"User cancelled"!==e&&t._service.notifyError("Error: ".concat(e))}))}),(function(){t.loading[i.id]=!1,t.override_state=null,t._service.notifyError("Updated meeting time clashes with another")}))}}},{key:"checkCollisions",value:function(e,t,n,i){var o=this;return new Promise((function(r,a){o._service.Spaces.available({room_ids:e.map((function(e){return e.id})).join(","),date:t,duration:n,ignore:i,hide_bookings:!0}).then((function(t){t.length===e.length?r():a()}),(function(){return a()}))}))}},{key:"moveBooking",value:function(e,t){var n=this;return new Promise((function(i,o){var r=n._dialog.open(M.b,{data:{title:"Update meeting",content:e,icon:{type:"icon",class:"material-icons",content:"event_available"},action:"Ok"}});n.subscription("confirm",r.componentInstance.event.subscribe((function(e){"done"===e.reason&&t.save().then((function(e){return i(e)}),(function(e){return o(e)})),r.close()}))),r.afterClosed().subscribe((function(){return n.unsub("confirm")}))}))}},{key:"events",get:function(){var e=this;return this.space?(this.space.bookingsFor(this.date)||[]).filter((function(t){return e.override_state&&e.override_state===t.icaluid&&(e.loading[t.id]=!0),t.declined?(!e.overflow_only||t.setup||t.breakdown)&&e.legend.declined:(!e.overflow_only||t.setup||t.breakdown)&&e.legend[t.type]})):[]}}]),n}(r.a)).\u0275fac=function(e){return new(e||N)(l.Qb(d.a),l.Qb(g.b))},N.\u0275cmp=l.Kb({type:N,selectors:[["day-view-space"]],viewQuery:function(e,t){var n;1&e&&l.Cc(T,!0),2&e&&l.sc(n=l.fc())&&(t.view=n.first)},inputs:{space_list:"space_list",date:"date",space:"space",scroll:"scroll",overflow_only:"overflow_only",legend:"legend",scroll_top:["scrollTop","scroll_top"],last_update:["lastUpdate","last_update"]},outputs:{inView:"inView",dragging:"dragging"},features:[l.zb,l.Ab],decls:5,vars:10,consts:[["cdkDropList","","cdkDropListSortingDisabled","","scrollContainer","#day-view-scroll",1,"space-display",3,"cdkDropListConnectedTo","cdkDropListData","id","cdkDropListDropped"],["view",""],["cdkDrag","",1,"drop-zone"],["cdkDrag","",3,"display","cdkDragDisabled","cdkDragStarted","cdkDragMoved","cdkDragReleased",4,"ngFor","ngForOf","ngForTrackBy"],["class","moving",4,"ngIf"],["cdkDrag","",3,"cdkDragDisabled","cdkDragStarted","cdkDragMoved","cdkDragReleased"],[3,"space","date","event","loading","overlap","position"],["class","event-preview",4,"cdkDragPreview"],["class","event-placeholder",3,"top","height",4,"cdkDragPlaceholder"],[1,"event-preview"],[1,"content"],[3,"fixed","space","event"],[1,"event-placeholder"],[1,"moving"],[1,"text"],[1,"spinner"],["diameter","32"]],template:function(e,t){1&e&&(l.Wb(0,"div",0,1),l.ec("cdkDropListDropped",(function(e){return t.drop(e)})),l.Rb(2,"div",2),l.Ec(3,H,4,8,"div",3),l.Vb(),l.Ec(4,L,5,0,"div",4)),2&e&&(l.oc("cdkDropListConnectedTo",t.space_list||l.pc(6,Q))("cdkDropListData",l.rc(7,Y,t.top,t.events))("id","space-col-"+(null==t.space?null:t.space.id)),l.Cb(3),l.oc("ngForOf",t.events)("ngForTrackBy",t.trackByFn),l.Cb(1),l.oc("ngIf",t.override_state))},directives:[y.e,w.a,y.a,i.s,i.t,j,y.d,y.c,k.c],styles:[".space-display[_ngcontent-%COMP%]{position:relative;height:100%;width:100%;overflow:hidden;pointer-events:auto}.event-preview[_ngcontent-%COMP%], .space-display[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{pointer-events:none}.event-placeholder[_ngcontent-%COMP%]{position:absolute;width:calc(100% - .5em);margin:0 .25em;border:3px dashed #969696;background-color:rgba(0,0,0,.2);border-radius:4px;transform:none!important;z-index:99999}.drop-zone[_ngcontent-%COMP%]{position:relative;height:100%;width:100%;pointer-events:none}.cdk-drag[_ngcontent-%COMP%], .drop-zone[_ngcontent-%COMP%]{transform:none!important}.cdk-drag[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.cdk-drag-disabled[_ngcontent-%COMP%]{cursor:auto}.moving[_ngcontent-%COMP%]{position:fixed;bottom:1.5em;left:50%;transform:translateX(-50%);padding:.5em 1em;border-radius:1.5em;display:flex;align-items:center;background-color:#fff;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12);z-index:999}.moving[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{margin-left:.5em}.moving[_ngcontent-%COMP%]   spinner[_ngcontent-%COMP%]{font-size:.25em}"]}),N),U=n("R0Ic"),$=n("4kJo"),q=n("q/DJ");function K(e,t){1&e&&l.Rb(0,"div")}var J=function(){return{class:"material-icons",content:"email"}},Z=function(){return{class:"material-icons",content:"phone"}};function ee(e,t){if(1&e&&(l.Wb(0,"div",19),l.Wb(1,"label"),l.Gc(2,"Booked by:"),l.Vb(),l.Wb(3,"div",20),l.Wb(4,"div",7),l.Gc(5),l.Vb(),l.Wb(6,"div",21),l.Wb(7,"a",22),l.Rb(8,"app-icon",9),l.Vb(),l.Wb(9,"a",22),l.Rb(10,"app-icon",9),l.Vb(),l.Vb(),l.Vb(),l.Vb()),2&e){var n=l.ic(3);l.Cb(5),l.Hc(null==n.event.creator?null:n.event.creator.name),l.Cb(2),l.oc("href","mailto:"+(null==n.event.creator?null:n.event.creator.email),l.yc)("disabled",!(null!=n.event.creator&&n.event.creator.email)),l.Cb(1),l.oc("icon",l.pc(7,J)),l.Cb(1),l.oc("href","tel:"+(null==n.event.creator?null:n.event.creator.phone),l.yc)("disabled",!(null!=n.event.creator&&n.event.creator.phone)),l.Cb(1),l.oc("icon",l.pc(8,Z))}}function te(e,t){if(1&e&&(l.Wb(0,"div",26),l.Gc(1),l.Vb()),2&e){var n=t.$implicit;l.Cb(1),l.Hc(n.name)}}function ne(e,t){if(1&e&&(l.Wb(0,"div",19),l.Wb(1,"label"),l.Gc(2,"Notes:"),l.Vb(),l.Rb(3,"div",27),l.jc(4,"safe"),l.Vb()),2&e){var n=l.ic(3);l.Cb(3),l.oc("innerHTML",l.kc(4,1,n.description||""),l.xc)}}function ie(e,t){if(1&e&&(l.Wb(0,"div",18),l.Wb(1,"div",19),l.Wb(2,"label"),l.Gc(3,"Host:"),l.Vb(),l.Wb(4,"div",20),l.Wb(5,"div",7),l.Gc(6),l.Vb(),l.Wb(7,"div",21),l.Wb(8,"a",22),l.Rb(9,"app-icon",9),l.Vb(),l.Wb(10,"a",22),l.Rb(11,"app-icon",9),l.Vb(),l.Vb(),l.Vb(),l.Vb(),l.Ec(12,ee,11,9,"div",23),l.Wb(13,"div",24),l.Wb(14,"label"),l.Gc(15,"Attendees:"),l.Vb(),l.Wb(16,"div",20),l.Ec(17,te,2,1,"div",25),l.Vb(),l.Vb(),l.Wb(18,"div",19),l.Wb(19,"label"),l.Gc(20,"Welcomed by:"),l.Vb(),l.Wb(21,"div",20),l.Gc(22),l.Vb(),l.Vb(),l.Wb(23,"div",19),l.Wb(24,"label"),l.Gc(25,"Catering:"),l.Vb(),l.Wb(26,"div",20),l.Gc(27),l.Vb(),l.Vb(),l.Ec(28,ne,5,3,"div",23),l.Vb()),2&e){var n=l.ic(2);l.oc("@show",void 0),l.Cb(6),l.Hc(null==n.event.organiser?null:n.event.organiser.name),l.Cb(2),l.oc("href","mailto:"+(null==n.event.organiser?null:n.event.organiser.email),l.yc)("disabled",!(null!=n.event.organiser&&n.event.organiser.email)),l.Cb(1),l.oc("icon",l.pc(13,J)),l.Cb(1),l.oc("href","tel:"+(null==n.event.organiser?null:n.event.organiser.phone),l.yc)("disabled",!(null!=n.event.organiser&&n.event.organiser.phone)),l.Cb(1),l.oc("icon",l.pc(14,Z)),l.Cb(1),l.oc("ngIf",n.event.creator&&n.event.organiser&&n.event.organiser.email!==n.event.creator.email),l.Cb(5),l.oc("ngForOf",n.event.attendees),l.Cb(5),l.Hc(n.notifyee),l.Cb(5),l.Hc(n.has_catering?"Catered":"No Catering"),l.Cb(1),l.oc("ngIf",n.description)}}function oe(e,t){1&e&&(l.Wb(0,"div",28),l.Wb(1,"div",29),l.Wb(2,"div",30),l.Rb(3,"mat-spinner",31),l.Vb(),l.Wb(4,"div",7),l.Gc(5,"Processing request..."),l.Vb(),l.Vb(),l.Vb())}var re=function(){return{class:"material-icons",content:"search"}},ae=function(e){return{class:"material-icons",content:e}};function ce(e,t){if(1&e){var n=l.Xb();l.Wb(0,"div"),l.Wb(1,"div",1),l.Wb(2,"div",2),l.Rb(3,"a-user-avatar",3),l.Vb(),l.Wb(4,"div",4),l.Wb(5,"div",5),l.Gc(6),l.Ec(7,K,1,0,"div",6),l.Vb(),l.Wb(8,"div",7),l.Gc(9),l.Vb(),l.Vb(),l.Wb(10,"button",8),l.ec("touchrelease",(function(){return l.wc(n),l.ic().view()})),l.Rb(11,"app-icon",9),l.Vb(),l.Vb(),l.Wb(12,"div",10),l.Wb(13,"div",11),l.Rb(14,"div",12),l.Wb(15,"app-icon",13),l.ec("touchrelease",(function(){l.wc(n);var e=l.ic();return e.shown=!e.shown})),l.Vb(),l.Rb(16,"div",12),l.Vb(),l.Ec(17,ie,29,15,"div",14),l.Vb(),l.Wb(18,"div",15),l.Wb(19,"button",16),l.ec("touchrelease",(function(){return l.wc(n),l.ic().accept()})),l.Gc(20),l.Vb(),l.Wb(21,"button",16),l.ec("touchrelease",(function(){return l.wc(n),l.ic().decline()})),l.Gc(22),l.Vb(),l.Vb(),l.Ec(23,oe,6,0,"div",17),l.Vb()}if(2&e){var i=l.ic();l.Eb("approval-event"+(i.type?" "+i.type:"")),l.Db("event-id",i.event.id),l.Cb(3),l.oc("user",i.event.organiser),l.Cb(3),l.Jc(" ",i.event.all_day?"All Day":i.event.start_time+" - "+i.event.end_time," ",i.event.space?"in "+i.event.space.name:""," "),l.Cb(1),l.oc("ngIf",i.was_edited),l.Cb(2),l.Ic("",i.event.title," "),l.Cb(2),l.oc("icon",l.pc(18,re)),l.Cb(4),l.oc("icon",l.qc(19,ae,"keyboard_arrow_"+(i.shown?"up":"down"))),l.Cb(2),l.oc("ngIf",i.shown),l.Cb(2),l.Gb("accepted",i.event.approved),l.Cb(1),l.Ic(" Accept",i.event.approved?"ed":""," "),l.Cb(1),l.Gb("declined",i.event.declined),l.Cb(1),l.Ic(" Decline",i.event.declined?"d":""," "),l.Cb(1),l.oc("ngIf",i.loading)}}var se,le={},de=((se=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i){var o;return _classCallCheck(this,n),(o=t.call(this))._service=e,o._dialog=i,o.acting=new l.o,o}return _createClass(n,[{key:"view",value:function(){var e=this;this.timeout("view",(function(){e._dialog.open(_.a,{data:{booking:e.event}}),e._service.set("CONCIERGE.day_view.viewing",e.event)}),50)}},{key:"accept",value:function(){var e=this;this.acting.emit(!0);var t=this._dialog.open(M.b,{data:{title:"Approve Meeting",content:"Approve ".concat(this.event.organiser.name||this.event.organiser,"'s meeting in \"").concat(this.event.space.name,'" at ').concat(this.event.start_time," for ").concat(this.event.length_string," on ").concat(this.event.date_string),icon:{type:"icon",class:"material-icons",content:"event_available"},action:"Ok"}});t.componentInstance.event.subscribe((function(n){"done"===n.reason&&(e.loading=!0,e._service.Bookings.accept(e.event.id,{comment:"",room_id:e.event.space.id}).then((function(){e._service.notifySuccess("Meeting approved."),e.event.approval_status[e.event.space.id]="accepted",le[e.event.id]="accepted",e._service.set("BOOKING.states",le),e.loading=!1,e.acting.emit(!1)}),(function(){e.acting.emit(!1),e._service.notifyError("Error approving meeting."),e.loading=!1}))),t.close()}))}},{key:"decline",value:function(){var e=this;this.acting.emit(!0);var t=this._dialog.open(M.b,{data:{title:"Decline Meeting",content:"Decline ".concat(this.event.organiser.name||this.event.organiser,"'s meeting in \"").concat(this.event.space.name,'" at ').concat(this.event.start_time," for ").concat(this.event.length_string," on ").concat(this.event.date_string),icon:{type:"icon",class:"material-icons",content:"event_busy"},action:"Ok"}});t.componentInstance.event.subscribe((function(n){if("done"===n.reason){e.loading=!0;var i=e.event;e.loading=!0,e._service.Bookings.decline(i.id,{booking_id:i.id,organiser:i.organiser.email,icaluid:i.icaluid,start:Math.floor(i.date/1e3),end:Math.floor(i.date/1e3)+60*i.duration,room_id:i.space.id}).then((function(){e._service.notifySuccess("Meeting declined."),e.event.approval_status[i.space.id]="declined",le[e.event.id]="declined",e._service.set("BOOKING.states",le),e.loading=!1,e.acting.emit(!1)}),(function(){e.acting.emit(!1),e._service.notifyError("Error declining meeting."),e.loading=!1}))}t.close()}))}},{key:"was_edited",get:function(){return this.event&&this.event.edits.length>0}},{key:"type",get:function(){return this.event?this.event.type:""}},{key:"notifyee",get:function(){return"Concierge"}},{key:"description",get:function(){return this.event&&this.event.notes?(this.event.notes.find((function(e){return"description"===e.type}))||{message:""}).message:""}},{key:"has_catering",get:function(){var e=this;return!!this.event&&!!(this.event.catering||[]).find((function(t){return e.event.space.id===t.location_id}))}}]),n}(r.a)).\u0275fac=function(e){return new(e||se)(l.Qb(d.a),l.Qb(g.b))},se.\u0275cmp=l.Kb({type:se,selectors:[["approvals-event"]],inputs:{event:"event"},outputs:{acting:"acting"},features:[l.zb],decls:1,vars:1,consts:[[3,"class",4,"ngIf"],[1,"header"],[1,"avatar"],[3,"user"],[1,"details"],[1,"text","bold"],[4,"ngIf"],[1,"text"],["mat-icon-button","",1,"search",3,"touchrelease"],[3,"icon"],[1,"body"],[1,"control"],[1,"bar"],[3,"icon","touchrelease"],["class","contents",4,"ngIf"],[1,"footer"],["mat-button","",1,"inverse",3,"touchrelease"],["class","load-state",4,"ngIf"],[1,"contents"],[1,"field"],[1,"value"],[1,"actions"],["mat-icon-button","",3,"href","disabled"],["class","field",4,"ngIf"],[1,"field","multiline"],["class","attendee",4,"ngFor","ngForOf"],[1,"attendee"],[1,"value",3,"innerHTML"],[1,"load-state"],[1,"no-item","center"],[1,"icon"],["diameter","32"]],template:function(e,t){1&e&&l.Ec(0,ce,24,21,"div",0),2&e&&l.oc("ngIf",t.event)},directives:[i.t,$.a,x.b,C.c,P.a,x.a,i.s,k.c],pipes:[q.b],styles:[".approval-event[_ngcontent-%COMP%]{position:relative;width:100%;background-color:#fff;font-size:.8em;margin:.5em 1px;border:2px solid #1f40e6;border-right-width:4px}.approval-event.internal[_ngcontent-%COMP%]{border-color:#e69fc7}.approval-event.external[_ngcontent-%COMP%]{border-color:#8c5ac8}.approval-event.training[_ngcontent-%COMP%]{border-color:#f0e700}.approval-event.interview[_ngcontent-%COMP%]{border-color:#348d02}.approval-event.setup[_ngcontent-%COMP%]{border-color:#d32f2f}.approval-event.cancelled[_ngcontent-%COMP%]{border-color:#617288}.header[_ngcontent-%COMP%]{display:flex;align-items:center;padding:1em}.avatar[_ngcontent-%COMP%]{font-size:1.2em}.details[_ngcontent-%COMP%]{padding:.5em;max-width:calc(100% - 4em)}.footer[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;width:100%}.load-state[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;background-color:hsla(0,0%,100%,.85)}.control[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:0 1em;margin-bottom:.5em}.control[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{height:1px;min-width:1px;flex:1;background-color:#ccc}.control[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{height:1em;width:1em;font-size:1.5em;margin:0 .5em;cursor:pointer}.contents[_ngcontent-%COMP%]{padding:0 1em 1em;overflow:hidden}.text[_ngcontent-%COMP%]{display:flex;align-items:center}.text[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{height:6px;width:6px;border-radius:100%;background-color:#ffb300;margin:.25em}.field[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:.5em}.field[_ngcontent-%COMP%]:last-child{margin-bottom:0}.field[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{display:flex;align-items:center;padding:0 .5em}.field[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{flex:1;min-width:50%}.field.multiline[_ngcontent-%COMP%]{align-items:flex-start}.field.multiline[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.no-item[_ngcontent-%COMP%]{font-size:.6em;color:#000}.no-item[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{margin:0;font-size:.75em}button[mat-button][_ngcontent-%COMP%]{flex:1;min-width:30%;background-color:#f7f8ff;transition:color .2s,background-color .2s;border:1px solid #ccc;color:rgba(0,0,0,.85);cursor:pointer}button[mat-button].accepted[_ngcontent-%COMP%], button[mat-button].declined[_ngcontent-%COMP%]{pointer-events:none;color:#fff}button[mat-button].accepted[_ngcontent-%COMP%]{background-color:#43a047}button[mat-button].declined[_ngcontent-%COMP%]{background-color:#e53935}.bold[_ngcontent-%COMP%]{font-weight:500}.actions[_ngcontent-%COMP%]{display:flex;align-items:center}[mat-icon-button][_ngcontent-%COMP%]{background-color:#1937ea;color:#fff;border:1px solid #1937ea;margin:.3em}[mat-icon-button][disabled][_ngcontent-%COMP%]{background-color:#f0f0f0;color:rgba(0,0,0,.35);border-color:rgba(0,0,0,.35)}[mat-icon-button].search[_ngcontent-%COMP%]{position:absolute;top:.5em;right:.5em;font-size:.8em}"],data:{animation:[Object(U.n)("show",[Object(U.m)(":enter",[Object(U.l)({opacity:0,height:0}),Object(U.e)(200,Object(U.l)({opacity:1,height:"*"}))]),Object(U.m)(":leave",[Object(U.l)({opacity:1,height:"*"}),Object(U.e)(200,Object(U.l)({opacity:0,height:0}))])])]}}),se);function ge(e,t){if(1&e){var n=l.Xb();l.Wb(0,"approvals-event",9),l.ec("acting",(function(e){return l.wc(n),l.ic(2).waiting_on_event=e})),l.Vb()}2&e&&l.oc("event",t.$implicit)}function ve(e,t){if(1&e&&(l.Wb(0,"div",4),l.Wb(1,"div",5),l.Rb(2,"div",6),l.Wb(3,"div",7),l.Gc(4),l.Vb(),l.Rb(5,"div",6),l.Vb(),l.Ec(6,ge,1,1,"approvals-event",8),l.Vb()),2&e){var n=l.ic();l.Cb(4),l.Hc(n.date_display),l.Cb(2),l.oc("ngForOf",n.events)("ngForTrackBy",n.trackByFn)}}function ue(e,t){1&e&&(l.Wb(0,"div",10),l.Wb(1,"div",11),l.Wb(2,"div",12),l.Rb(3,"mat-spinner",13),l.Vb(),l.Vb(),l.Vb())}function be(e,t){1&e&&(l.Wb(0,"div",15),l.Wb(1,"div",12),l.Wb(2,"i",16),l.Gc(3,"close"),l.Vb(),l.Vb(),l.Wb(4,"div",17),l.Gc(5,"No meetings pending approval"),l.Vb(),l.Vb())}function fe(e,t){if(1&e&&l.Ec(0,be,6,0,"div",14),2&e){var n=l.ic();l.oc("ngIf",!n.loading)}}var pe,he=((pe=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var i;return _classCallCheck(this,n),(i=t.call(this))._service=e,i.events=[],i.space_list=[],i}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;this.subscription("building",this._service.listen("APP.level",(function(t){var n=e._service.Organisation.building;e.space_list=e._service.Spaces.list((function(e){return e.zones.indexOf(-1===t?n.id:t)>=0})).map((function(e){return e.name})),e.processMeetings(),e.getMonthlyPending()}))),this.getMonthlyPending(),this.interval("monthly_pending",(function(){return e.getMonthlyPending()}),6e5)}},{key:"ngOnChanges",value:function(e){var t=this;e.date&&(this.events=[],this.processMeetings(),this.interval("process_meetings",(function(){return t.processMeetings()}),1e3),m(e.date.previousValue).isSame(m(e.date.currentValue),"M")||(this.getMonthlyPending(),this.interval("monthly_pending",(function(){return t.getMonthlyPending()}),6e5)))}},{key:"trackByFn",value:function(e,t){return t.id||e}},{key:"updateMeetings",value:function(){var e=this,t=this._service.get("APP.level"),n=-1===t?this._service.Organisation.building.id:t,i=m(this.date).startOf("d"),o=i.endOf("d");this.loading=!0,this._service.Spaces.query({zone_ids:n,available_from:i.unix(),available_to:o.unix()}).then((function(t){e.space_list=t.map((function(e){return e.id})),e.processMeetings(),e.loading=!1}))}},{key:"processMeetings",value:function(){if(!this.waiting_on_event){this.events=this.process(this.date);var e=this._service.get("CONCIERGE.pending_bookings")||{};e[m(this.date).format("YYYY-MM-DD")]=this.events.length,this._service.set("CONCIERGE.pending_bookings",e)}}},{key:"process",value:function(e){var t,n=[],i=_createForOfIteratorHelper(this.space_list);try{for(i.s();!(t=i.n()).done;){var o=t.value,r=this._service.Spaces.item(o);r&&(n=n.concat(r.bookingsFor(e).filter((function(e){return e.tentative}))))}}catch(a){i.e(a)}finally{i.f()}return n.sort((function(e,t){return e.date-t.date}))}},{key:"getMonthlyPending",value:function(){var e=this,t=m().startOf("d"),n=m(this.date).startOf("M"),i=n.endOf("M");if(!t.isAfter(i,"m")){t.isAfter(n,"m")&&(n=t);var o=this._service.get("APP.level"),r=(-1===o?null:o)||this._service.Organisation.building.id;console.log("Get Monthly:",n.format("MMMM YYYY")),this._service.Spaces.query({zone_ids:r,available_from:n.unix(),available_to:i.unix()}).then((function(t){for(var o=e._service.get("CONCIERGE.pending_bookings")||{},r=n;r.isBefore(i,"m");r=r.add(1,"d")){var a=e.process(r.valueOf());o[r.format("YYYY-MM-DD")]=a.length}e._service.set("CONCIERGE.pending_bookings",o)}))}}},{key:"date_display",get:function(){var e=m().startOf("d"),t=m(this.date).startOf("d");return e.isSame(t,"d")?"Today":1===t.diff(e,"d")?"Tomorrow":1===e.diff(t,"d")?"Yesterday":t.format("DD MMM YYYY")}}]),n}(r.a)).\u0275fac=function(e){return new(e||pe)(l.Qb(d.a))},pe.\u0275cmp=l.Kb({type:pe,selectors:[["day-view-approvals-view"]],inputs:{date:"date"},features:[l.zb,l.Ab],decls:5,vars:3,consts:[[1,"approvals-view"],["class","content",4,"ngIf","ngIfElse"],["class","load-state",4,"ngIf"],["empty_state",""],[1,"content"],[1,"date"],[1,"bar"],[1,"display"],[3,"event","acting",4,"ngFor","ngForOf","ngForTrackBy"],[3,"event","acting"],[1,"load-state"],[1,"no-item","center"],[1,"icon"],["diameter","32"],["class","info-block center",4,"ngIf"],[1,"info-block","center"],[1,"material-icons"],[1,"text"]],template:function(e,t){if(1&e&&(l.Wb(0,"div",0),l.Ec(1,ve,7,3,"div",1),l.Ec(2,ue,4,0,"div",2),l.Vb(),l.Ec(3,fe,1,1,"ng-template",null,3,l.Fc)),2&e){var n=l.tc(4);l.Cb(1),l.oc("ngIf",t.events&&t.events.length)("ngIfElse",n),l.Cb(1),l.oc("ngIf",t.loading)}},directives:[i.t,i.s,de,k.c],styles:[".approvals-view[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden auto;background-color:#eee}.no-item[_ngcontent-%COMP%]{font-size:.7em}.date[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;margin:.5em 0}.bar[_ngcontent-%COMP%]{height:1px;min-width:1px;flex:1}.bar[_ngcontent-%COMP%], .display[_ngcontent-%COMP%]{background-color:#707070}.display[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:.5em 1.5em;height:1.5em;border-radius:.8em;color:#fff;font-size:.8em}.load-state[_ngcontent-%COMP%]{position:absolute;left:50%;bottom:4px;transform:translateX(-50%);background-color:#fff;z-index:999;border-radius:4px;height:3em;width:3em;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.load-state[_ngcontent-%COMP%]   spinner[_ngcontent-%COMP%]{font-size:.4em}"]}),pe),_e=["scroll_area"];function me(e,t){1&e&&(l.Wb(0,"div",17),l.Rb(1,"mat-progress-bar",18),l.Vb())}function Ce(e,t){if(1&e&&(l.Wb(0,"div",19),l.Wb(1,"div",20),l.Wb(2,"div",4),l.Gc(3),l.Vb(),l.Rb(4,"div",21),l.Vb(),l.Wb(5,"div",22),l.Gc(6),l.Vb(),l.Vb()),2&e){var n=t.$implicit;l.oc("title",n.long_name),l.Cb(3),l.Hc(n.name),l.Cb(3),l.Jc(" Capacity - ",n.capacity||"0"," ",1===n.capacity?"person":"people"," ")}}function Oe(e,t){if(1&e){var n=l.Xb();l.Wb(0,"div",23),l.Wb(1,"div",19),l.Wb(2,"div",4),l.Gc(3,"Holding Bay"),l.Vb(),l.Rb(4,"div",21),l.Vb(),l.Wb(5,"div",24),l.ec("touchrelease",(function(){l.wc(n);var e=l.ic();return e.show_holding_bay=!e.show_holding_bay})),l.Wb(6,"div",21),l.Wb(7,"i",25),l.Gc(8),l.Vb(),l.Vb(),l.Vb(),l.Vb()}if(2&e){var i=l.ic();l.Gb("show",i.show_holding_bay),l.Cb(1),l.oc("title",i.holding_bay.name),l.Cb(7),l.Hc(i.show_holding_bay?"keyboard_arrow_right":"event_available")}}function ye(e,t){if(1&e&&(l.Wb(0,"div",26),l.Wb(1,"div",27),l.Gc(2),l.Vb(),l.Vb()),2&e){var n=t.$implicit,i=l.ic();l.Cb(1),l.Gb("active",i.is_today&&n.id===i.active_hour),l.Cb(1),l.Ic(" ",n.name," ")}}function Me(e,t){1&e&&(l.Wb(0,"div",26),l.Rb(1,"div",28),l.Vb())}function we(e,t){if(1&e){var n=l.Xb();l.Wb(0,"div",29),l.Wb(1,"day-view-space",30),l.ec("dragging",(function(e){return l.wc(n),l.ic().dragChange(e)}))("inView",(function(e){l.wc(n);var i=t.$implicit;return l.ic().in_view[i.id]=e})),l.Vb(),l.Vb()}if(2&e){var i=t.$implicit,o=l.ic();l.Dc("min-height",3*o.time_blocks.length+"rem"),l.Cb(1),l.oc("space_list",o.space_zones)("date",o.date)("space",i)("legend",o.legend_map)("overflow_only",o.overflow_only)("scroll",0-o.scroll_left)("scrollTop",o.scroll_offset-o.scroll_top)("lastUpdate",o.last_update)}}function Pe(e,t){if(1&e&&(l.Wb(0,"div",31),l.jc(1,"safe"),l.Rb(2,"div",32),l.Vb()),2&e){var n=l.ic();l.Dc("top",l.lc(1,2,"calc("+n.now*n.time_blocks.length*3+"rem - "+n.scroll_top+"px)","style"))}}function ke(e,t){if(1&e){var n=l.Xb();l.Wb(0,"day-view-space",35),l.ec("dragging",(function(e){return l.wc(n),l.ic(2).dragChange(e)}))("inView",(function(e){l.wc(n);var t=l.ic(2);return t.in_view[t.holding_bay.id]=e})),l.Vb()}if(2&e){var i=l.ic(2);l.oc("date",i.date)("space",i.holding_bay)("lastUpdate",i.last_update)}}function xe(e,t){if(1&e&&(l.Wb(0,"div",23),l.Ec(1,ke,1,3,"day-view-space",33),l.Rb(2,"day-view-approvals-view",34),l.Vb()),2&e){var n=l.ic();l.Gb("show",n.show_holding_bay),l.Cb(1),l.oc("ngIf",n.holding_bay),l.Cb(1),l.oc("date",n.date)}}var Ve,We=((Ve=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i,o,r){var a;return _classCallCheck(this,n),(a=t.call(this))._service=e,a._route=i,a._renderer=o,a._dialog=r,a.legend=[],a.time_blocks=a.generateTimeBlocks(),a.scroll_top=0,a.scroll_left=0,a.scroll_offset=0,a.spaces=[],a.filtered_spaces=[],a.in_view={},a.loading_space={},a.last_update=0,a.show_holding_bay=!0,a}return _createClass(n,[{key:"onResize",value:function(){this.scroll_area.nativeElement&&(this.box=this.scroll_area.nativeElement.getBoundingClientRect())}},{key:"ngOnInit",value:function(){var e=this;this._service.initialised.pipe(Object(a.a)((function(e){return e}))).subscribe((function(){e.init(),e.updateTime(),e.interval("time",(function(){return e.updateTime()}),15e3)}))}},{key:"ngOnChanges",value:function(e){var t=this;if(this._service.Spaces.is_initialised){if(e.date&&(this.is_today=m().isSame(m(this.date),"d"),this.updateBookings(),this.interval("bookings",(function(){return t.updateBookings()}),3e4)),e.level){var n=this.level?this.level:(this._service.Organisation.building||{}).id;this.spaces=this._service.Spaces.list((function(e){return e.zones.indexOf(n)>=0}))||[],this.initSpaces(),this.updateBookings(),this.interval("bookings",(function(){return t.updateBookings()}),3e4)}e.room_type&&this.initSpaces()}else this._service.Spaces.initialised.pipe(Object(a.a)((function(e){return e}))).subscribe((function(){t.ngOnChanges(e)}))}},{key:"init",value:function(){var e=this;this._service.Spaces.initialised.pipe(Object(a.a)((function(e){return e}))).subscribe((function(){e._service.title="Day View",e.subscription("viewing",e._service.listen("CONCIERGE.day_view.viewing",(function(t){return e.scrollIntoView(t)}))),e.subscription("route.query",e._route.queryParamMap.subscribe((function(t){if(t.has("view")){e.view_id=t.get("view");var n=localStorage.getItem("CONCIERGE.view_booking");if(n){var i=new s.a(e._service.Bookings,JSON.parse(n));e.view(i),localStorage.removeItem("CONCIERGE.view_booking")}}}))),e.updateBookings(),e.interval("bookings",(function(){return e.updateBookings()}),3e4),e.interval("scroll",(function(){e.scroll_area&&e.scroll_area.nativeElement&&e.updateScroll({target:e.scroll_area.nativeElement})}),1e3),e.scroll_area.nativeElement&&(e.box=e.scroll_area.nativeElement.getBoundingClientRect())}))}},{key:"updateScroll",value:function(e){this.scroll_top=e.target.scrollTop,this.scroll_left=e.target.scrollLeft}},{key:"generateTimeBlocks",value:function(){for(var e=[],t=m().startOf("h"),n=0;n<24;n++)e.push({id:t.hour(n).format("HH:mm"),name:t.hour(n).format("h:mm A")});return e}},{key:"updateTime",value:function(){var e=m();this.now=(e.hour()+e.minute()/60)/24,this.active_hour=e.startOf("h").format("HH:mm")}},{key:"updateBookings",value:function(){var e=this,t=this.spaces.filter((function(t){return!1!==e.in_view[t.id]}));if(t.length){t.forEach((function(t){return e.loading_space[t.id]=!0}));var n=m(this.date).startOf("d"),i=n.endOf("d"),o=t.reduce((function(e,t){return e+(e?",":"")+t.id}),""),r=this._service.get("APP.level"),a=[-1===r?this._service.Organisation.building.id:r];this.space_type&&a.push(this.space_type),this.loading=!0,this._service.Spaces.query({room_ids:o,zone_ids:a.join(","),available_from:n.unix(),available_to:i.unix()}).then((function(t){t.forEach((function(t){if(e.view_id){var n=t.bookings.find((function(t){return t.id===e.view_id}));n&&e.view(n)}var i=e.filtered_spaces.find((function(e){return e.id===t.id}));i&&(i._bookings=t._bookings)})),delete e.loading_space,e.last_update=m().valueOf(),e.loading_space={},e.loading=!1}),(function(){return e.loading=!1}))}}},{key:"view",value:function(e){console.log("View:",e.id),this._dialog.open(_.a,{data:{booking:e}}),this.view_id=null}},{key:"scrollIntoView",value:function(e){if(e&&this.scroll_area&&this.scroll_area.nativeElement){var t=this.scroll_area.nativeElement.querySelector("#event-".concat(e.id));if(t){var n=this.scroll_area.nativeElement.getBoundingClientRect(),i=t.getBoundingClientRect();this.scroll_area.nativeElement.scrollTo({left:i.left-n.left+this.scroll_area.nativeElement.scrollLeft,top:i.top-n.top+this.scroll_area.nativeElement.scrollTop,behavior:"smooth"})}}}},{key:"scrollView",value:function(e,t){(e||t)&&(this.scroll_area.nativeElement.scrollTop+=t||0,this.scroll_area.nativeElement.scrollLeft+=e||0,(t&&this.scroll_area.nativeElement.scrollTop>=this.scroll_area.nativeElement.scrollHeight||e&&this.scroll_area.nativeElement.scrollLeft>=this.scroll_area.nativeElement.scrollWidth||t&&this.scroll_area.nativeElement.scrollTop<=0||e&&this.scroll_area.nativeElement.scrollLeft<=0)&&this.clearInterval("auto_scroll"),this.updateScroll({target:this.scroll_area.nativeElement}))}},{key:"clearSelected",value:function(){this._service.set("CONCIERGE.day_view.viewing",null)}},{key:"cancelScroll",value:function(){this.clearInterval("auto_scroll")}},{key:"dragChange",value:function(e){var t=this;e?(this.scroll_offset=this.scroll_area.nativeElement.scrollTop,this.subscription("listen_move",this._renderer.listen("window","mousemove",(function(e){var n=e.clientX,i=e.clientY,o=i>t.box.bottom-.05*t.box.height?1:i<t.box.top+.05*t.box.height?-1:0,r=n>t.box.right-.05*t.box.width?1:n<t.box.left+.05*t.box.height?-1:0;t.scrollView(5*r,5*o),t.interval("auto_scroll",(function(){return t.scrollView(10*r,10*o)}),10)}))),this.clearInterval("bookings")):(this.interval("bookings",(function(){return t.updateBookings()}),3e4),this.clearInterval("auto_scroll"),this.unsub("listen_move"))}},{key:"initSpaces",value:function(){var e=this,t=this.holding_bay;this.filtered_spaces=this.spaces.filter((function(n){return(!e.space_type||n.zones.indexOf(e.space_type)>=0)&&(!t||n.id!==t.id)&&n.bookable})),this.filtered_spaces.sort((function(e,t){return(e.name||"").localeCompare(t.name)}))}},{key:"legend_map",get:function(){var e={};return(this.legend||[]).forEach((function(t){return e[t]=!0})),e}},{key:"is_loading",get:function(){var e=this;return this.loading||Object.keys(this.loading_space).reduce((function(t,n){return t||e.loading_space[n]}),!1)}},{key:"holding_bay",get:function(){var e=this._service.Organisation.building;return e&&e.holding_bay?this._service.Spaces.item(e.holding_bay):null}},{key:"space_zones",get:function(){return this.spaces.map((function(e){return"space-col-".concat(e.id)}))}}]),n}(r.a)).\u0275fac=function(e){return new(e||Ve)(l.Qb(d.a),l.Qb(o.a),l.Qb(l.F),l.Qb(g.b))},Ve.\u0275cmp=l.Kb({type:Ve,selectors:[["day-view-timeline"]],viewQuery:function(e,t){var n;1&e&&l.Cc(_e,!0),2&e&&l.sc(n=l.fc())&&(t.scroll_area=n.first)},hostBindings:function(e,t){1&e&&l.ec("resize",(function(){return t.onResize()}),!1,l.vc)},inputs:{date:"date",level:"level",space_type:"space_type",legend:"legend",overflow_only:"overflow_only",loading:"loading"},features:[l.zb,l.Ab],decls:22,vars:14,consts:[[1,"timeline"],["class","loader",4,"ngIf"],[1,"header"],[1,"time-blocks"],[1,"text"],[1,"flex"],[1,"group"],["class","space-header",3,"title",4,"ngFor","ngForOf"],["class","sidebar",3,"show",4,"ngIf"],[1,"body",3,"touchrelease"],["class","block",4,"ngFor","ngForOf"],["id","day-view-scroll",1,"flex","content",3,"scroll"],["scroll_area",""],[1,"time-lines"],[1,"space-day"],["class","space","cdkDropListGroup","",3,"min-height",4,"ngFor","ngForOf"],["class","now-line",3,"top",4,"ngIf"],[1,"loader"],["mode","indeterminate"],[1,"space-header",3,"title"],[1,"details"],[1,"icon"],[1,"capacity"],[1,"sidebar"],[1,"tag",3,"touchrelease"],[1,"material-icons"],[1,"block"],["div","",1,"hour"],[1,"line"],["cdkDropListGroup","",1,"space"],[3,"space_list","date","space","legend","overflow_only","scroll","scrollTop","lastUpdate","dragging","inView"],[1,"now-line"],[1,"knob"],[3,"date","space","lastUpdate","dragging","inView",4,"ngIf"],[3,"date"],[3,"date","space","lastUpdate","dragging","inView"]],template:function(e,t){1&e&&(l.Wb(0,"div",0),l.Ec(1,me,2,0,"div",1),l.Wb(2,"div",2),l.Wb(3,"div",3),l.Wb(4,"div",4),l.Gc(5,"Time"),l.Vb(),l.Vb(),l.Wb(6,"div",5),l.Wb(7,"div",6),l.Ec(8,Ce,7,4,"div",7),l.Vb(),l.Vb(),l.Ec(9,Oe,9,4,"div",8),l.Vb(),l.Wb(10,"div",9),l.ec("touchrelease",(function(){return t.clearSelected()})),l.Wb(11,"div",3),l.Wb(12,"div",6),l.Ec(13,ye,3,3,"div",10),l.Vb(),l.Vb(),l.Wb(14,"div",11,12),l.ec("scroll",(function(e){return t.updateScroll(e)})),l.Wb(16,"div",13),l.Ec(17,Me,2,0,"div",10),l.Vb(),l.Wb(18,"div",14),l.Ec(19,we,2,10,"div",15),l.Vb(),l.Vb(),l.Ec(20,Pe,3,5,"div",16),l.Ec(21,xe,3,4,"div",8),l.Vb(),l.Vb()),2&e&&(l.Cb(1),l.oc("ngIf",t.is_loading),l.Cb(6),l.Dc("left",0-t.scroll_left+"px"),l.Cb(1),l.oc("ngForOf",t.filtered_spaces),l.Cb(1),l.oc("ngIf",t.holding_bay),l.Cb(3),l.Dc("top",0-t.scroll_top+"px"),l.Cb(1),l.oc("ngForOf",t.time_blocks),l.Cb(3),l.Dc("min-width",15*t.filtered_spaces.length+"rem"),l.Cb(1),l.oc("ngForOf",t.time_blocks),l.Cb(2),l.oc("ngForOf",t.filtered_spaces),l.Cb(1),l.oc("ngIf",t.is_today),l.Cb(1),l.oc("ngIf",t.holding_bay))},directives:[i.t,i.s,C.c,O.a,y.f,X,he],pipes:[q.b],styles:[".timeline[_ngcontent-%COMP%]{position:relative;height:100%;flex-direction:column;background-color:#ecf1f5}.header[_ngcontent-%COMP%], .timeline[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center}.header[_ngcontent-%COMP%]{border-bottom:1px solid #ccc;height:3em}.header[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%]{overflow:hidden;height:100%}.header[_ngcontent-%COMP%]   .group[_ngcontent-%COMP%]{position:absolute;display:flex;align-items:center;top:0;left:0;bottom:0}.header[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{margin-left:.5em}.header[_ngcontent-%COMP%]   spinner[_ngcontent-%COMP%]{font-size:.25em}.body[_ngcontent-%COMP%]{position:relative;width:100%;flex:1;min-height:50%;overflow:hidden}.body[_ngcontent-%COMP%], .body[_ngcontent-%COMP%]   .group[_ngcontent-%COMP%]{display:flex;align-items:center}.body[_ngcontent-%COMP%]   .group[_ngcontent-%COMP%]{position:absolute;flex-direction:column;top:0;left:0;right:0}.time-blocks[_ngcontent-%COMP%]{position:relative;width:6em;border-right:1px solid #ccc;height:100%;overflow:hidden}.time-blocks[_ngcontent-%COMP%]   .block[_ngcontent-%COMP%]:first-child{opacity:0}.time-blocks[_ngcontent-%COMP%] > .text[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:100%;width:100%}.flex[_ngcontent-%COMP%]{position:relative;flex:1;min-width:5em}.content[_ngcontent-%COMP%]{overflow:auto;background-color:#fff;height:100%}.time-lines[_ngcontent-%COMP%]{position:absolute;width:100%;pointer-events:none}.time-lines[_ngcontent-%COMP%]   .block[_ngcontent-%COMP%]{border-bottom:1px solid rgba(0,0,0,.1)}.time-lines[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]{position:absolute;top:50%;border-bottom:1px dashed rgba(0,0,0,.1);width:100%}.block[_ngcontent-%COMP%]{position:relative;width:100%;height:3rem;box-sizing:border-box;font-size:.8em}.hour[_ngcontent-%COMP%]{position:absolute;top:0;transform:translateY(-50%);text-align:center;width:100%;transition:color .2s}.hour.active[_ngcontent-%COMP%]{color:#1937ea}.space-header[_ngcontent-%COMP%]{flex-direction:column;border-right:1px solid rgba(0,0,0,.1);height:100%;width:15rem;padding:.25em 1em}.space-header[_ngcontent-%COMP%], .space-header[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.space-header[_ngcontent-%COMP%]   .capacity[_ngcontent-%COMP%]{font-size:.7em;text-align:center}.space-header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:.9em}.space-day[_ngcontent-%COMP%]{display:flex}.space[_ngcontent-%COMP%]{border-right:1px solid rgba(0,0,0,.1);min-height:50vh;min-width:15rem;max-width:15rem;pointer-events:none}.now-line[_ngcontent-%COMP%]{position:absolute;left:6em;right:0;top:0;border:1px solid #1937ea;pointer-events:none;z-index:101}.now-line[_ngcontent-%COMP%]   .knob[_ngcontent-%COMP%]{position:absolute;top:0;left:-1px;transform:translate(-50%,-50%);height:12px;width:12px;border-radius:100%;background-color:#1937ea}.sidebar[_ngcontent-%COMP%]{position:relative;border-left:1px solid #ccc;height:100%;background-color:rgba(0,0,0,.05);z-index:102;width:0;transition:width .2s}.sidebar.show[_ngcontent-%COMP%]{width:24em}.sidebar[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{border:none}.sidebar[_ngcontent-%COMP%]   .space-header[_ngcontent-%COMP%]{width:100%}.auto-scroll[_ngcontent-%COMP%]{position:absolute;top:3em;left:6em;right:0;bottom:0;pointer-events:none}@media only screen and (orientation:portrait) and (max-width:450px){.auto-scroll[_ngcontent-%COMP%]{display:none}}@media only screen and (orientation:landscape) and (max-width:800px){.auto-scroll[_ngcontent-%COMP%]{display:none}}.auto-scroll[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{pointer-events:auto}.auto-scroll[_ngcontent-%COMP%]   .bottom[_ngcontent-%COMP%], .auto-scroll[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]{position:absolute;left:0;right:0;height:32px}.auto-scroll[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]{top:0}.auto-scroll[_ngcontent-%COMP%]   .bottom[_ngcontent-%COMP%]{bottom:0}.auto-scroll[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%], .auto-scroll[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;width:32px}.auto-scroll[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{top:0}.auto-scroll[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{bottom:0}.tag[_ngcontent-%COMP%]{position:absolute;left:1px;top:50%;height:2.5em;transform:translate(-100%,-50%);border-radius:1.3em 0 0 1.3em;background-color:#fff;border:1px solid #ccc!important;border-right:none!important}.tag[_ngcontent-%COMP%], .tag[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{display:flex;align-items:center}.tag[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{justify-content:center;height:1.25em;width:1.25em;font-size:2em;margin:0 .1em}.loader[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;right:0;height:4px;z-index:999}"]}),Ve),Ee=n("FKr1");function Ie(e,t){if(1&e&&(l.Wb(0,"mat-option",15),l.Gc(1),l.Vb()),2&e){var n=t.$implicit;l.oc("value",n.id),l.Cb(1),l.Ic(" ",n.name," ")}}function De(e,t){if(1&e){var n=l.Xb();l.Wb(0,"mat-form-field",5),l.Wb(1,"mat-select",14),l.ec("ngModelChange",(function(e){return l.wc(n),l.ic().active_level=e}))("ngModelChange",(function(){return l.wc(n),l.ic().updateLevel()})),l.Ec(2,Ie,2,2,"mat-option",7),l.Vb(),l.Vb()}if(2&e){var i=l.ic();l.Cb(1),l.oc("ngModel",i.active_level),l.Cb(1),l.oc("ngForOf",i.levels)}}function Se(e,t){if(1&e&&(l.Wb(0,"mat-option",15),l.Gc(1),l.Vb()),2&e){var n=t.$implicit;l.oc("value",n.id),l.Cb(1),l.Ic(" ",n.name," ")}}function Ge(e,t){if(1&e){var n=l.Xb();l.Wb(0,"mat-form-field",5),l.Wb(1,"mat-select",14),l.ec("ngModelChange",(function(e){return l.wc(n),l.ic().active_type=e})),l.Ec(2,Se,2,2,"mat-option",7),l.Vb(),l.Vb()}if(2&e){var i=l.ic();l.Cb(1),l.oc("ngModel",i.active_type),l.Cb(1),l.oc("ngForOf",i.space_types)}}function Re(e,t){if(1&e&&(l.Wb(0,"mat-option",15),l.Wb(1,"div",16),l.Wb(2,"div",13),l.Gc(3),l.Vb(),l.Wb(4,"div",17),l.Rb(5,"div",18),l.Vb(),l.Vb(),l.Vb()),2&e){var n=t.$implicit;l.oc("value",n.id),l.Cb(3),l.Hc(n.name),l.Cb(2),l.Dc("background-color",n.color)}}var ze,Ae=((ze=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i,o,r){var a;return _classCallCheck(this,n),(a=t.call(this))._service=e,a._dialog=i,a._router=o,a._route=r,a.active_level="",a.active_type="",a.levels=[],a.space_types=[],a.legend=[],a.legend_keys=[{name:"Internal",id:"internal",color:"#E69FC7"},{name:"Client",id:"client",color:"#1F40E6"},{name:"External",id:"external",color:"#8C5AC8"},{name:"Setup",id:"setup",color:"#d32f2f"},{name:"Training",id:"training",color:"#F0E700"},{name:"Interview",id:"interview",color:"#348D02"}],a}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;this._service.initialised.pipe(Object(a.a)((function(e){return e}))).subscribe((function(){e.legend=e.legend_keys.map((function(e){return"".concat(e.id)})),e.subscription("route.params",e._route.paramMap.subscribe((function(t){if(t.has("level")&&e.active_level!==t.get("level")){var n=e._service.Organisation.levelWithID(t.get("level"));if(n){var i=e._service.Organisation.buildings.find((function(e){return e.id===n.building_id}));i&&(e.active_level=n.id,e._service.Organisation.building=i)}}}))),e.subscription("building",e._service.Organisation.listen("active_building").subscribe((function(){var t=e._service.Organisation.building||{levels:[]};t.levels.find((function(t){return t.id===e.active_level}))||(e.active_level=(t.levels[0]||{id:""}).id,e.updateLevel()),e.levels=[{id:"",name:"All Levels"}].concat(t.levels||[]),e.levels.sort((function(e,t){return(e.name||"").localeCompare(t.name||"")})),e.space_types=[{id:"",name:"All Space Types"}].concat(e._service.Organisation.space_types)})))}))}},{key:"newMeeting",value:function(){this._dialog.open(c.a,{data:{booking:new s.a(this._service.Bookings,{})}})}},{key:"updateLevel",value:function(){this._router.navigate(["/day-view",this.active_level])}}]),n}(r.a)).\u0275fac=function(e){return new(e||ze)(l.Qb(d.a),l.Qb(g.b),l.Qb(o.c),l.Qb(o.a))},ze.\u0275cmp=l.Kb({type:ze,selectors:[["a-day-view"]],features:[l.zb],decls:22,vars:11,consts:[[1,"day-view"],[1,"group"],[3,"date","dateChange"],[1,"topbar"],["appearance","outline",4,"ngIf"],["appearance","outline"],["multiple","","placeholder","No items shown",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["labelPosition","before","title","Only show meetings with setup and breakdown times",3,"ngModel","ngModelChange"],[3,"date","level","legend","overflow_only","space_type"],["mat-button","",1,"new-item",3,"touchrelease"],[1,"content"],[1,"material-icons"],[1,"text"],[3,"ngModel","ngModelChange"],[3,"value"],[1,"key"],[1,"colour"],[1,"blob"]],template:function(e,t){1&e&&(l.Wb(0,"div",0),l.Rb(1,"a-sidebar"),l.Wb(2,"div",1),l.Wb(3,"a-topbar-header",2),l.ec("dateChange",(function(e){return t.date=e})),l.Wb(4,"div",3),l.Ec(5,De,3,2,"mat-form-field",4),l.Ec(6,Ge,3,2,"mat-form-field",4),l.Wb(7,"mat-form-field",5),l.Wb(8,"mat-select",6),l.ec("ngModelChange",(function(e){return t.legend=e})),l.Wb(9,"mat-select-trigger"),l.Gc(10,"Legend"),l.Vb(),l.Ec(11,Re,6,4,"mat-option",7),l.Vb(),l.Vb(),l.Wb(12,"mat-slide-toggle",8),l.ec("ngModelChange",(function(e){return t.only_overflow=e})),l.Gc(13," Only Setup/Breakdown "),l.Vb(),l.Vb(),l.Vb(),l.Wb(14,"main"),l.Rb(15,"day-view-timeline",9),l.Vb(),l.Vb(),l.Wb(16,"button",10),l.ec("touchrelease",(function(){return t.newMeeting()})),l.Wb(17,"div",11),l.Wb(18,"div",12),l.Gc(19,"add"),l.Vb(),l.Wb(20,"div",13),l.Gc(21,"New Meeting"),l.Vb(),l.Vb(),l.Vb(),l.Vb()),2&e&&(l.Cb(3),l.oc("date",t.date),l.Cb(2),l.oc("ngIf",t.levels&&t.levels.length>1),l.Cb(1),l.oc("ngIf",t.space_types&&t.space_types.length>1),l.Cb(2),l.oc("ngModel",t.legend),l.Cb(3),l.oc("ngForOf",t.legend_keys),l.Cb(1),l.oc("ngModel",t.only_overflow),l.Cb(3),l.oc("date",t.date)("level",t.active_level)("legend",t.legend)("overflow_only",t.only_overflow)("space_type",t.active_type))},directives:[v.a,u.a,i.t,b.b,f.a,p.r,p.u,f.c,i.s,h.a,We,x.b,C.c,Ee.g],styles:[".day-view[_ngcontent-%COMP%], [_nghost-%COMP%], main[_ngcontent-%COMP%]{height:100%;width:100%}.day-view[_ngcontent-%COMP%]{display:flex;height:100%}main[_ngcontent-%COMP%]{height:calc(100% - 3.5em)}.group[_ngcontent-%COMP%]{flex:1;min-width:12em}.topbar[_ngcontent-%COMP%]{padding:.1em 0 .1em .5em;height:3.5em}.topbar[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{margin-right:.5em;width:10em}.key[_ngcontent-%COMP%]{display:flex;align-items:center}.key[_ngcontent-%COMP%]:hover   .blob[_ngcontent-%COMP%]{height:16px;width:16px}.key[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{flex:1;min-width:50%}.key[_ngcontent-%COMP%]   .colour[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:16px;width:16px}.key[_ngcontent-%COMP%]   .blob[_ngcontent-%COMP%]{height:8px;width:8px;border-radius:100%;transition:height .2s,width .2s}.new-item[_ngcontent-%COMP%]{position:absolute;bottom:1em;right:1em;z-index:999;cursor:pointer;height:1.5em;min-width:1.5em;padding:0;border-radius:.8em;font-size:1.75em;border:none;transition:padding .2s;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12)}.new-item[_ngcontent-%COMP%], .new-item[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{align-items:center;justify-content:center}.new-item[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex}.new-item[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{width:0;overflow:hidden;opacity:0;transition:width .2s,opacity .2s;font-size:1.2rem}.new-item[_ngcontent-%COMP%]:hover{padding:0 .5em}.new-item[_ngcontent-%COMP%]:hover   .text[_ngcontent-%COMP%]{width:7em;opacity:1}"]}),ze),je=n("PCNd");n.d(t,"DayViewModule",(function(){return Be}));var Te,Fe=[{path:"",component:Ae},{path:":level",component:Ae},{path:"**",redirectTo:""}],Be=((Te=function e(){_classCallCheck(this,e)}).\u0275mod=l.Ob({type:Te}),Te.\u0275inj=l.Nb({factory:function(e){return new(e||Te)},imports:[[i.c,p.l,o.g.forChild(Fe),je.a]]}),Te)}}]);